{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/issues/aws-auto-scaling-group-pending/","result":{"data":{"markdownRemark":{"id":"e921c51b-e395-5028-9d23-844e9cdada33","html":"<p>운영중인 서비스의 Blue/Green 배포 중 신규 배포를 위한 Replacement의 Auto Scaling Group 내부에서 인스턴스가 제대로 생성되지 않는 문제가 발생했습니다.\n인스턴스가 생성되지 않으니 배포를 위한 준비를 할 수 없어 배포 자체를 진행할 수 없는 상황이었습니다.</p>\n<p>AWS Auto Scaling Group에서 인스턴스가 제대로 생성되지 않은 이유와 해결할 수 있는 방법을 정리합니다.</p>\n<h2 id=\"원인\" style=\"position:relative;\"><a href=\"#%EC%9B%90%EC%9D%B8\" aria-label=\"원인 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>원인</h2>\n<p>현재 운영중인 서비스에서 어플리케이션 배포를 위해 AWS의 CodeDeploy 서비스를 사용하고 있습니다.\nCodeDeploy 사용 시 신규로 올라온 인스턴스의 프로비저닝을 위해 Auto Scaling Group에 Lifecycle Hook이 자동으로 추가됩니다.\n해당 Hook은 Scale out 시 새로 추가된 장비에 LifeCycle Hook을 통해 기존 배포된 버전을 프로비저닝 하는 역할을 수행합니다.</p>\n<p>Blue/Green 배포가 정상적으로 종료되면 Original Auto Scaling Group의 Lifecycle Hook을 제거하는 과정이 수행되는데\n네트워크 이슈 등으로 ASG에서 Lifecycle Hook이 정상적으로 제거되지 않아 <code class=\"language-text\">Instance failed to complete user&#39;s Lifecycle Action</code>와 같은 에러 메세지와 함께 Pending이 발생된 것 으로 생각됩니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/1a867/aws-auto-scaling-group-pending-history.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.166666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAApUlEQVQI10WM25KCMBAF+f/vQ0U05GYSrBUCkUTf2shW7T509dSZmdN4MxIq45S4SsfhPNBdDcdecTxL2m7gdNEMOiDtuFtoz6HmbSfqTtGeBNr9cH8kmq28eVa2XEhbZpoXnK+PUqG0rdZIpekvAjFIbi788b3z4b7Pc1xrx4um5MxOybxKYV0XQvBYazDGYM2vvXNM04NliTtxnonxn5TW2lH4AIcU3kZ6Tpp3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/8ac56/aws-auto-scaling-group-pending-history.webp 240w,\n/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/d3be9/aws-auto-scaling-group-pending-history.webp 480w,\n/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/e46b2/aws-auto-scaling-group-pending-history.webp 960w,\n/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/f992d/aws-auto-scaling-group-pending-history.webp 1440w,\n/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/882b9/aws-auto-scaling-group-pending-history.webp 1920w,\n/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/3c376/aws-auto-scaling-group-pending-history.webp 1998w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/8ff5a/aws-auto-scaling-group-pending-history.png 240w,\n/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/e85cb/aws-auto-scaling-group-pending-history.png 480w,\n/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/d9199/aws-auto-scaling-group-pending-history.png 960w,\n/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/07a9c/aws-auto-scaling-group-pending-history.png 1440w,\n/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/29114/aws-auto-scaling-group-pending-history.png 1920w,\n/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/1a867/aws-auto-scaling-group-pending-history.png 1998w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/d9199/aws-auto-scaling-group-pending-history.png\"\n          alt=\"asg pending\"\n          title=\"asg pending\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<h2 id=\"해결\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0\" aria-label=\"해결 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해결</h2>\n<p>아래 Auto ScalingGroup의 Lifecycle Hook 탭에서 해당 Lifecycle Hook을 수동으로 제거하면 정상적으로 인스턴스 생성이 이루어집니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/691611b16d87e79feea60a2d2ea88789/7f7f8/auto-scaling-group-lifecycle-hook.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.833333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAAApUlEQVQY02WQ2w6DIBBE+f8v9EFD4wW8g5ZUwMZph0ReJDk5m80ySxDLsmAYBvR9j2makrdtg7U2s65r6u37Ds4bY/B5Gzg74nsG8FzXlSw43LZtCmIwL5znieM4Hnjvs0OIOHz4OyDGmGAt5nlGXdegx3FMZigXKKUeNE2DqqrweklordJjyrKElBJFUUA459B1Xb6gtc6+YfjdZ815wh6Xk/tLflCELdNrzJxaAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/691611b16d87e79feea60a2d2ea88789/8ac56/auto-scaling-group-lifecycle-hook.webp 240w,\n/static/691611b16d87e79feea60a2d2ea88789/d3be9/auto-scaling-group-lifecycle-hook.webp 480w,\n/static/691611b16d87e79feea60a2d2ea88789/e46b2/auto-scaling-group-lifecycle-hook.webp 960w,\n/static/691611b16d87e79feea60a2d2ea88789/f992d/auto-scaling-group-lifecycle-hook.webp 1440w,\n/static/691611b16d87e79feea60a2d2ea88789/882b9/auto-scaling-group-lifecycle-hook.webp 1920w,\n/static/691611b16d87e79feea60a2d2ea88789/e1a3b/auto-scaling-group-lifecycle-hook.webp 2396w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/691611b16d87e79feea60a2d2ea88789/8ff5a/auto-scaling-group-lifecycle-hook.png 240w,\n/static/691611b16d87e79feea60a2d2ea88789/e85cb/auto-scaling-group-lifecycle-hook.png 480w,\n/static/691611b16d87e79feea60a2d2ea88789/d9199/auto-scaling-group-lifecycle-hook.png 960w,\n/static/691611b16d87e79feea60a2d2ea88789/07a9c/auto-scaling-group-lifecycle-hook.png 1440w,\n/static/691611b16d87e79feea60a2d2ea88789/29114/auto-scaling-group-lifecycle-hook.png 1920w,\n/static/691611b16d87e79feea60a2d2ea88789/7f7f8/auto-scaling-group-lifecycle-hook.png 2396w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/691611b16d87e79feea60a2d2ea88789/d9199/auto-scaling-group-lifecycle-hook.png\"\n          alt=\"auto-scaling-group-lifecycle-hook\"\n          title=\"auto-scaling-group-lifecycle-hook\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>어떤 이유인지는 모르겠으나 CodeDeploy agent가 위의 Lifecycle Hook을 제거해주는 작업을 정상적으로 수행해주지 못한것으로 보입니다.</p>\n<blockquote>\n<p>CodeDeploy가 관리하는 Auto Scaling Group의 경우 Lifecycle Hook을 제거하면 Scale out 진행 시 프로비저닝이 정상적으로 동작하지 않으니 유의해서 제거하셔야 합니다.</p>\n</blockquote>","tableOfContents":"<ul>\n<li><a href=\"/posts/issues/aws-auto-scaling-group-pending/#%EC%9B%90%EC%9D%B8\">원인</a></li>\n<li><a href=\"/posts/issues/aws-auto-scaling-group-pending/#%ED%95%B4%EA%B2%B0\">해결</a></li>\n</ul>","fields":{"slug":"/posts/issues/aws-auto-scaling-group-pending/","tagSlugs":["/tag/aws/","/tag/cloud/","/tag/auto-scaling-group/"]},"frontmatter":{"date":"2018-10-01T00:00:00.000Z","description":"AWS Auto Scaling Group에서 인스턴스 생성이 Pending되는 이슈","tags":["AWS","Cloud","Auto Scaling Group"],"title":"AWS Auto Scaling groups -  Instance failed to complete user's Lifecycle Action error","socialImage":{"publicURL":"/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/aws-auto-scaling-group-pending-history.png"}}}},"pageContext":{"slug":"/posts/issues/aws-auto-scaling-group-pending/"}},"staticQueryHashes":["2067870509","251939775","401334301"]}
<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[kyucumber]]></title><description><![CDATA[없음]]></description><link>https://kyucumber.github.io</link><generator>GatsbyJS</generator><lastBuildDate>Sun, 27 Feb 2022 06:39:18 GMT</lastBuildDate><item><title><![CDATA[이펙티브 코틀린 아이템 24. 제네릭 타입과 variance 한정자를 활용하라]]></title><description><![CDATA[Effective Kotlin Item24. 제네릭 타입과 variance 한정자를 활용하라]]></description><link>https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-24</link><guid isPermaLink="false">https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-24</guid><pubDate>Sun, 27 Feb 2022 00:05:00 GMT</pubDate><content:encoded>&lt;h2 id=&quot;invariant&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#invariant&quot; aria-label=&quot;invariant permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;invariant&lt;/h2&gt;
&lt;p&gt;variacne 한정자(out 또는 in)이 없는 경우 invariant(불공변성)는 제네릭 타입으로 만들어지는 타입들이 서로 관련성이 없다는 의미이다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;class Cup&amp;lt;T&amp;gt;

// 아래 세가지 다 독립적이며 어떠한 관련성도 없다.
val intCup: Cup&amp;lt;Int&amp;gt;
val intCup: Cup&amp;lt;Any&amp;gt;
val intCup: Cup&amp;lt;Nothing&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;variance&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#variance&quot; aria-label=&quot;variance permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;variance&lt;/h2&gt;
&lt;p&gt;제네릭 타입 간 관련성을 가지길 원한다면 out 또는 in이라는 variance 한정자를 붙일 수 있다.&lt;/p&gt;
&lt;h3 id=&quot;covariant공변성과-out-한정자&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#covariant%EA%B3%B5%EB%B3%80%EC%84%B1%EA%B3%BC-out-%ED%95%9C%EC%A0%95%EC%9E%90&quot; aria-label=&quot;covariant공변성과 out 한정자 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;covariant(공변성)과 out 한정자&lt;/h3&gt;
&lt;p&gt;out은 타입 파라미터를 covariant(공변성)으로 만든다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;class Cup&amp;lt;out T&amp;gt;

open class Dog
class Puppy: Dog()

val b: Cup&amp;lt;Dog&amp;gt; = Cup&amp;lt;Puppy&amp;gt;() // OK
val a: Cup&amp;lt;Puppy&amp;gt; = Cup&amp;lt;Dog&amp;gt;() // 오류&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;A가 B의 서브타입일 때 &lt;code class=&quot;language-text&quot;&gt;Cup&amp;lt;A&amp;gt;&lt;/code&gt;가 &lt;code class=&quot;language-text&quot;&gt;Cup&amp;lt;B&amp;gt;&lt;/code&gt;의 서브타입이라는 의미, 위에서는 &lt;code class=&quot;language-text&quot;&gt;Cup&amp;lt;Dog&amp;gt;&lt;/code&gt;에 서브타입인 &lt;code class=&quot;language-text&quot;&gt;Cup&amp;lt;Puppy&amp;gt;&lt;/code&gt;가 할당될 수 있다.&lt;/p&gt;
&lt;h3 id=&quot;contravariant반변성과-in-한정자&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#contravariant%EB%B0%98%EB%B3%80%EC%84%B1%EA%B3%BC-in-%ED%95%9C%EC%A0%95%EC%9E%90&quot; aria-label=&quot;contravariant반변성과 in 한정자 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;contravariant(반변성)과 in 한정자&lt;/h3&gt;
&lt;p&gt;in은 out과 반대 의미이다. in 한정자는 타입 파라미터를 contravariant(반변성)으로 만든다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;class Cup&amp;lt;in T&amp;gt;

open class Dog
class Puppy: Dog()

val b: Cup&amp;lt;Dog&amp;gt; = Cup&amp;lt;Puppy&amp;gt;() // 오류
val a: Cup&amp;lt;Puppy&amp;gt; = Cup&amp;lt;Dog&amp;gt;() // OK&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;A가 B의 서브타입일 때 &lt;code class=&quot;language-text&quot;&gt;Cup&amp;lt;A&amp;gt;&lt;/code&gt;가 &lt;code class=&quot;language-text&quot;&gt;Cup&amp;lt;B&amp;gt;&lt;/code&gt;의 슈퍼타입이라는 의미, 위에서는 &lt;code class=&quot;language-text&quot;&gt;Cup&amp;lt;Puppy&amp;gt;&lt;/code&gt;에 슈퍼타입인 &lt;code class=&quot;language-text&quot;&gt;Cup&amp;lt;Dog&amp;gt;&lt;/code&gt;가 할당될 수 있다.&lt;/p&gt;
&lt;p&gt;variance 한정자를 그림으로 나타내면 다음과 같다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/85d7a3ed02198d80267995ad134e40cf/1790f/item-24-variance.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 34.583333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABY0lEQVQoz3VRyU4CQRD1+4xRQNknYXFN9AM8oCRy4CuM6NXwEwYBJYRlBhBBOMhAIJFlDjODDDy7KsLEg5VUuqte9auqflur1Qr/mWVZWC6Xm5hqF4vFH5zitRO+RcB8PoemzYRrfCdT1R4ymSfUajKT0uOaoiCXy6LZfOOa6WSCbPYZ+XwO7XaLc0z4cH8HKeiF33eAdPqRgcTNNcKhoPAA6nWFm52eRHEYDeHi/Ay6rkOWKwj43QiJmmQyYRNOpxNUKiWeRpvNGBiNhlDEg1brHaZp8pRq7xPF4qs4exybpiHwJhqNGkbDoU04Hn9BUaoCqDM5Wb+volQqco4IaeVO5wPlcgndbmdDKMtVFAovGAwGNmEqdQuncweOve3NylexS/ENHnjcDtFM5pUjYQmS5MPxUYSbELnLtQufdx/xeMwmJIUMw+CO1q+K30IcypHTNKQgCUZEdFJMecPQuWYt5g/TSOy7tFqnAgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/85d7a3ed02198d80267995ad134e40cf/8ac56/item-24-variance.webp 240w,
/static/85d7a3ed02198d80267995ad134e40cf/d3be9/item-24-variance.webp 480w,
/static/85d7a3ed02198d80267995ad134e40cf/e46b2/item-24-variance.webp 960w,
/static/85d7a3ed02198d80267995ad134e40cf/1671b/item-24-variance.webp 1189w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/85d7a3ed02198d80267995ad134e40cf/8ff5a/item-24-variance.png 240w,
/static/85d7a3ed02198d80267995ad134e40cf/e85cb/item-24-variance.png 480w,
/static/85d7a3ed02198d80267995ad134e40cf/d9199/item-24-variance.png 960w,
/static/85d7a3ed02198d80267995ad134e40cf/1790f/item-24-variance.png 1189w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/85d7a3ed02198d80267995ad134e40cf/d9199/item-24-variance.png&quot;
          alt=&quot;item-24-variance.png&quot;
          title=&quot;item-24-variance.png&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;함수-타입&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%95%A8%EC%88%98-%ED%83%80%EC%9E%85&quot; aria-label=&quot;함수 타입 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;함수 타입&lt;/h2&gt;
&lt;p&gt;함수 타입은 파라미터 유형과 리턴 타입에 따라 서로 관계를 갖는다.&lt;/p&gt;
&lt;p&gt;(Int) → Any 타입의 함수는 다음과 같은 타입 등으로도 동작한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;(Int) → Number&lt;/li&gt;
&lt;li&gt;(Number) → Any&lt;/li&gt;
&lt;li&gt;(Number) → Number&lt;/li&gt;
&lt;li&gt;(Number) → Int&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;이는 아래와 같은 관계에 의해서 가능하다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7a3a6858329f824f22e3efff55cdc19c/3096d/item-24-function-type.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAAA/UlEQVQoz3VSia6DIBD0/3+zNnnaVuUQBdTpLn3bgscmhoXIMMdW27aBi9f8kxrHEdPk4NwI7/3lv9JXstnXuq5YlgXWWmilaDUEPKXzfeX3K9nw5XmeE4thGFLPZ3tGIQao9IBFjPHA+gvIAEoN0Frjfq8RQsAV+6Zp0LZtYszgueyDZJEUgv8HFXZsQaSHp8y7rXi0YLg3mMs5h67r0spMDLE/C+LXJw+RsSgBjTEk7Y887fF6Pgn8lZj+PF2/+0vJ3LNslswSy+QXCuETlgAKmYNk9qbve5o7i7q+nc5cHsrj0cJTkMbogsxhbHhlzyScM7940OVfDi4P6Q3WEhRznF2WqgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/7a3a6858329f824f22e3efff55cdc19c/8ac56/item-24-function-type.webp 240w,
/static/7a3a6858329f824f22e3efff55cdc19c/d3be9/item-24-function-type.webp 480w,
/static/7a3a6858329f824f22e3efff55cdc19c/e46b2/item-24-function-type.webp 960w,
/static/7a3a6858329f824f22e3efff55cdc19c/b2f3f/item-24-function-type.webp 1319w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/7a3a6858329f824f22e3efff55cdc19c/8ff5a/item-24-function-type.png 240w,
/static/7a3a6858329f824f22e3efff55cdc19c/e85cb/item-24-function-type.png 480w,
/static/7a3a6858329f824f22e3efff55cdc19c/d9199/item-24-function-type.png 960w,
/static/7a3a6858329f824f22e3efff55cdc19c/3096d/item-24-function-type.png 1319w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/7a3a6858329f824f22e3efff55cdc19c/d9199/item-24-function-type.png&quot;
          alt=&quot;item-24-variance.png&quot;
          title=&quot;item-24-variance.png&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;파라미터 타입은 Int → Number → Any로 높은 타입으로 이동하며, 리턴 타입은 Any → Number → Int로 낮은 타입으로 이동한다.&lt;/p&gt;
&lt;p&gt;코틀린의 &lt;strong&gt;함수 타입의 모든 파라미터 타입은 contravariant(in 한정자)이며 모든 리턴 타입은 covariant(out 한정자)&lt;/strong&gt;이다.&lt;/p&gt;
&lt;p&gt;함수 타입을 사용할때는 이처럼 자동으로 variance 한정자가 사용되며, 코틀린에서 자주 사용되는 것으로는 covariant(out 한정자)를 가진 List가 존재한다.&lt;/p&gt;
&lt;h2 id=&quot;variance-한정자의-안정성&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#variance-%ED%95%9C%EC%A0%95%EC%9E%90%EC%9D%98-%EC%95%88%EC%A0%95%EC%84%B1&quot; aria-label=&quot;variance 한정자의 안정성 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;variance 한정자의 안정성&lt;/h2&gt;
&lt;p&gt;자바의 배열은 covariant이며 이로 인해 아래와 같은 문제가 발생할 수 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;java&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;Integer[] numbers = {1, 4, 2, 1};
Object[] objects = numbers;
objects[2] = &amp;quot;B&amp;quot; // 오류&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위는 컴파일 타임 중에는 아무 문제가 없지만 런타임 오류가 발생한다.&lt;/p&gt;
&lt;p&gt;코틀린은 이러한 결함을 해결하기 위해 Array를 invariant(IntArray, CharArray, ByteArray 등) 만들었으며, &lt;code class=&quot;language-text&quot;&gt;Array&amp;lt;Int&amp;gt;&lt;/code&gt;를 &lt;code class=&quot;language-text&quot;&gt;Array&amp;lt;Any&amp;gt;&lt;/code&gt; 등으로 바꿀 수 없다.&lt;/p&gt;
&lt;h3 id=&quot;covariant-타입-파라미터와-함수-타입의-파라미터&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#covariant-%ED%83%80%EC%9E%85-%ED%8C%8C%EB%9D%BC%EB%AF%B8%ED%84%B0%EC%99%80-%ED%95%A8%EC%88%98-%ED%83%80%EC%9E%85%EC%9D%98-%ED%8C%8C%EB%9D%BC%EB%AF%B8%ED%84%B0&quot; aria-label=&quot;covariant 타입 파라미터와 함수 타입의 파라미터 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;covariant 타입 파라미터와 함수 타입의 파라미터&lt;/h3&gt;
&lt;p&gt;아래 코드는 covariant하지 않다.  &lt;strong&gt;covariant 타입 파라미터(out)가 in 한정자 위치(함수의 타입 파라미터)에 있다면 covariant(out)와 업캐스팅을 연결해서 우리가 원하는 타입을 아무것이나 전달&lt;/strong&gt;할 수 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;open class Dog
class Puppy: Dog()
class Hound: Dog()

fun takeDog(dog: Dog) {}

fun main() {
    takeDog(Dog())
    takeDog(Puppy())
    takeDog(Hound())
}

class Box&amp;lt;out T&amp;gt; {
    private var value: T? = null

    // Type parameter T is declared as &amp;#39;out&amp;#39; but occurs in &amp;#39;in&amp;#39; position in type T
    fun set(value: T) {
        this.value = value
    }

    fun get(): T = value ?: error(&amp;quot;Value not set&amp;quot;)
}

fun main() {
    val puppyBox = Box&amp;lt;Puppy&amp;gt;()
    val dogBox: Box&amp;lt;Dog&amp;gt; = puppyBox

    dogBox.set(Hound()) // Puppy를 위한 Box지만 Hound를 set 함수에 전달할 수 있다.
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위와 같은 행위가 가능하다면 오류가 발생할 것이므로 코틀린은 &lt;strong&gt;public in 한정자 위치(함수의 타입 파라미터)에 covariant 타입 파라미터(out)가 오는 것을 금지해 이런 오류를 사전에 방지&lt;/strong&gt;한다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;주석에도 표시해 뒀지만, 위와 같이 클래스를 정의하면 아래와 같은 에러 메시지가 노출된다.&lt;/p&gt;
&lt;p&gt;Type parameter T is declared as ‘out’ but occurs in ‘in’ position in type T&lt;/p&gt;
&lt;/blockquote&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;class Box&amp;lt;out T&amp;gt; {
    private var value: T? = null

    private fun set(value: T) {
        this.value = value
    }

    fun get(): T = value ?: error(&amp;quot;Value not set&amp;quot;)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;private으로 제한하면 오류가 발생하지 않는다. get 메소드의 리턴 타입에 T가 사용되는데 covariant(out 한정자)는 public out 한정자 위치에도 안전하므로 이는 따로 제한되지 않는다.&lt;/p&gt;
&lt;p&gt;위와 같은 covariant는 Producer나 Immutable 데이터 홀더에 많이 사용되며 아래 &lt;code class=&quot;language-text&quot;&gt;List&amp;lt;T&amp;gt;&lt;/code&gt;도 covariant의 형태를 띄고 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;public interface List&amp;lt;out E&amp;gt; : Collection&amp;lt;E&amp;gt; {&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;MutableList&amp;lt;T&amp;gt;&lt;/code&gt;의 T는 in 한정자 위치(함수의 타입 파라미터)에서 사용되며 안전하지 않으므로 invariant로 제공된다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;public interface MutableList&amp;lt;E&amp;gt; : List&amp;lt;E&amp;gt;, MutableCollection&amp;lt;E&amp;gt; {&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;이외에 좋은 예로는 Response가 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;sealed class Response&amp;lt;out R, out E&amp;gt;
class Failure&amp;lt;out E&amp;gt;(val error: E): Response&amp;lt;Nothing, E&amp;gt;()
class Success&amp;lt;out R&amp;gt;(val value: R): Response&amp;lt;R, Nothing&amp;gt;()&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;covariant와 Nothing 타입으로 인해 Failure는 오류 타입을 지정하지 않아도 되고, Success는 잠재적인 값을 지정하지 않아도 된다.&lt;/p&gt;
&lt;h3 id=&quot;contravariant-타입-파라미터와-함수-리턴-타입-클래스의-프로퍼티-타입&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#contravariant-%ED%83%80%EC%9E%85-%ED%8C%8C%EB%9D%BC%EB%AF%B8%ED%84%B0%EC%99%80-%ED%95%A8%EC%88%98-%EB%A6%AC%ED%84%B4-%ED%83%80%EC%9E%85-%ED%81%B4%EB%9E%98%EC%8A%A4%EC%9D%98-%ED%94%84%EB%A1%9C%ED%8D%BC%ED%8B%B0-%ED%83%80%EC%9E%85&quot; aria-label=&quot;contravariant 타입 파라미터와 함수 리턴 타입 클래스의 프로퍼티 타입 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;contravariant 타입 파라미터와 함수 리턴 타입, 클래스의 프로퍼티 타입&lt;/h3&gt;
&lt;p&gt;contravariant 타입 파라미터(in)와 public out 위치(함수 리턴 타입 또는 클래스의 프로퍼티 타입)에서도 문제가 발생할 수 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;open class Car
interface Boat
class Amphibious: Car(), Boat

fun getAmphibious(): Amphibious = Amphibious()

class Box&amp;lt;in T&amp;gt;(
    // Type parameter T is declared as &amp;#39;in&amp;#39; but occurs in &amp;#39;out&amp;#39; position in type T
    val value: T
)

fun main() {
    val garage: Box&amp;lt;Car&amp;gt; = Box(Car())
    val amphibious: Box&amp;lt;Amphibious&amp;gt; = garage
    val boat: Boat = amphibious.value // 실제로는 Car를 위한 Box이다.

    // 책에는 garage.value로 되어있는데 조금 이상해서 수정했습니다.
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;Box에 어떤 타입이 들어있는지 확실하게 알수가 없다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;value에 T 타입을 지정하면 아래와 같은 에러 메시지가 노출된다.&lt;/p&gt;
&lt;p&gt;Type parameter T is declared as ‘in’ but occurs in ‘out’ position in type T&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;이러한 상황을 막기 위해 코틀린은 &lt;strong&gt;contravariant 타입 파라미터(in)을 public out 한정자 위치(함수 리턴 타입, 클래스의 프로퍼티 타입)위치에 사용하는것을 금지&lt;/strong&gt;하고 있다.&lt;/p&gt;
&lt;p&gt;물론 이번에도 아래처럼 private로 지정하면 아무런 문제가 없다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;class Box&amp;lt;in T&amp;gt;(
    private val value: T
)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;contravariant를 사용하는 예로는 &lt;code class=&quot;language-text&quot;&gt;kotlin.coroutine.Continuation&lt;/code&gt; 이 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;public interface Continuation&amp;lt;in T&amp;gt; {
    /**
     * The context of the coroutine that corresponds to this continuation.
     */
    public val context: CoroutineContext

    /**
     * Resumes the execution of the corresponding coroutine passing a successful or failed [result] as the
     * return value of the last suspension point.
     */
    public fun resumeWith(result: Result&amp;lt;T&amp;gt;)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;variance-한정자의-위치&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#variance-%ED%95%9C%EC%A0%95%EC%9E%90%EC%9D%98-%EC%9C%84%EC%B9%98&quot; aria-label=&quot;variance 한정자의 위치 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;variance 한정자의 위치&lt;/h2&gt;
&lt;p&gt;variance 한정자는 선언 부분과 클래스 인터페이스를 활용하는 위치에 사용할 수 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;선언 부분&lt;/p&gt;
&lt;p&gt;일반적으로 이 위치에 사용하며, 클래스와 인터페이스가 사용되는 모든 곳에 영향을 준다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;// 선언 쪽의 variance 한정자
class Box&amp;lt;out T&amp;gt;(val value: T)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;클래스와 인터페이스를 활용하는 위치&lt;/p&gt;
&lt;p&gt;이 위치에  variance를 적용하면 특정 변수에만 variance 한정자가 적용된다. 특정 인스턴스에만 적용해야 하는 경우 사용한다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;class Box&amp;lt;T&amp;gt;(val value: T)

// 사용하는 쪽의 variance 한정자
val boxAny: Box&amp;lt;out Any&amp;gt; = boxStr&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;MutableList에 in 한정자를 포함하면 요소의 리턴이 불가능하므로 붙이지 않는다.&lt;/p&gt;
&lt;p&gt;하지만 여러 타입을 받아들이게 하기 위해 아래와 같이 단일 파라미터 타입에 in을 붙여 활용할 수 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;interface Dog
interface Cutie

data class Puppy(val name: String): Dog, Cutie
data class Hound(val name: String): Dog
data class Cat(val name: String): Cutie

fun fillWithPuppies(list: MutableList&amp;lt;in Puppy&amp;gt;) {
    list.add(Puppy(&amp;quot;One&amp;quot;))
    list.add(Puppy(&amp;quot;Two&amp;quot;))
}

fun main() {
    val dogs = mutableListOf&amp;lt;Dog&amp;gt;(Hound(&amp;quot;Pluto&amp;quot;))
    fillWithPuppies(dogs)

    val cats = mutableListOf&amp;lt;Cutie&amp;gt;(Cat(&amp;quot;Pluto&amp;quot;))
    fillWithPuppies(cats)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;variance 한정자를 사용하면 아래처럼 제한이 있을 수 있다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;MutableList&amp;lt;out T&amp;gt;&lt;/code&gt; get() 요소 추출 시 T 타입이 리턴되지만 set은 Nothing 타입의 아규먼트가 전달될 수도 있을것으로 예상되므로 사용할 수 없다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;MutableList&amp;lt;in T&amp;gt;&lt;/code&gt; 사용 시 get과 set을 모두 사용할 수 있지만 get()을 사용할 경우 Any?가 리턴된다. 이는 슈퍼타입을 가진 리스트가 존재할 가능성이 있기 때문이다.&lt;/p&gt;
&lt;h2 id=&quot;정리&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A0%95%EB%A6%AC&quot; aria-label=&quot;정리 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;정리&lt;/h2&gt;
&lt;p&gt;코틀린은 강력한 제네릭 기능을 제공하며 아래와 같은 타입 한정자가 존재한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;기본적인 variance의 동작은 invariant이다. &lt;code class=&quot;language-text&quot;&gt;Cup&amp;lt;A&amp;gt;&lt;/code&gt;와 &lt;code class=&quot;language-text&quot;&gt;Cup&amp;lt;B&amp;gt;&lt;/code&gt;는 기본적으로는 아무런 관계를 갖지 않는다.&lt;/li&gt;
&lt;li&gt;out 한정자는 타입 파라미터를 covariant하게 만든다. covariant 타입은 out 위치에 사용할 수 있다.&lt;/li&gt;
&lt;li&gt;in 한정자는 타입 파라미터를 contravariant하게 만든다. contravariant 타입은 in 위치에 사용할 수 있다.&lt;/li&gt;
&lt;li&gt;List, Set의 타입 파라미터는 covariant(out) 이다.&lt;/li&gt;
&lt;li&gt;Array, MutableList, MutableSet의 타입 파라미터는 invaraint이다.&lt;/li&gt;
&lt;li&gt;함수 타입의 파라미터 타입은 contravariant(in)이다.&lt;/li&gt;
&lt;li&gt;리턴 타입의 파라미터 타입은 covariant(out) 이다. &lt;strong&gt;&lt;em&gt;책에는 contravariant로 되어 있음 임의로 수정&lt;/em&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;리턴만 되는 타입에는 covariant(out)을 사용한다.&lt;/li&gt;
&lt;li&gt;허용만 되는 타입에는 contravariant(in)을 사용한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;이펙티브 코틀린 - 프로그래밍 인사이트, 마르친 모스칼라 지음, 윤인성 옮김&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;개인적인 기록을 위해 작성된 글이라 잘못된 내용이 있을 수 있습니다.&lt;/p&gt;
&lt;p&gt;오류가 있다면 댓글을 남겨주세요.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[이펙티브 코틀린 아이템 23. 타입 파라미터의 섀도잉을 피하라]]></title><description><![CDATA[Effective Kotlin Item23. 타입 파라미터의 섀도잉을 피하라]]></description><link>https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-23</link><guid isPermaLink="false">https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-23</guid><pubDate>Sun, 27 Feb 2022 00:04:00 GMT</pubDate><content:encoded>&lt;p&gt;프로퍼티와 파라미터가 같은 이름을 가지는 경우 지역 파라미터가 외부 스코프에 있는 프로퍼티를 가리며 이를 섀도잉(shadowing)이라고 부른다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;class Forest(val name: String) {
    fun addTree(name: String) {
        // ...
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;이러한 섀도잉 현상은 클래스 타입 파라미터와 함수 타입 파라미터 사이에서도 발생한다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;interface Tree
class Birch: Tree
class Spruce: Tree

// Type parameter &amp;quot;T&amp;quot; is never used
class Forest&amp;lt;T: Tree&amp;gt; {
    // Forest와 addTree의 타입 파라미터가 독립적으로 동작하는 문제
    fun &amp;lt;T: Tree&amp;gt; addTree(tree: T) {
        // ..
    }
}

val forest = Forest&amp;lt;Birch&amp;gt;()

forest.addTree(Birch())
forest.addTree(Spruce())&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위에 주석에도 적었지만, Forest 클래스의 타입 파라미터와 addTree 함수의 타입 파라미터가 독립적으로 동작하게 되어 addTree 메소드에 의도하지 않은 타입이 전달될 수 있다.&lt;/p&gt;
&lt;p&gt;독립적인 타입 파라미터를 의도했다면 이름을 아예 다르게 하는것이 좋다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;class Forest&amp;lt;T: Tree&amp;gt; {
    fun &amp;lt;ST: Tree&amp;gt; addTree(tree: ST) {
        // ..
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;정리&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A0%95%EB%A6%AC&quot; aria-label=&quot;정리 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;정리&lt;/h2&gt;
&lt;p&gt;타입 파라미터 섀도잉을 피하자.&lt;/p&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;이펙티브 코틀린 - 프로그래밍 인사이트, 마르친 모스칼라 지음, 윤인성 옮김&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;개인적인 기록을 위해 작성된 글이라 잘못된 내용이 있을 수 있습니다.&lt;/p&gt;
&lt;p&gt;오류가 있다면 댓글을 남겨주세요.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[이펙티브 코틀린 아이템 22. 일반적인 알고리즘을 구현할 때 제네릭을 사용하라]]></title><description><![CDATA[Effective Kotlin Item22. 일반적인 알고리즘을 구현할 때 제네릭을 사용하라]]></description><link>https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-22</link><guid isPermaLink="false">https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-22</guid><pubDate>Sun, 27 Feb 2022 00:03:00 GMT</pubDate><content:encoded>&lt;p&gt;아규먼트로 함수에 값을 전달할 수 있는 것 처럼, 타입 아규먼트를 사용해 함수에 타입을 전달할 수 있다.&lt;/p&gt;
&lt;p&gt;타입 아규먼트를 사용하는 함수를 &lt;strong&gt;제네릭 함수&lt;/strong&gt;라고 부른다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;inline fun &amp;lt;T&amp;gt; Iterable&amp;lt;T&amp;gt;.filter(
    predicate: (T) -&amp;gt; Boolean
): List&amp;lt;T&amp;gt; {
    // ...
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;타입 파라미터는 컴파일러에 타입과 관련된 정보를 제공해 컴파일러가 타입을 조금이라도 더 정확하게 추측할 수 있게 해준다. filter에서 아규먼트가 컬렉션의 요소와 같은 타입이라는 것을 알 수 있으므로 잘못 처리하는것을 막을 수 있다.&lt;/p&gt;
&lt;p&gt;컴파일 과정에서 최종적으로 이러한 타입 정보는 사라지지만, 개발 중에는 타입 정보를 이용해 안전하게 사용할 수 있다.&lt;/p&gt;
&lt;h2 id=&quot;제네릭-제한&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A0%9C%EB%84%A4%EB%A6%AD-%EC%A0%9C%ED%95%9C&quot; aria-label=&quot;제네릭 제한 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;제네릭 제한&lt;/h2&gt;
&lt;p&gt;타입 파라미터의 중요한 기능 중 하나는 구체적인 타입의 서브타입만 사용하게 타입을 제한하는 것이다.&lt;/p&gt;
&lt;p&gt;아래에서는 콜론 뒤에 슈퍼타입을 설정해 타입에 제한을 건다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;fun &amp;lt;T: Comparable&amp;lt;T&amp;gt;&amp;gt; Iterable&amp;lt;T&amp;gt;.sorted(): List&amp;lt;T&amp;gt; {
    // ...
}

fun &amp;lt;T, C : MutableCollection&amp;lt;in T&amp;gt;&amp;gt; Iterable&amp;lt;T&amp;gt;.toCollection(destination: C): C {
    // ...
}

class ListAdapter&amp;lt;T: ItemAdapter&amp;gt;(/*..*/) { }&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;타입에 제한이 걸리므로, 내부에서 해당 타입이 제공하는 메소드를 사용할 수 있다.&lt;/p&gt;
&lt;p&gt;예를 들어 T가 Iterable&lt;Int&gt;의 서브타입인 경우 T 타입을 기본으로 반복 처리가 가능하고, 반복 처리때 사용되는 객체가 Int라는 것을 알 수 있다.&lt;/p&gt;
&lt;p&gt;많이 사용하는 제한 중 Any도 있다. 이는 nullable이 아닌 타입을 나타낸다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;inline fun &amp;lt;T, R : Any&amp;gt; Iterable&amp;lt;T&amp;gt;.mapNotNull(
    transform: (T) -&amp;gt; R?
): List&amp;lt;R&amp;gt; {
    // ..
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;아래와 같이 둘 이상의 제한을 걸수도 있다. 둘 이상의 제약을 걸때는 &lt;code class=&quot;language-text&quot;&gt;where&lt;/code&gt; 키워드를 사용한다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;fun &amp;lt;T: Animal&amp;gt; pet(animal: T) where T: GoodTempered {
    // ..
}

fun &amp;lt;T&amp;gt; pet(animal: T) where T: Animal, T: GoodTempered {
    // ..
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;정리&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A0%95%EB%A6%AC&quot; aria-label=&quot;정리 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;정리&lt;/h2&gt;
&lt;p&gt;타입 파라미터를 이용해 type-saf 제네릭 알고리즘과 제네릭 객체를 구현하기 때문에 코틀린에서 타입 파라미터는 굉장히 중요한 부분이다.&lt;/p&gt;
&lt;p&gt;타입 파라미터는 구체적인 자료형(concrete type)의 서브타입을 제한할 수 있으며 이렇게 하면 특정 자료형이 제공하는 메소드를 안전하게 사용할 수 있다.&lt;/p&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;이펙티브 코틀린 - 프로그래밍 인사이트, 마르친 모스칼라 지음, 윤인성 옮김&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;개인적인 기록을 위해 작성된 글이라 잘못된 내용이 있을 수 있습니다.&lt;/p&gt;
&lt;p&gt;오류가 있다면 댓글을 남겨주세요.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[이펙티브 코틀린 아이템 21. 일반적인 프로퍼티 패턴은 프로퍼티 위임으로 만들어라]]></title><description><![CDATA[Effective Kotlin Item21. 일반적인 프로퍼티 패턴은 프로퍼티 위임으로 만들어라]]></description><link>https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-21</link><guid isPermaLink="false">https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-21</guid><pubDate>Sun, 27 Feb 2022 00:02:00 GMT</pubDate><content:encoded>&lt;p&gt;코틀린은 코드 재사용과 관련해 프로퍼티 위임이라는 새로운 기능을 제공한다.&lt;/p&gt;
&lt;p&gt;프로퍼티 위임을 사용하면 일반적인 프로퍼티의 행위를 추출해 재사용할 수 있다.&lt;/p&gt;
&lt;p&gt;lazy를 이용해 지연 프로퍼티를 사용하면 생성과 동시에 값을 초기화 할 수 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val value by lazy { createValue() }

fun createValue(): String = &amp;quot;Test&amp;quot;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;프로퍼티 위임을 사용해 observable 패턴도 쉽게 만들 수 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;var items: List&amp;lt;Item&amp;gt; by 
    Delegates.observable(listOf()) { _, _, _ -&amp;gt;
        notifyDataSetChanged()
    }

var key: String? by
    Delegates.observable(null) { _, old, new -&amp;gt;
        Log.e(&amp;quot;Key changed from $old to $new&amp;quot;)
    }&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;간단한 프로퍼티 델리게이트를 살펴보자.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;// AS-IS 델리게이트 적용 전
var token: String? = null
    get() {
        print(&amp;quot;token returned value $field&amp;quot;)
        return field
    }
    set(value) {
        print(&amp;quot;token changed from $field to $value&amp;quot;)
        field = value
    }

var attempts: Int = 0
    get() {
        print(&amp;quot;attempts returned value $field&amp;quot;)
        return field
    }
    set(value) {
        print(&amp;quot;attempts changed from $field to $value&amp;quot;)
        field = value
    }&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위 두 token, attempts는 타입은 다르지만 거의 같은 처리를 하며 프로젝트 내에서 자주 반복되어 사용될 만한 패턴이다. 따라서 프로퍼티 위임을 활용해 추출할 수 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;// TO-BE 델리게이트 적용 후
var token: String? by LoggingProperty(null)
var attempts: Int by LoggingProperty(0)

private class LoggingProperty&amp;lt;T&amp;gt;(var value: T) {
    operator fun getValue(
        thisRef: Any?,
        prop: KProperty&amp;lt;*&amp;gt;
    ): T {
        print(&amp;quot;${prop.name} returned value $value&amp;quot;)
        return value
    }
    
    operator fun setValue(
        thisRef: Any?,
        prop: KProperty&amp;lt;*&amp;gt;,
        newValue: T
    ) {
        val name = prop.name
        print(&amp;quot;changed from $value to $newValue&amp;quot;)
        value = newValue
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;프로퍼티 위임이 어떻게 동작하는지 이해하려면 by가 어떻게 컴파일되는지 살펴보자&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;@JvmField
private val &amp;#39;token$delegate&amp;#39; = LoggingProperty&amp;lt;String?&amp;gt;(null)
var token: String?
    get() = &amp;#39;token$delegate&amp;#39;.getValue(this, ::token)
    set(value) { &amp;#39;token$delegate&amp;#39;.setValue(this, ::token, value) }&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;멤버 함수 뿐만 아니라 확장 함수로도 만들 수 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val map: Map&amp;lt;String, Any&amp;gt; = mapOf(
    &amp;quot;name&amp;quot; to &amp;quot;Marcin&amp;quot;,
    &amp;quot;kotlinProgrammer&amp;quot; to true
)

val name by map

inline operator fun &amp;lt;V, V1 : V&amp;gt; Map&amp;lt;in String, V&amp;gt;
    .getvalue(thisRef: Any?, property: KProperty&amp;lt;*&amp;gt;): V1 = 
    getOrImplicitDefault(property.name) as V1&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;코틀린 stdlib의 아래 프로퍼티 델리게이터를 알아 두면 유용하게 활용할 수 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;lazy&lt;/li&gt;
&lt;li&gt;Delegates.observable&lt;/li&gt;
&lt;li&gt;Delegates.vetoable&lt;/li&gt;
&lt;li&gt;Delegates.notNull&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;정리&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A0%95%EB%A6%AC&quot; aria-label=&quot;정리 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;정리&lt;/h2&gt;
&lt;p&gt;프로퍼티 델리게이트는 프로퍼티와 관련된 다양한 조작을 할 수 있다. 표준 라이브러리의 lazy와 observable이 대표적인 예이다.&lt;/p&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;이펙티브 코틀린 - 프로그래밍 인사이트, 마르친 모스칼라 지음, 윤인성 옮김&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;개인적인 기록을 위해 작성된 글이라 잘못된 내용이 있을 수 있습니다.&lt;/p&gt;
&lt;p&gt;오류가 있다면 댓글을 남겨주세요.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[이펙티브 코틀린 아이템 20. 일반적인 알고리즘을 반복해서 구현하지 말라]]></title><description><![CDATA[Effective Kotlin Item20. 일반적인 알고리즘을 반복해서 구현하지 말라]]></description><link>https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-20</link><guid isPermaLink="false">https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-20</guid><pubDate>Sun, 27 Feb 2022 00:00:01 GMT</pubDate><content:encoded>&lt;p&gt;다음과 같이 숫자를 특정 범위에 맞추는 알고리즘은 stdlib의 coerceIn 확장함수로 이미 구현되어 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val percent = when {
    numberFromUser &amp;gt; 100 -&amp;gt; 100
    numberFromUser &amp;lt; 0 -&amp;gt; 0
    else numberFromUser
}

// 이미 존재
val percent = numberFromUser.coerceIn(0, 100)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;이미 있는 것을 활용하면 코드가 짧아진다는 것 이외에도 다양한 장점이 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;코드 작성 속도가 빨라진다.&lt;/li&gt;
&lt;li&gt;구현을 따로 읽지 않아도 함수의 이름 등만 보고도 무엇을 하는지 확실하게 알 수 있다.&lt;/li&gt;
&lt;li&gt;직접 구현할 때 발생할 수 있는 실수를 줄일 수 있다.&lt;/li&gt;
&lt;li&gt;제작자들이 한번만 최적화하면, 모든 곳이 최적화의 혜택을 받을 수 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;표준-라이브러리-살펴보기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%91%9C%EC%A4%80-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-%EC%82%B4%ED%8E%B4%EB%B3%B4%EA%B8%B0&quot; aria-label=&quot;표준 라이브러리 살펴보기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;표준 라이브러리 살펴보기&lt;/h2&gt;
&lt;p&gt;일반적인 알고리즘은 대부분 정의되어 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;override fun saveCallResult(item: SourceResponse) {
    var sourceList = ArrayList&amp;lt;SourceEntity&amp;gt;()

    item.sources.forEach {
        var sourceEntity = SourceEntity()
        sourceEntity.id = it.id
        sourceEntity.category = it.category
        sourceEntity.country = it.country
    }
    db.insertSources(sourceList)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;어떤 자료형을 다른 자료형으로 매핑하기 위한 map과 같은 함수는 이미 제공되고 있으니, 위의 코드에서도 forEach를 사용하지 말고 map을 사용하는 것이 좋다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;override fun saveCallResult(item: SourceResponse) {
    val sourceEntries = item.sources.map(::sourceToEntry)
    db.insertSources(sourceList)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;나만의-유틸리티-구현하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%82%98%EB%A7%8C%EC%9D%98-%EC%9C%A0%ED%8B%B8%EB%A6%AC%ED%8B%B0-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0&quot; aria-label=&quot;나만의 유틸리티 구현하기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;나만의 유틸리티 구현하기&lt;/h2&gt;
&lt;p&gt;상황에 따라 표준 라이브러리에 없는 알고리즘이 필요할 수도 있다.&lt;/p&gt;
&lt;p&gt;컬렉션에 있는 모든 숫자의 곱을 계산하는 라이브러리가 필요한 경우 범용 유틸리티 함수(universal utility function)로 정의하는것이 좋다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;fun Iterable&amp;lt;Int&amp;gt;.product() = fold(1) { acc, i -&amp;gt; acc * i }&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;필요 없는 함수를 중복해서 만들지 않게 기존에 관련된 함수가 있는지 탐색하는 과정이 필요하다.&lt;/p&gt;
&lt;p&gt;많이 사용되는 알고리즘을 추출하는 방법으로는 톱레벨 함수, 프로퍼티 위임, 클래스 등이 있다.&lt;/p&gt;
&lt;p&gt;확장 함수는 앞의 방법과 비교해 다음과 같은 장점을 가지고 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;함수는 상태를 유지하지 않으므로, 행위를 나타내기 좋다.&lt;/li&gt;
&lt;li&gt;톱레벨 함수와 비교해서, 확장 함수는 구체적인 타입이 있는 객체에만 사용을 제한할 수 있으므로 좋다.&lt;/li&gt;
&lt;li&gt;수정할 객체를 아규먼트로 전달받아 사용하는 것보다는 확장 리시버로 사용하는 것이 가독성 측면에서 좋다.&lt;/li&gt;
&lt;li&gt;확장 함수는 객체에 정의한 함수보다 객체를 사용할 때, 자동 완성 기능 등으로 제안이 이루어지므로 쉽게 찾을 수 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;정리&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A0%95%EB%A6%AC&quot; aria-label=&quot;정리 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;정리&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;일반적인 알고리즘을 반복해서 만들지 말자. 대부분 stdlib에 이미 정의되어 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;이펙티브 코틀린 - 프로그래밍 인사이트, 마르친 모스칼라 지음, 윤인성 옮김&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;개인적인 기록을 위해 작성된 글이라 잘못된 내용이 있을 수 있습니다.&lt;/p&gt;
&lt;p&gt;오류가 있다면 댓글을 남겨주세요.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[이펙티브 코틀린 아이템 19. knowledge를 반복하여 사용하지 말라.]]></title><description><![CDATA[Effective Kotlin Item19. knowledge를 반복하여 사용하지 말라.]]></description><link>https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-19</link><guid isPermaLink="false">https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-19</guid><pubDate>Sun, 27 Feb 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;프로그래밍 언어의 핵심 특징이라고 할 수 있는 재사용성(resuability)은 정렬 알고리즘과 같은 부분을 한번 만들어 놓으면, 필요할 때 이를 활용할 수 있다는 것이다.&lt;/p&gt;
&lt;p&gt;print 함수를 약간만 변경해도 프로그램에 수많은 문제가 발생할 수 있듯, 재사용성은 힘이 있는 만큼 굉장히 위험할 수 있다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;“프로젝트에서 이미 있던 코드를 복사해서 붙여넣고 있다면, 무언가가 잘못된 것이다.”
이는 단순한 휴리스틱이지만 잘 들어맞는다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;drydont-repeat-yourself&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#drydont-repeat-yourself&quot; aria-label=&quot;drydont repeat yourself permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;DRY(Don’t Repeat Yourself)&lt;/h3&gt;
&lt;p&gt;실용주의 프로그래머라는 책에서도 반복에 대한 부분을 DRY 규칙이라고 표현하고 있다.&lt;/p&gt;
&lt;p&gt;추가로 아래와 같은 이름으로도 알려져 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SSOT(Single Source of Truth)&lt;/li&gt;
&lt;li&gt;WET(We Enjoy Typing, Write Everything Twice)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;이는 굉장히 많은 개발자가 비슷한 문제를 겪고, 같은 이야기를 하고 있다는 것이다.&lt;/p&gt;
&lt;h2 id=&quot;knowledge&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#knowledge&quot; aria-label=&quot;knowledge permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;knowledge&lt;/h2&gt;
&lt;p&gt;프로젝트를 진행할 때 정의한 모든것이 knowledge가 될 수 있다.&lt;/p&gt;
&lt;p&gt;프로그램에서 중요한 knowledge를 뽑는다면 다음과 같다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;로직(logic): 프로그램이 어떠한 식으로 동작하는지, 프로그램이 어떻게 보이는지&lt;/li&gt;
&lt;li&gt;공통 알고리즘(common algorithm): 원하는 동작을 하기 위한 알고리즘&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;위 둘의 큰 차이점은 &lt;strong&gt;시간에 따른 변화&lt;/strong&gt;이다.&lt;/p&gt;
&lt;p&gt;비즈니스 로직은 시간이 지나면서 계속 변하지만, 공통 알고리즘은 크게 변하지 않는다.&lt;/p&gt;
&lt;h2 id=&quot;모든-것은-변화한다&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%AA%A8%EB%93%A0-%EA%B2%83%EC%9D%80-%EB%B3%80%ED%99%94%ED%95%9C%EB%8B%A4&quot; aria-label=&quot;모든 것은 변화한다 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;모든 것은 변화한다.&lt;/h2&gt;
&lt;p&gt;프로그래밍에서 유일하게 유지되는 것은 &lt;strong&gt;변화한다는 속성&lt;/strong&gt;이라는 말이 있다.&lt;/p&gt;
&lt;p&gt;우리 프로젝트의 knowledge가 변화하는 이유는 다음과 같다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;회사가 사용자의 요구 또는 습관을 더 많이 알게 되었다.&lt;/li&gt;
&lt;li&gt;디자인 표준이 변화했다.&lt;/li&gt;
&lt;li&gt;플랫폼, 라이브러리, 도구 등이 변화해서 이에 대응해야 한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;knowledge의 반복은 확장성을 막고 쉽게 깨지게 만든다. 개발자는 knowledge 반복을 줄일 수 있는 여러 도구나 기능을 활용할 수 있다.(Hibernate와 같은 ORM, 추상화 등)&lt;/p&gt;
&lt;h2 id=&quot;언제-코드를-반복해도-될까&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%96%B8%EC%A0%9C-%EC%BD%94%EB%93%9C%EB%A5%BC-%EB%B0%98%EB%B3%B5%ED%95%B4%EB%8F%84-%EB%90%A0%EA%B9%8C&quot; aria-label=&quot;언제 코드를 반복해도 될까 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;언제 코드를 반복해도 될까?&lt;/h2&gt;
&lt;p&gt;반대로 아래와 같이 knowledge 반복을 줄이면 안되는 상황도 있다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;독립적인 2개의 안드로이드 애플리케이션, 빌드 도구 설정이 유사하므로 추출해 knowledge 반복을 줄이는 경우&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;처음에는 설정이 유사하지만 두 애플리케이션은 독립적이며 이후에 구성 변경이 필요할 수 있다. 이처럼 신중하지 못한 추출은 변경을 더 어렵게 만든다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;함께 변경될 가능성이 높은가? 따로 변경될 가능성이 높은가를 질문&lt;/strong&gt;으로 두 코드가 같은 knowledge를 나타내는지 어느정도 결정할 수 있다.&lt;/p&gt;
&lt;p&gt;이외에 유용한 휴리스틱으로, 비즈니스 규칙이 다른곳에서 왔는지를 체크한다. 다른 곳에서 왔다면 독립적으로 변경될 가능성이 높다.&lt;/p&gt;
&lt;h2 id=&quot;단일-책임의-원칙single-responsibility-principle-srp&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%8B%A8%EC%9D%BC-%EC%B1%85%EC%9E%84%EC%9D%98-%EC%9B%90%EC%B9%99single-responsibility-principle-srp&quot; aria-label=&quot;단일 책임의 원칙single responsibility principle srp permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;단일 책임의 원칙(Single Responsibility Principle, SRP)&lt;/h2&gt;
&lt;p&gt;단일 책임의 원칙은 잘못된 코드 추출로부터 우리를 보호할 수 있는 규칙이다.&lt;/p&gt;
&lt;p&gt;두 액터(actor)가 같은 클래스를 변경하는 일은 없어야 한다.&lt;/p&gt;
&lt;p&gt;액터란 변화를 만들어 내는 존재이며 서로의 업무와 분야에 대해 잘 모르는 개발자들로 비유된다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5c93454c266ec0675738e047683a68b4/2c5fd/effective-kotlin-item-19.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.5%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABLUlEQVQoz5VSwU6DQBDlzzURK7alIdrUHvRnTGrSxJ7tpbU9lAIHAiywsECfO9MsNcbEOMnLzu6+efMG1oKOuq4ZJk6n06/5X0Fci5IsSxlKNZBS9pdd13EeRQFGowEc5waj4QDTqYfZ7AGTyVCf38G2r7BcvjGXBYuiQFVJbLcbrFbvvVvjLgoDjMcOXNdh4fnTI16e5/C8MSbuPW7taywWrxfBsizZGSFJEt4rpRhSlgwKujsefY0Dr0HgI9TNfP+AUpv6JlgwKGjMpmk0FK9K1dyIXMdxrMcP+fOcOQ03raqKp+wF81xAiAxpmnJORBI4kyU7pobkZrf7ZEd017Ytg/I8zy+CQgh2sd/vsF5/MOHn3yMXVGwmoL0B1Zoayzwb7ti1faER+u+z+QLT91uZurHZqQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/5c93454c266ec0675738e047683a68b4/8ac56/effective-kotlin-item-19.webp 240w,
/static/5c93454c266ec0675738e047683a68b4/d3be9/effective-kotlin-item-19.webp 480w,
/static/5c93454c266ec0675738e047683a68b4/e46b2/effective-kotlin-item-19.webp 960w,
/static/5c93454c266ec0675738e047683a68b4/1e748/effective-kotlin-item-19.webp 1006w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/5c93454c266ec0675738e047683a68b4/8ff5a/effective-kotlin-item-19.png 240w,
/static/5c93454c266ec0675738e047683a68b4/e85cb/effective-kotlin-item-19.png 480w,
/static/5c93454c266ec0675738e047683a68b4/d9199/effective-kotlin-item-19.png 960w,
/static/5c93454c266ec0675738e047683a68b4/2c5fd/effective-kotlin-item-19.png 1006w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/5c93454c266ec0675738e047683a68b4/d9199/effective-kotlin-item-19.png&quot;
          alt=&quot;effective-kotlin-item-19.png&quot;
          title=&quot;effective-kotlin-item-19.png&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;위와 같이 Student라는 클래스를 여러 부서에서 활용한다면 각각의 부서의 목적에 따라 수정하면서 오동작을 일으킬 수 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;서로 다른 곳에서 사용하는 knowledge는 독립적으로 변경할 가능성이 많다. 따라서 비슷한 처리를 하더라도 완전히 다른 knowledge로 취급하는 것이 좋다.&lt;/li&gt;
&lt;li&gt;다른 knowledge는 분리해 두는 것이 좋다. 그렇지 않으면 재사용해서는 안되는 부분을 재사용하려는 유혹이 발생할 수 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;정리&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A0%95%EB%A6%AC&quot; aria-label=&quot;정리 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;정리&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;모든 것은 변화하므로 공통 knowledge가 있다면 추출해서 이러한 변화에 대비해야 한다.&lt;/li&gt;
&lt;li&gt;DRY를 엄격하게 지키려고 비슷해 보이는 코드는 모두 추출하려는 경향이 있는데, 극단적인 것은 언제나 좋지 않다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;이펙티브 코틀린 - 프로그래밍 인사이트, 마르친 모스칼라 지음, 윤인성 옮김&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;개인적인 기록을 위해 작성된 글이라 잘못된 내용이 있을 수 있습니다.&lt;/p&gt;
&lt;p&gt;오류가 있다면 댓글을 남겨주세요.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[이펙티브 코틀린 아이템 18. 코딩 컨벤션을 지켜라]]></title><description><![CDATA[Effective Kotlin Item 18. 코딩 컨벤션을 지켜라]]></description><link>https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-18</link><guid isPermaLink="false">https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-18</guid><pubDate>Wed, 16 Feb 2022 00:58:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://kotlinlang.org/docs/coding-conventions.html&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;코틀린 문서의 Coding Convensions&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;코틀린 커뮤니티에 속한 사람이라면 이러한 컨벤션을 최대한 지켜주는 것이 좋다. 이를 지키면 아래와 같은 장점이 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;어떤 프로젝트를 접해도 쉽게 이해할 수 있다.&lt;/li&gt;
&lt;li&gt;외부 개발자도 프로젝트의 코드를 쉽게 이해할 수 있다.&lt;/li&gt;
&lt;li&gt;다른 개발자도 코드의 작동 방식을 쉽게 추측할 수 있다.&lt;/li&gt;
&lt;li&gt;코드를 병합하고, 프로젝트의 코드 일부를 다른 프로젝트로 이동하는것이 쉽다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;컨벤션을 지킬 때 도움이 되는 도구들&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Intellij Formatter(Predefined style/Kotlin style guide)&lt;/li&gt;
&lt;li&gt;ktlint&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;자주 위반되는 규칙 중 하나는 클래스와 함수의 형식이다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;// BAD
class FullName(val name: String, val surname: String)

// GOOD
class Person(
    val id: Int = 0,
    val name: String = &amp;quot;&amp;quot;,
    val surname: String = &amp;quot;&amp;quot;
)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;함수도 파라미터를 많이 갖고 있고 길다면 아래와 같이 작성한다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;public fun &amp;lt;T&amp;gt; Iterable&amp;lt;T&amp;gt;.joinToString(
    separator: CharSequence = &amp;quot;, &amp;quot;,
    prefix: CharSequence = &amp;quot;&amp;quot;,
    // ...
)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;아래와 같이 작성하는 것은 두가지 측면에서 문제가 될 수 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;Class Person(val id: Int = 0,
    val name: String = &amp;quot;&amp;quot;,
    val surname: String = &amp;quot;&amp;quot;)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;모든 클래스의 아규먼트가 클래스 이름에 따라 다른 크기의 들여쓰기를 갖는다. 이 경우 클래스 이름 변경 시 모든 기본 생성자 파라미터의 들여쓰기가 변경된다.&lt;/li&gt;
&lt;li&gt;클래스가 차지하는 공간의 너비가 너무 크다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;일부 팀이 다른 규칙을 사용하기로 결정할 수 있지만 프로젝트의 컨벤션은 반드시 지켜주는 것이 좋다.&lt;/p&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;이펙티브 코틀린 - 프로그래밍 인사이트, 마르친 모스칼라 지음, 윤인성 옮김&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;개인적인 기록을 위해 작성된 글이라 잘못된 내용이 있을 수 있습니다.&lt;/p&gt;
&lt;p&gt;오류가 있다면 댓글을 남겨주세요.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[이펙티브 코틀린 아이템 17. 이름 있는 아규먼트를 사용하라]]></title><description><![CDATA[Effective Kotlin Item 17. 이름 있는 아규먼트를 사용하라]]></description><link>https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-17</link><guid isPermaLink="false">https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-17</guid><pubDate>Wed, 16 Feb 2022 00:56:00 GMT</pubDate><content:encoded>&lt;p&gt;코드에서 아규먼트의 의미가 명확하지 않은 경우가 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val text = (1..10).joinToString(&amp;quot;|&amp;quot;)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;“|”가 prefixd인지 separator를 의미하는건지 코드만 보아서는 알기 어렵다.&lt;/p&gt;
&lt;p&gt;파라미터가 명확하지 않은 경우 named argument를 사용해 명확하게 만들어줄 수 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val text = (1..10).joinToString(separator = &amp;quot;|&amp;quot;)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;함수 호출 시 잘못된 위치에 파라미터를 배치하는 경우도 방지할 수 있다.&lt;/p&gt;
&lt;p&gt;자바 함수를 호출할 때에는 named argument를 사용할 수 없다.&lt;/p&gt;
&lt;h2 id=&quot;정리&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A0%95%EB%A6%AC&quot; aria-label=&quot;정리 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;정리&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;named argument는 가독성 향상에 도움이 된다.&lt;/li&gt;
&lt;li&gt;같은 타입의 파라미터가 여러개 있는 경우 named argument를 사용하자.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;이펙티브 코틀린 - 프로그래밍 인사이트, 마르친 모스칼라 지음, 윤인성 옮김&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;개인적인 기록을 위해 작성된 글이라 잘못된 내용이 있을 수 있습니다.&lt;/p&gt;
&lt;p&gt;오류가 있다면 댓글을 남겨주세요.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[이펙티브 코틀린 아이템 16. 프로퍼티는 동작이 아니라 상태를 나타내야 한다.]]></title><description><![CDATA[Effective Kotlin Item 16. 프로퍼티는 동작이 아니라 상태를 나타내야 한다.]]></description><link>https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-16</link><guid isPermaLink="false">https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-16</guid><pubDate>Wed, 16 Feb 2022 00:55:00 GMT</pubDate><content:encoded>&lt;p&gt;코틀린의 프로퍼티와 자바의 필드는 비슷해 보이지만 완전히 다른 개념이다.
코틀린의 프로퍼티는 아래처럼 &lt;strong&gt;사용자 정의 setter, getter&lt;/strong&gt;를 가질 수 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;var name: String? = null
    get() = field?.toUpperCase()
    set(value) {
        if (!value.isNullOrBlank()
    }&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위 코드의 field라는 식별자는 프로퍼티의 데이터를 저장해두는 backing field에 대한 레퍼런스이다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val fullName: String
    get() = &amp;quot;$name $username&amp;quot;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;val을 사용해 읽기 전용 프로퍼티를 만들때는 field가 만들어지지 않는다.&lt;/p&gt;
&lt;p&gt;var을 사용해 만든 읽고 쓸수 있는 프로퍼티는 getter, setter를 정의할 수 있다. 이러한 프로퍼티를 &lt;strong&gt;파생 프로퍼티(derived property)&lt;/strong&gt;라고 부르며 자주 사용한다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;var date: Date
    get() = Date(mills)
    set(value) {
        millis = value.time
    }&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;직렬화 문제 등으로 더이상 해당 타입을 사용할 수 없을 때 위와 같이 사용할 수 있다.&lt;/p&gt;
&lt;p&gt;프로퍼티는 필드가 필요 없고 개념적으로 접근자(val은 getter, var은 getter, setter)를 나타낸다.  따라서 코틀린은 인터페이스에도 프로퍼티를 정의할 수 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;인터페이스에 프로퍼티 정의&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;interface Person {
  val name: String
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;프로퍼티 위임&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val db: Database by lazy { connectToDb() }&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;확장 프로퍼티&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val Context.preferences: SharedPreferences
  get() = PreferenceManager.getDefaultSharedPreferences(this)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;프로퍼티는 필드가 아니라 접근자를 나타낸다. 프로퍼티를 함수 대신 사용할 수도 있지만 완전히 대체해서 사용하는 것은 좋지 않다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;// BAD
val Tree&amp;lt;Int&amp;gt;.sum: Int
    get() = when (this) {
        is Leaf -&amp;gt; value
        is Node -&amp;gt; left.sum + right.sum
    }

// GOOD
fun Tree&amp;lt;Int&amp;gt;.sum(): Int = when (this) {
    is Leaf -&amp;gt; value
    is Node -&amp;gt; left.sum() + right.sum()
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;이런 게터에 재귀 형태의 &lt;strong&gt;많은 계산이 들어갈 것이라고 예상하지 않기 때문에 이러한 처리는 프로퍼티가 아닌 함수로 구현&lt;/strong&gt;해야 한다.&lt;/p&gt;
&lt;p&gt;원칙적으로 프로퍼티는 상태를 나타내거나 설정하기 위한 목적으로만 사용하는 것이 좋고 다른 로직 등을 포함하지 않아야 한다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;프로퍼티 사용 판단을 위한 간단한 질문&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;이 프로퍼티를 함수로 정의할 경우, 접두사로 get 또는 set을 붙일 것인가? 아니라면 프로퍼티로 만드는 것은 좋지 않다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;프로퍼티-대신-함수를-사용해야-하는-경우&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%94%84%EB%A1%9C%ED%8D%BC%ED%8B%B0-%EB%8C%80%EC%8B%A0-%ED%95%A8%EC%88%98%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4%EC%95%BC-%ED%95%98%EB%8A%94-%EA%B2%BD%EC%9A%B0&quot; aria-label=&quot;프로퍼티 대신 함수를 사용해야 하는 경우 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;프로퍼티 대신 함수를 사용해야 하는 경우&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;연산 비용이 높거나 복잡도가 O(1)보다 큰 경우&lt;/li&gt;
&lt;li&gt;비즈니스 로직을 포함하는 경우: 로깅 리스너 통지, 바인드된 요소 변경 등&lt;/li&gt;
&lt;li&gt;결정적이지 않은 경우: 같은 동작을 연속적으로 두번 했을 때 다른 값이 나올 수 있다면 함수 사용&lt;/li&gt;
&lt;li&gt;변환의 경우: 변환은 관습적으로 Int.toDouble()과 같은 변환 함수로 이루어지기 때문에 이런 변환을 프로퍼티로 만들면 오해를 불러 일으킬 수 있다.&lt;/li&gt;
&lt;li&gt;게터에서 프로퍼티의 상태 변경이 일어나야 하는 경우: 관습적으로 게터에서 프로퍼티의 상태 변화를 일으킨다고 생각하지 않는다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;이펙티브 코틀린 - 프로그래밍 인사이트, 마르친 모스칼라 지음, 윤인성 옮김&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;개인적인 기록을 위해 작성된 글이라 잘못된 내용이 있을 수 있습니다.&lt;/p&gt;
&lt;p&gt;오류가 있다면 댓글을 남겨주세요.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[이펙티브 코틀린 아이템 15. 리시버를 명시적으로 참조하라]]></title><description><![CDATA[Effective Kotlin Item 15. 리시버를 명시적으로 참조하라]]></description><link>https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-15</link><guid isPermaLink="false">https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-15</guid><pubDate>Wed, 16 Feb 2022 00:15:00 GMT</pubDate><content:encoded>&lt;p&gt;무언가를 자세히 설명하기 위해 명시적으로 더 긴 코드를 사용할 때가 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;클래스의 메소드임을 나타내기 위해 this를 사용하는 경우&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;class Test {
    private var num: Int = 0
    
    fun test() {
        this.num += 1
    }&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;확장 리시버를 명시적으로 참조하게 하는 경우&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;fun &amp;lt;T: comparable&amp;lt;T&amp;gt;&amp;gt; List&amp;lt;T&amp;gt;.quickSort(): List&amp;lt;T&amp;gt; {
    // ...
    val pivot = this.first() // this를 붙인 부분
    
    // ...
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;여러-개의-리시버&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%97%AC%EB%9F%AC-%EA%B0%9C%EC%9D%98-%EB%A6%AC%EC%8B%9C%EB%B2%84&quot; aria-label=&quot;여러 개의 리시버 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;여러 개의 리시버&lt;/h2&gt;
&lt;p&gt;스코프 내부에 둘 이상의 리시버가 있는 경우 리시버를 명시적으로 나타내는게 좋다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;AS-IS&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;class Node(val name: String) {
    fun makeChild(childName: String) =
        create(&amp;quot;$name.$childName&amp;quot;).apply {
            println(&amp;quot;Created $name&amp;quot;)
        }

    private fun create(name: String): Node? = Node(name)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위의 예는 name이 Node의 name을 참조하는 것이 아니라 생성자로 전달된 name을 참조하게 된다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;TO-BE&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;class Node(val name: String) {
    fun makeChild(childName: String) =
        create(&amp;quot;$name.$childName&amp;quot;).apply {
            println(&amp;quot;Created ${this?.name}&amp;quot;)
        }

    private fun create(name: String): Node? = Node(name)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;수정된 코드에서 문제는 해결되었지만 apply가 아닌 also를 사용했다면 이런 문제 자체가 일어나지 않는다.&lt;/p&gt;
&lt;p&gt;일반적으로 also, let을 사용하는 것이 nullable 값을 처리할 때 훨씬 좋은 선택지이다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;create(&amp;quot;$name.$childName&amp;quot;).also {
    println(&amp;quot;Created $it?.name&amp;quot;)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;리시버가 명확하지 않으면 아래와 같이 명시적으로 리서버를 적어서 명확하게 하자.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;class Node(val name: String) {
    fun makeChild(childName: String) =
        create(&amp;quot;$name.$childName&amp;quot;).apply {
            println(&amp;quot;Created ${this?.name} ${this@Node.name}&amp;quot;)
        }

    private fun create(name: String): Node? = Node(name)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;dsl-마커&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#dsl-%EB%A7%88%EC%BB%A4&quot; aria-label=&quot;dsl 마커 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;DSL 마커&lt;/h2&gt;
&lt;p&gt;DSL을 사용할 때는 리시버를 가진 요소가 중첩되더라도 명시적으로 리시버를 붙이지 않는다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;table {
    tr {
        td { +&amp;quot;Column 1&amp;quot; }
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;기본적으로 모든 스코프에서 외부 스코프 리시버의 메소드를 사용할 수 있지만 아래와 같은 경우 코드에 문제가 발생한다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;table {
    tr {
        td { +&amp;quot;Column 1&amp;quot; }
        tr {
            td { +&amp;quot;Value 1&amp;quot; }
        }
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;이러한 잘못된 사용을 막으려면 암묵적으로 외부 리시버를 사용하는것을 막는 DslMarker라는 메타 어노테이션을 사용해야 한다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;@DslMarker
annotation class HtmlDsl

@DslMarker
annotation class TableDsl&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;이렇게 하면 외부 리시버 사용이 금지되며, 원한다면 명시적으로 지정해 사용할 수 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;table {
    tr {
        td { +&amp;quot;Column 1&amp;quot; }
        tr { // 컴파일 오류
            td { +&amp;quot;Value 1&amp;quot; }
        }
    }
}

table {
    tr {
        td { +&amp;quot;Column 1&amp;quot; }
        this@table.tr {
            td { +&amp;quot;Value 1&amp;quot; }
        }
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;정리&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A0%95%EB%A6%AC&quot; aria-label=&quot;정리 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;정리&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;짧게 적을 수 있다는 이유만으로 리시버를 제거하지 말자.&lt;/li&gt;
&lt;li&gt;여러개의 리시버가 있는 상황 등에는 리시버를 명시적으로 적어주는 것이 좋다.&lt;/li&gt;
&lt;li&gt;DSL에서 외부 스코프의 리시버를 적게 강제하고 싶다면 DslMarker 메타 어노테이션을 사용하자&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;이펙티브 코틀린 - 프로그래밍 인사이트, 마르친 모스칼라 지음, 윤인성 옮김&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;개인적인 기록을 위해 작성된 글이라 잘못된 내용이 있을 수 있습니다.&lt;/p&gt;
&lt;p&gt;오류가 있다면 댓글을 남겨주세요.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[이펙티브 코틀린 아이템 14. 변수 타입이 명확하지 않은 경우 확실하게 지정하라]]></title><description><![CDATA[Effective Kotlin Item 14. 변수 타입이 명확하지 않은 경우 확실하게 지정하라]]></description><link>https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-14</link><guid isPermaLink="false">https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-14</guid><pubDate>Wed, 16 Feb 2022 00:10:00 GMT</pubDate><content:encoded>&lt;p&gt;코틀린은 수준 높은 타입 추론 시스템을 갖추고 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val num = 10
val name = &amp;quot;Mkk&amp;quot;
val ids = listOf(12, 112, 554, 997)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;이는 유형이 명확할 때 코드가 짧아지므로 코드의 가독성이 향상되지만 유형이 명확하지 않을때는 남용하면 좋지 않다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val data = getSomeData()&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;함수 정의를 따라가면 타입을 확인할 수 있지만 이는 가독성이 떨어진다는 의미이다.&lt;/p&gt;
&lt;p&gt;가독성 향상 이외에도 안전을 위해서 타입을 지정하는 것이 좋다.&lt;/p&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;이펙티브 코틀린 - 프로그래밍 인사이트, 마르친 모스칼라 지음, 윤인성 옮김&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;개인적인 기록을 위해 작성된 글이라 잘못된 내용이 있을 수 있습니다.&lt;/p&gt;
&lt;p&gt;오류가 있다면 댓글을 남겨주세요.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[이펙티브 코틀린 아이템 12. 연산자 오버로드를 할 때는 의미에 맞게 사용하라]]></title><description><![CDATA[Effective Kotlin Item 12. 연산자 오버로드를 할 때는 의미에 맞게 사용하라]]></description><link>https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-12</link><guid isPermaLink="false">https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-12</guid><pubDate>Sat, 12 Feb 2022 00:10:00 GMT</pubDate><content:encoded>&lt;p&gt;연산자 오버로딩은 굉장히 강력한 기능이지만 위험할 수 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;fun Int.factorial(): Int = (1..this).product()
// 생략

operator fun Int.not() = factorial()
print(10 * !6) // 7200&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;팩토리얼은 ! 기호를 사용해 표기하니 위와 같이 구현한다면 안된다.
함수의 이름이 not이기 때문에 논리 연산에 사용해야지 팩토리얼 연산에 연산자 오버로딩을 사용하면 안된다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;연산자&lt;/th&gt;
&lt;th&gt;대응되는 함수&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;+a&lt;/td&gt;
&lt;td&gt;a.unaryPlus()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-a&lt;/td&gt;
&lt;td&gt;a.unaryMinus()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;!a&lt;/td&gt;
&lt;td&gt;a.not()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;++a&lt;/td&gt;
&lt;td&gt;a.inc()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;—a&lt;/td&gt;
&lt;td&gt;a.dec()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;a + b&lt;/td&gt;
&lt;td&gt;a.plus(b)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;a * b&lt;/td&gt;
&lt;td&gt;a.times(b)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;a / b&lt;/td&gt;
&lt;td&gt;a.div(b)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;a..b&lt;/td&gt;
&lt;td&gt;a.rangeTo(b)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;a in b&lt;/td&gt;
&lt;td&gt;b.contains(a)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;a += b&lt;/td&gt;
&lt;td&gt;a.plusAssign(b)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;a href=&quot;https://kotlinlang.org/docs/operator-overloading.html&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Kotlin docs operator overloading&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;따라서 팩토리얼을 계산하기 위해 ! 연산자를 사용하면 안된다. 이는 관례에 어긋나기 때문이다.&lt;/p&gt;
&lt;h2 id=&quot;분명하지-않은-경우&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%B6%84%EB%AA%85%ED%95%98%EC%A7%80-%EC%95%8A%EC%9D%80-%EA%B2%BD%EC%9A%B0&quot; aria-label=&quot;분명하지 않은 경우 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;분명하지 않은 경우&lt;/h2&gt;
&lt;p&gt;관례를 충족하는지 아닌지 확실하지 않은 경우도 존재할 것이다. 이 경우는 infix를 활용한 확장 함수를 사용하는 것이 좋다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;infix fun Int.timesRepeated(operation: () -&amp;gt; Unit) = {
    repeat(this) { operation() }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;top-level function을 사용하는 것도 좋다. 위와 같이 함수를 n번 호출하는 것은 다음과 같은 형태로 이미 구현되어 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;repeat(3) { print(&amp;quot;Hello&amp;quot;) }&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;규칙을-무시해도-되는-경우&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EA%B7%9C%EC%B9%99%EC%9D%84-%EB%AC%B4%EC%8B%9C%ED%95%B4%EB%8F%84-%EB%90%98%EB%8A%94-%EA%B2%BD%EC%9A%B0&quot; aria-label=&quot;규칙을 무시해도 되는 경우 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;규칙을 무시해도 되는 경우&lt;/h2&gt;
&lt;p&gt;지금까지 설명한 연산자 오버로딩 규칙을 무시해도 되는 중요한 경우가 있다. 이는 &lt;strong&gt;DSL을 설계할 때&lt;/strong&gt;이다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;body {
    div {
        + &amp;quot;Some text&amp;quot;
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위는 HTML DSL이며 문자열 앞에 String.unaryPlus가 사용되었지만 문제가 되지 않는다. 이는 DSL 코드이기 때문이다.&lt;/p&gt;
&lt;h2 id=&quot;정리&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A0%95%EB%A6%AC&quot; aria-label=&quot;정리 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;정리&lt;/h2&gt;
&lt;p&gt;연산자 오버로딩은 이름에 의미에 맞게 사용하자.&lt;/p&gt;
&lt;p&gt;꼭 연산자 형태로 사용하고 싶다면 infix 확장 함수 또는 top-level function을 사용하자&lt;/p&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;이펙티브 코틀린 - 프로그래밍 인사이트, 마르친 모스칼라 지음, 윤인성 옮김&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;개인적인 기록을 위해 작성된 글이라 잘못된 내용이 있을 수 있습니다.&lt;/p&gt;
&lt;p&gt;오류가 있다면 댓글을 남겨주세요.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[이펙티브 코틀린 아이템 11. 가독성을 목표로 설계하라]]></title><description><![CDATA[Effective Kotlin Item 11. 가독성을 목표로 설계하라]]></description><link>https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-11</link><guid isPermaLink="false">https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-11</guid><pubDate>Sat, 12 Feb 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;코틀린은 간결성이 아니라 가독성(readability)를 좋게 하는데 목표를 두고 설게된 프로그래밍 언어이다.&lt;/p&gt;
&lt;p&gt;개발자는 코드를 작성하는것 보다 읽는 데 많은 시간을 소모한다.&lt;/p&gt;
&lt;p&gt;따라서 항상 가독성을 생각하면서 코드를 작성해야 한다.&lt;/p&gt;
&lt;h2 id=&quot;인식-부하-감소&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%9D%B8%EC%8B%9D-%EB%B6%80%ED%95%98-%EA%B0%90%EC%86%8C&quot; aria-label=&quot;인식 부하 감소 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;인식 부하 감소&lt;/h2&gt;
&lt;p&gt;가독성은 사람에 따라 다르게 느낄 수 있지만 경험과 인식에 대한 과학으로 만들어진 어느정도의 규칙이 존재한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;구현 A&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;if (person != null &amp;amp;&amp;amp; person.isAdult) {
    view.shopwPerson(person)
} else {
    view.showError()
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;A는 일반적인 관용구(if / else, &amp;#x26;&amp;#x26;, 메소드 호출)을 사용하고 있어 초보자에게는 구현 A가 더 이해하기 쉽다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;구현 B&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;person?.takeIf { it.isAdult }
    ?.let(view::showPerson)
    ?.: view showError()&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;B는 더 짧지만 B는 코틀린에 대한 숙련도가 있는 사람이 아니라면 읽고 이해하기 어렵다.&lt;/p&gt;
&lt;p&gt;이외에도 아래와 같은 차이가 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A는 수정 및 디버깅이 용이하다. if 혹은 else 블록에 작업을 추가하는 경우 B에서는 함수 참조를 사용할 수 있어 코드를 수정해야 한다.&lt;/li&gt;
&lt;li&gt;구현 B에서 showPerson의 리턴 타입에 따라(null인 경우) 의도치 않게 showError를 호출할 수도 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;우리의 뇌는 짧은 코드를 빠르게 읽을 수 있지만 익숙한 코드는 더 빠르게 읽을 수 있다.
따라서 기본적으로 &lt;strong&gt;인지 부하를 줄이는 방향으로 코드를 작성&lt;/strong&gt;하는것이 좋다.&lt;/p&gt;
&lt;h2 id=&quot;극단적이-되지-않기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EA%B7%B9%EB%8B%A8%EC%A0%81%EC%9D%B4-%EB%90%98%EC%A7%80-%EC%95%8A%EA%B8%B0&quot; aria-label=&quot;극단적이 되지 않기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;극단적이 되지 않기&lt;/h2&gt;
&lt;p&gt;위의 구현 B에서 let으로 인해 예상치 못한 결과가 나오는 경우를 보고 일부는 let을 절대로 쓰면 안된다고 이해하는 경우가 있다.&lt;/p&gt;
&lt;p&gt;let은 좋은 코드를 만들기 위해 다양하게 활용할 수 있으므로 극단적으로 받아들이면 안된다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;var person: Person? = null

fun printName() {
    person?.let { print(it.name) }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위와 같이 가변 프로퍼티를 가진 경우 스마트 캐스팅이 불가능하고 safe call과 let을 활용하면 사람들이 쉽게 인식할 수 있는 코드를 작성할 수 있다.&lt;/p&gt;
&lt;p&gt;이외에도 아래와 같은 경우 let을 많이 사용한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;연산을 아규먼트 처리 후로 이동시킬 때&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;print(students.filter{ }.joinToString{ })
-&amp;gt;
students.filter{ }.joinToString{ }.let(::print)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;데코레이터를 사용해도 객체를 감쌀 때&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;var obj = FileInputStream(&amp;quot;/file.gz&amp;quot;)
  .let(::BufferedInputStream)
  .let(::ZipInputStream)
  .let(::ObjectInputStream)
  .readObject() as SomeObject&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;위의 경우는 디버그하기 어렵고 경험이 적은 코틀린 개발자는 이해하기 어렵다.&lt;/p&gt;
&lt;p&gt;하지만 위의 경우는 &lt;strong&gt;비용을 지불할 만한 가치가 있으며 정당성 없이 복잡성을 추가하는 경우가 아니다&lt;/strong&gt;.&lt;/p&gt;
&lt;h2 id=&quot;컨벤션&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%BB%A8%EB%B2%A4%EC%85%98&quot; aria-label=&quot;컨벤션 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;컨벤션&lt;/h2&gt;
&lt;p&gt;네이밍, 규칙, 관용구 등에 대해 개발자는 항상 토론하며 이를 위해 이해하고 기억해야 하는 규칙이 존재한다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val abc = &amp;quot;A&amp;quot; { &amp;quot;B&amp;quot; } and &amp;quot;C&amp;quot;
print(abc)

operator fun String.invoke(f: () -&amp;gt; String): String = this + f()
infix fun String.and(s: String) = this + s&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위 코드는 이후에 설명하는 수많은 규칙들을 위반한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;연산자는 의미에 맞게 사용해야 한다. invoke는 위와 같은 형태로 사용하면 안된다.&lt;/li&gt;
&lt;li&gt;람다를 마지막 아규먼트로 사용한다 라는 컨벤션을 여기에 적용하면 코드가 복잡해진다.&lt;/li&gt;
&lt;li&gt;현재 코드에서 and라는 함수 이름이 실제 함수 내부에서 이루어지는 처리와 맞지 않다.&lt;/li&gt;
&lt;li&gt;문자열을 결합하는 기능은 이미 언어에 내장되어 있어 이미 있는 것들 다시 만들 필요는 없다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;이펙티브 코틀린 - 프로그래밍 인사이트, 마르친 모스칼라 지음, 윤인성 옮김&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;개인적인 기록을 위해 작성된 글이라 잘못된 내용이 있을 수 있습니다.&lt;/p&gt;
&lt;p&gt;오류가 있다면 댓글을 남겨주세요.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[이펙티브 코틀린 아이템 08. 적절하게 null을 처리하라]]></title><description><![CDATA[Effective Kotlin Item 08. 적절하게 null을 처리하라]]></description><link>https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-08</link><guid isPermaLink="false">https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-08</guid><pubDate>Tue, 08 Feb 2022 02:10:00 GMT</pubDate><content:encoded>&lt;p&gt;null은 값이 부족하다는 것을 나타낸다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;프로퍼티가 null인 경우&lt;/p&gt;
&lt;p&gt;값이 설정되지 않았거나 제거되었음&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;null을 리턴하는 경우 여러 의미를 가질 수 있음&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;String.toIntOrNull()은 String을 Int로 적절히 변환할 수 없을 때 null&lt;/li&gt;
&lt;li&gt;Interable&lt;T&gt;.firstOrNull()은 주어진 조건에 맞는 요소가 없는 경우 null&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;이러한 null은 nullable 값의 처리를 위해 명확한 의미를 갖는 것이 좋으며 아래와 같은 세가지 방법으로 처리한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;safe call(?), smart casting, elvis operator 연산자를 활용해 안전하게 처리한다.&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;오류를 throw 한다.&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;함수 또는 프로퍼티를 리팩토링해서 nullable 타입이 나오지 않게 바꾼다.&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;null을-안전하게-처리하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#null%EC%9D%84-%EC%95%88%EC%A0%84%ED%95%98%EA%B2%8C-%EC%B2%98%EB%A6%AC%ED%95%98%EA%B8%B0&quot; aria-label=&quot;null을 안전하게 처리하기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;null을 안전하게 처리하기&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;safe call, smart casting&lt;/p&gt;
&lt;p&gt;널리 사용되는 방법으로는 safe call과 smart casting이 있다.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;printer?.print() // safe call
if (printer != null) printer.print() // smart casting&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;elvis operator&lt;/p&gt;
&lt;p&gt;elvis operator 또한 많이 사용되며 elvis operator 오른쪽에는 return, throw를 포함한 모든 표현식이 허용된다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;이는 return, throw 모두 Nothing을 리턴하게 설계되어서 가능하다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val printerName = printer?.name ?: &amp;quot;Unnamed&amp;quot;
val printerName = printer?.name ?: return
val printerName = printer?.name ?: throw Error(&amp;quot;error&amp;quot;)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;smart casting with contracts feature(규약 기능)&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val name = readLine()
if (!name.isNullOrBlank()) {
    println(name.toUpperCase()) // smart casting에 의해 safe call(?) 없이 toUpperCase 호출 가능
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;blockquote&gt;
&lt;p&gt;방어적 프로그래밍과 공격적 프로그래밍&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;방어적 프로그래밍(defensive programming)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;모든 가능성을 올바른 방식으로 처리하는 것 (null일때 출력하지 않기 등)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;공격적 프로그래밍(offensive programming)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;예상하지 못한 상황 발생 시 개발자에게 알려서 수정하게 만드는 방식 require, check 등이 공격적 프로그래밍을 위한 도구이다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;오류-throw-하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%98%A4%EB%A5%98-throw-%ED%95%98%EA%B8%B0&quot; aria-label=&quot;오류 throw 하기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;오류 throw 하기&lt;/h2&gt;
&lt;p&gt;아래와 같은 상황에서 names가 null이면 별도의 행위 없이 코드가 이어서 진행된다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val names: List&amp;lt;String&amp;gt;? = getNames()

if (!new.isNullOrEmpty()) {
    names.forEach { println(it) }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;만약 names가 null이 될 것을 예상하지 못한다면 println이 호출되지 않아 의아할 것이며 개발자가 오류를 찾기 어렵게 만든다.&lt;/p&gt;
&lt;p&gt;이러한 부분에서 문제가 발생할 경우 throw, !!, requireNotNull, checkNotNull등을 활용해 개발자에게 오류를 강제로 발생시켜 주는 것이 좋다.&lt;/p&gt;
&lt;h3 id=&quot;not-null-assertion과-관련된-문제&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#not-null-assertion%EA%B3%BC-%EA%B4%80%EB%A0%A8%EB%90%9C-%EB%AC%B8%EC%A0%9C&quot; aria-label=&quot;not null assertion과 관련된 문제 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;not-null assertion(!!)과 관련된 문제&lt;/h3&gt;
&lt;p&gt;!!은 nullable이지만 null이 나오지 않는다는 것이 확실한 상황에 많이 사용된다.
not-null assertion(!!)은 사용하기 쉽지만 좋은 해결 방법은 아니다.&lt;/p&gt;
&lt;p&gt;현재 null이 나오지 않는 사실이 확실하다고 미래에 확실한 것은 아니기 때문이다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;class ABC {
    private var controller: UserController? = null

    fun init() {
        controller = UserController()
    }

    fun test() {
        controller!!.doSomething()
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위와 같이 사용하면  &lt;code class=&quot;language-text&quot;&gt;controller!!.doSomething()&lt;/code&gt; 와 같이 프로퍼티를 계속 언팩(unpack)해야 하므로 사용하기 귀찮다.&lt;/p&gt;
&lt;p&gt;이 경우 lateinit 또는 Delegrates.notNull을 활용하는게 좋다.&lt;/p&gt;
&lt;h3 id=&quot;의미-없는-nullablity-피하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%9D%98%EB%AF%B8-%EC%97%86%EB%8A%94-nullablity-%ED%94%BC%ED%95%98%EA%B8%B0&quot; aria-label=&quot;의미 없는 nullablity 피하기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;의미 없는 nullablity 피하기&lt;/h3&gt;
&lt;p&gt;nullability는 어떻게든 처리해야 하므로 추가 비용이 발생한다.&lt;/p&gt;
&lt;p&gt;따라서 필요한 경우가 아니라면 nullability 자체를 피하는게 좋다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;클래스에서 nullability에 따라 List&lt;T&gt;의 get 혹은 getOrNull과 유사한 여러 함수를 만들어 제공한다.&lt;/li&gt;
&lt;li&gt;클래스 생성 이후 확실히 생성된다는 보장이 있으면 lateinit 프로퍼티 혹은 notNull 델리게이트 활용&lt;/li&gt;
&lt;li&gt;빈 컬렉션 대신 null을 리턴하지 말자, 요소가 부족한 것을 나타낼때는 empty 컬렉션 활용&lt;/li&gt;
&lt;li&gt;nullable enum과 None enum 값은 완전히 다른 의미이다. null인 사용하는 곳에서 별도로 처리하지만, None enum은 정의에 없으므로 필요한 경우 추가해서 활용할 수 있다는 의미&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;lateinit-프로퍼티와-notnull-델리게이트&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#lateinit-%ED%94%84%EB%A1%9C%ED%8D%BC%ED%8B%B0%EC%99%80-notnull-%EB%8D%B8%EB%A6%AC%EA%B2%8C%EC%9D%B4%ED%8A%B8&quot; aria-label=&quot;lateinit 프로퍼티와 notnull 델리게이트 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;lateinit 프로퍼티와 notNull 델리게이트&lt;/h3&gt;
&lt;p&gt;클래스 생성 중 초기화 할 수 없는 프로퍼티를 가지는 것은 드문 일은 아니지만 분명 존재하는 일이다.&lt;/p&gt;
&lt;p&gt;이러한 프로퍼티는 사용전 반드시 초기화가 필요하다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;class ABC {
    private var controller: UserController? = null

    fun init() {
        controller = UserController()
    }

    fun test() {
        controller!!.doSomething()
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;매번 !! operator를 활용해 nullable에서 타입 변환해 사용하는 것은 바람직하지 않다.&lt;/p&gt;
&lt;p&gt;이때는 아래처럼 lateinit 혹은 notNull Delegates를 활용하자.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;class ABC {
    private lateinit var controller: UserController

    fun init() {
        controller = UserController()
    }

    fun test() {
        controller!!.doSomething()
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;lateinit은 nullable과 비교해 아래와 같은 이점이 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;!! operator를 이용한 언팩이 불필요하다.&lt;/li&gt;
&lt;li&gt;이후에 null로 사용하고 싶을 때 nullable로 만들수도 있다.&lt;/li&gt;
&lt;li&gt;프로퍼티가 초기화된 이후에는 초기화되지 않은 상태로 돌아갈 수 없다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;아래처럼 onCreate때 초기화 해 lateinit을 사용할 수 없는 경우 Delegrates.notNull을 사용한다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;private var doctorId: Int by Delegates.notNull()

fun onCreate() {
    docterId = // 생략
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;다음과 같이 property delegation을 활용할 수도 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;private var doctorId: Int by arg(DOCTER_ID_ARG)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://www.kyobobook.co.kr/product/detailViewKor.laf?mallGb=KOR&amp;#x26;ejkGb=KOR&amp;#x26;barcode=9788966263370&amp;#x26;orderClick=4bb#&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;이펙티브 코틀린 - 프로그래밍 인사이트, 마르친 모스칼라 지음, 윤인성 옮김&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;개인적인 기록을 위해 작성된 글이라 잘못된 내용이 있을 수 있습니다.&lt;/p&gt;
&lt;p&gt;오류가 있다면 댓글을 남겨주세요.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[이펙티브 코틀린 아이템 07. 결과 부족이 발생할 경우 null과 Failure를 사용하라]]></title><description><![CDATA[Effective Kotlin Item 07. 결과 부족이 발생할 경우 null과 Failure를 사용하라]]></description><link>https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-07</link><guid isPermaLink="false">https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-07</guid><pubDate>Tue, 08 Feb 2022 01:50:00 GMT</pubDate><content:encoded>&lt;p&gt;아래와 같이 함수가 원하는 결과를 만들어 낼 수 없을 때가 존재한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;서버로부터 데이터를 읽어 들이려고 했는데, 인터넷 연결 문제로 읽어들이지 못한 경우&lt;/li&gt;
&lt;li&gt;조건에 맞는 첫 번째 요소를 찾으려 했는데, 조건에 맞는 요소가 없는 경우&lt;/li&gt;
&lt;li&gt;텍스트를 파싱해서 객체를 만들려고 했는데, 텍스트의 형식이 맞지 않는 경우&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;위와 같은 상황을 처리하는 메커니즘은 크게 두가지가 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;null 또는 실패를 나타내는 sealed 클래스(일반적으로 Failure라는 이름 사용)&lt;/li&gt;
&lt;li&gt;예외 throw&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;예외를 throw 하는 경우 예외를 정보를 전달하는 방법으로 사용하면 안된다.
예외는 &lt;strong&gt;예외적인 상황이 발생했을 때 사용하는 것&lt;/strong&gt;이 좋다. 이유는 아래와 같다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;많은 개발자가 예외가 전파되는 과정을 제대로 추적하지 못한다.&lt;/li&gt;
&lt;li&gt;코틀린의 모든 예외는 unchecked 예외이며 따라서 사용자가 예외를 처리하지 않을수도 있다. 이와 관련된 내용은 문서에도 제대로 제대로 드러나지 않는다.&lt;/li&gt;
&lt;li&gt;예외는 예외적인 상황을 처리하기 위해 만들어졌으므로 명시적인 테스트 만큼 빠르게 동작하지 않는다.&lt;/li&gt;
&lt;li&gt;try-catch 블록 내부에 코드를 배치하면, 컴파일러가 할 수 있는 &lt;strong&gt;최적화가 제한&lt;/strong&gt;된다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;null-또는-sealed-클래스를-활용한-오류-처리&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#null-%EB%98%90%EB%8A%94-sealed-%ED%81%B4%EB%9E%98%EC%8A%A4%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%9C-%EC%98%A4%EB%A5%98-%EC%B2%98%EB%A6%AC&quot; aria-label=&quot;null 또는 sealed 클래스를 활용한 오류 처리 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;null 또는 sealed 클래스를 활용한 오류 처리&lt;/h2&gt;
&lt;p&gt;위에서 다룬 첫번째 방법인 null 또는 실패를 나타내는 sealed 클래스를 사용하는 방법은 오류를 표현할 때 굉장히 좋다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;예측할 수 있는 범위의 오류는 null과 Failure를 사용하고 예측하기 어려운 범위의 오류는 예외를 throw 해서 처리하자.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;AS-IS&lt;/strong&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;inline fun &amp;lt;reified T&amp;gt;.readObjectOrNull(): T? {
    // ...
    if (incorrectSign) {
        return null
    }
    // ..
    return result
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;strong&gt;TO-BE&lt;/strong&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;inline fun &amp;lt;reified T&amp;gt;.readObjectOrNull(): T? {
    // ...
    if (incorrectSign) {
        return Failure(JsonParsingException()
    }
    // ..
    return Success(result)
}

sealed class Result&amp;lt;out T&amp;gt;
class Success&amp;lt;out T&amp;gt;(val result: T): Result&amp;lt;T&amp;gt;()
class Failure(val throwable: Throwable): Result&amp;lt;Nothing&amp;gt;()

class JsonParsingException: Exception&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위와 같이 표시되는 오류는 다루기 쉬우며 놓치기 어렵다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val age = userText.readObjectOrNull&amp;lt;Person&amp;gt;()?.age ?: -1&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;null을 처리해야 하면 위의 safe call(?) 또는 elvis operator(?:)와 같은 다양한 null-safety 기능을 활용하자.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val person = userText.readObjectOrNull&amp;lt;Person&amp;gt;()
val age = when(person) {
    is Success -&amp;gt; person.age
    is Failure -&amp;gt; -1
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;Result와 같은 Union type을 리턴하기로 했다면 위의 when 표현식을 사용해 이를 처리할 수 있다.&lt;/p&gt;
&lt;p&gt;위에서 설명한 오류 처리 방식은 try-catch 블록보다 효율적이며, 사용하기 쉽고 명확하다.
예외는 놓칠 수 있고, 전체 애플리케이션을 중지시킬 수 있지만 null 값과 seald result 클래스는 명시적으로 처리해야 하며 애플리케이션을 중지시키지도 않는다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;null과 sealed class 차이점
추가적인 정보 전달이 필요하면 sealed result를 사용하고, 그렇지 않으면 null을 사용하는게 일반적이다.
Failure는 처리할 때 필요한 정보를 가질 수 있다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;List에서는 아래와 같은 형태의 함수를 사용한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;get&lt;/p&gt;
&lt;p&gt;해당 요소가 없다면 IndexOutOfBoundsException(List 기준)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;getOrNull&lt;/p&gt;
&lt;p&gt;해당 요소가 없다면 null&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;위 두가지 함수 이외에 일부 유용한 getOrDefault도 존재.&lt;/p&gt;
&lt;p&gt;일반적으로 getOrNull 또는 Elvis operator(?:)를 사용하는 것이 처리하기 쉽다.&lt;/p&gt;
&lt;h2 id=&quot;정리&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A0%95%EB%A6%AC&quot; aria-label=&quot;정리 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;정리&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;예측하기 어려운 범위가 아닌 경우라면 null 또는 sealed 클래스를 활용하자&lt;/li&gt;
&lt;li&gt;개발자에게 null이 발생할 수 있다고 경고를 주려면 getOrNull 등을 사용해 무엇이 리턴되는지 예측할 수 있게 하는 것이 좋다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;이펙티브 코틀린 - 프로그래밍 인사이트, 마르친 모스칼라 지음, 윤인성 옮김&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;개인적인 기록을 위해 작성된 글이라 잘못된 내용이 있을 수 있습니다.&lt;/p&gt;
&lt;p&gt;오류가 있다면 댓글을 남겨주세요.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[이펙티브 코틀린 아이템 06. 사용자 정의 오류보다는 표준 오류를 사용하라]]></title><description><![CDATA[Effective Kotlin Item 06. 사용자 정의 오류보다는 표준 오류를 사용하라]]></description><link>https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-06</link><guid isPermaLink="false">https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-06</guid><pubDate>Tue, 08 Feb 2022 01:30:00 GMT</pubDate><content:encoded>&lt;p&gt;require, check, assert 등을 사용하면 대부분 코틀린 오류를 처리할 수 있지만
이외의 예측하지 못한 상황을 나타내야 하는 경우가 존재한다.&lt;/p&gt;
&lt;p&gt;JSON 형식을 파싱하는 라이브러리 구현 시 JSON 파일 형식에 문제가 있다면 JSONPArsingException을 발생시키는 것이 좋다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;inline fun &amp;lt;reified T&amp;gt; String.readObject(): T {
    //...
    if (incorrectSign) {
        throw JsonParsingException()
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위에서는 표준 라이브러리에 이를 나타내는 적절한 오류가 없어서 사용자 정의 오류를 사용했다.&lt;/p&gt;
&lt;p&gt;하지만 가급적 직접 정의하기 보다는 최대한 표준 라이브러리에 존재하는 오류를 사용하는 것이 좋다.&lt;/p&gt;
&lt;p&gt;표준 라이브러리의 예외는 많은 개발자가 알고 있으므로 널리 알려진 요소를 재사용하면 다른 사람들이 API를 더 쉽게 배우고 이해할 수 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;IllegalArgumentException, IllegalStateException&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;IndexOutOfBoundsException&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;컬렉션 또는 배열에서 인덱스 파라미터 값이 범위를 벗어난 경우&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ConcurrentModificationException&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;동시 수정을 금지하는데 발생한 경우&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;UnsupportedOperationException&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;사용하려던 메소드는 현재 객체에서 사용할 수 없다는 것을 나타냄&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;기본적으로 사용할 수 없는 메소드는 클래스에 없는 것이 좋다.&lt;/p&gt;
&lt;p&gt;사용할 수 없는 메소드를 일부러 두는 경우도 있음 → listOf로 만든 컬렉션은 Immutable임을 알려주기 위한 목적으로 add를 호출 시 무조건 오류가 발생한다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;NoSuchElementException&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;사용자가 사용하려던 요소가 존재하지 않음을 나타냄&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;책 내용에서 가급적 표준 오류를 다루라고 했지만 아래와 같은 사례도 존재하므로 무조건적으로 표준 오류를 사용하기 보다는 팀 구성원들의 의견을 종합해 처리하는게 좋을 것 같습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;컨트롤러 레이어에서 JPA의 &lt;code class=&quot;language-text&quot;&gt;Dataintegrityviolationexception&lt;/code&gt; 과 같은 저수준 예외를 활용하는 경우&lt;/li&gt;
&lt;li&gt;require나 check에서 발생시키는 예외가 이미 구현된 예외 처리 구문과 겹쳐 예외를 구분해야 하거나 하는 경우&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;이펙티브 코틀린 - 프로그래밍 인사이트, 마르친 모스칼라 지음, 윤인성 옮김&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;개인적인 기록을 위해 작성된 글이라 잘못된 내용이 있을 수 있습니다.&lt;/p&gt;
&lt;p&gt;오류가 있다면 댓글을 남겨주세요.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[이펙티브 코틀린 아이템 05. 예외를 활용해 코드에 제한을 걸어라]]></title><description><![CDATA[Effective Kotlin Item 05. 예외를 활용해 코드에 제한을 걸어라]]></description><link>https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-05</link><guid isPermaLink="false">https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-05</guid><pubDate>Tue, 08 Feb 2022 01:00:00 GMT</pubDate><content:encoded>&lt;p&gt;확실하게 어떤 형태로 동작해야 하는 코드가 있다면, 예외를 활용해 제한을 걸어주는 것이 좋다.&lt;/p&gt;
&lt;p&gt;코틀린에서는 코드의 동작에 제한을 걸때 다음과 같은 방법을 사용할 수 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;require&lt;/li&gt;
&lt;li&gt;check&lt;/li&gt;
&lt;li&gt;assert(테스트 에서만 작동)&lt;/li&gt;
&lt;li&gt;return 또는 throw와 함께 사용하는 Evlis operator&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;fun pop(num: Int = 1): List&amp;lt;T&amp;gt; {
    require(num &amp;lt;= size) {
        &amp;quot;Cannot remove more elements than current size&amp;quot;
    }
    // 생략
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위와 같이 제한을 걸어주면 아래와 같은 장점이 존재한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;제한을 걸면 문서를 읽지 않은 개발자도 문제를 확인할 수 있다.&lt;/li&gt;
&lt;li&gt;문제가 있을 경우 함수가 예상하지 못한 동작을 하지 않고 예외를 throw 한다. throw를 하지 않고 예상하지 못한 동작을 하는 것은 예외를 throw 하는 것 보다 위험하며, 상태를 관리하기 어렵다.&lt;/li&gt;
&lt;li&gt;코드가 어느정도 자체적으로 검사되어 위와 관련된 테스트를 줄일 수 있다.&lt;/li&gt;
&lt;li&gt;스마트 캐스트를 활용할 수 있게 되어, 캐스트를 적게 할 수 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;아규먼트&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%95%84%EA%B7%9C%EB%A8%BC%ED%8A%B8&quot; aria-label=&quot;아규먼트 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;아규먼트&lt;/h2&gt;
&lt;p&gt;함수를 정의할 때 타입 시스템을 활용해 아래와 같이 argument에 제한을 거는 코드를 많이 사용한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;숫자를 아규먼트로 받아 팩토리얼을 계산한다면 숫자는 양의 정수여야 한다.&lt;/li&gt;
&lt;li&gt;좌표들을 아규먼트로 받아서 클러스터를 찾을 때는 비어있지 않은 좌표 목록이 필요하다.&lt;/li&gt;
&lt;li&gt;사용자로부터 이메일 주소를 받을 때 값이 입력되어 있는지, 형식이 올바른지 체크해야 한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;일반적으로 이러한 제한을 걸 때 require 함수를 사용한다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;fun factorial(n: Int): Long {
    require(n &amp;gt;= 0)
    //
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;상태&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%83%81%ED%83%9C&quot; aria-label=&quot;상태 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;상태&lt;/h2&gt;
&lt;p&gt;아래와 같은 경우, 어떤 구체적인 조건을 만족할 때만 함수를 사용할 수 있게 해야 한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;어떤 객체가 미리 초기화되어 있어야만 처리를 하게 하고 싶은 함수&lt;/li&gt;
&lt;li&gt;사용자가 로그인했을 때만 처리를 하게 하고 싶은 함수&lt;/li&gt;
&lt;li&gt;객체를 사용할 수 있는 시점에 사용하고 싶은 함수&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;위와 같이 상태와 관련된제한을 할 때는 일반적으로 check를 사용한다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;fun speak(text: String) {
    check(isInitialized)
    // ..
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;이러한 확인은 사용자가 규약을 어기고 사용하면 안되는 곳에서 함수를 호출하고 있다고 의심될 때 한다.&lt;/p&gt;
&lt;p&gt;사용자가 코드를 제대로 사용할거라고 믿기 보다는 문제 상황을 예측하고, 문제 상황에 예외를 throw 하는 것이 좋다.&lt;/p&gt;
&lt;h2 id=&quot;assert--계열-함수-사용&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#assert--%EA%B3%84%EC%97%B4-%ED%95%A8%EC%88%98-%EC%82%AC%EC%9A%A9&quot; aria-label=&quot;assert  계열 함수 사용 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Assert  계열 함수 사용&lt;/h2&gt;
&lt;p&gt;단위 테스트에서의 Assert 계열 함수 사용에 대해 다룬다.&lt;/p&gt;
&lt;p&gt;자세한 내용은 생략&lt;/p&gt;
&lt;h2 id=&quot;nullability와-스마트-캐스팅&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#nullability%EC%99%80-%EC%8A%A4%EB%A7%88%ED%8A%B8-%EC%BA%90%EC%8A%A4%ED%8C%85&quot; aria-label=&quot;nullability와 스마트 캐스팅 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;nullability와 스마트 캐스팅&lt;/h2&gt;
&lt;p&gt;코틀린에서 require와 check로 조건을 확인해 true가 나오면 해당 조건은 이후로도 true일 거라고 가정한다.&lt;/p&gt;
&lt;p&gt;따라서 이를 활용해 타입 비교를 한다면 스마트 캐스트가 작동한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Smart cast&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;fun changeDress(person: Person) {
    require(person.outfit is Dress)
    val dress: Dress = person.outfit // person.outfit은 스마트 캐스트로 인해 Dress 타입 보장
    // ..
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;requireNotNull, checkNotNull을 활용한 unpack&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;위와 같은 특징은 대상이 null인지 체크하는데 유용하며, 이 경우 requireNotNull, checkNotNull이라는 특수한 함수를 사용해도 좋다.&lt;/p&gt;
&lt;p&gt;둘 다 스마트 캐스트를 지원하므로 변수를 언팩(unpack)하는 용도로 활용할 수 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;class Person(val email: String?)
fun validateEmail(email: String) { }

fun sendEmail(person: Person, text: String) {
    val email = requireNotNull(person.email)
    validateEmail(email)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;Elvis operator 활용&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;nullability를 목적으로 오른쪽에 throw 혹은 return을 두고 Elvis operator를 활용하는 경우가 많다.&lt;/p&gt;
&lt;p&gt;이러한 코드는 굉장히 읽기 쉽고, 유연하게 사용할 수 있다.&lt;/p&gt;
&lt;p&gt;첫번째로 오른쪽에 return을 넣으면 오류 없이 단순히 함수를 중지할 수도 있음&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;fun sendEmail(person: Person, text: String) {
    val email: String = person.email ?: return
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;return / throw와 run 활용&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;프로퍼티에 문제가 있어서 null 일 때 여러 처리가 필요한 경우 return / throw와 run을 조합해 사용할 수 있다.&lt;/p&gt;
&lt;p&gt;이는 함수가 중지된 이유를 로그에 출력해야 할 때 사용할 수 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;fun sendEmail(person: Person, text: String) {
    val email: String = person.email ?: run {
        log(&amp;quot;Email not sent, no email adress&amp;quot;)
        return
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;정리&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A0%95%EB%A6%AC&quot; aria-label=&quot;정리 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;정리&lt;/h2&gt;
&lt;p&gt;이번 절에서 활용한 내용을 기반으로 아래와 같은 이득을 얻을 수 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;제한을 훨씬 더 쉽게 확인할 수 있다.&lt;/li&gt;
&lt;li&gt;애플리케이션을 더 안정적으로 지킬 수 있다.&lt;/li&gt;
&lt;li&gt;코드를 잘못 쓰는 상황을 막을 수 있다.&lt;/li&gt;
&lt;li&gt;스마트 캐스팅을 활용할 수 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;활용한 메커니즘&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;require block&lt;/li&gt;
&lt;li&gt;check block&lt;/li&gt;
&lt;li&gt;assert block&lt;/li&gt;
&lt;li&gt;return, throw, elvis operator&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;이펙티브 코틀린 - 프로그래밍 인사이트, 마르친 모스칼라 지음, 윤인성 옮김&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;개인적인 기록을 위해 작성된 글이라 잘못된 내용이 있을 수 있습니다.&lt;/p&gt;
&lt;p&gt;오류가 있다면 댓글을 남겨주세요.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[이펙티브 코틀린 아이템 04. inferred 타입으로 리턴하지 말라]]></title><description><![CDATA[Effective Kotlin Item 04. inferred 타입으로 리턴하지 말라]]></description><link>https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-04</link><guid isPermaLink="false">https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-04</guid><pubDate>Tue, 08 Feb 2022 00:50:00 GMT</pubDate><content:encoded>&lt;p&gt;코틀린의 타입 추론(type inference)을 사용할 때 몇가지 위험한 부분들이 존재한다.&lt;/p&gt;
&lt;p&gt;inferred 타입을 사용하면 슈퍼클래스나 인터페이스로 설정되지 않으며, 정확하게 오른쪽에 있는 피연산자에 맞게 설정되는 문제가 존재한다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;open class Animal
class Zebra: Animal()

fun main() {
    var animal = Zebra()
    animal = Animal() // Type mismatch
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;일반적으로는 위와 같은 상황이 문제가 되지 않으며 타입을 명시적으로 지정해 해결할 수 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;open class Animal
class Zebra: Animal()

fun main() {
    // 타입 명시적 지정
    var animal: Animal = Zebra()
    animal = Animal()
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;하지만 직접 라이브러리 또는 모듈을 조작할 수 없는 경우 이러한 문제를 간단하게 해결할 수 없다.&lt;/p&gt;
&lt;p&gt;inferred 타입을 노출하면 아래와 같이 위험한 일이 발생할 수 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;interface CarFactory {
    fun produce(): Car
}

val DEFAULT_CAR: Car = Fiat126P()&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위 코드를 아래와 같이 Default를 지정해 inferred 타입을 사용하고 리턴 타입을 제거하면 CarFactory 인터페이스에서는 Fiat126P 이외의 자동차를 생산할 수 없게 된다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;interface CarFactory {
    fun produce() = DEFAULT_CAR
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;정리&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A0%95%EB%A6%AC&quot; aria-label=&quot;정리 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;정리&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;타입을 확실하게 지정해야 하는 경우 명시적으로 타입을 지정해야 한다는 원칙을 가져야 한다.&lt;/li&gt;
&lt;li&gt;안전을 위해 외부 API를 만들때는 반드시 타입을 지정하고 이렇게 지정한 타입을 특별한 이유와 확실한 확인 없이 제거하지 말자&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;이펙티브 코틀린 - 프로그래밍 인사이트, 마르친 모스칼라 지음, 윤인성 옮김&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;개인적인 기록을 위해 작성된 글이라 잘못된 내용이 있을 수 있습니다.&lt;/p&gt;
&lt;p&gt;오류가 있다면 댓글을 남겨주세요.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[이펙티브 코틀린 아이템 03. 최대한 플랫폼 타입을 사용하지 말라]]></title><description><![CDATA[Effective Kotlin Item 03. 최대한 플랫폼 타입을 사용하지 말라]]></description><link>https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-03</link><guid isPermaLink="false">https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-03</guid><pubDate>Tue, 08 Feb 2022 00:40:00 GMT</pubDate><content:encoded>&lt;p&gt;자바에서 자주 볼 수 있었던 NPE는 코틀린의 null-safety 메커니즘으로 인해 거의 찾아보기 힘들지만 자바와 코틀린을 연결해서 사용할 때는 이러한 예외가 발생할 수 있다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;@NotNull&lt;/code&gt; 혹은 &lt;code class=&quot;language-text&quot;&gt;@Nullable&lt;/code&gt; 이 붙은 경우라면 String, String?으로 추정 및 변경이 가능하지만 &lt;strong&gt;어노테이션이 없다면 모든 것을 nullable로 가정&lt;/strong&gt;하고 다루어야 한다.&lt;/p&gt;
&lt;p&gt;nullable과 가장 많은 문제가 되는 부분은 자바의 제네릭 타입이다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;public class UserRepo {
    public List&amp;lt;User&amp;gt; getUsers() {
        // **
    }
}

val users: List&amp;lt;User&amp;gt; = UserRepo().users!!.filterNotNull()&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위와 같이 리스트 자체가 null인지, 내부 데이터가 널인지 등을 체크해야 하며 리스트가 아닌 map, filterNotNull 등의 메소드를 제공하지 않는 다른 제네릭 타입이라면 null 확인 자체가 복잡한 일이 된다.&lt;/p&gt;
&lt;h3 id=&quot;플랫폼-타입&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%94%8C%EB%9E%AB%ED%8F%BC-%ED%83%80%EC%9E%85&quot; aria-label=&quot;플랫폼 타입 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;strong&gt;플랫폼 타입&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;위와 같은 문제 때문에 코틀린은 자바 등 다른 프로그래밍 언어에서 넘어온 타입을 특수하게 다루며 이를 &lt;strong&gt;플랫폼 타입(platform type)&lt;/strong&gt;이라고 부른다.
플랫폼 타입은 String! 처럼 뒤에 ! 기호를 붙여서 표기한다. (직접적으로 코드에 나타나지는 않음)&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val repo = UserRepo()
val user1 = repo.user // user1: User!
val user2: User = repo.user // user2: User
val user1: User? = repo.user // user3: User?&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위와 같이 사용이 가능하기 때문에 null 체크 등의 복잡한 문제는 사라진다.&lt;/p&gt;
&lt;p&gt;하지만 여전히 null일 가능성이 존재하므로 플랫폼 타입을 사용할 때는 항상 주의를 기울여야 한다.&lt;/p&gt;
&lt;p&gt;가급적 자바를 코틀린과 함께 사용할 때 자바 코드에 아래와 같이 어노테이션(NotNull, Nullable)을 붙여 사용하자.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;public @NotNull User getUser() {
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;현재 다음과 같은 어노테이션이 지원되고 있음&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;org.jetbrains.annotations &lt;code class=&quot;language-text&quot;&gt;@Nullable&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;@NotNull&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;JSR-305, javax.annotation &lt;code class=&quot;language-text&quot;&gt;@Nullable&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;@Nonnull&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;@CheckForNull&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;JavaX, javax.annotation &lt;code class=&quot;language-text&quot;&gt;@Nullable&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;@Nonnull&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;@CheckForNull&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;기타 등등&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;JSR-305의 &lt;code class=&quot;language-text&quot;&gt;@ParametersAreNonnullbyDefault&lt;/code&gt; 를 사용하면 자바에서도 디폴트로 파라미터가 널이 아님을 보장할 수 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;public class JavaClass {
    public String getValue() {
        return null;
    }
}

fun statedType() {
    // NPE
    val value: String = JavaClass().value

    println(value.length)
}

fun platformType() {
    val value = JavaClass().value

    // NPE
    println(value.length)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위 케이스에서 statedType은 값을 가져오는 경우에 즉시 NPE가 발생하지만 platformType은 length를 호출할 때 NPE가 발생한다.&lt;/p&gt;
&lt;p&gt;이러한 변수를 한 두번 안전하게 사용하더라도 이후에 다른 사람이 사용할 때 NPE가 발생하지 않은거란 보장이 없음 때문에 이와 같은 &lt;strong&gt;플랫폼 타입은 최대한 빨리 제거&lt;/strong&gt;하는 것이 좋다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;interface UserRepo {
    fun getUserName() = JavaClass().value
}

class RepoImpl: UserRepo {
    override fun getUserName(): String? {
        return null
    }
}

fun main() {
    val repo: UserRepo = RepoImpl()
    val text: String = repo.getUserName() // Runtime에 NPE
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위의 예제에서도 디폴트 메소드가 inferred type(추론된 타입)이며 플랫폼 타입으로 지정되기 때문에 사용하는 사람이 nullable이 아닐거라고 받아들이면 런타임에 NPE가 발생할 수 있다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;위와 같은 문제를 IDE에서 친절하게 알려주긴 합니다.
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2567854fee0a640b5bb1145faa9019f8/75d3b/inferred-type-ide.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 10.833333333333334%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsSAAALEgHS3X78AAAAgElEQVQI10XIyQrCMABF0X6JoChCh5gmndJZoTZFV2JL/f8PudZsXBy473lZ/kZ2M/K6IPsF1czE+omuV1T9Iam2v3wR9CtCTYh4JHLs1n+/7YsBb7dXnM45dfugqCymmiiM3YzkxZ00GzClJdE3/LAhunQEUUMoWteO6Nw+HFO+SOlCrE+wVE8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/2567854fee0a640b5bb1145faa9019f8/8ac56/inferred-type-ide.webp 240w,
/static/2567854fee0a640b5bb1145faa9019f8/d3be9/inferred-type-ide.webp 480w,
/static/2567854fee0a640b5bb1145faa9019f8/e46b2/inferred-type-ide.webp 960w,
/static/2567854fee0a640b5bb1145faa9019f8/f992d/inferred-type-ide.webp 1440w,
/static/2567854fee0a640b5bb1145faa9019f8/882b9/inferred-type-ide.webp 1920w,
/static/2567854fee0a640b5bb1145faa9019f8/ee81e/inferred-type-ide.webp 1966w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/2567854fee0a640b5bb1145faa9019f8/8ff5a/inferred-type-ide.png 240w,
/static/2567854fee0a640b5bb1145faa9019f8/e85cb/inferred-type-ide.png 480w,
/static/2567854fee0a640b5bb1145faa9019f8/d9199/inferred-type-ide.png 960w,
/static/2567854fee0a640b5bb1145faa9019f8/07a9c/inferred-type-ide.png 1440w,
/static/2567854fee0a640b5bb1145faa9019f8/29114/inferred-type-ide.png 1920w,
/static/2567854fee0a640b5bb1145faa9019f8/75d3b/inferred-type-ide.png 1966w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/2567854fee0a640b5bb1145faa9019f8/d9199/inferred-type-ide.png&quot;
          alt=&quot;inferred-type-ide&quot;
          title=&quot;inferred-type-ide&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;정리&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A0%95%EB%A6%AC&quot; aria-label=&quot;정리 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;정리&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;다른 프로그래밍 언어에서 와서 nullable 여부를 알 수 없는 값을 플랫폼 타입이라고 한다.&lt;/li&gt;
&lt;li&gt;사용하는 부분 뿐만 아니라 활용하는 곳 까지 영향을 줄 수 있는 위험한 코드이며 빨리 해당 코드를 제거하는게 좋다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;이펙티브 코틀린 - 프로그래밍 인사이트, 마르친 모스칼라 지음, 윤인성 옮김&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;개인적인 기록을 위해 작성된 글이라 잘못된 내용이 있을 수 있습니다.&lt;/p&gt;
&lt;p&gt;오류가 있다면 댓글을 남겨주세요.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[이펙티브 코틀린 아이템 02. 변수의 스코프를 최소화하라]]></title><description><![CDATA[Effective Kotlin Item 02. 변수의 스코프를 최소화하라]]></description><link>https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-02</link><guid isPermaLink="false">https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-02</guid><pubDate>Tue, 08 Feb 2022 00:10:00 GMT</pubDate><content:encoded>&lt;p&gt;상태 정의 시 변수와 프로퍼티의 스코프를 최소화 하는 것이 좋다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;프로퍼티 보다는 지역 변수를 사용한다.&lt;/li&gt;
&lt;li&gt;최대한 좁은 스코프를 갖게 변수를 사용한다. 예를 들어 반복문 내부에서만 사용되면 변수를 반복문 내부에 작성하는것이 좋다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;변수는 읽기 전용 전용 여부와 상관 없이 if, when, try-catch, elvis operator 등을 활용해 변수를 정의할 때 초기화되는 것이 좋다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;fun updateWeather(degrees: Int) {
    val (description, color) = when {
        degrees &amp;lt; 5 -&amp;gt; &amp;quot;cold to Color.BLUE
        else -&amp;gt; &amp;quot;hot&amp;quot; to Colodr.RED
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;여러 프로퍼티를 한꺼번에 설정해야 하는 경우 위처럼 destructuring declaration을 활용한다.&lt;/p&gt;
&lt;h2 id=&quot;캡처링&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%BA%A1%EC%B2%98%EB%A7%81&quot; aria-label=&quot;캡처링 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;캡처링&lt;/h2&gt;
&lt;p&gt;에라토스테네스의 체 구현 시 아래와 같은 코드를 작성할 수 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val primes: Sequence&amp;lt;Int&amp;gt; = sequence {
    var numbers = generateSequence(2) { it + 1 }

    while (true) {
        val prime = numbers.first()
        yield(prime)
        numbers = numbers.drop(1)
            .filter { it % prime != 0 }
    }
}

println(primes.take(10).toList())
// [2, 3, 5, 7, 11, 13, 17, 19, 23, 29]&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위 코드를 아래와 같이 최적화하려고 시도하는 경우 문제가 발생한다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val primes: Sequence&amp;lt;Int&amp;gt; = sequence {
    var numbers = generateSequence(2) { it + 1 }

    // while 스코프 바깥에 var로 정의
    var prime: Int
    while (true) {
        prime = numbers.first()
        yield(prime)
        numbers = numbers.drop(1)
            .filter { it % prime != 0 }
    }
}

println(primes.take(10).toList())
// [2, 3, 5, 6, 7, 8, 9, 10, 11, 12]&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위와 같은 문제가 발생할 수 있으므로 &lt;strong&gt;가변성을 피하고 스코프 범위를 좁게&lt;/strong&gt; 만들어 이런 문제를 간단하게 피해갈 수 있다.&lt;/p&gt;
&lt;p&gt;Sequence를 많이 사용해보지 않아 조금 헷갈렸는데, var를 사용할 때 prime 값이 ObjectRef로 캡처링되면서 지연 필터링이 우리가 의도한 대로 동작하지 않는 것 같습니다.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://medium.com/@yangweigbh/how-kotlin-lambda-capture-variable-ef90e11e531d&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Kotlin Lambda Capture Variable&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;정리&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A0%95%EB%A6%AC&quot; aria-label=&quot;정리 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;정리&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;변수의 스코프는 좁게 만들어서 활용하자.&lt;/li&gt;
&lt;li&gt;var 보다는 val을 사용하는 것이 좋다.&lt;/li&gt;
&lt;li&gt;람다에서 변수를 캡처한다는 것을 기억하자.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;이펙티브 코틀린 - 프로그래밍 인사이트, 마르친 모스칼라 지음, 윤인성 옮김&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;개인적인 기록을 위해 작성된 글이라 잘못된 내용이 있을 수 있습니다.&lt;/p&gt;
&lt;p&gt;오류가 있다면 댓글을 남겨주세요.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[이펙티브 코틀린 아이템 01. 가변성을 제한하라]]></title><description><![CDATA[Effective Kotlin Item 01. 가변성을 제한하라]]></description><link>https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-01</link><guid isPermaLink="false">https://kyucumber.github.io/posts/book/effective-kotlin/effective-kotlin-item-01</guid><pubDate>Tue, 08 Feb 2022 00:00:00 GMT</pubDate><content:encoded>&lt;h2 id=&quot;코틀린에서-가변성-제한하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%BD%94%ED%8B%80%EB%A6%B0%EC%97%90%EC%84%9C-%EA%B0%80%EB%B3%80%EC%84%B1-%EC%A0%9C%ED%95%9C%ED%95%98%EA%B8%B0&quot; aria-label=&quot;코틀린에서 가변성 제한하기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;코틀린에서 가변성 제한하기&lt;/h2&gt;
&lt;p&gt;코틀린에서 가변성을 제한하기 위해 굉장히 많은 방법을 활용할 수 있지만
많이 사용되고 중요한 방법은 아래와 같다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;읽기 전용 프로퍼티(val)&lt;/li&gt;
&lt;li&gt;가변 컬렉션과 읽기 전용 컬렉션 구분&lt;/li&gt;
&lt;li&gt;데이터 클래스의 copy&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;읽기-전용-프로퍼티val&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%9D%BD%EA%B8%B0-%EC%A0%84%EC%9A%A9-%ED%94%84%EB%A1%9C%ED%8D%BC%ED%8B%B0val&quot; aria-label=&quot;읽기 전용 프로퍼티val permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;읽기 전용 프로퍼티(val)&lt;/h3&gt;
&lt;p&gt;코틀린에서는 val 키워드로 읽기 전용 프로퍼티를 만들 수 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;읽기 전용 프로퍼티로 정의해도 Mutable한 데이터를 담고 있다면 내부적으로 변경이 가능하다&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;가변-컬렉션과-읽기-전용-컬렉션-구분하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EA%B0%80%EB%B3%80-%EC%BB%AC%EB%A0%89%EC%85%98%EA%B3%BC-%EC%9D%BD%EA%B8%B0-%EC%A0%84%EC%9A%A9-%EC%BB%AC%EB%A0%89%EC%85%98-%EA%B5%AC%EB%B6%84%ED%95%98%EA%B8%B0&quot; aria-label=&quot;가변 컬렉션과 읽기 전용 컬렉션 구분하기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;가변 컬렉션과 읽기 전용 컬렉션 구분하기&lt;/h3&gt;
&lt;p&gt;아래와 같은 컬렉션 다운 캐스팅 금지&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val list = listOf(1,2,3)

if (list is MutableList) {
    list.add(4)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;JVM 기준 Arrays.ArrayList에는 add가 구현되어 있지 않아 UnsupportedOperationException이 발생한다.&lt;/p&gt;
&lt;p&gt;읽기 전용에서 가변으로 변경하려면 아래와 같은 toMutableList를 활용한다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val list = listOf(1,2,3)

val mutable = list.toMutableList()&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 id=&quot;데이터-클래스의-copy&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%81%B4%EB%9E%98%EC%8A%A4%EC%9D%98-copy&quot; aria-label=&quot;데이터 클래스의 copy permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;데이터 클래스의 copy&lt;/h3&gt;
&lt;p&gt;Immutable 객체를 사용하면 아래와 같은 장점이 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;한번 정의된 상태가 유지되므로 코드를 이해하기 쉽다.&lt;/li&gt;
&lt;li&gt;Immutable 객체는 공유시에도 충돌이 발생하지 않아 병렬 처리를 안전하게 할 수 있다.&lt;/li&gt;
&lt;li&gt;Immutable 객체에 대한 참조는 변경되지 않으므로, 쉽게 캐시할 수 있다.&lt;/li&gt;
&lt;li&gt;Immutable 객체의 방어적 복사본을 만들 필요가 없다. 또한 깊은 복사를 따로 할 필요가 없다.&lt;/li&gt;
&lt;li&gt;Immutable 객체는 다른 객체를 만들때 활용하기 좋으며 실행을 더 쉽게 예측할 수 있다.&lt;/li&gt;
&lt;li&gt;Imuutable 객체는 Set 혹은 Map의 키로 활용할 수 있다. (Mutable은 요소에 수정이 일어나면 해시 테이블 내부에서 요소를 찾을 수 없어 활용할 수 없음)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Int와 같이 내부적으로 plus, minus와 같이 불변한 Int를 리턴하는 메소드를 만들어 불변을 유지할 수 있다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;매번 모든 프로퍼티 대상으로 plus, minus와 같은 함수를 만드는 것은 번거로우니 data class 및 copy 메소드를 활용하자&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;다른-종류의-변경-가능-지점mutating-point&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%8B%A4%EB%A5%B8-%EC%A2%85%EB%A5%98%EC%9D%98-%EB%B3%80%EA%B2%BD-%EA%B0%80%EB%8A%A5-%EC%A7%80%EC%A0%90mutating-point&quot; aria-label=&quot;다른 종류의 변경 가능 지점mutating point permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;다른 종류의 변경 가능 지점(mutating point)&lt;/h2&gt;
&lt;p&gt;변경 가능한 리스트를 만들 때 아래와 같은 두가지 선택지가 존재한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;val + MutableList&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val list1: MutableList&amp;lt;Int&amp;gt; = mutableListOf()&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;var + ImmutableList&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;var list2: List&amp;lt;Int&amp;gt; = listOf()&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;두 가지 모두 변경은 가능하지만 내부적인 동작이 다르다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;list1 += 1 // list1.plusAssign(1)
list2 += 1 // list2.plus(1)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;첫번째 코드는 멀티스레드 처리 시 내부의 동기화 여부를 알 수 없어 위험하며 두번째 코드가 멀티스레드 안정성이 더 좋다. (하지만 잘못 만들면 일부 요소의 손실 가능)&lt;/p&gt;
&lt;p&gt;mutable 프로퍼티를 사용하면 사용자 정의 setter(또는 이를 사용하는 델리게이트)를 활용해 변경을 추적할 수 있음&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;var names by Delegates.observable(listOf&amp;lt;String&amp;gt;()) { _, old, new -&amp;gt; 
    println(&amp;quot;Names chanaged from $old to $new&amp;quot;)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;MutableCollection 대신 mutable 프로퍼티인 var를 활용하는게 객체 변경을 더 제어하기가 쉽다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;최악의 방법은 프로퍼티와 컬렉션 모두 Mutable로 만드는 것&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;var list = mutableListOf&amp;lt;Int&amp;gt;()

list += 1 // 모호성이 발생해 해당 연산자 사용 불가능&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;변경-가능-지점-노출하지-말기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%B3%80%EA%B2%BD-%EA%B0%80%EB%8A%A5-%EC%A7%80%EC%A0%90-%EB%85%B8%EC%B6%9C%ED%95%98%EC%A7%80-%EB%A7%90%EA%B8%B0&quot; aria-label=&quot;변경 가능 지점 노출하지 말기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;변경 가능 지점 노출하지 말기&lt;/h2&gt;
&lt;p&gt;Mutable 객체가 외부에 노출되는 경우 수정이 발생할 수 있으니 위험하다.&lt;/p&gt;
&lt;p&gt;리턴되는 mutable 객체 복제해 반환하는 &lt;strong&gt;방어적 복제(defensive copying)&lt;/strong&gt; 사용&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;class UserHolder {
   private val user: MutableUser()

   fun get(): MutableUser {
       return user.copy()
   }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;정리&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A0%95%EB%A6%AC&quot; aria-label=&quot;정리 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;정리&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;var 보다는 val 사용&lt;/li&gt;
&lt;li&gt;mutable 프로퍼티보다는 immutable 프로퍼티 사용&lt;/li&gt;
&lt;li&gt;mutable 객체와 클래스 보다는 immutable 객체와 클래스 사용&lt;/li&gt;
&lt;li&gt;변경이 필요한 대상이 있다면 immutable data class로 만들고 copy 활용&lt;/li&gt;
&lt;li&gt;컬렉션에 상태를 저장해야 한다면, mutable 보다는 immutable 컬렉션 사용&lt;/li&gt;
&lt;li&gt;변이 지점을 적절하게 설게하고 불필요한 변이 지점을 만들지 않는게 좋다.&lt;/li&gt;
&lt;li&gt;mutable 객체의 외부 노출은 피하자.&lt;/li&gt;
&lt;li&gt;효율성 때문에 immutable 보다 mutable을 다루는게 좋은 경우도 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;이펙티브 코틀린 - 프로그래밍 인사이트, 마르친 모스칼라 지음, 윤인성 옮김&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;개인적인 기록을 위해 작성된 글이라 잘못된 내용이 있을 수 있습니다.&lt;/p&gt;
&lt;p&gt;오류가 있다면 댓글을 남겨주세요.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[spring data redis에서 atomic operation 보장을 위해 Lua script 활용하기]]></title><description><![CDATA[spring data redis에서 atomic operation 보장을 위해 Lua script를 사용하는 법을 정리합니다]]></description><link>https://kyucumber.github.io/posts/spring/spring-data-redis-atomic-operations/</link><guid isPermaLink="false">https://kyucumber.github.io/posts/spring/spring-data-redis-atomic-operations/</guid><pubDate>Fri, 10 Dec 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;팀 내에서 서비스 운영을 위해 Redis Clutser를 사용하고 있으며
내부 코드에 아래와 같이 PartialUpdate를 사용해 구현된 부분이 존재합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;redisKVTemplate.update(
    PartialUpdate(id, Data::class.java)
        .set(&amp;quot;timeout&amp;quot;, timeout)
        .set(&amp;quot;accessedAt&amp;quot;, accessedAt)
)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;내부적으로 Data의 만료 여부를 체크하고 만료된 데이터를 삭제하는 로직이 존재하는데
멀티 인스턴스에서 여러 operation이 들어오다 보니 &lt;strong&gt;삭제된 이후에 Data에 대한 PartialUpdate가 수행&lt;/strong&gt;되는 경우가 빈번하게 발생했습니다.&lt;/p&gt;
&lt;deckgo-highlight-code   terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;org.springframework.data.mapping.model.MappingInstantiationException: Failed to instantiate data.Data using constructor fun &amp;lt;init&amp;gt;(kotlin.String, kotlin.String, kotlin.String, kotlin.String, kotlin.String, java.time.Instant, java.time.Instant, kotlin.Long):&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;삭제된 이후 PartialUpdate를 수행하면 timeout, accessedAt 값 이외의 값들이 존재하지 않게 되며
해당 값들은 Kotlin에서 non null 타입으로 정의되어 있어 위와 같은 예외가 발생하게 됩니다.&lt;/p&gt;
&lt;p&gt;서비스에 큰 이슈는 없는 상황이라 방치하고 있었지만 atomic operation을 보장해 위와 같은 케이스가 발생하지 않도록 수정이 필요했습니다.&lt;/p&gt;
&lt;h2 id=&quot;redis와-transaction&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#redis%EC%99%80-transaction&quot; aria-label=&quot;redis와 transaction permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Redis와 Transaction&lt;/h2&gt;
&lt;p&gt;Cluster 모드가 아닌 경우라면 MULTI, EXEC, DISCARD, WATCH 등의 키워드를 이용해 spring-data-redis 내에서 트랜잭션을 보장할 수 있습니다.&lt;/p&gt;
&lt;p&gt;하지만 &lt;a href=&quot;https://stackoverflow.com/questions/43124168/is-transaction-multi-exec-supported-in-spring-data-redis-in-a-cluster-mode&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;클러스터 모드를 사용하는 경우 spring-data-redis 내부에서는 트랜잭션 보장을 지원하지 않습니다&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;따라서 spring-data-redis의 트랜잭션 서포트를 기대할 수 없는 상황이며 atomic operation 보장을 위해서 다른 방법을 사용해야 합니다.&lt;/p&gt;
&lt;p&gt;Redis는 서버 내부의 Lua 인터프리터를 이용해 Lua script로 작성된 코드를 해석하고 실행할 수 있습니다.
Lua script를 활용해 여러 명령어를 조합할 수 있으며, 스크립트 자체가 하나의 명령어와 같이 동작하기 때문에 atomic operation을 보장할 수 있습니다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Lua script를 사용하더라도 여러 샤드에 있는 키를 조작하거나 하는 행동은 불가능하므로 스크립트에 관련된 키가 단일 샤드에서 실행되도록 보장해야 합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;spring-data-redis와-lua-script&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#spring-data-redis%EC%99%80-lua-script&quot; aria-label=&quot;spring data redis와 lua script permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;spring data redis와 Lua script&lt;/h2&gt;
&lt;p&gt;spring-data-redis에서는 &lt;a href=&quot;https://github.com/spring-projects/spring-data-redis/blob/main/src/main/asciidoc/reference/redis-scripting.adoc&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Lua script의 사용을 지원&lt;/a&gt;합니다.&lt;/p&gt;
&lt;p&gt;atomic을 보장하고 싶은 operation의 내용은 아래와 같습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Hash의 특정 field가 존재하는 경우에만 PartialUpdate를 수행한다.&lt;/li&gt;
&lt;li&gt;Hash의 특정 field가 존재하지 않는 경우 해당 키의 데이터를 제거한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;해당 operation의 수행을 위해
아래와 같은 Lua script 작성 및 설정을 통해 atomic operation을 보장할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;resources/scripts/update_data_if_exist.lua&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;lua&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;-- update_data_if_exist.lua
if redis.call(&amp;#39;HEXISTS&amp;#39;, KEYS[1], &amp;#39;username&amp;#39;)==1 then
  redis.call(&amp;#39;HSET&amp;#39;, KEYS[1], &amp;#39;timeout&amp;#39;, ARGV[1])
  redis.call(&amp;#39;HSET&amp;#39;, KEYS[1], &amp;#39;accessedAt&amp;#39;, ARGV[2])
else
  redis.call(&amp;#39;DEL&amp;#39;, KEYS[1])
end&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;RedisLuaScriptConfig&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;@Configuration
class RedisLuaScriptConfig {
    @Bean
    fun updateIfExistScript(): RedisScript&amp;lt;Unit&amp;gt; =
        RedisScript.of(ResourceScriptSource(ClassPathResource(&amp;quot;scripts/update_data_if_exist.lua&amp;quot;)).scriptAsString)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;DataRepository&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;interface DataRepository : CrudRepository&amp;lt;Data, String&amp;gt;, DataCustomRepository

interface DataCustomRepository {
    fun updateTimeoutAndAccessedAt(data: Data, accessedAt: Instant = Instant.now())
}

@Repository
class DataCustomRepositoryImpl(
    private val updateIfExistScript: RedisScript&amp;lt;Unit&amp;gt;,
    private val stringRedisTemplate: RedisTemplate&amp;lt;String, String&amp;gt;
) : DataCustomRepository {
    override fun updateTimeoutAndAccessedAt(data: Data, accessedAt: Instant) {
        stringRedisTemplate.execute(
            updateIfExistScript,
            listOf(&amp;quot;data:${session.id}&amp;quot;),
            data.timeout.toString(),
            accessedAt.toString()
        )
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/spring-projects/spring-data-redis/blob/main/src/main/asciidoc/reference/redis-scripting.adoc&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Spring Data - Redis Redis Scripting&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://engineering.linecorp.com/ko/blog/atomic-cache-stampede-redis-lua-script/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Atomic 처리와 cache stampede 대책을 위해 Redis Lua script를 활용한 이야기&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;개인적인 기록을 위해 작성된 글이라 잘못된 내용이 있을 수 있습니다.&lt;/p&gt;
&lt;p&gt;오류가 있다면 댓글을 남겨주세요.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[스프링에서 코틀린 스타일 테스트 코드 작성하기]]></title><description><![CDATA[스프링에서 코틀린 스타일 테스트 코드 작성하기]]></description><link>https://kyucumber.github.io/posts/spring/kotlin-test-with-spring</link><guid isPermaLink="false">https://kyucumber.github.io/posts/spring/kotlin-test-with-spring</guid><pubDate>Sun, 06 Jun 2021 00:00:00 GMT</pubDate><content:encoded>&lt;h2 id=&quot;개요&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EA%B0%9C%EC%9A%94&quot; aria-label=&quot;개요 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;개요&lt;/h2&gt;
&lt;p&gt;스프링 기반 프로젝트에서 코틀린을 사용하더라도 아래와 같이 기존에 사용하던 테스트 프레임워크인 &lt;code class=&quot;language-text&quot;&gt;Junit&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Assertion&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Mockito&lt;/code&gt; 등은 동일하게 사용할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2691faaea6a713b79b43c8f53e0f1cdd/8b640/kotlin-with-junit-test.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 51.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABTklEQVQoz41Sa3OCMBDk//+66vSDLVAdiyLPBBLyIMD2gsXaDo7NsHMHIZvduwuMtpBMQdYKLbMo2YSsoFh1GAaHaZooDjN8vgbQ40aHTOQI+r6HEgZt0UI2GjXvwZsOVc3h9/67PLF1FoG/mTOO/T5BtC+QHBKw8yd4dgFjDEJKSILqFHRvYQhKUW4NFMGf/2HFVeE4jKhygeigcTpzHD5CxGGIKIoQxzGOxyOEEDNJZzVEK6CMhjTqRrjYvxJOIzRtCsHRtA1FiaZpZniV1tqndpcYONfD6h5tSbaohk65p4dXG7MQeoU+qXOO3e6EMK6R5S3S9Iw8TTFQzSzZ8xbv7T1UuHTSv+ze3rHZvlLNEmw3L+CXFJYzyLJAVebIqwJK61WlN0JfH+fcPHMLxnH8NXf4hqNv7r6rK+UIjDEzwb2N+xv/DrBf/v9H+AL49Ax26zs09wAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/2691faaea6a713b79b43c8f53e0f1cdd/8ac56/kotlin-with-junit-test.webp 240w,
/static/2691faaea6a713b79b43c8f53e0f1cdd/d3be9/kotlin-with-junit-test.webp 480w,
/static/2691faaea6a713b79b43c8f53e0f1cdd/e46b2/kotlin-with-junit-test.webp 960w,
/static/2691faaea6a713b79b43c8f53e0f1cdd/f992d/kotlin-with-junit-test.webp 1440w,
/static/2691faaea6a713b79b43c8f53e0f1cdd/7017d/kotlin-with-junit-test.webp 1454w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/2691faaea6a713b79b43c8f53e0f1cdd/8ff5a/kotlin-with-junit-test.png 240w,
/static/2691faaea6a713b79b43c8f53e0f1cdd/e85cb/kotlin-with-junit-test.png 480w,
/static/2691faaea6a713b79b43c8f53e0f1cdd/d9199/kotlin-with-junit-test.png 960w,
/static/2691faaea6a713b79b43c8f53e0f1cdd/07a9c/kotlin-with-junit-test.png 1440w,
/static/2691faaea6a713b79b43c8f53e0f1cdd/8b640/kotlin-with-junit-test.png 1454w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/2691faaea6a713b79b43c8f53e0f1cdd/d9199/kotlin-with-junit-test.png&quot;
          alt=&quot;kotlin with junit test&quot;
          title=&quot;kotlin with junit test&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;초기 코틀린에 익숙하지 않은 상태에서 관련 지식이 없어 위와 같은 형태로 Junit, AssertJ, Mockito를 사용해 테스트를 작성했었습니다. 하지만 코틀린에 익숙해질수록 &lt;strong&gt;코틀린 스타일의 테스트를 작성할 수 없어&lt;/strong&gt; 아쉬움을 느꼈습니다.&lt;/p&gt;
&lt;p&gt;이 글에서는 코틀린에서 Junit, AssertJ, Mockito를 사용해 테스트를 작성하는 경우의 문제점과 코틀린 진영에서 많이 사용되는 Testing 도구인 Kotest 및 Mockk 등에 대해 알아봅니다.&lt;/p&gt;
&lt;h2 id=&quot;코틀린-dsl과-코틀린-스타일의-테스트코드&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%BD%94%ED%8B%80%EB%A6%B0-dsl%EA%B3%BC-%EC%BD%94%ED%8B%80%EB%A6%B0-%EC%8A%A4%ED%83%80%EC%9D%BC%EC%9D%98-%ED%85%8C%EC%8A%A4%ED%8A%B8%EC%BD%94%EB%93%9C&quot; aria-label=&quot;코틀린 dsl과 코틀린 스타일의 테스트코드 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;코틀린 DSL과 코틀린 스타일의 테스트코드&lt;/h2&gt;
&lt;p&gt;코틀린에서는 아래와 형태와 같은 DSL(Domain Specific Language) 스타일의 중괄호를 활용한 코드 스타일을 제공합니다. 코틀린 내부에서 제공하는 Standard library 대부분도 DSL을 이용해 작성된 것을 볼 수 있습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://play.kotlinlang.org/byExample/09_Kotlin_JS/06_HtmlBuilder?_gl=1*scn3we*_ga*MTExMjE5OTk1NC4xNjExNjY4NzEx*_ga_J6T75801PF*MTYyNDM2NTA0Mi4xMDguMC4xNjI0MzY1MDQyLjA.&amp;#x26;_ga=2.54260653.40338281.1624343617-1112199954.1611668711&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Type safe builders&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-list/#kotlin.collections.List&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Kotlin Standard Library&lt;/a&gt;
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 15.833333333333332%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAAgElEQVQI14WOuw7DIBAE/f8/mSINYMc2jwMbMBNCkaSIlJVGu1fdTGc62LeCWsBaYbUbznu0NrjgiSmNlijUWmmt/aReFeU0UwzCrAO3+4EygjG634q5t7U7QcIg58y/5JqZUjfw3uLdxvpYiCK0ctKuMvjO26abvh6UUgafXXkCeazp19XwqJYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/e8d71d59ae84d469bcf8c845de547a9e/8ac56/kotlin-dsl-filter.webp 240w,
/static/e8d71d59ae84d469bcf8c845de547a9e/d3be9/kotlin-dsl-filter.webp 480w,
/static/e8d71d59ae84d469bcf8c845de547a9e/e46b2/kotlin-dsl-filter.webp 960w,
/static/e8d71d59ae84d469bcf8c845de547a9e/f992d/kotlin-dsl-filter.webp 1440w,
/static/e8d71d59ae84d469bcf8c845de547a9e/7017d/kotlin-dsl-filter.webp 1454w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/e8d71d59ae84d469bcf8c845de547a9e/8ff5a/kotlin-dsl-filter.png 240w,
/static/e8d71d59ae84d469bcf8c845de547a9e/e85cb/kotlin-dsl-filter.png 480w,
/static/e8d71d59ae84d469bcf8c845de547a9e/d9199/kotlin-dsl-filter.png 960w,
/static/e8d71d59ae84d469bcf8c845de547a9e/07a9c/kotlin-dsl-filter.png 1440w,
/static/e8d71d59ae84d469bcf8c845de547a9e/8b640/kotlin-dsl-filter.png 1454w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/e8d71d59ae84d469bcf8c845de547a9e/d9199/kotlin-dsl-filter.png&quot;
          alt=&quot;kotlin dsl filter&quot;
          title=&quot;kotlin dsl filter&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
    &lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://kotlinlang.org/docs/scope-functions.html&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Kotlin Scope Functions (let, also, apply, run ..)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;기존에 사용하던 Junit과 AssertJ, Mockito를 사용해 테스트를 진행하게 되면 위와 같은 코틀린 스타일의 테스트 코드를 작성할 수 없습니다.
비즈니스 로직을 코틀린 DSL을 이용해 잘 작성하더라도 테스트에서 예전 방식의 코드를 작성해야 하다 보니 코틀린에 익숙해질수록 테스트 작성이 어색해지게 됩니다.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://kotest.io/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Kotest&lt;/a&gt;나 &lt;a href=&quot;https://mockk.io/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Mockk&lt;/a&gt;와 같은 도구들을 사용하면 아래처럼 코틀린 DSL과 Infix를 사용해 코틀린 스타일의 테스트 코드를 작성할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/907a791ed6f8ad9865dbbe029f230f52/3115b/kotlin-style-test-code.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.916666666666664%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABEElEQVQoz42Ri26DMAxF8/9/ONayrkCBPCBpeIaQO5Nu0saKVEtXjiPr5thhQ6PQNxpWd+gNiWpdlZjnGcF7eOcQ1hX7CCH80Uo9wnIwnWXIkgs+kgJv7zfk1ytOSYJzmqLlFUR6gixyWF5DSgEhBKZpiib7WLwDc7aHlh01z5B6QWctlJRRYlNdEbmGH8dIvckT+Z7wgQ2wYZxQc4VKtFDKoMkz3NJzpLqVJTjn0MbgWfwY/c5svBvYto0UfavQ0VijvcMRkXMzlmWh7P4RPSOMhr024EUDntN+Pi+QRKSaFtMwRNMjsiOxgRZsiErRiE2RwRPRKzRHD7FHQ9iqqPCCZlrBSCDbB23rmL7P2/0XXgZuwef0NdYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/907a791ed6f8ad9865dbbe029f230f52/8ac56/kotlin-style-test-code.webp 240w,
/static/907a791ed6f8ad9865dbbe029f230f52/d3be9/kotlin-style-test-code.webp 480w,
/static/907a791ed6f8ad9865dbbe029f230f52/e46b2/kotlin-style-test-code.webp 960w,
/static/907a791ed6f8ad9865dbbe029f230f52/f992d/kotlin-style-test-code.webp 1440w,
/static/907a791ed6f8ad9865dbbe029f230f52/882b9/kotlin-style-test-code.webp 1920w,
/static/907a791ed6f8ad9865dbbe029f230f52/9eba6/kotlin-style-test-code.webp 3924w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/907a791ed6f8ad9865dbbe029f230f52/8ff5a/kotlin-style-test-code.png 240w,
/static/907a791ed6f8ad9865dbbe029f230f52/e85cb/kotlin-style-test-code.png 480w,
/static/907a791ed6f8ad9865dbbe029f230f52/d9199/kotlin-style-test-code.png 960w,
/static/907a791ed6f8ad9865dbbe029f230f52/07a9c/kotlin-style-test-code.png 1440w,
/static/907a791ed6f8ad9865dbbe029f230f52/29114/kotlin-style-test-code.png 1920w,
/static/907a791ed6f8ad9865dbbe029f230f52/3115b/kotlin-style-test-code.png 3924w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/907a791ed6f8ad9865dbbe029f230f52/d9199/kotlin-style-test-code.png&quot;
          alt=&quot;kotlin style test code&quot;
          title=&quot;kotlin style test code&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;kotest&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#kotest&quot; aria-label=&quot;kotest permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Kotest&lt;/h2&gt;
&lt;p&gt;코틀린 진영에서 가장 많이 사용되는 테스트 프레임워크입니다. 코틀린 DSL을 통한 테스트 작성을 지원합니다.
&lt;code class=&quot;language-text&quot;&gt;Kotest&lt;/code&gt; 에서는 String Spec, Annotation Spec, Describe Spec 등의 테스트 레이아웃을 제공하며 Assertion을 위한 라이브러리 기능도 제공하고 있습니다.&lt;/p&gt;
&lt;p&gt;Kotest를 사용하기 위해서는 아래와 같은 설정 / 의존성 추가가 필요합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;test {
    useJUnitPlatform()
}

dependencies {
    testImplementation(&amp;quot;io.kotest:kotest-runner-junit5:${Versions.KOTEST}&amp;quot;)
    testImplementation(&amp;quot;io.kotest:kotest-assertions-core:${Versions.KOTEST}&amp;quot;)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 id=&quot;kotest-test-framework&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#kotest-test-framework&quot; aria-label=&quot;kotest test framework permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Kotest Test Framework&lt;/h3&gt;
&lt;p&gt;Kotest는 테스트를 위한 10가지 가량의 레이아웃을 제공합니다&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 902px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a82ffeca95ac2bbdc856d40742ef0da7/58213/kotest-test-frameworks.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 130.83333333333334%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsSAAALEgHS3X78AAADSElEQVRIx4WUDXeiPBCF/f9/brf7vtvWr4ICKoioED6D3p07GNZae5ZzLkNCmExmHmZyvV7RXy54vC4y96jHi9/ev+d40vfDwjCKMJvN8fr2hiAIRqfuI15BGOL19Q3T6Uxt0zSjY7du4qIzpkCWpYiTBMfj6WlUp9MZ2+0WaZpit4vRdt2XKCe8lU2PshWnzf1xgLZtZZNMHeR5jmeXi26MkDdT9zjkFtGhRd32XKYLGnHIVARBiCTZjw7UfpPPie17mLJGWdWo6ga5qVUcU3XT6rwpKz3y+ZzjnBdq88Igk/RQfLa2Z1F6rOMC86DAMhIbDipMJQvPUqR3vL3P8D6dYzZfiJ3peDZfYrH0MJ0t8PPlP6zWIVhgddhJcq39Kya7kch45M5a3ZniB7R8r2vaTt93ndW19DVhNvbnHmHKHFr4cYeqHTJELFarFTzPQxRtsFgs4fsrcWqfFmjARnYddnQ7Dc8uCkaglnMShZvruq/SCHmL9gZBbLDaDTYvKi3IUYrw4a3wIVEFYYTlhwfPX2tR+J6FcipE3EgdHs8VkqxELNodSlS3CrNy+/SAzXaHZJ8KQhtsBejClCMFTnTKVAwcVhZ5aZVBMpnLmPM84uGQoSgKlTESvUTHwlwu16f/+4RAHk2P3dGqTU5WizQUpcV6vRaoE8RxjM1mK9ooFd8WhWAr1Br2ADer645B647oCsU17hsnjkewA4Id5vjt5wgSOVpZqvNUjvvy63/8+PkiAM818XQ+qPqr2/xYlK5rP4FNSOsb2Bf9R68KNcffStZbB3ZW9NhmA9zJLX8ObN/3sVwutW396+LGWmXC3LQWVdNJpTuJxt5A7m45qjQK5kihfqZ7sLepkQZhsKEVuMljKU4INoFeS/si3CfpMPcwfwLb3IGdCdh0sj9W2ArYh9NQXf4RBHkXJ2oZLU/zCPUXsCt2bBGtqaW79AOk5I0wU3Vd33phrh8+At33I9gXnAToKO2Qni2CPfN4GcGOpGOvBG4WxfN87d6u27ju/alj88j1Dea6Gax26BuwjXYYJr5XsTCuiz9qBDtMjHbp6TrXrj0LcoT7Ulv7b+nY0WanOcod1E+L4sCWMLnj92rG7v0vsJnHP4g03A9WN7OTAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/a82ffeca95ac2bbdc856d40742ef0da7/8ac56/kotest-test-frameworks.webp 240w,
/static/a82ffeca95ac2bbdc856d40742ef0da7/d3be9/kotest-test-frameworks.webp 480w,
/static/a82ffeca95ac2bbdc856d40742ef0da7/5cb76/kotest-test-frameworks.webp 902w&quot;
          sizes=&quot;(max-width: 902px) 100vw, 902px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/a82ffeca95ac2bbdc856d40742ef0da7/8ff5a/kotest-test-frameworks.png 240w,
/static/a82ffeca95ac2bbdc856d40742ef0da7/e85cb/kotest-test-frameworks.png 480w,
/static/a82ffeca95ac2bbdc856d40742ef0da7/58213/kotest-test-frameworks.png 902w&quot;
          sizes=&quot;(max-width: 902px) 100vw, 902px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/a82ffeca95ac2bbdc856d40742ef0da7/58213/kotest-test-frameworks.png&quot;
          alt=&quot;kotlin test frameworks&quot;
          title=&quot;kotlin test frameworks&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Kotest에서 익숙하고 많이 사용하는 몇가지 스타일에 대해 살펴보겠습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/kyucumber/kotlin-testing-with-spring-boot/blob/master/src/test/kotlin/org/kyucumber/CalculatorAnnotationSpec.kt&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Kotest Annotation Spec&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;기존 Junit 방식과 가장 유사한 방식입니다. 별 다른 장점이 없는 레이아웃이지만 Junit에서 Kotest로의 마이그레이션이 필요한 상황이라면 나쁘지 않은 선택이 될 수 있습니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;internal class CalculatorAnnotationSpec: AnnotationSpec() {
    private val sut = Calculator()

    @Test
    fun `1과 2를 더하면 3이 반환된다`() {
        val result = sut.calculate(&amp;quot;1 + 2&amp;quot;)

        result shouldBe 3
    }

    @Test
    fun `식을 입력하면, 해당하는 결과값이 반환된다`() {
        calculations.forAll { (expression, answer) -&amp;gt;
            val result = sut.calculate(expression)

            result shouldBe answer
        }
    }

    @Test
    fun `입력값이 null 이거나 빈 공백 문자일 경우 IllegalArgumentException 예외를 던진다`() {
        blanks.forAll {
            shouldThrow&amp;lt;IllegalArgumentException&amp;gt; {
                sut.calculate(it)
            }
        }
    }

    @Test
    fun `사칙연산 기호 이외에 다른 문자가 연산자로 들어오는 경우 IllegalArgumentException 예외를 던진다 `() {
        invalidInputs.forAll {
            shouldThrow&amp;lt;IllegalArgumentException&amp;gt; {
                sut.calculate(it)
            }
        }
    }

    private val calculations = listOf(
        &amp;quot;1 + 3 * 5&amp;quot; to 20.0,
        &amp;quot;2 - 8 / 3 - 3&amp;quot; to -5.0,
        &amp;quot;1 + 2 + 3 + 4 + 5&amp;quot; to 15.0
    )
    private val blanks = listOf(&amp;quot;&amp;quot;, &amp;quot; &amp;quot;, &amp;quot;    &amp;quot;)
    private val invalidInputs = listOf(&amp;quot;1 &amp;amp; 2&amp;quot;, &amp;quot;1 + 5 % 1&amp;quot;)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/kyucumber/kotlin-testing-with-spring-boot/blob/master/src/test/kotlin/org/kyucumber/CalculatorBehaviorSpec.kt&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Kotest Behavior Spec&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;기존 스프링 기반 프로젝트에서 작성하던 Given, When, Then 패턴을 코틀린 DSL을 이용해 간결하게 정의할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 934px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7e1a287b1faa14fe1c725c6bb8e1d4b6/078fe/kotest-behavior-spec.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 59.583333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAACEUlEQVQoz11T2Y7TQBD0hyxCwEqAULIskJDDHs/l+z6TXfj/3yi6x0m04aHUdtJTU9XV9vKyRqgtZJSgbDpUbX9DUbdo+hE2yXEMFfa+IIRLDcLb+1EognQ9XpAaDNMJ59e/qJoW/TCh6QZ0/YKm7ZDlBYyNUJQVyqpyNUkzV/k/PxAIQglfCCLUGusgxbcwwQ9Z4Elk+B7meNxovH8WePcU4GF1xMPax4efEp82hqDx8ZfC49Y4cM/nnSWeDJ5NMqx3EqujwiHNoYqRMOAQ19jqAr9NSc8NgqzHPqqxsyWOSYPVXuPLRuDrNnR4DiJs5IVQkFypNHSsUXYVBrZN9qd5Jts9bBQjimOybZ11G0WuP5TKQUgJbSz1JPBCZZaBEgKpIaxC0Ta3UHqabz/OiEg9h8B9h0BezqhbIHzWxCk8QTctCdFQKSVfSZgsJsIOedWgpZQ5sIy2gQkPlC6De/nctTKhpk1xlv03CgOjkFYFJd6hJIXz+dUp7MYJ3JvmpVNyuJDdEdoYHu/e/4RxmaEmy0wyzmdnfTydaScHnF7+uAsUHX6r2FlmhUlW3Mn3acAmj1F3vSPtJ1JHIbF1nitXvogd1LSvLOjK4QjFXSjGhZI3tbPLypiMn3nZWRkT8mU8Yx4HfxTcw/OTJoJ3JbvOw6c1kPT11P2icDq9OJXDfHKVSXkMrM4R0u8lrdjV8j/ZFbLsYUnh4wAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/7e1a287b1faa14fe1c725c6bb8e1d4b6/8ac56/kotest-behavior-spec.webp 240w,
/static/7e1a287b1faa14fe1c725c6bb8e1d4b6/d3be9/kotest-behavior-spec.webp 480w,
/static/7e1a287b1faa14fe1c725c6bb8e1d4b6/7d4d8/kotest-behavior-spec.webp 934w&quot;
          sizes=&quot;(max-width: 934px) 100vw, 934px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/7e1a287b1faa14fe1c725c6bb8e1d4b6/8ff5a/kotest-behavior-spec.png 240w,
/static/7e1a287b1faa14fe1c725c6bb8e1d4b6/e85cb/kotest-behavior-spec.png 480w,
/static/7e1a287b1faa14fe1c725c6bb8e1d4b6/078fe/kotest-behavior-spec.png 934w&quot;
          sizes=&quot;(max-width: 934px) 100vw, 934px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/7e1a287b1faa14fe1c725c6bb8e1d4b6/078fe/kotest-behavior-spec.png&quot;
          alt=&quot;kotest behavior spec&quot;
          title=&quot;kotest behavior spec&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;internal class CalculatorBehaviorSpec : BehaviorSpec({
    val sut = Calculator()
    given(&amp;quot;calculate&amp;quot;) {
        val expression = &amp;quot;1 + 2&amp;quot;
        `when`(&amp;quot;1과 2를 더하면&amp;quot;) {
            val result = sut.calculate(expression)
            then(&amp;quot;3이 반환된다&amp;quot;) {
                result shouldBe 3
            }
        }

        val calculations = listOf(
            &amp;quot;1 + 3 * 5&amp;quot; to 20.0,
            &amp;quot;2 - 8 / 3 - 3&amp;quot; to -5.0,
            &amp;quot;1 + 2 + 3 + 4 + 5&amp;quot; to 15.0
        )
        `when`(&amp;quot;수식을 입력하면&amp;quot;) {
            then(&amp;quot;해당하는 결과값이 반환된다&amp;quot;) {
                calculations.forAll { (expression, answer) -&amp;gt;
                    val result = sut.calculate(expression)

                    result shouldBe answer
                }
            }
        }

        val blanks = listOf(&amp;quot;&amp;quot;, &amp;quot; &amp;quot;, &amp;quot;    &amp;quot;)
        `when`(&amp;quot;입력값이 null이거나 빈 값인 경우&amp;quot;) {
            then(&amp;quot;IllegalArgumentException 예외를 던진다&amp;quot;){
                blanks.forAll {
                    shouldThrow&amp;lt;IllegalArgumentException&amp;gt; {
                        sut.calculate(it)
                    }
                }
            }
        }

        val invalidInputs = listOf(&amp;quot;1 &amp;amp; 2&amp;quot;, &amp;quot;1 + 5 % 1&amp;quot;)
        `when`(&amp;quot;사칙연산 기호 이외에 다른 연산자가 들어오는 경우&amp;quot;) {
            then(&amp;quot;IllegalArgumentException 예외를 던진다&amp;quot;){
                invalidInputs.forAll {
                    shouldThrow&amp;lt;IllegalArgumentException&amp;gt; {
                        sut.calculate(it)
                    }
                }
            }
        }
    }
})&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/kyucumber/kotlin-testing-with-spring-boot/blob/master/src/test/kotlin/org/kyucumber/CalculatorDescribeSpec.kt&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Kotest Describe Spec&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Describe, Context, It 패턴으로 테스트를 작성해보셨던 분들이라면 익숙한 스타일입니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 938px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ec33dc2665e4b3464bf002da57af2d43/dc333/kotest-describe-spec.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 59.166666666666664%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAACNklEQVQoz12Sy3LUMBBF/UmEgiRjy7Zsj2zLb1ueNwkULCaEULAilaz5BEilMkV+9dKtMHmwuNUtyX36qmVHD6eQ1QqyfY9yuUW12qLZfKZ4ZtWdfIEyn+DpFSbTHq4aMPlPbmrgsTIDx0sjNGYGs/6ApOyQNgaqNkjrAbobkVYdZFYiSBTyQqOsKhRliSzP7FqXBTzhwRUCx56AE8QR/PlPiI93qM52aM7v0V/cw93c4mC8wevZDV6ZX5T/xpvlndXbf/FwvcPx5g8OZrfwT3fQ23s4aV7AzU7g1udIFl/RnF6hJen1JdTiB7LVJfTmCvn6Ctny0q6Ld9cIum84zLc40mdWfnOB6fgdTpJmEMJF4HsIIw9pEWPoWxjTQqkIUvoIQ+9RQeDZPY5CTCB8kjimM4EkkXDCKIEXRPDCGEIm8JOY5lagM3P04wJ52SCMFWKVQ05TxKlGEE1tjaAaruPcp72EzpxA8oakA/6AwRKxVgQcUTYdxsUS7WBQtT0qWvfjDIrGxDViX0O5T5xYZXCmmaZN+bBJ3Xx6pGmZoe56NP1ggTXBuPGRK0j+C9geyNECubP/rAsD01rDzBfohhHDbI5hnNu8qBrrbiKCR9nbPQcq6/CpC8ekSB9As4W9etMb9PSvslvO2Tk3aLoBkv7PvZmIZuwE9lHkk8Mkgipz64pnt4dxzpHX7J7hdhw0mqJuLcwCLcwPX8wkTGPUff8AJQCL3XQE5BGxazsGinxNrrGPQsC/q0DBwTPp68gAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/ec33dc2665e4b3464bf002da57af2d43/8ac56/kotest-describe-spec.webp 240w,
/static/ec33dc2665e4b3464bf002da57af2d43/d3be9/kotest-describe-spec.webp 480w,
/static/ec33dc2665e4b3464bf002da57af2d43/e5056/kotest-describe-spec.webp 938w&quot;
          sizes=&quot;(max-width: 938px) 100vw, 938px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/ec33dc2665e4b3464bf002da57af2d43/8ff5a/kotest-describe-spec.png 240w,
/static/ec33dc2665e4b3464bf002da57af2d43/e85cb/kotest-describe-spec.png 480w,
/static/ec33dc2665e4b3464bf002da57af2d43/dc333/kotest-describe-spec.png 938w&quot;
          sizes=&quot;(max-width: 938px) 100vw, 938px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/ec33dc2665e4b3464bf002da57af2d43/dc333/kotest-describe-spec.png&quot;
          alt=&quot;kotest describe spec&quot;
          title=&quot;kotest describe spec&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;internal class CalculatorDescribeSpec : DescribeSpec({
    val sut = Calculator()

    describe(&amp;quot;calculate&amp;quot;) {
        context(&amp;quot;식이 주어지면&amp;quot;) {
            val inputs = listOf(
                &amp;quot;1 + 3 * 5&amp;quot; to 20.0,
                &amp;quot;2 - 8 / 3 - 3&amp;quot; to -5.0,
                &amp;quot;1 + 2 + 3 + 4 + 5&amp;quot; to 15.0
            )

            it(&amp;quot;해당 식에 대한 결과값이 반환된다&amp;quot;) {
                inputs.forAll { (expression, data) -&amp;gt;
                    val result = sut.calculate(expression)

                    result shouldBe data
                }
            }
        }

        context(&amp;quot;0으로 나누는 경우&amp;quot;) {
            it(&amp;quot;Infinity를 반환한다&amp;quot;) {
                val result = sut.calculate(&amp;quot;1 / 0&amp;quot;)

                result shouldBe Double.POSITIVE_INFINITY
            }
        }

        context(&amp;quot;입력값이 null이거나 공백인 경우&amp;quot;) {
            val blanks = listOf(&amp;quot;&amp;quot;, &amp;quot; &amp;quot;, &amp;quot;      &amp;quot;)
            it(&amp;quot;IllegalArgumentException 예외를 던진다&amp;quot;) {
                blanks.forAll {
                    shouldThrow&amp;lt;IllegalArgumentException&amp;gt; {
                        sut.calculate(it)
                    }
                }
            }
        }

        context(&amp;quot;사칙연산 기호 이외에 다른 문자가 연산자로 들어오는 경우&amp;quot;) {
            val invalidInputs = listOf(&amp;quot;1 &amp;amp; 2&amp;quot;, &amp;quot;1 + 5 % 1&amp;quot;)
            it(&amp;quot;IllegalArgumentException 예외를 던진다&amp;quot;) {
                invalidInputs.forAll {
                    shouldThrow&amp;lt;IllegalArgumentException&amp;gt; {
                        sut.calculate(it)
                    }
                }
            }
        }
    }
})&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 id=&quot;kotest-assertions&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#kotest-assertions&quot; aria-label=&quot;kotest assertions permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Kotest Assertions&lt;/h3&gt;
&lt;p&gt;위에 작성한 예제 코드에서는 Kotest의 Assertion이 사용되었습니다. Kotest에서 제공하는 간단한 몇가지 Assertion 표현식을 살펴보겠습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Assertions&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;shouldBe&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;name shouldBe &amp;quot;kyunam&amp;quot;

// == assertThat(name).isEqualTo(&amp;quot;kyunam&amp;quot;)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Inspectors&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;forExactly&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;mylist.forExactly(3) {
    it.city shouldBe &amp;quot;Chicago&amp;quot;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;forAtLeast&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val xs = listOf(&amp;quot;sam&amp;quot;, &amp;quot;gareth&amp;quot;, &amp;quot;timothy&amp;quot;, &amp;quot;muhammad&amp;quot;)

xs.forAtLeast(2) {
    it.shouldHaveMinLength(7)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Exceptions&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;shouldThrow&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;shouldThrow&amp;lt;IllegalAccessException&amp;gt; {
  // code in here that you expect to throw an IllegalAccessException
}

// == assertThrows&amp;lt;IllegalAccessException&amp;gt; { }&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;shouldThrowAny&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val exception = shouldThrowAny {
  // test here can throw any type of Throwable!
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;kotest-with-springboottest&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#kotest-with-springboottest&quot; aria-label=&quot;kotest with springboottest permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Kotest with @SpringBootTest&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;@SpringBootTest&lt;/code&gt;와 같은 통합 테스트에서도 Kotest의 테스트 레이아웃을 사용할 수 있습니다.&lt;/p&gt;
&lt;p&gt;사용을 위해서는 아래와 같은 spring extension 의존성의 추가가 필요합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;dependencies {
    testImplementation(&amp;quot;io.kotest:kotest-extensions-spring:${Versions.KOTEST}&amp;quot;)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/kyucumber/kotlin-testing-with-spring-boot/blob/master/src/test/kotlin/org/kyucumber/CalculatorSpringBootSpec.kt&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Kotest - using &lt;code class=&quot;language-text&quot;&gt;@SpringBootTest&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;@SpringBootTest
internal class CalculatorSpringBootSpec : DescribeSpec() {
    override fun extensions() = listOf(SpringExtension)

    @Autowired
    private lateinit var calculatorService: CalculatorService

    init {
        this.describe(&amp;quot;calculate&amp;quot;) {
            context(&amp;quot;식이 주어지면&amp;quot;) {
                val inputs = listOf(
                    &amp;quot;1 + 3 * 5&amp;quot; to 20.0,
                    &amp;quot;2 - 8 / 3 - 3&amp;quot; to -5.0,
                    &amp;quot;1 + 2 + 3 + 4 + 5&amp;quot; to 15.0
                )
                it(&amp;quot;해당 식에 대한 결과값이 반환된다&amp;quot;) {
                    inputs.forAll { (expression, data) -&amp;gt;
                        val result = calculatorService.calculate(expression)

                        result shouldBe data
                    }
                }
            }
        }
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 id=&quot;kotest-isolation-mode&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#kotest-isolation-mode&quot; aria-label=&quot;kotest isolation mode permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Kotest Isolation Mode&lt;/h3&gt;
&lt;p&gt;Kotest는 아래와 같이 테스트 간 격리에 대한 설정을 제공하고 있습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kotest/kotest/blob/master/doc/isolation_mode.md&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Kotest Isolation Mode&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;SingleInstance - 기본값&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;InstancePerTest&lt;/li&gt;
&lt;li&gt;InstancePerLeaf&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Kotest에서는 테스트 간 격리 레벨에 대해 디폴트로 SingleInstance를 설정하고 있으며 이 경우 Mocking 등 때문에 테스트 간 충돌이 발생할 수 있습니다. 따라서 테스트간 완전한 격리를 위해서는 아래와 같이 IsolationMode를 &lt;code class=&quot;language-text&quot;&gt;InstancePerLeaf&lt;/code&gt;로 지정해 사용해야 합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;internal class CalculatorDescribeSpec : DescribeSpec({
    isolationMode = IsolationMode.InstancePerLeaf
    // ...
})&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;mockk&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#mockk&quot; aria-label=&quot;mockk permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Mockk&lt;/h2&gt;
&lt;p&gt;Mockk는 코틀린 스타일의 Mock 프레임워크입니다.
Mockito를 사용하는 경우 아래처럼 코틀린 DSL 스타일의 테스트를 작성할 수 없습니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;given(userRepository.findById(1L).willReturn(expectedUser)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;Mockk를 사용하면 아래와 같이 코틀린 DSL 스타일로 Mock 테스트를 작성할 수 있습니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;every { userRepository.findById(1L) } answers { expectedUser }&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;Mockk의 사용을 위해서는 아래와 같은 의존성 추가가 필요합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;dependencies {
    testImplementation(&amp;quot;io.mockk:mockk:10.10.6&amp;quot;)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 id=&quot;mockk-features&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#mockk-features&quot; aria-label=&quot;mockk features permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Mockk features&lt;/h3&gt;
&lt;p&gt;Mockito와 큰 차이가 없습니다. 대응되는 키워드만 잘 찾으면 러닝커브 없이 바로 사용이 가능합니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Mocking&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val permissionRepository = mockk&amp;lt;PermissionRepository&amp;gt;()&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;SpyK&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val car = spyk(Car()) // or spyk&amp;lt;Car&amp;gt;() to call default constructor&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Constructor mocks&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;class MockCls {
  fun add(a: Int, b: Int) = a + b
}

mockkConstructor(MockCls::class)

every { anyConstructed&amp;lt;MockCls&amp;gt;().add(1, 2) } returns 4

assertEquals(4, MockCls().add(1, 2)) // note new object is created

verify { anyConstructed&amp;lt;MockCls&amp;gt;().add(1, 2) }&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Relaxed mock&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;val car = mockk&amp;lt;PermissionRepository&amp;gt;(relaxed = true)

// unnecessary
// every { permissionRepository.delete(id) } just Runs&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Answers&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;answers&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;every { permissionRepository.save(permission) } answers { permission }&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;throws&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;every { permissionRepository.findByIdOrNull(id) } throws EntityNotFoundException()&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;just Runs&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;every { permissionRepository.delete(id) } just Runs&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;retrunsMany&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;every { permissionRepository.save(permission) } returnsMany listOf(firstPermission, secondPermission)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;returns&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;every { permissionRepository.save(permission) } retunrs permission
every { permissionRepository.save(permission) } retunrs firstPermission andThen secondPermission&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Argument matching&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;any&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;every { permissionRepository.save(any()) } retunrs permission&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;varargs&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;every { obj.manyMany(5, 6, *varargAll { it == 7 }) } returns 3

println(obj.manyMany(5, 6, 7)) // 3
println(obj.manyMany(5, 6, 7, 7)) // 3
println(obj.manyMany(5, 6, 7, 7, 7)) // 3

every { obj.manyMany(5, 6, *varargAny { nArgs &amp;gt; 5 }, 7) } returns 5

println(obj.manyMany(5, 6, 4, 5, 6, 7)) // 5
println(obj.manyMany(5, 6, 4, 5, 6, 7, 7)) // 5&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Verification&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;verify&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;verify(atLeast = 3) { car.accelerate(allAny()) }
verify(atMost  = 2) { car.accelerate(fromSpeed = 10, toSpeed = or(20, 30)) }
verify(exactly = 1) { car.accelerate(fromSpeed = 10, toSpeed = 20) }
verify(exactly = 0) { car.accelerate(fromSpeed = 30, toSpeed = 10) } // means no calls were performed&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;verifyAll&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;verifyAll {
    obj.sum(1, 3)
    obj.sum(1, 2)
    obj.sum(2, 2)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;verifySequnece&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;verifySequence {
    obj.sum(1, 2)
    obj.sum(1, 3)
    obj.sum(2, 2)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;springmockk-spek&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#springmockk-spek&quot; aria-label=&quot;springmockk spek permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;SpringMockk, Spek&lt;/h2&gt;
&lt;p&gt;이외에 아래와 같은 테스트 도구들도 있습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;SpringMockk&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;@MockkBean&lt;/code&gt; , &lt;code class=&quot;language-text&quot;&gt;@SpykBean&lt;/code&gt; 기능 제공&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;@MockkBean // @MockBean 대신 @MockkBean 사용 가능
private lateinit var userRepository: UserRepository&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Spek&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Kotest의 Describe Spec의 기능 제공&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;internal class CalculatorDescribeSpec : Spek({
    val sut = Calculator()

    describe(&amp;quot;calculate&amp;quot;) {
        context(&amp;quot;식이 주어지면&amp;quot;) {
            val inputs = listOf(
                &amp;quot;1 + 3 * 5&amp;quot; to 20.0,
                &amp;quot;2 - 8 / 3 - 3&amp;quot; to -5.0,
                &amp;quot;1 + 2 + 3 + 4 + 5&amp;quot; to 15.0
            )

            it(&amp;quot;해당 식에 대한 결과값이 반환된다&amp;quot;) {
                inputs.forAll { (expression, data) -&amp;gt;
                    val result = sut.calculate(expression)

                    result shouldBe data
                }
            }
        }

        context(&amp;quot;0으로 나누는 경우&amp;quot;) {
            it(&amp;quot;Infinity를 반환한다&amp;quot;) {
                val result = sut.calculate(&amp;quot;1 / 0&amp;quot;)

                result shouldBe Double.POSITIVE_INFINITY
            }
        }

        context(&amp;quot;입력값이 null이거나 공백인 경우&amp;quot;) {
            val blanks = listOf(&amp;quot;&amp;quot;, &amp;quot; &amp;quot;, &amp;quot;      &amp;quot;)
            it(&amp;quot;IllegalArgumentException 예외를 던진다&amp;quot;) {
                blanks.forAll {
                    shouldThrow&amp;lt;IllegalArgumentException&amp;gt; {
                        sut.calculate(it)
                    }
                }
            }
        }

        context(&amp;quot;사칙연산 기호 이외에 다른 문자가 연산자로 들어오는 경우&amp;quot;) {
            val invalidInputs = listOf(&amp;quot;1 &amp;amp; 2&amp;quot;, &amp;quot;1 + 5 % 1&amp;quot;)
            it(&amp;quot;IllegalArgumentException 예외를 던진다&amp;quot;) {
                invalidInputs.forAll {
                    shouldThrow&amp;lt;IllegalArgumentException&amp;gt; {
                        sut.calculate(it)
                    }
                }
            }
        }
    }
})&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://kotest.io/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://kotest.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://mockk.io/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://mockk.io/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://kotlinlang.org/docs/type-safe-builders.html&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://kotlinlang.org&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[logback에서 stdout 로그 출력 시 특정 Thread가 lock을 무기한 보유하는 이슈]]></title><description><![CDATA[stdout 로그 출력 시 특정 Thread가 lock을 무기한 보유하는 이슈 정리]]></description><link>https://kyucumber.github.io/posts/issues/logback-thread-lock-issue</link><guid isPermaLink="false">https://kyucumber.github.io/posts/issues/logback-thread-lock-issue</guid><pubDate>Sat, 01 May 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;운영중인 개발 환경 서버에서 504 Gateway Time-out이 발생하고 일정 시간이 지나도 회복되지 않는 문제가 발생했습니다.&lt;/p&gt;
&lt;p&gt;해당 어플리케이션의 경우 지속적으로 헬스체크를 진행하고 실패시 트래픽을 받지 않도록 구성해두었는데도 문제가 있는 장비는 제거되지 않고 계속 트래픽을 받고 있었습니다.&lt;/p&gt;
&lt;p&gt;트래픽을 받는 특정 장비 내부에서 curl을 이용해 헬스체크 path에 대해 요청을 보내보았으나 아래와 같이 정상적으로 200 응답이 내려오는 것을 확인할 수 있었습니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;❯ curl http://localhost/actuator/health
{&amp;quot;status&amp;quot;:&amp;quot;UP&amp;quot;,&amp;quot;components&amp;quot;:{&amp;quot;ping&amp;quot;:{&amp;quot;status&amp;quot;:&amp;quot;UP&amp;quot;}}}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;명확한 원인 파악을 위해 아래와 같이 스레드 덤프를 따서 확인해보았습니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;java.lang.Thread.State: RUNNABLE
at java.io.FileOutputStream.writeBytes(Native Method)
at java.io.FileOutputStream.write(FileOutputStream.java:326)
at java.io.BufferedOutputStream.write(BufferedOutputStream.java:122)
- locked &amp;lt;0x00000000c023a8e0&amp;gt; (a java.io.BufferedOutputStream)
at java.io.PrintStream.write(PrintStream.java:480)
- locked &amp;lt;0x00000000c023a8c0&amp;gt; (a java.io.PrintStream)
at java.io.FilterOutputStream.write(FilterOutputStream.java:97)
at ch.qos.logback.core.joran.spi.ConsoleTarget$1.write(ConsoleTarget.java:37)
at ch.qos.logback.core.OutputStreamAppender.writeBytes(OutputStreamAppender.java:199)
at ch.qos.logback.core.OutputStreamAppender.subAppend(OutputStreamAppender.java:231)
at ch.qos.logback.core.OutputStreamAppender.append(OutputStreamAppender.java:102)
at ch.qos.logback.core.UnsynchronizedAppenderBase.doAppend(UnsynchronizedAppenderBase.java:84)
at ch.qos.logback.core.spi.AppenderAttachableImpl.appendLoopOnAppenders(AppenderAttachableImpl.java:51)
at ch.qos.logback.classic.Logger.appendLoopOnAppenders(Logger.java:270)
at ch.qos.logback.classic.Logger.callAppenders(Logger.java:257)
at ch.qos.logback.classic.Logger.buildLoggingEventAndAppend(Logger.java:421)
at ch.qos.logback.classic.Logger.filterAndLog_1(Logger.java:398)
at ch.qos.logback.classic.Logger.info(Logger.java:583)
at 문제가 발생한 패키지(문제가 발생한 클래스.kt:107)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;해당 스레드 덤프의 내용을 보면 특정 스레드 하나가 RUNNABLE 상태임에도 불구하고 &lt;code class=&quot;language-text&quot;&gt;at java.io.PrintStream.write(PrintStream.java:480)&lt;/code&gt;에서 locked로 lock이 발생한 것을 확인할 수 있습니다.&lt;/p&gt;
&lt;h2 id=&quot;원인&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%9B%90%EC%9D%B8&quot; aria-label=&quot;원인 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;원인&lt;/h2&gt;
&lt;p&gt;대부분의 로그는 파일로 별도로 떨구게 구성해두었는데, 개발 환경이다보니 어플리케이션 내부에 아래와 같이 stdout 로그를 찍는 부분이 logback 설정에 포함되어 있었고 이 부분에서 문제가 발생한 것으로 보입니다.&lt;/p&gt;
&lt;deckgo-highlight-code   terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;
&amp;lt;appender name=&amp;quot;STDOUT&amp;quot; class=&amp;quot;ch.qos.logback.core.ConsoleAppender&amp;quot;&amp;gt;
    &amp;lt;encoder&amp;gt;
        &amp;lt;charset&amp;gt;utf8&amp;lt;/charset&amp;gt;
        &amp;lt;pattern&amp;gt;%d{MM-dd HH:mm:ss} [%thread] %.-5level %logger{36} - %msg%n&amp;lt;/pattern&amp;gt;
    &amp;lt;/encoder&amp;gt;
&amp;lt;/appender&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;stdout으로 로그를 출력하더라도 기존에 잘 동작하고 특별한 설정의 변경이 없던 어플리케이션에서 갑자기 왜 위와 같은 문제가 발생한 것인지는 명확히 파악하지 못했습니다.
트래픽, 로깅의 양도 늘어나지 않았고 별다른 설정의 변경이 없는 상태에서 왜 Lock이 잡혀 어플리케이션이 행이 걸리는지는 의문입니다.&lt;/p&gt;
&lt;p&gt;일단 근본적인 원인은 Lock을 무기한으로 보유하고 있는 RUNNABLE 스레드로 보입니다. 아래와 같이 유사한 현상을 겪은 케이스를 logback 이슈에서 찾을 수 있었습니다.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://jira.qos.ch/browse/LOGBACK-1406?attachmentViewMode=list&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://jira.qos.ch/browse/LOGBACK-1406?attachmentViewMode=list&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://jira.qos.ch/browse/LOGBACK-1422?attachmentViewMode=list&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://jira.qos.ch/browse/LOGBACK-1422?attachmentViewMode=list&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;해결&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%95%B4%EA%B2%B0&quot; aria-label=&quot;해결 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;해결&lt;/h2&gt;
&lt;p&gt;근본적인 원인은 확인하지 못했으나, stdout으로 로그를 찍는 부분이 어플리케이션에 영향을 주지 않도록 아래 부분을 변경했습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ConsoleAppender → AsyncAppender로 변경&lt;/li&gt;
&lt;li&gt;neverBlock 설정 추가&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code   terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;appender name=&amp;quot;STDOUT-ASYNC&amp;quot; class=&amp;quot;ch.qos.logback.classic.AsyncAppender&amp;quot;&amp;gt;
    &amp;lt;neverBlock&amp;gt;true&amp;lt;/neverBlock&amp;gt;
    &amp;lt;appender-ref ref=&amp;quot;STDOUT&amp;quot;/&amp;gt;
&amp;lt;/appender&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;AsyncAppender만 사용해도 문제가 없을 것으로 생각했는데 AsyncAppender만을 적용해도 스레드가 무기한으로 Lock을 보유하는 문제는 동일하게 발생했습니다.&lt;/p&gt;
&lt;p&gt;설정을 조금 잘못 넣어서 그런것일지도 모르겠으나, neverBlock 설정을 추가한 시점부터 의도한 대로 Lock이 걸려도 어플리케이션이 멈추지 않고 정상적으로 동작했습니다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;위와 같이 설정하는 경우 Lock이 걸린 시점부터는 stdout 로그가 정상적으로 출력되지 않습니다.&lt;/p&gt;
&lt;/blockquote&gt;</content:encoded></item><item><title><![CDATA[Amazon OpenSearch Service 백업을 위한 스냅샷 관리 자동화]]></title><description><![CDATA[Amazon OpenSearch Service 백업을 위한 스냅샷 관리 자동화 방법에 대해 정리합니다.]]></description><link>https://kyucumber.github.io/posts/elasticsearch/elasticsearch-snapshot-management</link><guid isPermaLink="false">https://kyucumber.github.io/posts/elasticsearch/elasticsearch-snapshot-management</guid><pubDate>Sat, 01 May 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;br&gt;
엘라스틱서치를 사용하면 인덱스의 도큐먼트를 백업해야 하는 경우가 자주 있습니다.&lt;/p&gt;
&lt;p&gt;현재 Amazon OpenSearch Service 서비스를 활용하고 있습니다.
Amazon OpenSearch Service 서비스에서 영구적인 데이터 보관을 위해 S3에 어떻게 데이터를 백업하는지 정리합니다.&lt;/p&gt;
&lt;h2 id=&quot;opensearch에서-제공하는-스냅샷-생성-방식&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#opensearch%EC%97%90%EC%84%9C-%EC%A0%9C%EA%B3%B5%ED%95%98%EB%8A%94-%EC%8A%A4%EB%83%85%EC%83%B7-%EC%83%9D%EC%84%B1-%EB%B0%A9%EC%8B%9D&quot; aria-label=&quot;opensearch에서 제공하는 스냅샷 생성 방식 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;OpenSearch에서 제공하는 스냅샷 생성 방식&lt;/h2&gt;
&lt;p&gt;OpenSearch에서는 아래와 같은 두가지 방식의 스냅샷 생성을 제공합니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Automated snapshots - 자동 스냅샷&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Manual snapshots - 수동 스냅샷&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;버전마다 보관 기간은 다르지만 자동 스냅샷은 14일 가량의 짧은 기간동안만 보관되므로 인덱스 데이터를 S3 등에 &lt;strong&gt;영구적으로 보관하기 위해서는 수동 스냅샷&lt;/strong&gt;을 사용해야 합니다.&lt;/p&gt;
&lt;p&gt;수동 스냅샷 기능과 ISM(Index State Management)기능을 활용하면 인덱스의 기간, 크기, 문서 수 등의 변화에 따라 수동 스냅샷을 자동으로 생성할 수 있습니다.&lt;/p&gt;
&lt;p&gt;해당 문서에서는 수동 스냅샷 생성을 위한 절차와 ISM 정책 적용에 대한 내용에 대해 정리합니다.&lt;/p&gt;
&lt;h2 id=&quot;opensearch-스냅샷-백업을-위한-s3-버킷-생성&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#opensearch-%EC%8A%A4%EB%83%85%EC%83%B7-%EB%B0%B1%EC%97%85%EC%9D%84-%EC%9C%84%ED%95%9C-s3-%EB%B2%84%ED%82%B7-%EC%83%9D%EC%84%B1&quot; aria-label=&quot;opensearch 스냅샷 백업을 위한 s3 버킷 생성 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;OpenSearch 스냅샷 백업을 위한 S3 버킷 생성&lt;/h2&gt;
&lt;p&gt;OpenSearch가 스냅샷 저장소로 사용할 S3 버킷을 생성합니다.
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/8cbd92c41bcf5e45b952a9a97d88d2cb/09ede/es-snapshot-bucket.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 52.916666666666664%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABSUlEQVQoz5WSW3OCMBSE+f8/rbUdn7XWVuUSFKIBJECS7TlHsfrQkWbmm3AZls3uiV5mM7zP58Lr7A2HokCpNcrjkTDCyRiYqppEtFgusfpc42O1kn272wlxliPea2xUCX26CLLwMyJ2U5ArlefIMoWyLNF1Hay1RCu07TTEYZqmiOMYaZrRnpCghnMDhuH/VFWNqCBH7I4dOe/By9PuQ3ggBP/AuAK9G/eqFkGNhNztyN1mu5WHddPI3/iakfzqBoWxOJj2CkXSu6vYnSBnlikllvlh3/e3IzjnbgxE7zz6waMbHOHpROHBqQhqGo8kSakYalMfwREYams8OsdwL8z5tlQUSfxxZGqY22WXYzFK5XLPzbFj74N88AwR3O8PWH99C+yu5gzrS4bWdjJCUxdnH7GqDCUNb3M+oyNHLPI7ixZncjoFLu8H8WlRyu2YiEEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/8cbd92c41bcf5e45b952a9a97d88d2cb/8ac56/es-snapshot-bucket.webp 240w,
/static/8cbd92c41bcf5e45b952a9a97d88d2cb/d3be9/es-snapshot-bucket.webp 480w,
/static/8cbd92c41bcf5e45b952a9a97d88d2cb/e46b2/es-snapshot-bucket.webp 960w,
/static/8cbd92c41bcf5e45b952a9a97d88d2cb/f992d/es-snapshot-bucket.webp 1440w,
/static/8cbd92c41bcf5e45b952a9a97d88d2cb/cf022/es-snapshot-bucket.webp 1710w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/8cbd92c41bcf5e45b952a9a97d88d2cb/8ff5a/es-snapshot-bucket.png 240w,
/static/8cbd92c41bcf5e45b952a9a97d88d2cb/e85cb/es-snapshot-bucket.png 480w,
/static/8cbd92c41bcf5e45b952a9a97d88d2cb/d9199/es-snapshot-bucket.png 960w,
/static/8cbd92c41bcf5e45b952a9a97d88d2cb/07a9c/es-snapshot-bucket.png 1440w,
/static/8cbd92c41bcf5e45b952a9a97d88d2cb/09ede/es-snapshot-bucket.png 1710w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/8cbd92c41bcf5e45b952a9a97d88d2cb/d9199/es-snapshot-bucket.png&quot;
          alt=&quot;Es snapshot bucket&quot;
          title=&quot;Es snapshot bucket&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;스냅샷-레파지토리-및-스냅샷-생성을-위한-iam-role-생성&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%8A%A4%EB%83%85%EC%83%B7-%EB%A0%88%ED%8C%8C%EC%A7%80%ED%86%A0%EB%A6%AC-%EB%B0%8F-%EC%8A%A4%EB%83%85%EC%83%B7-%EC%83%9D%EC%84%B1%EC%9D%84-%EC%9C%84%ED%95%9C-iam-role-%EC%83%9D%EC%84%B1&quot; aria-label=&quot;스냅샷 레파지토리 및 스냅샷 생성을 위한 iam role 생성 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;스냅샷 레파지토리 및 스냅샷 생성을 위한 IAM Role 생성&lt;/h2&gt;
&lt;p&gt;스냅샷 레파지토리 등록, 스냅샷 저장, 삭제, 조회 등을 위해 OpenSearch에서 S3에 대해 저장, 조회, 삭제 등을 할 수 있는 IAM Role이 필요합니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;IAM Role 생성하기&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/b123802d584483583d535cab73ebc69a/536c7/es-snapshot-role.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 41.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAAA1UlEQVQoz5VRiw6DIBDj/z/TqFtUREV8oXaU7JJp2JJdUu4gcNcW1XUdsiyDcw7/xHmeSai+71EUBZqmQdu2F1hrYYwB73AwMzEMQ7LZcRxQXPZ9h/ce27ZFsJZBWusIquA+z3OUZYl5ni9v2Ccy/CVLLtEOMrTjiDGAzZipgJCaA9SdNoMT67pGVVWxkZsm6GCJfj5gwjntENkylDlKvhsteV1XLMsSm0dLaEU4829L+DgVKvV796BkgpIJ1mQocmkB91NQ8pXhJ8hQPo6QWs7JVli/AKx4cbGE8HxrAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/b123802d584483583d535cab73ebc69a/8ac56/es-snapshot-role.webp 240w,
/static/b123802d584483583d535cab73ebc69a/d3be9/es-snapshot-role.webp 480w,
/static/b123802d584483583d535cab73ebc69a/e46b2/es-snapshot-role.webp 960w,
/static/b123802d584483583d535cab73ebc69a/f992d/es-snapshot-role.webp 1440w,
/static/b123802d584483583d535cab73ebc69a/6c9e6/es-snapshot-role.webp 1480w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/b123802d584483583d535cab73ebc69a/8ff5a/es-snapshot-role.png 240w,
/static/b123802d584483583d535cab73ebc69a/e85cb/es-snapshot-role.png 480w,
/static/b123802d584483583d535cab73ebc69a/d9199/es-snapshot-role.png 960w,
/static/b123802d584483583d535cab73ebc69a/07a9c/es-snapshot-role.png 1440w,
/static/b123802d584483583d535cab73ebc69a/536c7/es-snapshot-role.png 1480w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/b123802d584483583d535cab73ebc69a/d9199/es-snapshot-role.png&quot;
          alt=&quot;ES snapshot iam role&quot;
          title=&quot;ES snapshot iam role&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Policy 생성하기&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;생성한 IAM Role에 바인딩 할 정책 생성합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;json&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;{
  &amp;quot;Version&amp;quot;: &amp;quot;2012-10-17&amp;quot;,
  &amp;quot;Statement&amp;quot;: [{
    &amp;quot;Action&amp;quot;: [
      &amp;quot;s3:ListBucket&amp;quot;
    ],
    &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;,
    &amp;quot;Resource&amp;quot;: [
      &amp;quot;arn:aws:s3:::elasticsearch-snapshot&amp;quot;
    ]
  },
    {
      &amp;quot;Action&amp;quot;: [
        &amp;quot;s3:GetObject&amp;quot;,
        &amp;quot;s3:PutObject&amp;quot;,
        &amp;quot;s3:DeleteObject&amp;quot;
      ],
      &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;,
      &amp;quot;Resource&amp;quot;: [
        &amp;quot;arn:aws:s3:::elasticsearch-snapshot/*&amp;quot;
      ]
    },
    {
      &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;,
      &amp;quot;Action&amp;quot;: &amp;quot;iam:PassRole&amp;quot;,
      &amp;quot;Resource&amp;quot;: &amp;quot;해당 IAM Role 생성 이후 생성된 IAM Role의 arn 입력&amp;quot;
    },
    {
      &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;,
      &amp;quot;Action&amp;quot;: &amp;quot;es:ESHttpPut&amp;quot;,
      &amp;quot;Resource&amp;quot;: &amp;quot;Elasticsearch service에 대한 arn 입력&amp;quot;
    }
  ]
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;IAM Role에 Policy 바인딩&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Policy를 IAM Role에 바인딩합니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;생성된 IAM Role에 Trust relationship 설정하기&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;OpenSearch가 해당 Role을 Assume할 수 있도록 아래와 같은 Trust Relationship을 생성한 Role에 추가합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;json&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;{
  &amp;quot;Version&amp;quot;: &amp;quot;2012-10-17&amp;quot;,
  &amp;quot;Statement&amp;quot;: [{
    &amp;quot;Sid&amp;quot;: &amp;quot;&amp;quot;,
    &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;,
    &amp;quot;Principal&amp;quot;: {
      &amp;quot;Service&amp;quot;: &amp;quot;es.amazonaws.com&amp;quot;
    },
    &amp;quot;Action&amp;quot;: &amp;quot;sts:AssumeRole&amp;quot;
  }]
  
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;스냅샷-레파지토리-생성&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%8A%A4%EB%83%85%EC%83%B7-%EB%A0%88%ED%8C%8C%EC%A7%80%ED%86%A0%EB%A6%AC-%EC%83%9D%EC%84%B1&quot; aria-label=&quot;스냅샷 레파지토리 생성 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;스냅샷 레파지토리 생성&lt;/h2&gt;
&lt;p&gt;스냅샷의 생성 및 관리를 위해서는 Snapshot Repository가 사전에 등록되어 있어야 합니다.
일회성 작업이기 때문에 간단하게 Python 스크립트를 작성해 사용했습니다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;저는 해당 스크립트를 이전에 생성한 IAM Role을 바인딩한 EC2에서 실행했습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;deckgo-highlight-code language=&quot;python&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;import boto3
import requests
from requests_aws4auth import AWS4Auth

bucket = &amp;quot;elasticsearch-snapshot&amp;quot;
role_arn = &amp;quot;arn:aws:iam::00000000000:role/elasticsearchSnapshotRole&amp;quot;
host = &amp;quot;https://{$elasticsearchDomain}/&amp;quot;
region = &amp;quot;ap-northeast-2&amp;quot;
service = &amp;quot;es&amp;quot;

credentials = boto3.Session().get_credentials()
awsauth = AWS4Auth(credentials.access_key, credentials.secret_key, region, service, session_token=credentials.token)

# Register snapshot repository

path = &amp;quot;_snapshot/&amp;quot; + bucket
url = host + path

payload = {
    &amp;quot;type&amp;quot;: &amp;quot;s3&amp;quot;,
    &amp;quot;settings&amp;quot;: {
        &amp;quot;bucket&amp;quot;: bucket,
        &amp;quot;region&amp;quot;: region,
        &amp;quot;role_arn&amp;quot;: role_arn
    }
}

headers = {&amp;quot;Content-Type&amp;quot;: &amp;quot;application/json&amp;quot;}

r = requests.put(url, auth=awsauth, json=payload, headers=headers)

print(r.status_code)
print(r.text)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;index-state-management&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#index-state-management&quot; aria-label=&quot;index state management permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Index State Management&lt;/h2&gt;
&lt;p&gt;OpenSearch에서는 Open Distro For Elasticsearch 기능을 제공하며
Open Distro에는 ISM(Index State management) 플러그인이 포함되어 있습니다.
ISM 플러그인을 활용하면 &lt;strong&gt;인덱스 기간, 인덱스 크기, 문서 수 변경을 기반으로 주기적인 인덱스 관리 작업을 자동화&lt;/strong&gt; 할 수 있습니다.&lt;/p&gt;
&lt;h3 id=&quot;index-state-management-policy&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#index-state-management-policy&quot; aria-label=&quot;index state management policy permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Index State Management Policy&lt;/h3&gt;
&lt;p&gt;ISM Policy는 아래와 같은 구조를 가지고 있습니다. 하위에 states 및 ism_template 등의 속성 값을 가집니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;json&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;{
  &amp;quot;policy&amp;quot;: {
    &amp;quot;description&amp;quot;: &amp;quot;Example policy.&amp;quot;,
    &amp;quot;default_state&amp;quot;: &amp;quot;empty&amp;quot;,
    &amp;quot;states&amp;quot;: [
      {
        &amp;quot;name&amp;quot;: &amp;quot;empty&amp;quot;,
        &amp;quot;actions&amp;quot;: [],
        &amp;quot;transitions&amp;quot;: []
      }
    ],
    &amp;quot;ism_template&amp;quot;: {
      &amp;quot;index_patterns&amp;quot;: [&amp;quot;test-index-v1*&amp;quot;],
      &amp;quot;priority&amp;quot;: 100
    }
  }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;states&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;정책이 가지는 여러 상태들에 대해 정의할 수 있습니다. 각각의 상태에는 상태 진입 시 순차적으로 실행되는 action과 모든 action들이 완료된 후 상태 변경을 수행하는 transition이 존재합니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;action&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;action은 상태 변경에 따라 순차적으로 실행되는 작업입니다. 스냅샷을 생성하거나, 인덱스를 삭제하는 등 다양한 작업을 수행할 수 있습니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;json&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;// occupied 상태로 전환되는 시점에 스냅샷 생성 action 수행
&amp;quot;states&amp;quot;: [
  {
    &amp;quot;name&amp;quot;: &amp;quot;occupied&amp;quot;,
    &amp;quot;actions&amp;quot;: [
        {
          &amp;quot;snapshot&amp;quot;: {
            &amp;quot;repository&amp;quot;: &amp;quot;elasticsearch-snapshot&amp;quot;
          }
        }
      ],
    // ...
  }
]&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;transition&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;상태가 변경되기 위해 충족되어야 하는 조건을 정의합니다. 현재 상태의 모든 action의 수행이 완료된 후 transition을 체크하고 상태 변경을 수행합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;json&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;// empty 상태의 모든 action을 수행하고 조건이 충족되면 occupied 상태로 변경
&amp;quot;states&amp;quot;: [
	{
	  &amp;quot;name&amp;quot;: &amp;quot;empty&amp;quot;,
	  &amp;quot;actions&amp;quot;: [],
	  &amp;quot;transitions&amp;quot;: [
	    {
	      &amp;quot;state_name&amp;quot;: &amp;quot;occupied&amp;quot;,
	      &amp;quot;conditions&amp;quot;: {
	        &amp;quot;min_index_age&amp;quot;: &amp;quot;10d&amp;quot;
	      }
	    }
	  ]
	},
  // ...
]&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ism_template&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;템플릿 패턴을 정의해 해당 패턴이 일치하는 인덱스에 자동으로 정책을 적용합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;json&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;// test-index-v1-* 패턴과 일치하는 인덱스 생성 시 해당 정책 적용
&amp;quot;ism_template&amp;quot;: {
  &amp;quot;index_patterns&amp;quot;: [&amp;quot;test-index-v1-*&amp;quot;],
  &amp;quot;priority&amp;quot;: 100
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;index-state-management-policy를-이용한-수동-스냅샷-생성-자동화&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#index-state-management-policy%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%88%98%EB%8F%99-%EC%8A%A4%EB%83%85%EC%83%B7-%EC%83%9D%EC%84%B1-%EC%9E%90%EB%8F%99%ED%99%94&quot; aria-label=&quot;index state management policy를 이용한 수동 스냅샷 생성 자동화 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Index State Management Policy를 이용한 수동 스냅샷 생성 자동화&lt;/h2&gt;
&lt;p&gt;위에서 등록한 레파지토리를 기반으로 수동 스냅샷을 생성할 수 있습니다.
레파지토리 등록과 동일하게 Python 코드로 수동 스냅샷 생성을 진행할 수 있지만 여기서는 Index State Management 기능을 이용해 스냅샷을 생성합니다.&lt;/p&gt;
&lt;p&gt;일회성 작업이 아니라 지속적으로 스냅샷을 생성해야 한다면 Index State Management 기능을 활용하는게 좋습니다.&lt;/p&gt;
&lt;h3 id=&quot;index-state-management-policy-생성하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#index-state-management-policy-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0&quot; aria-label=&quot;index state management policy 생성하기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Index State Management Policy 생성하기&lt;/h3&gt;
&lt;p&gt;키바나의 아래 화면 혹은 api 호출을 통해 Policy를 생성할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7f2e88b1355962dbceacafd4eb951ced/79538/es-snapshot-ism-policy-create.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 39.583333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABRklEQVQoz5VRy24CMQzMh7YFIVBRT+2t/VBQLyBV4imRBbJ5bV5TOyxQjo1kWbbjmbEtPj6/MH17x8twgufBBE+DMfkxBqNXDP9po/EU4ticcDhIaG1grYdqDQz5gsdXyt0/GHD7y17Ml2t8/+ywkho+ZPguQKmWgDWaI5HJppLFlOG6iBAT4tUoF0OEVwqO/gdjIVZ7CakcTrpDFzNO5zNmszkWiyU2my0kATpna21/djCeQEMgwB6casf1FrudhG8aCOc7tNrWMUPsFRKbUro28Eu5IJMVmjGxqt54ZK4lUpmIgFULBompVLAupPrBOtqlcaSKx+IcK1dEbEhdrDF73n1L5ImJ8oVMMMjVKjgxaetoDRYupNtRLOV4l865GmcCVW17jytovij8C8gjG1LnaRV1vP4AVUFVUW4Hof6a4/jSn/ALFLNNw41otLwAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/7f2e88b1355962dbceacafd4eb951ced/8ac56/es-snapshot-ism-policy-create.webp 240w,
/static/7f2e88b1355962dbceacafd4eb951ced/d3be9/es-snapshot-ism-policy-create.webp 480w,
/static/7f2e88b1355962dbceacafd4eb951ced/e46b2/es-snapshot-ism-policy-create.webp 960w,
/static/7f2e88b1355962dbceacafd4eb951ced/f992d/es-snapshot-ism-policy-create.webp 1440w,
/static/7f2e88b1355962dbceacafd4eb951ced/882b9/es-snapshot-ism-policy-create.webp 1920w,
/static/7f2e88b1355962dbceacafd4eb951ced/ac702/es-snapshot-ism-policy-create.webp 2530w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/7f2e88b1355962dbceacafd4eb951ced/8ff5a/es-snapshot-ism-policy-create.png 240w,
/static/7f2e88b1355962dbceacafd4eb951ced/e85cb/es-snapshot-ism-policy-create.png 480w,
/static/7f2e88b1355962dbceacafd4eb951ced/d9199/es-snapshot-ism-policy-create.png 960w,
/static/7f2e88b1355962dbceacafd4eb951ced/07a9c/es-snapshot-ism-policy-create.png 1440w,
/static/7f2e88b1355962dbceacafd4eb951ced/29114/es-snapshot-ism-policy-create.png 1920w,
/static/7f2e88b1355962dbceacafd4eb951ced/79538/es-snapshot-ism-policy-create.png 2530w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/7f2e88b1355962dbceacafd4eb951ced/d9199/es-snapshot-ism-policy-create.png&quot;
          alt=&quot;es-snapshot-ism-policy-create&quot;
          title=&quot;es-snapshot-ism-policy-create&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;json&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;PUT _opendistro/_ism/policies/auto-snapshot-policy
{
  &amp;quot;policy&amp;quot;: {
    &amp;quot;description&amp;quot;: &amp;quot;Takes an index snapshot.&amp;quot;,
    &amp;quot;default_state&amp;quot;: &amp;quot;empty&amp;quot;,
    &amp;quot;states&amp;quot;: [
      {
        &amp;quot;name&amp;quot;: &amp;quot;empty&amp;quot;,
        &amp;quot;actions&amp;quot;: [],
        &amp;quot;transitions&amp;quot;: [
          {
            &amp;quot;state_name&amp;quot;: &amp;quot;occupied&amp;quot;,
            &amp;quot;conditions&amp;quot;: {
              &amp;quot;min_index_age&amp;quot;: &amp;quot;10d&amp;quot;
            }
          }
        ]
      },
      {
        &amp;quot;name&amp;quot;: &amp;quot;occupied&amp;quot;,
        &amp;quot;actions&amp;quot;: [
          {
            &amp;quot;snapshot&amp;quot;: {
              &amp;quot;repository&amp;quot;: &amp;quot;elasticsearch-snapshot&amp;quot;,
            }
          }
        ],
        &amp;quot;transitions&amp;quot;: []
      }
    ],
    &amp;quot;ism_template&amp;quot;: {
      &amp;quot;index_patterns&amp;quot;: [
        &amp;quot;test-index-v1*&amp;quot;
      ],
      &amp;quot;priority&amp;quot;: 100
    }
  }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;정책을 생성하면 신규 생성되는 &lt;code class=&quot;language-text&quot;&gt;test-index-v1-*&lt;/code&gt; 패턴의 인덱스에 대해 생성 10일 뒤 인덱스 스냅샷을 자동으로 생성하게 됩니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/255d96fff579bfbd97d7d99918d2066a/b43c0/es-snapshot-ism-policy.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 27.916666666666668%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA5ElEQVQY02WQ4XKEIAyEff/n7I9T7zgqCISA2w1qZ3p15psgJJtsptYBox9nvNF2QGr7R9X+h2cQPHzGshV8uYRpXZ9w7o3HPGNZVszkxf+4JxzHgd4/6ShFBrUqY4GqQkSgtWJyb08BD4sx7kPIyCxQjtouod/IO5GKQsQEr1gpag2mnAuT6ZGfiQSK7imxawO4hpQyvrcwmoUQx0Q2+SettVFHwcyiNMZ+OQfvPXY2CUWxS0PKpyXLizxvuSKKjvc7x7AJTWeynZi6dbEpzE7nWWnvtNyvXfZh+b6/sfd2vVnOD9U+1WtjcnVYAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/255d96fff579bfbd97d7d99918d2066a/8ac56/es-snapshot-ism-policy.webp 240w,
/static/255d96fff579bfbd97d7d99918d2066a/d3be9/es-snapshot-ism-policy.webp 480w,
/static/255d96fff579bfbd97d7d99918d2066a/e46b2/es-snapshot-ism-policy.webp 960w,
/static/255d96fff579bfbd97d7d99918d2066a/f992d/es-snapshot-ism-policy.webp 1440w,
/static/255d96fff579bfbd97d7d99918d2066a/882b9/es-snapshot-ism-policy.webp 1920w,
/static/255d96fff579bfbd97d7d99918d2066a/a2101/es-snapshot-ism-policy.webp 2826w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/255d96fff579bfbd97d7d99918d2066a/8ff5a/es-snapshot-ism-policy.png 240w,
/static/255d96fff579bfbd97d7d99918d2066a/e85cb/es-snapshot-ism-policy.png 480w,
/static/255d96fff579bfbd97d7d99918d2066a/d9199/es-snapshot-ism-policy.png 960w,
/static/255d96fff579bfbd97d7d99918d2066a/07a9c/es-snapshot-ism-policy.png 1440w,
/static/255d96fff579bfbd97d7d99918d2066a/29114/es-snapshot-ism-policy.png 1920w,
/static/255d96fff579bfbd97d7d99918d2066a/b43c0/es-snapshot-ism-policy.png 2826w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/255d96fff579bfbd97d7d99918d2066a/d9199/es-snapshot-ism-policy.png&quot;
          alt=&quot;es-snapshot-ism-policy&quot;
          title=&quot;es-snapshot-ism-policy&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;snapshot action은 OpenSearch 7.8 버전부터 제공됩니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;기존에 존재하던 Index들은 패턴이 일치하더라도 자동으로 정책이 적용되지 않습니다.&lt;/p&gt;
&lt;p&gt;Index Management &gt; Policy managed indices 메뉴에서 수동으로 정책을 적용해야 합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://opendistro.github.io/for-elasticsearch/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Open Distro for Elasticsearch&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.aws.amazon.com/opensearch-service/latest/developerguide/managedomains-snapshots.html&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Creating index snapshots in Amazon Elasticsearch Service&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.aws.amazon.com/opensearch-service/latest/developerguide/ism.html&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Index State Management in Amazon Elasticsearch Service&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://opendistro.github.io/for-elasticsearch-docs/docs/im/ism/policies/#sample-policy-with-ism-template&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Policy with ISM&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[파일이 존재하는데도 No such file or directory 에러가 발생하는 경우]]></title><description><![CDATA[파일이 존재하는데도 No such file or directory 에러가 발생하는 이슈 정리]]></description><link>https://kyucumber.github.io/posts/issues/no-such-file-or-directory</link><guid isPermaLink="false">https://kyucumber.github.io/posts/issues/no-such-file-or-directory</guid><pubDate>Mon, 29 Mar 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;파트 내에서 사용할 CI 환경 구성 중 Embedded Redis를 사용해 테스트를 실행하는 모듈의 테스트가 지속적으로 실패하는 문제를 겪었습니다.&lt;/p&gt;
&lt;p&gt;로컬이나 다른 이미지에서는 빌드가 성공했기 때문에 관련 내용을 별도 찾아볼 필요 없이 이미지 변경으로 해결은 가능했지만
왜 해당 이미지에서만 테스트가 구동되지 않는지 관련 내용을 찾아보고 정리했습니다.&lt;/p&gt;
&lt;p&gt;실패한 이미지에서 발생한 에러 메세지는 아래와 같습니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;2021-03-29T21:23:49.643+0900 [DEBUG] [TestEventLogger]         at java.lang.Thread.run(Thread.java:748)
2021-03-29T21:23:49.643+0900 [DEBUG] [TestEventLogger]
2021-03-29T21:23:49.643+0900 [DEBUG] [TestEventLogger]         Caused by:
2021-03-29T21:23:49.643+0900 [DEBUG] [TestEventLogger]         java.io.IOException: Cannot run program &amp;quot;/tmp/1617020629467-0/redis-server-3.0.7&amp;quot; (in directory &amp;quot;/tmp/1617020629467-0&amp;quot;): error=2, No such file or directory
2021-03-29T21:23:49.643+0900 [DEBUG] [TestEventLogger]             at java.lang.ProcessBuilder.start(ProcessBuilder.java:1048)
2021-03-29T21:23:49.643+0900 [DEBUG] [TestEventLogger]             at redis.embedded.AbstractRedisInstance.start(AbstractRedisInstance.java:34)
2021-03-29T21:23:49.643+0900 [DEBUG] [TestEventLogger]             ... 85 more
2021-03-29T21:23:49.643+0900 [DEBUG] [TestEventLogger]
2021-03-29T21:23:49.643+0900 [DEBUG] [TestEventLogger]             Caused by:
2021-03-29T21:23:49.643+0900 [DEBUG] [TestEventLogger]             java.io.IOException: error=2, No such file or directory&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;No such file or directory&lt;/code&gt; 메세지만 보고 바이너리를 해당 경로에 복사하거나 하는 과정이 누락된 것이라고 생각했습니다.
하지만 실제 해당 경로를 체크했을 때 실제 바이너리 파일은 정상적으로 해당 경로에 위치하고 있었습니다.&lt;/p&gt;
&lt;p&gt;삽질을 계속하다가 해당 이미지에서 직접 바이너리를 실행시켜보니 아래와 같이 바이너리 파일이
존재하는데도 아래와 같이 &lt;code class=&quot;language-text&quot;&gt;No such file or directory&lt;/code&gt; 에러가 노출되는것을 확인할 수 있었습니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;bash-4.4# uname -a
Linux 490bc54ba0f4 4.14.214-160.339.amzn2.x86_64 #1 SMP Sun Jan 10 05:53:05 UTC 2021 x86_64 Linux

bash-4.4# ls -al

-rwxr-xr-x    1 root     root       4311368 Mar 29 20:35 redis-server-3.0.7
-rwxr-xr-x    1 root     root        927664 Mar 29 20:35 redis-server-3.0.7-darwin

bash-4.4# ./redis-server-3.0.7
bash: ./redis-server-3.0.7: No such file or directory&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;a href=&quot;https://askubuntu.com/questions/133389/no-such-file-or-directory-but-the-file-exists&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://askubuntu.com/questions/133389/no-such-file-or-directory-but-the-file-exists&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;파일을 찾지 못하는 경우 뿐만 아니라 운영체제 별 필요한 런타임 구성 요소가 누락되는
경우도 &lt;code class=&quot;language-text&quot;&gt;No such file or directory&lt;/code&gt;라는 형태로 에러가 출력될 수 있다는 것을 알수 있었습니다.&lt;/p&gt;
&lt;p&gt;위 에러가 발생한 케이스는 해당 Embedded Redis 라이브러리에서 사용하는 Redis 바이너리 자체가 alpine에서 구동되지 않는 문제라 결국은 CI에 사용하는 이미지를 교체해 해결했습니다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Gradle test fixtures 플러그인을 통해 중복 코드 줄이기]]></title><description><![CDATA[Gradle에서 test-fixtures 플러그인을 통해 테스트에서 발생하는 중복 코드를 제거하는 방법 정리]]></description><link>https://kyucumber.github.io/posts/spring/gradle-test-fixtures-plugins</link><guid isPermaLink="false">https://kyucumber.github.io/posts/spring/gradle-test-fixtures-plugins</guid><pubDate>Mon, 01 Mar 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;아래와 같은 멀티모듈 구조를 가진 프로젝트에서 &lt;code class=&quot;language-text&quot;&gt;module-library&lt;/code&gt;에 포함된 &lt;code class=&quot;language-text&quot;&gt;User&lt;/code&gt;라는 클래스와 연관된 테스트를 각각의 모듈에서 작성한다고 할 때 어떤 문제점이 있을까요?&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;yaml&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;├── module-one
│   └── module-library
│   └── test
│       └──  OneUserTest
├── module-two
│   └── module-library
│   └── test
│       └──  TwoUserTest
├── module-three
│   └── module-library
│   └── test
│       └──  ThreeUserTest
└── module-library
    └── src
        └── User&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;실제 코드를 작성할 때는 별 다른 문제가 없지만 테스트를 작성할 때 &lt;code class=&quot;language-text&quot;&gt;module-library&lt;/code&gt;에서 가지고 있는 &lt;code class=&quot;language-text&quot;&gt;User&lt;/code&gt;에 대한 Test Fixture를 중복적으로 각 모듈별로 만들어주어야 하는 별거 아니지만 귀찮은 문제가 있습니다.&lt;/p&gt;
&lt;p&gt;각 모듈 &lt;code class=&quot;language-text&quot;&gt;module-one&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;module-two&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;module-three&lt;/code&gt; 테스트 패키지 하위에 필요한 Fixture를 만들어서 사용할 수 있기에 불편함을 감수하고 사용하고 있었는데
Gradle의 &lt;code class=&quot;language-text&quot;&gt;java-test-fixtures&lt;/code&gt; plugin을 통해 모듈 별 Test Fixture 중복을 제거할 수 있었습니다.&lt;/p&gt;
&lt;h2 id=&quot;gradle-java-test-fixtures-플러그인-적용하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#gradle-java-test-fixtures-%ED%94%8C%EB%9F%AC%EA%B7%B8%EC%9D%B8-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0&quot; aria-label=&quot;gradle java test fixtures 플러그인 적용하기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Gradle java-test-fixtures 플러그인 적용하기&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;module-library/build.gradle.kts&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;plugins {
    `java-test-fixtures`
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;플러그인 추가 후 여러 모듈에서 사용할 &lt;code class=&quot;language-text&quot;&gt;module-library/src/testFixtures&lt;/code&gt; 디렉토리를 생성하고 하위에 아래와 같이 Fixture 생성을 위한 클래스를 생성합니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;module-library/src/testFixtures/kotlin/com.example/Fixtures.kt&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;object Fixtures {
    fun user(cn: String): User =
        User(
            name = &amp;quot;김규남&amp;quot;,
            orga = &amp;quot;무슨 조직&amp;quot;,
        )
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;testfixtures-사용하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#testfixtures-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0&quot; aria-label=&quot;testfixtures 사용하기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;testFixtures 사용하기&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;module-library&lt;/code&gt;에 정의된 &lt;code class=&quot;language-text&quot;&gt;testFixtures&lt;/code&gt;를 사용하기 위해서는 Fixture의 적용이 필요한 모듈에 아래와 같이 의존성을 추가해야 합니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;module-one/build.gradle.kts&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;dependencies {
    implementation(project(&amp;quot;:module-library&amp;quot;))
    testImplementation(testFixtures(project(&amp;quot;:module-library&amp;quot;))) // 추가
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위와 같이 의존성을 추가하고 나면 OneUserTest에서 해당 Fixtures.user 메소드를 호출할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;module-one/src/test/kotlin/com.example/OneUserTest.kt&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;class OneUserTest {
    @Test
    fun `test`() {
        val user = Fixtures.user()
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;다른 모듈 &lt;code class=&quot;language-text&quot;&gt;module-two&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;module-three&lt;/code&gt;도 동일하게 사용할 수 있습니다.&lt;/p&gt;
&lt;p&gt;이제는 각각의 모듈에서 Test Fixture를 위해 중복 코드를 정의하지 않고 &lt;code class=&quot;language-text&quot;&gt;module-library/testFixtures&lt;/code&gt; 하위에만 Fixture 정의를 위한 코드를 추가해 사용할 수 있습니다. &lt;/p&gt;
&lt;h3 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.gradle.org/current/userguide/java_testing.html#sec:java_test_fixtures&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Gradle Java Test Fixtures&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[RestHighLevelClient 테스트 작성 시 SearchResponse 더미 데이터 생성하기]]></title><description><![CDATA[Spring Elasticsearch RestHighLevelClient 사용 시 단위 테스트 작성을 위한 SearchResponse 더미 데이터 생성하기]]></description><link>https://kyucumber.github.io/posts/spring/rest-high-level-client-unit-test/</link><guid isPermaLink="false">https://kyucumber.github.io/posts/spring/rest-high-level-client-unit-test/</guid><pubDate>Wed, 10 Feb 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Spring에서 RestHighLevelClient 관련 unit 테스트 작성시 SearchResponse 더미 데이터 생성을 위한 코드를 작성했습니다. 관련 내용을 정리합니다.&lt;/p&gt;
&lt;h2 id=&quot;searchresponse-데이터-생성을-위한-util-클래스-정의&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#searchresponse-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%83%9D%EC%84%B1%EC%9D%84-%EC%9C%84%ED%95%9C-util-%ED%81%B4%EB%9E%98%EC%8A%A4-%EC%A0%95%EC%9D%98&quot; aria-label=&quot;searchresponse 데이터 생성을 위한 util 클래스 정의 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;SearchResponse 데이터 생성을 위한 Util 클래스 정의&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ElasticsearchTestUtils.kt&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;object ElasticsearchTestUtils {
    fun getSearchResponseFromJson(jsonResponse: String): SearchResponse {
        try {
            val registry = NamedXContentRegistry(getDefaultNamedXContents())
            val parser: XContentParser =
                JsonXContent.jsonXContent.createParser(registry, DeprecationHandler.THROW_UNSUPPORTED_OPERATION, jsonResponse)
            return SearchResponse.fromXContent(parser)
        } catch (e: IOException) {
            println(&amp;quot;exception $e&amp;quot;)
        } catch (e: Exception) {
            println(&amp;quot;exception $e&amp;quot;)
        }
        throw IllegalStateException(&amp;quot;invalid state&amp;quot;)
    }

    private fun getDefaultNamedXContents(): List&amp;lt;NamedXContentRegistry.Entry&amp;gt; {
        val map: MutableMap&amp;lt;String, ContextParser&amp;lt;Any, out Aggregation&amp;gt;&amp;gt; = HashMap()
        map[TopHitsAggregationBuilder.NAME] =
            ContextParser { p: XContentParser?, c: Any? -&amp;gt; ParsedTopHits.fromXContent(p, c as String?) }
        map[StringTerms.NAME] =
            ContextParser { p: XContentParser?, c: Any? -&amp;gt; ParsedStringTerms.fromXContent(p, c as String?) }
        return map.entries.stream()
            .map { entry: Map.Entry&amp;lt;String, ContextParser&amp;lt;Any, out Aggregation&amp;gt;&amp;gt; -&amp;gt;
                NamedXContentRegistry.Entry(
                    Aggregation::class.java, ParseField(entry.key), entry.value
                )
            }.toList()
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;searchresponse-생성을-위한-json-파일-생성&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#searchresponse-%EC%83%9D%EC%84%B1%EC%9D%84-%EC%9C%84%ED%95%9C-json-%ED%8C%8C%EC%9D%BC-%EC%83%9D%EC%84%B1&quot; aria-label=&quot;searchresponse 생성을 위한 json 파일 생성 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;SearchResponse 생성을 위한 json 파일 생성&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;test/resources/json/search.json&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;json&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;{
    &amp;quot;took&amp;quot; : 3,
    &amp;quot;timed_out&amp;quot; : false,
    &amp;quot;_shards&amp;quot; : {
        &amp;quot;total&amp;quot; : 6,
        &amp;quot;successful&amp;quot; : 6,
        &amp;quot;skipped&amp;quot; : 0,
        &amp;quot;failed&amp;quot; : 0
    },
    &amp;quot;hits&amp;quot; : {
        &amp;quot;total&amp;quot; : {
            &amp;quot;value&amp;quot; : 3,
            &amp;quot;relation&amp;quot; : &amp;quot;eq&amp;quot;
        },
        &amp;quot;max_score&amp;quot; : 1.0,
        &amp;quot;hits&amp;quot; : [
            {
                &amp;quot;_index&amp;quot; : &amp;quot;index&amp;quot;,
                &amp;quot;_type&amp;quot; : &amp;quot;_doc&amp;quot;,
                &amp;quot;_id&amp;quot; : &amp;quot;1&amp;quot;,
                &amp;quot;_score&amp;quot; : 1.0,
                &amp;quot;_source&amp;quot; : {
                }
            }
        ]
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;resthighlevelclient-mocking이-필요한-테스트-작성&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#resthighlevelclient-mocking%EC%9D%B4-%ED%95%84%EC%9A%94%ED%95%9C-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%9E%91%EC%84%B1&quot; aria-label=&quot;resthighlevelclient mocking이 필요한 테스트 작성 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;RestHighLevelClient mocking이 필요한 테스트 작성&lt;/h2&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;describe(&amp;quot;elasticsearch client unit test&amp;quot;) {
    val elasticsearchClient = mockk&amp;lt;RestHighLevelClient&amp;gt;()
    val lastAccessService = LastAccessSearchService(
        elasticsearchClient = elasticsearchClient,
        fullAuthAccessInfoDeserializer = FullAuthAccessInfoDeserializer()
    )

    context(&amp;quot;key를 통해 검색하는 경우&amp;quot;) {
        val query = Query()
        val key = &amp;quot;key&amp;quot;

        it(&amp;quot;해당 key에 해당하는 모든 유저 목록을 불러온다&amp;quot;) {
            val searchResponse: SearchResponse = ElasticsearchTestUtils.getSearchResponseFromJson(ClassPathResource(&amp;quot;json/search.json&amp;quot;).file.readText())
            every { elasticsearchClient.search(query.createRequest(), RequestOptions.DEFAULT) } answers { searchResponse }

            val searchResults = elasticsearchService.search(key)

            assertThat(searchResults[0].key).isEqualTo(key)
        }
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위와 같이 정의하고 사용하다 보니 Aggregation Query 결과에 대한 부분은 제대로 파싱되지 않아 제대로 사용하긴 어려워 보였습니다. 그리고 이렇게 까지 해서 단위 테스트를 작성해야 할까 싶은 생각이 드네요…&lt;/p&gt;
&lt;h3 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://discuss.elastic.co/t/elasticsearch-json-response-to-searchresponse-object/124394/4&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://discuss.elastic.co/t/elasticsearch-json-response-to-searchresponse-object/124394/4&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[ElasticsearchSinkConnector timestamp format - week based year]]></title><description><![CDATA[ElasticsearchSinkConnector에서 timestamp 포맷이 맞지 않아 주단위 인덱스가 잘못 생성된 문제 정리]]></description><link>https://kyucumber.github.io/posts/issues/elasticsearch-sink-connector-weeke-based-index</link><guid isPermaLink="false">https://kyucumber.github.io/posts/issues/elasticsearch-sink-connector-weeke-based-index</guid><pubDate>Mon, 28 Dec 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;운영중인 시스템에서 Kafka에서 Elasticsearch로의 데이터 적재를 위해 ElasticsearchSinkConnector를 사용하고 있습니다.
Connector의 설정을 통해 인덱스 이름이 월 단위로 롤링되도록 구성해두었는데, 연말에 인덱스 이름이 의도하지 않은 형태로 생성되었습니다.&lt;/p&gt;
&lt;p&gt;Elasticsearch나 Connector의 문제가 아닌 DateTimeFormat을 제대로 알지 못하고 있어 발생한 문제였습니다. 관련 내용을 아래에 정리했습니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ElasticsearchSinkConnector 설정&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;json&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;connector.class: io.confluent.connect.elasticsearch.ElasticsearchSinkConnector
transforms.TimestampRouter.timestamp.format: YYYY-&amp;#39;W&amp;#39;ww
transforms.TimestampRouter.topic.format: index-pattern-v1-${timestamp}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;문제가-된-인덱스&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%AC%B8%EC%A0%9C%EA%B0%80-%EB%90%9C-%EC%9D%B8%EB%8D%B1%EC%8A%A4&quot; aria-label=&quot;문제가 된 인덱스 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;문제가 된 인덱스&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;기준일 &lt;code class=&quot;language-text&quot;&gt;2020/12/28&lt;/code&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;의도한 인덱스 패턴: &lt;code class=&quot;language-text&quot;&gt;index-pattern-v1-2020-w53&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;실제로 생성된 인덱스: &lt;code class=&quot;language-text&quot;&gt;index-pattern-v1-2020-w01&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;아래와 같이 코드 레벨에서 확인한 결과 &lt;code class=&quot;language-text&quot;&gt;index-pattern-2020-w01&lt;/code&gt;이 출력되었습니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;DateTimeFormatter.ofPattern(&amp;quot;YYYY-MM-&amp;#39;w&amp;#39;ww&amp;quot;)

requestTimeRange = localDate(&amp;quot;2020-12-28&amp;quot;) until localDate(&amp;quot;2021-01-02&amp;quot;)

[index-pattern-2020-w01, index-pattern-2021-w01]&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;코드에서 &lt;code class=&quot;language-text&quot;&gt;w01&lt;/code&gt;이 나오는 것으로 보아 &lt;code class=&quot;language-text&quot;&gt;w01&lt;/code&gt;이라는 값은 정상적인 값으로 보입니다.&lt;/p&gt;
&lt;p&gt;다만 2021년의 첫주라 &lt;code class=&quot;language-text&quot;&gt;index-pattern-2021-w01&lt;/code&gt;이 나오길 기대했으나 &lt;code class=&quot;language-text&quot;&gt;index-pattern-2020-w01&lt;/code&gt;이 나와 문제가 됐습니다.&lt;/p&gt;
&lt;p&gt;결론부터 정리하면 아래와 같습니다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;주 단위 기준 년도를 사용하려면 &lt;code class=&quot;language-text&quot;&gt;YYYY&lt;/code&gt;가 아닌 &lt;code class=&quot;language-text&quot;&gt;Y&lt;/code&gt;를 사용하면 된다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Java8 DateTimeFormatter Patterns for Formatting and Parsing&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code   terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;Symbol  Meaning                     Presentation      Examples
  ------  -------                     ------------      -------
   G       era                         text              AD; Anno Domini; A
   u       year                        year              2004; 04
   y       year-of-era                 year              2004; 04
   D       day-of-year                 number            189
   M/L     month-of-year               number/text       7; 07; Jul; July; J
   d       day-of-month                number            10   Q/q     quarter-of-year             number/text       3; 03; Q3; 3rd quarter
   Y       week-based-year             year              1996; 96&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;변경 후 ElasticsearchSinkConnector 설정&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;json&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;connector.class: io.confluent.connect.elasticsearch.ElasticsearchSinkConnector
transforms.TimestampRouter.timestamp.format: Y-&amp;#39;W&amp;#39;ww
transforms.TimestampRouter.topic.format: index-pattern-v1-${timestamp}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;</content:encoded></item><item><title><![CDATA[axios 에서 Blob 형태 파일 응답 처리하기]]></title><description><![CDATA[axios 에서 Blob 형태 파일 응답을 처리하는 방법을 정리합니다.]]></description><link>https://kyucumber.github.io/posts/frontend/axios-handle-byte-array-response/</link><guid isPermaLink="false">https://kyucumber.github.io/posts/frontend/axios-handle-byte-array-response/</guid><pubDate>Thu, 10 Dec 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;서버에서 ByteArray 형태의 응답을 내려주는 경우에 파일을 처리하는 방법을 정리합니다.&lt;/p&gt;
&lt;h2 id=&quot;서버-응답-예시&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%84%9C%EB%B2%84-%EC%9D%91%EB%8B%B5-%EC%98%88%EC%8B%9C&quot; aria-label=&quot;서버 응답 예시 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;서버 응답 예시&lt;/h2&gt;
&lt;p&gt;아래와 같이 ByteArray 형태로 파일을 응답하는 API가 존재한다고 가정합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;@GetMapping
fun download(@RequestParam key: String): ResponseEntity&amp;lt;ByteArray&amp;gt; {
    val file = fileService.download(key)

    return ResponseEntity.ok()
        .contentType(MediaType.parseMediaType(file.contentType))
        .contentLength(file.contentLength)
        .body(file.content)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;프론트에서의-처리&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%94%84%EB%A1%A0%ED%8A%B8%EC%97%90%EC%84%9C%EC%9D%98-%EC%B2%98%EB%A6%AC&quot; aria-label=&quot;프론트에서의 처리 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;프론트에서의 처리&lt;/h2&gt;
&lt;p&gt;프론트에서 해당 Byte Array를 받아 처리하려고 하는데 응답을 받아 Blob에 대해 처리하는 부분이 잘 동작하지 않았습니다.&lt;/p&gt;
&lt;p&gt;조금 찾아보니 axios의 기본 responseType 처리가 json이라 별도의 responseType을 설정해주어야 합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;responseType: &amp;#39;json&amp;#39;, // default&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;get 요청 시 아래와 같이 responseType을 지정해줍니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;axios.get(this._url, {
  responseType: &amp;#39;blob&amp;#39;
})&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;받은 응답값은 아래와 같이 활용해 Blob을 생성할 수 있습니다.&lt;/p&gt;
&lt;p&gt;Blob을 생성한 뒤 window.URL.createObjectURL을 호출해 url을 반환받아 활용하면 됩니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;typescript&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;export interface FileData {
  data: Blob;
  contentType: string;
}

await res = s3FileStore.fetchS3Download(employee.imageUrl) // return FileData

const blob = new Blob([res.data], { type: res.contentType });
const url = window.URL.createObjectURL(blob);

setProfileImage(url);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://axios-http.com/docs/req_config&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Axios Docs, Request Config&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/60454048/how-does-axios-handle-blob-vs-arraybuffer-as-responsetype&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://stackoverflow.com/questions/60454048/how-does-axios-handle-blob-vs-arraybuffer-as-responsetype&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Kotlin 프로젝트의 Spring Boot 2.2.x 마이그레이션]]></title><description><![CDATA[Kotlin 프로젝트의 Spring Boot 2.2.x 마이그레이션 과정에서 겪은 이슈 정리]]></description><link>https://kyucumber.github.io/posts/spring/spring-boot-2.2.x-migration</link><guid isPermaLink="false">https://kyucumber.github.io/posts/spring/spring-boot-2.2.x-migration</guid><pubDate>Sun, 01 Nov 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;운영중인 코틀린 프로젝트에서 Spring Cloud 관련 버전업이 필요한 부분이 있어 겸사겸사 2.1.x -&gt; 2.2.x로 마이그레이션을 진행했습니다.
이후 마이그레이션 하는 경우에 활용하기 위해 마이그레이션 과정에서 겪었던 문제들을 아래에 정리했습니다.&lt;/p&gt;
&lt;h2 id=&quot;jackson-module-kotlin-is-prefix를-제거하는-버그-픽스&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#jackson-module-kotlin-is-prefix%EB%A5%BC-%EC%A0%9C%EA%B1%B0%ED%95%98%EB%8A%94-%EB%B2%84%EA%B7%B8-%ED%94%BD%EC%8A%A4&quot; aria-label=&quot;jackson module kotlin is prefix를 제거하는 버그 픽스 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Jackson module kotlin &lt;code class=&quot;language-text&quot;&gt;is&lt;/code&gt; prefix를 제거하는 버그 픽스&lt;/h2&gt;
&lt;p&gt;기존에 존재하던 &lt;code class=&quot;language-text&quot;&gt;is&lt;/code&gt; prefix를 제거하는 버그가 해소되었습니다.
아래와 같이 사용하는 코드가 있었다면 클라이언트쪽에서 찾아 변경하거나 &lt;code class=&quot;language-text&quot;&gt;@JsonProperty&lt;/code&gt;를 추가해 사용해야 합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;data class Data(
    val isAdmin: Boolean = false // is가 제거된 `admin`으로 Deserialize 되던 버그가 해결되어 이제 `isAdmin` 으로 Deserialize 된다.
)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/FasterXML/jackson-module-kotlin/issues/80&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://github.com/FasterXML/jackson-module-kotlin/issues/80&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/FasterXML/jackson-module-kotlin/issues/346&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://github.com/FasterXML/jackson-module-kotlin/issues/346&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/spinnaker/orca/commit/df71ed993f77b06b029f5e129256f1972d1d0d3b&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://github.com/spinnaker/orca/commit/df71ed993f77b06b029f5e129256f1972d1d0d3b&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;deprecated-mediatypeapplicationjsonutf8&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#deprecated-mediatypeapplicationjsonutf8&quot; aria-label=&quot;deprecated mediatypeapplicationjsonutf8 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Deprecated MediaType.APPLICATION&lt;em&gt;JSON&lt;/em&gt;UTF8&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;MediaType.APPLICATION_JSON_UTF8&lt;/code&gt; 가 Deprecate 되었습니다.
&lt;a href=&quot;https://github.com/spring-projects/spring-framework/issues/22788&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;제기된 이슈&lt;/a&gt;와 관련된 내용을 살펴봤을 때
RFC 스펙이 변경되면서 JSON 인코딩이 기본적으로 UTF-8로 변경되었고 이에 따라 불필요해져 Deprecate 된 것 같습니다.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://tools.ietf.org/html/rfc7159#section-8.1&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;RFC-7159&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;JSON text SHALL be encoded in UTF-8, UTF-16, or UTF-32&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://tools.ietf.org/html/rfc8259#section-8.1&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;RFC-8259&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;JSON text exchanged between systems that are not part of a closed ecosystem MUST be encoded using UTF-8&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Deprecate 된 코드들만 제거해주면 큰 문제는 없었는데, 기존 MockMvc로 작성된 테스트 코드에서 한글이 다 깨지는 문제가 있었습니다.
MockMvc를 사용하는 경우 아래처럼 &lt;code class=&quot;language-text&quot;&gt;DEFAULT_CHARACTER_ENCODING&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;ISO_8859&lt;/code&gt;로 지정되어 한글이 깨지는 것 같네요.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;java&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;public class MockHttpServletResponse implements HttpServletResponse {

	private static final String CHARSET_PREFIX = &amp;quot;charset=&amp;quot;;

	private static final String DATE_FORMAT = &amp;quot;EEE, dd MMM yyyy HH:mm:ss zzz&amp;quot;;

	private static final TimeZone GMT = TimeZone.getTimeZone(&amp;quot;GMT&amp;quot;);


	//---------------------------------------------------------------------
	// ServletResponse properties
	//---------------------------------------------------------------------

	private boolean outputStreamAccessAllowed = true;

	private boolean writerAccessAllowed = true;

	@Nullable
	private String characterEncoding = WebUtils.DEFAULT_CHARACTER_ENCODING;
	
    // public static final String DEFAULT_CHARACTER_ENCODING = &amp;quot;ISO-8859-1&amp;quot;;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;a href=&quot;https://qastack.kr/programming/58525387/mockmvc-no-longer-handles-utf-8-characters-with-spring-boot-2-2-0-release&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://qastack.kr/programming/58525387/mockmvc-no-longer-handles-utf-8-characters-with-spring-boot-2-2-0-release&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;mockmvcsecurityautoconfiguration-제거&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#mockmvcsecurityautoconfiguration-%EC%A0%9C%EA%B1%B0&quot; aria-label=&quot;mockmvcsecurityautoconfiguration 제거 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;MockMvcSecurityAutoConfiguration 제거&lt;/h2&gt;
&lt;p&gt;아래 2.1.x에 있던 &lt;code class=&quot;language-text&quot;&gt;MockMvcSecurityAutoConfiguration&lt;/code&gt;가 제거되었습니다.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/spring-projects/spring-boot/blob/2.1.x/spring-boot-project/spring-boot-test-autoconfigure/src/main/java/org/springframework/boot/test/autoconfigure/web/servlet/MockMvcSecurityAutoConfiguration.java&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://github.com/spring-projects/spring-boot/blob/2.1.x/spring-boot-project/spring-boot-test-autoconfigure/src/main/java/org/springframework/boot/test/autoconfigure/web/servlet/MockMvcSecurityAutoConfiguration.java&lt;/a&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;java&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;@Configuration
@ConditionalOnProperty(prefix=&amp;quot;spring.test.mockmvc&amp;quot;,
                       name=&amp;quot;secure&amp;quot;,
                       havingValue=&amp;quot;true&amp;quot;,
                       matchIfMissing=true)
@Import(value={SecurityAutoConfiguration.class,UserDetailsServiceAutoConfiguration.class,org.springframework.boot.test.autoconfigure.web.servlet.MockMvcSecurityConfiguration.class})
public class MockMvcSecurityAutoConfiguration {}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위 AutoConfiguration이 제거되면서 테스트 일부가 영향을 받아 실패했습니다.
변경된 AutoConfiguration에 따라 불필요한 exclude 설정을 정리해 깨진 테스트를 복구했습니다.&lt;/p&gt;
&lt;p&gt;위 &lt;code class=&quot;language-text&quot;&gt;MockMvcSecurityAutoConfiguration&lt;/code&gt;이 제거되고 아래와 같이 변경되었습니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/16ddd6bdd7723e3cff39b3a61a88585a/7388e/spring-boot-test-autoconfigure-spring-factories.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 24.583333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAAA70lEQVQY03XPyU7DMBAG4DwLFXDi1KrlQBYatXESx3uWJqmDkOD93+DHmariAodP/3gZaxydGIPsejRSgTcC2loY10IZC6kNhNIhNdXaOlqvd1f3uuIcXAgSySrDNDl8fy349G3Q4XpRmHoBP2osk8E8iEBS7UdD572t0JmS6CYPjpRRzTLULIWzEt7P8HOLvhUwioGd41+nm/Kc3BQpqjt6I6OMNrsUD9sYj/sEmXJ4Ky3iyiLlLV7iIuy/4/k1J0+HIza7BGvPf6K6zCDqHM41+FgG+PD91RImvYYcB415tFRPFxMmL9CE+2sf/8MPDZ67JmIWpy0AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/16ddd6bdd7723e3cff39b3a61a88585a/8ac56/spring-boot-test-autoconfigure-spring-factories.webp 240w,
/static/16ddd6bdd7723e3cff39b3a61a88585a/d3be9/spring-boot-test-autoconfigure-spring-factories.webp 480w,
/static/16ddd6bdd7723e3cff39b3a61a88585a/e46b2/spring-boot-test-autoconfigure-spring-factories.webp 960w,
/static/16ddd6bdd7723e3cff39b3a61a88585a/ff749/spring-boot-test-autoconfigure-spring-factories.webp 1104w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/16ddd6bdd7723e3cff39b3a61a88585a/8ff5a/spring-boot-test-autoconfigure-spring-factories.png 240w,
/static/16ddd6bdd7723e3cff39b3a61a88585a/e85cb/spring-boot-test-autoconfigure-spring-factories.png 480w,
/static/16ddd6bdd7723e3cff39b3a61a88585a/d9199/spring-boot-test-autoconfigure-spring-factories.png 960w,
/static/16ddd6bdd7723e3cff39b3a61a88585a/7388e/spring-boot-test-autoconfigure-spring-factories.png 1104w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/16ddd6bdd7723e3cff39b3a61a88585a/d9199/spring-boot-test-autoconfigure-spring-factories.png&quot;
          alt=&quot;autoconfigure&quot;
          title=&quot;autoconfigure&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;# AutoConfigureMockMvc auto-configuration imports
org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc=\
org.springframework.boot.test.autoconfigure.web.servlet.MockMvcAutoConfiguration,\
org.springframework.boot.test.autoconfigure.web.servlet.MockMvcWebClientAutoConfiguration,\
org.springframework.boot.test.autoconfigure.web.servlet.MockMvcWebDriverAutoConfiguration,\
org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration,\
org.springframework.boot.autoconfigure.security.servlet.SecurityFilterAutoConfiguration,\
org.springframework.boot.autoconfigure.security.servlet.UserDetailsServiceAutoConfiguration,\
org.springframework.boot.test.autoconfigure.web.servlet.MockMvcSecurityConfiguration&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;antpathmatcher-우선순위-변경-관련-이슈&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#antpathmatcher-%EC%9A%B0%EC%84%A0%EC%88%9C%EC%9C%84-%EB%B3%80%EA%B2%BD-%EA%B4%80%EB%A0%A8-%EC%9D%B4%EC%8A%88&quot; aria-label=&quot;antpathmatcher 우선순위 변경 관련 이슈 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;AntPathMatcher 우선순위 변경 관련 이슈&lt;/h2&gt;
&lt;p&gt;우선순위를 정하는 &lt;code class=&quot;language-text&quot;&gt;compare&lt;/code&gt; 로직에 아래 코드가 추가되었습니다.
큰 변경이 있었던 건 아니지만 기존 &lt;code class=&quot;language-text&quot;&gt;AntPathMatcher&lt;/code&gt;를 활용하던 프로젝트라면 원하던 대로 기존 로직들이 동작하는지 체크해보아야 할 것 같습니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;java&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt; if (info1.isPrefixPattern() &amp;amp;&amp;amp; info2.isPrefixPattern()) {
        return info2.getLength() - info1.getLength();
 }&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/spring-projects/spring-framework/blob/5.2.x/spring-core/src/main/java/org/springframework/util/AntPathMatcher.java#L782&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://github.com/spring-projects/spring-framework/blob/5.2.x/spring-core/src/main/java/org/springframework/util/AntPathMatcher.java#L782&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;tomcat-메트릭-노출-이슈&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#tomcat-%EB%A9%94%ED%8A%B8%EB%A6%AD-%EB%85%B8%EC%B6%9C-%EC%9D%B4%EC%8A%88&quot; aria-label=&quot;tomcat 메트릭 노출 이슈 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Tomcat 메트릭 노출 이슈&lt;/h2&gt;
&lt;p&gt;2.2.x로 마이그레이션을 진행한 이후 아래와 같은 톰캣 메트릭들이 노출되지 않았습니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;tomcat_threads_busy_threads&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;릴리즈 노트를 제대로 보지 않아 해당 부분의 패치를 누락했습니다.
아래 설정을 추가해 해결할 수 있습니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;yaml&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;server:
  tomcat:
    mbeanregistry:
      enabled: true&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.2-Release-Notes#tomcats-mbean-registry&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Spring Boot 2.2 릴리즈 노트 Tomcat’s MBean Registry&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Tomcat’s MBean Registry is now disabled by default, saving approximately 2MB of heap.
If you want to use Tomcat’s MBeans, for example so that they can be used to expose metrics via Micrometer, set the server.tomcat.mbeanregistry.enabled to true.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;redis-cluster-사용-시-redisreactivehealthindicator-이슈&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#redis-cluster-%EC%82%AC%EC%9A%A9-%EC%8B%9C-redisreactivehealthindicator-%EC%9D%B4%EC%8A%88&quot; aria-label=&quot;redis cluster 사용 시 redisreactivehealthindicator 이슈 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Redis cluster 사용 시 RedisReactiveHealthIndicator 이슈&lt;/h2&gt;
&lt;p&gt;2.2.x로 올리고 첫 배포를 진행할 때 레디스 클러스터를 사용중인 모듈의 헬스체크가 제대로 되지 않는 문제가 발생했습니다.&lt;/p&gt;
&lt;p&gt;기존에 헬스 체크가 인프라에 영향을 받도록 구성되어 있었는데, 인프라 장애 시 어플리케이션 장애 대응이 더 어려워지는 문제가 있어 해당 부분을 제거했고,
이에 따라 헬스체크가 제대로 되지 않아 어플리케이션 배포가 되지 않는 문제도 자연스럽게 해소되었습니다.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/spring-projects/spring-boot/issues/21514&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://github.com/spring-projects/spring-boot/issues/21514&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Spring Cloud Function을 이용한 Kafka Client 구성하기]]></title><description><![CDATA[Spring Cloud Function을 이용해 Spring에서 Kafka Producer, Consumer, Streams 코드를 작성하는 방법 정리]]></description><link>https://kyucumber.github.io/posts/spring/spring-cloud-function-kafka/</link><guid isPermaLink="false">https://kyucumber.github.io/posts/spring/spring-cloud-function-kafka/</guid><pubDate>Sat, 03 Oct 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://github.com/spring-cloud/spring-cloud-function&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Spring Cloud Function&lt;/a&gt;은 spring-cloud 하위의 프로젝트입니다.
Spring Cloud Function을 이용하면 사용자가 정의한 &lt;code class=&quot;language-text&quot;&gt;Supplier&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;Consumer&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;Function&lt;/code&gt;등의 인터페이스를 &lt;strong&gt;FunctionCatalog&lt;/strong&gt;가 읽어 Consume, Produce 등을 수행하는 표준 표현으로 변환하는 기능을 사용할 수 있습니다.&lt;/p&gt;
&lt;p&gt;Spring Cloud Function에서는 Java 8 부터 사용할 수 있는 3가지 코어 Function(&lt;code class=&quot;language-text&quot;&gt;Supplier&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Function&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Consumer&lt;/code&gt;) interface들을 지원합니다.
각각의 인터페이스를 이용해 Kafka Producer, Consumer, Streams를 구성한 코드를 정리했습니다. &lt;/p&gt;
&lt;h2 id=&quot;supplier-interface를-이용한-kafka-producer-구성하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#supplier-interface%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-kafka-producer-%EA%B5%AC%EC%84%B1%ED%95%98%EA%B8%B0&quot; aria-label=&quot;supplier interface를 이용한 kafka producer 구성하기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Supplier interface를 이용한 Kafka Producer 구성하기&lt;/h2&gt;
&lt;p&gt;Supplier interface를 통해 Kafka Producer를 구성할 수 있습니다. 아래와 같은 의존성 및 properties가 정의되어야 합니다.
Producer의 경우 Non Reactive 혹은 Reactive 방식으로 구성할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;build.gradle.kts&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;implementation(&amp;quot;org.springframework.cloud:spring-cloud-function-kotlin&amp;quot;)
implementation(&amp;quot;org.springframework.cloud:spring-cloud-stream-binder-kafka&amp;quot;)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;a href=&quot;https://cloud.spring.io/spring-cloud-stream-binder-kafka/spring-cloud-stream-binder-kafka.html#_kafka_binder_properties&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Kafka Binder Properties&lt;/a&gt;, &lt;a href=&quot;https://cloud.spring.io/spring-cloud-stream-binder-kafka/spring-cloud-stream-binder-kafka.html#kafka-producer-properties&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Kafka Producer Properties&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;application.yml&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;yaml&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;spring:
  profiles: local
  cloud:
    function:
      definition: kotlinSupplier; # 함수 이름, 여러개인 경우 kotlinSupplier,kotlinConsumer; 이런 식으로 정의
    stream:
      bindings:
        kotlinSupplier-out-0:
          destination: backoffice-auth.local.logging.access-info.json #
      kafka:
        binder:
          brokers: localhost
          defaultBrokerPort: 9092
          configuration:
            acks: all
        bindings:
          kotlinSupplier-out-0:
            producer: # producer 세부 설정, 별도로 설정할 부분이 없어 생략&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 id=&quot;non-reactive-producer&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#non-reactive-producer&quot; aria-label=&quot;non reactive producer permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Non Reactive Producer&lt;/h3&gt;
&lt;p&gt;Non Reactive 방식의 Producer를 정의하기 위해서 아래와 같이 설정할 수 있습니다.
아래와 같이 설정하는 경우 &lt;a href=&quot;https://github.com/spring-cloud/spring-cloud-stream/blob/master/spring-cloud-stream/src/main/java/org/springframework/cloud/stream/config/DefaultPollerProperties.java&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;default poller&lt;/a&gt; 에 의해서 polling 방식(Non Reactive)을 통해 producing을 진행합니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ProducerConfig&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;@Configuration
class ProducerConfig {
    @Bean
    fun kotlinSupplier() = Supplier&amp;lt;String&amp;gt; {
        &amp;quot;produce test&amp;quot;
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;아래와 같이 Polling 방식으로 producing이 진행되는것을 확인할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/dad2c90af96c4112cff042300d1c93ce/555cf/spring-cloud-function-supplier.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 22.083333333333332%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAYUlEQVQY06XNSw7DIBAEUe5/zmwsjBkYPsaIqci+gZOS3rLVLqROKgNVRZJggJn95M59tsS2Z0LY8d7TWqPW+sq9iTESjgPn5UR0UEoha2bZYq335pwPJ3qhbdJ7f57+7QvcJDm7xSnvJwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/dad2c90af96c4112cff042300d1c93ce/8ac56/spring-cloud-function-supplier.webp 240w,
/static/dad2c90af96c4112cff042300d1c93ce/d3be9/spring-cloud-function-supplier.webp 480w,
/static/dad2c90af96c4112cff042300d1c93ce/e46b2/spring-cloud-function-supplier.webp 960w,
/static/dad2c90af96c4112cff042300d1c93ce/f992d/spring-cloud-function-supplier.webp 1440w,
/static/dad2c90af96c4112cff042300d1c93ce/882b9/spring-cloud-function-supplier.webp 1920w,
/static/dad2c90af96c4112cff042300d1c93ce/9ddbc/spring-cloud-function-supplier.webp 1960w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/dad2c90af96c4112cff042300d1c93ce/8ff5a/spring-cloud-function-supplier.png 240w,
/static/dad2c90af96c4112cff042300d1c93ce/e85cb/spring-cloud-function-supplier.png 480w,
/static/dad2c90af96c4112cff042300d1c93ce/d9199/spring-cloud-function-supplier.png 960w,
/static/dad2c90af96c4112cff042300d1c93ce/07a9c/spring-cloud-function-supplier.png 1440w,
/static/dad2c90af96c4112cff042300d1c93ce/29114/spring-cloud-function-supplier.png 1920w,
/static/dad2c90af96c4112cff042300d1c93ce/555cf/spring-cloud-function-supplier.png 1960w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/dad2c90af96c4112cff042300d1c93ce/d9199/spring-cloud-function-supplier.png&quot;
          alt=&quot;nonreactivesupplier&quot;
          title=&quot;nonreactivesupplier&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&quot;reactive-producer&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reactive-producer&quot; aria-label=&quot;reactive producer permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reactive Producer&lt;/h3&gt;
&lt;p&gt;Reactive 방식의 Producer를 정의하기 위해서 아래와 같이 구성할 수 있습니다.
예제 코드에서는 기본 구현체 중 하나인 &lt;code class=&quot;language-text&quot;&gt;EmitterProcessor&lt;/code&gt;를 이용했습니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ProducerConfig&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;@Configuration
class ProducerConfig {
    @Bean
    fun processor(): EmitterProcessor&amp;lt;String&amp;gt; =
        EmitterProcessor.create&amp;lt;String&amp;gt;()

    @Bean
    fun processorSink(processor: EmitterProcessor&amp;lt;String&amp;gt;): FluxSink&amp;lt;String&amp;gt; {
        return processor.sink(FluxSink.OverflowStrategy.DROP)
    }

    @Bean
    fun kotlinSupplier(processor: EmitterProcessor&amp;lt;String&amp;gt;) = Supplier&amp;lt;Flux&amp;lt;String&amp;gt;&amp;gt; {
        processor
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ProduceTestController&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;@RestController
@RequestMapping(&amp;quot;/api/v1&amp;quot;)
class ProduceTestController(
    private val processorSink: FluxSink&amp;lt;String&amp;gt;
) {
    @GetMapping
    fun produce() {
        this.processorSink.next(UUID.randomUUID().toString())
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위와 같이 코드를 정의하고, 해당 &lt;code class=&quot;language-text&quot;&gt;/api/v1&lt;/code&gt; 경로로 GET 요청을 보내면 아래와 같이 producing이 진행됩니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2ba2991ce4f5a5049bc8316c86b3bae6/555cf/spring-cloud-function-reactive-supplier.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 22.083333333333332%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAWklEQVQY06WPWwqAIBQF2/8yIwIr7XbTfIFTLiE8MJy/gZnOO3FqZnOBebVohFwb0Git/79NTgvHVTAushhFAsQyIJS7Cyu7JIz1yANpRHj5gnS+VmMVn8aSXzfLO4v0BUOHAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/2ba2991ce4f5a5049bc8316c86b3bae6/8ac56/spring-cloud-function-reactive-supplier.webp 240w,
/static/2ba2991ce4f5a5049bc8316c86b3bae6/d3be9/spring-cloud-function-reactive-supplier.webp 480w,
/static/2ba2991ce4f5a5049bc8316c86b3bae6/e46b2/spring-cloud-function-reactive-supplier.webp 960w,
/static/2ba2991ce4f5a5049bc8316c86b3bae6/f992d/spring-cloud-function-reactive-supplier.webp 1440w,
/static/2ba2991ce4f5a5049bc8316c86b3bae6/882b9/spring-cloud-function-reactive-supplier.webp 1920w,
/static/2ba2991ce4f5a5049bc8316c86b3bae6/9ddbc/spring-cloud-function-reactive-supplier.webp 1960w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/2ba2991ce4f5a5049bc8316c86b3bae6/8ff5a/spring-cloud-function-reactive-supplier.png 240w,
/static/2ba2991ce4f5a5049bc8316c86b3bae6/e85cb/spring-cloud-function-reactive-supplier.png 480w,
/static/2ba2991ce4f5a5049bc8316c86b3bae6/d9199/spring-cloud-function-reactive-supplier.png 960w,
/static/2ba2991ce4f5a5049bc8316c86b3bae6/07a9c/spring-cloud-function-reactive-supplier.png 1440w,
/static/2ba2991ce4f5a5049bc8316c86b3bae6/29114/spring-cloud-function-reactive-supplier.png 1920w,
/static/2ba2991ce4f5a5049bc8316c86b3bae6/555cf/spring-cloud-function-reactive-supplier.png 1960w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/2ba2991ce4f5a5049bc8316c86b3bae6/d9199/spring-cloud-function-reactive-supplier.png&quot;
          alt=&quot;nonreactivesupplier&quot;
          title=&quot;nonreactivesupplier&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;consumer-interface를-통해-kafka-consumer-구성하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#consumer-interface%EB%A5%BC-%ED%86%B5%ED%95%B4-kafka-consumer-%EA%B5%AC%EC%84%B1%ED%95%98%EA%B8%B0&quot; aria-label=&quot;consumer interface를 통해 kafka consumer 구성하기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Consumer interface를 통해 Kafka Consumer 구성하기&lt;/h2&gt;
&lt;p&gt;Consumer interface를 통해 Kafka Consumer를 구성할 수 있습니다.
아래와 같은 의존성 및 설정이 정의되어야 합니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;build.gradle.kts&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;implementation(&amp;quot;org.springframework.cloud:spring-cloud-function-kotlin&amp;quot;)
implementation(&amp;quot;org.springframework.cloud:spring-cloud-stream-binder-kafka&amp;quot;)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;a href=&quot;https://cloud.spring.io/spring-cloud-stream-binder-kafka/spring-cloud-stream-binder-kafka.html#_kafka_binder_properties&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Kafka Binder Properties&lt;/a&gt;, &lt;a href=&quot;https://cloud.spring.io/spring-cloud-stream-binder-kafka/spring-cloud-stream-binder-kafka.html#kafka-consumer-properties&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Kafka Consumer Properties&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;application.yml&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;yaml&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;spring:
  profiles: local
  cloud:
    function:
      definition: kotlinConsumer;
    stream:
      kafka:
        binder:
          brokers: localhost
          defaultBrokerPort: 9092
          configuration:
            acks: all
        bindings:
          kotlinConsumer-in-0:
            startOffset: earliest
      bindings:
        kotlinConsumer-in-0:
          group: kotlin-consumer # consumer group id
          destination: topic # consume topic name&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ConsumerConfig&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;@Configuration
class ConsumerConfig {
    @Bean
    fun kotlinConsumer() = Consumer&amp;lt;String&amp;gt; {
        println(it)
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;function-interface를-이용해-kafka-streams-구성하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#function-interface%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%B4-kafka-streams-%EA%B5%AC%EC%84%B1%ED%95%98%EA%B8%B0&quot; aria-label=&quot;function interface를 이용해 kafka streams 구성하기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Function interface를 이용해 Kafka Streams 구성하기&lt;/h2&gt;
&lt;p&gt;Function interface를 통해 Kafka Streams API를 구현할 수 있습니다. 아래와 같은 의존성 및 설정이 정의되어야 합니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;build.gradle.kts&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;dependencies {
    implementation(&amp;quot;org.springframework.cloud:spring-cloud-stream&amp;quot;)
    implementation(&amp;quot;org.springframework.cloud:spring-cloud-stream-binder-kafka-streams&amp;quot;)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;a href=&quot;https://cloud.spring.io/spring-cloud-stream-binder-kafka/spring-cloud-stream-binder-kafka.html#_kafka_streams_properties&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Kafka Streams Properties&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;application.yml&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;yaml&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;spring:
  profiles: local
  cloud:
    function:
      definition: fullAuthAccessLogProcessor;
    stream:
      kafka:
        streams:
          binder:
            brokers: localhost:9092
            configuration:
              acks: all
          bindings:
            fullAuthAccessLogProcessor-in-0:
              consumer:
                applicationId: access-info-log-processor
      bindings:
        fullAuthAccessLogProcessor-in-0:
          destination: backoffice-auth.local.logging.access-info.json
        fullAuthAccessLogProcessor-out-0:
          destination: backoffice-auth.local.logging.full-access-info.json&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;StreamsConfig&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;@Configuration
class StreamsConfig {
    @Bean
    fun fullAuthAccessLogProcessor(fullAuthAccessInfoMapper: FullAuthAccessInfoMapper) =
        Function&amp;lt;KStream&amp;lt;String, AuthAccessInfoSchema&amp;gt;, KStream&amp;lt;String, FullAuthAccessInfoSchema&amp;gt;&amp;gt; {
            it.mapValues { value -&amp;gt; fullAuthAccessInfoMapper.map(value) }
        }

    @Bean
    fun fullAuthAccessInfoSchemaSerde(objectMapper: ObjectMapper): Serde&amp;lt;FullAuthAccessInfoSchema&amp;gt; =
        JsonSerde(FullAuthAccessInfoSchema::class.java, objectMapper)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;additional-options&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#additional-options&quot; aria-label=&quot;additional options permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Additional Options&lt;/h2&gt;
&lt;p&gt;Spring Cloud Function에서는 여러 함수 설정, Composition, Kotlin lambda support 등의 추가적인 기능을 제공합니다.&lt;/p&gt;
&lt;h3 id=&quot;multiple-functions-binding&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#multiple-functions-binding&quot; aria-label=&quot;multiple functions binding permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Multiple Functions Binding&lt;/h3&gt;
&lt;p&gt;여러 Function들이 정의되는 경우 아래와 같이 definition을 통해 여러 함수를 지정해주어야 동작합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;yaml&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;---
spring:
  profiles: local
  cloud:
    function:
      definition: kotlinSupplier|kotlinConsumer;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 id=&quot;declarative-function-composition&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#declarative-function-composition&quot; aria-label=&quot;declarative function composition permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Declarative Function Composition&lt;/h3&gt;
&lt;p&gt;여러 Function들의 Composition 기능도 제공합니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;|&lt;/code&gt;를 통해 Composition을 표현할 수 있습니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;yaml&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;spring:
  profiles: local
  cloud:
    function:
      definition: uppercase|reverse&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/spring-cloud/spring-cloud-stream-samples/blob/master/multi-functions-samples/function-composition-kafka/src/main/java/demo/FunctionCompositionDemoApplication.java&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Function Composition Example&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;kotlin-lambda-support&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#kotlin-lambda-support&quot; aria-label=&quot;kotlin lambda support permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Kotlin Lambda support&lt;/h3&gt;
&lt;p&gt;Kotlin lambda를 이용해 Functon, Supplier, Consumer를 구성하려는 경우 아래 의존성을 추가해야 합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;@Bean
open fun kotlinSupplier(): () -&amp;gt; String {
    return  { &amp;quot;Hello from Kotlin&amp;quot; }
}

@Bean
open fun kotlinFunction(): (String) -&amp;gt; String {
    return  { it.toUpperCase() }
}

@Bean
open fun kotlinConsumer(): (String) -&amp;gt; Unit {
    return  { println(it) }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;build.gradle.kts&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;dependencies {
    implementation(&amp;quot;org.springframework.cloud:spring-cloud-function-kotlin&amp;quot;)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/spring-cloud/spring-cloud-stream-binder-kafka/issues/795&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;현재 작성된 버전 기준으로는 Kafka Streams에 대해서는 lambda support가 지원되지 않습니다.&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://cloud.spring.io/spring-cloud-stream-binder-kafka/spring-cloud-stream-binder-kafka.html&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://cloud.spring.io/spring-cloud-stream-binder-kafka/spring-cloud-stream-binder-kafka.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/spring-cloud/spring-cloud-stream-samples/tree/master/multi-functions-samples/function-composition-kafka&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://github.com/spring-cloud/spring-cloud-stream-samples/tree/master/multi-functions-samples/function-composition-kafka&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Gatsby로 블로그 만들기]]></title><description><![CDATA[Gatsby Starter를 통해 블로그를 생성하는 법을 정리합니다.]]></description><link>https://kyucumber.github.io/posts/gatsby/create-gatsby-blog/</link><guid isPermaLink="false">https://kyucumber.github.io/posts/gatsby/create-gatsby-blog/</guid><pubDate>Wed, 30 Sep 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;최근 Notion을 통해 모든 메모들을 정리하고 있었는데 점점 속도가 느려지는 것 같은 느낌이 들어 별도의 블로그를 관리할 필요를 느꼈습니다.
기존에 Jekyll이나 Hexo같은 블로그 프레임워크 대신 React로 구성되어 있는 &lt;a href=&quot;https://www.gatsbyjs.com/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;gatsby&lt;/a&gt;를 이용하여 정적 블로그를 구성해봤는데 평소 개발하던 스택과 비슷해서 커스터마이징도 쉽고 설치 및 사용도 편리한 것 같습니다.&lt;/p&gt;
&lt;h2 id=&quot;installation&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#installation&quot; aria-label=&quot;installation permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Installation&lt;/h2&gt;
&lt;p&gt;node, npm, xCode나 git 등은 기본적으로 설치되어 있다고 가정하고, gatsby-cli를 설치합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;$ npm install -g gatsby-cli&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;gatsby-블로그-생성하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#gatsby-%EB%B8%94%EB%A1%9C%EA%B7%B8-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0&quot; aria-label=&quot;gatsby 블로그 생성하기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Gatsby 블로그 생성하기&lt;/h2&gt;
&lt;p&gt;여러 starter들을 이용해 기본적인 테마를 가진 Gatsby 블로그를 생성할 수 있습니다.&lt;/p&gt;
&lt;p&gt;Hexo나 Jekyll에 있는 Theme랑 동일한데 Gatsby에서는 Starter라는 이름으로 제공하는 것 같습니다.&lt;/p&gt;
&lt;p&gt;아무것도 없는 기본 starter를 이용해 gatsby 블로그를 생성하는 경우 아래와 같이 진행할 수 있어요.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;$ gatsby new hello-world https://github.com/gatsbyjs/gatsby-starter-hello-world&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;Gatsby의 Starter들은 아래 링크에서 확인할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.gatsbyjs.com/starters/gatsbyjs/gatsby-starter-default&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Gatsby Starter&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;저는 아래 링크의 gatsby-starter-lumen을 이용해 전체적인 틀을 구성하고, css나 구성을 조금씩 변경해서 사용하고 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.gatsbyjs.com/starters/alxshelepenok/gatsby-starter-lumen&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;gatsby-starter-lumen&lt;/a&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;$ gatsby new my-gatsby-project https://github.com/alxshelepenok/gatsby-starter-lumen
$ cd my-gatsby-project
$ gatsby develop&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;순서대로 실행하고 localhost:8080으로 접속하면 아래와 같은 화면이 표시됩니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/22fb169a44c46c428f2ace7aba50eded/8079d/lumen-starter.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 47.08333333333333%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABP0lEQVQoz5VRW3KDMAzk/ofpBXqJ/mcIYAgkgME8HF6BrVcZUvr4qWYWCdsjrXY9azQKdQJj27YXGG3boiw1Rttg6SvM04hlWTDPk8Ms2N/u4VVpiI/3t1fDY87zHL7vI4kVAv8EpSKkaYowDHE+nxEEAbquk/ePx0OyZ61FXhRY1xXbgSXD1DUulwviOIGKY6mTJJFBt9tNcpZluF6v8k/20rCqKpnEuu97mcawdoAxDVp3RxhjcL/fZTjBd3sthMhwmp568HLHk+GGcXarrLs637X6K6QhGVH8nxcMXZaik84z6CxEWeRomsYZVaJ2cmitpWYmczGFzbj/0ZBXQ/eQBlC/IIzEoCiKnmdKSb2bQ7O4nccP1x7H8ZfLxtSiG7Xt3GDqTAJHkBnPCTFlGAYxhStQ2K+GG4aJYuNf8QnCtLdgv/rihAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/22fb169a44c46c428f2ace7aba50eded/8ac56/lumen-starter.webp 240w,
/static/22fb169a44c46c428f2ace7aba50eded/d3be9/lumen-starter.webp 480w,
/static/22fb169a44c46c428f2ace7aba50eded/e46b2/lumen-starter.webp 960w,
/static/22fb169a44c46c428f2ace7aba50eded/f992d/lumen-starter.webp 1440w,
/static/22fb169a44c46c428f2ace7aba50eded/882b9/lumen-starter.webp 1920w,
/static/22fb169a44c46c428f2ace7aba50eded/92e50/lumen-starter.webp 2100w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/22fb169a44c46c428f2ace7aba50eded/8ff5a/lumen-starter.png 240w,
/static/22fb169a44c46c428f2ace7aba50eded/e85cb/lumen-starter.png 480w,
/static/22fb169a44c46c428f2ace7aba50eded/d9199/lumen-starter.png 960w,
/static/22fb169a44c46c428f2ace7aba50eded/07a9c/lumen-starter.png 1440w,
/static/22fb169a44c46c428f2ace7aba50eded/29114/lumen-starter.png 1920w,
/static/22fb169a44c46c428f2ace7aba50eded/8079d/lumen-starter.png 2100w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/22fb169a44c46c428f2ace7aba50eded/d9199/lumen-starter.png&quot;
          alt=&quot;gatsby-lumen&quot;
          title=&quot;gatsby-lumen&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;css나 구성을 변경하고 싶으시면 직접 커스터마이징을 진행하시면 됩니다.&lt;/p&gt;
&lt;h2 id=&quot;gatsby-플러그인-적용하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#gatsby-%ED%94%8C%EB%9F%AC%EA%B7%B8%EC%9D%B8-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0&quot; aria-label=&quot;gatsby 플러그인 적용하기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Gatsby 플러그인 적용하기&lt;/h2&gt;
&lt;p&gt;lumen starter의 경우 코드 블럭 모양이 노란색이고 예쁘지 않은것 같아서 아래 플러그인을 추가로 적용했습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;gatsby-remark-highlight-code&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;위 플러그인을 적용하면 코드 블럭의 모양이 아래와 같은 모양으로 변경됩니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ecb6df9751274aa7b1172d1da29ff793/9b1e2/screenshot-carbon.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 20.416666666666668%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA0klEQVQY03XOzYqCYBSAYe8iBqaCCBXLrBkpG6dAJmg1t5kZOS1s0U3kTzQ/9xDOxhaFwjufuBtq8fBy4HA40vVyZRsELFZr3KWP6/lVS67PUsye93HfasPCXRNsd+R5jnQ6pczGEzTNQG49o7YHKIqBovZQNJNmq89jQxM6N9WbXWoPMubQIcsypDT9xbbnDAc2o5GDZb7yZE3ovwjWFN2w6ejWXd3eGFk1cd7excEzUvnm8fjJPoyJooRQKBuFlTgWkoPooeo/iVDuf33/UBQFf5cVyj3kDEUiAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/ecb6df9751274aa7b1172d1da29ff793/8ac56/screenshot-carbon.webp 240w,
/static/ecb6df9751274aa7b1172d1da29ff793/d3be9/screenshot-carbon.webp 480w,
/static/ecb6df9751274aa7b1172d1da29ff793/e46b2/screenshot-carbon.webp 960w,
/static/ecb6df9751274aa7b1172d1da29ff793/f992d/screenshot-carbon.webp 1440w,
/static/ecb6df9751274aa7b1172d1da29ff793/17f0a/screenshot-carbon.webp 1880w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/ecb6df9751274aa7b1172d1da29ff793/8ff5a/screenshot-carbon.png 240w,
/static/ecb6df9751274aa7b1172d1da29ff793/e85cb/screenshot-carbon.png 480w,
/static/ecb6df9751274aa7b1172d1da29ff793/d9199/screenshot-carbon.png 960w,
/static/ecb6df9751274aa7b1172d1da29ff793/07a9c/screenshot-carbon.png 1440w,
/static/ecb6df9751274aa7b1172d1da29ff793/9b1e2/screenshot-carbon.png 1880w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/ecb6df9751274aa7b1172d1da29ff793/d9199/screenshot-carbon.png&quot;
          alt=&quot;gatsby carbon&quot;
          title=&quot;gatsby carbon&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;적용 전 설치를 위해 루트 디렉토리에서 아래 명령어를 실행합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;$ npm install --save gatsby-transformer-remark gatsby-remark-highlight-code @deckdeckgo/highlight-code&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;이후 아래 설정 파일에 플러그인 설정을 추가합니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;gatsby-config.js&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;plugins: [
  {
    resolve: `gatsby-transformer-remark`,
    options: {
      plugins: [
        {
          resolve: `gatsby-remark-highlight-code`
        },
      ],
    },
  },
]&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;추가로 load를 위해 코드 내에 아래 내용을 추가합니다.&lt;/p&gt;
&lt;p&gt;저는 사용하는 테마에 맞춰 아래 파일에 추가했습니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;src/components/Layout/Layout.js&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;// @flow strict
import React from &amp;#39;react&amp;#39;;
import { defineCustomElements as deckDeckGoHighlightElement } from &amp;#39;@deckdeckgo/highlight-code/dist/loader&amp;#39;;

const Layout = ({}: Props) =&amp;gt; {

  deckDeckGoHighlightElement();
  return ();
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;google-analytics&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#google-analytics&quot; aria-label=&quot;google analytics permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Google Analytics&lt;/h2&gt;
&lt;p&gt;lumen starter의 경우 아래 설정 변경으로 간단하게 Google Analytics의 적용이 가능합니다.&lt;/p&gt;
&lt;p&gt;아래 googleAnalyticsId에 추적 ID 값을 입력하면 등록이 끝납니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;config.js&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;module.exports = {
  url: &amp;#39;https://kyucumber.github.io&amp;#39;,
  // ...
  googleAnalyticsId: &amp;#39;@Google Analytics Id&amp;#39;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;disqus-댓글-추가하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#disqus-%EB%8C%93%EA%B8%80-%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0&quot; aria-label=&quot;disqus 댓글 추가하기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Disqus 댓글 추가하기&lt;/h2&gt;
&lt;p&gt;disqus 홈페이지에서 shortname을 복사해 config.js에 입력하면 댓글 기능을 이용할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f13e8b37c369a6aaa5a0c61f56c46389/6274f/disqus.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 41.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABnElEQVQoz12Qy04UQRSG+1V8BBWDuDGAgVZfQBMHE6MLdizAuFLXbty4xIiEi4+kIoG4YEZlerqqb3Xpms9TBaPGk3z9n1N16q+uk61tvmH95TuevHjLtXzAlRs5V1cesTrYStx9/Jx87ULvP3vNvaevyAebLD/cYPHBBkv/kc2977i+3TG33TK/47i1G1jY9Sx89FJ7bu858k+OO/uWpX3H8oFn5cCQHxpWDx2Le5abO5b5D4Jo9nlYc/Sj4WRsOf7VJb6cqT98HWqOhorvhWFUTxlWvRASo0s903/JCt0w0S2Enr7vscagywI1KSgnYypVUukS2zUEb+md+YfLOgR8IEU2Vg26MThZsc7TdJapbESCfJzv8X1I6mQ/1bJuRa11mIisR+L5bKIq2bDJXc7RGsmn01RHg6JUNE2LUgqlNVq0OD1G/xxhpLfrOtq2TcQ8K8QwmlZVia+/iaETvwtDIxdFw1Ya4+GIlfz89IROxhJj1juLrNQ1uqqp6hrvmvSHs6ZO8lJX6WlB3h9kVlFjxJH5Ps49pNnP+A1aCDRgXn4S3AAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/f13e8b37c369a6aaa5a0c61f56c46389/8ac56/disqus.webp 240w,
/static/f13e8b37c369a6aaa5a0c61f56c46389/d3be9/disqus.webp 480w,
/static/f13e8b37c369a6aaa5a0c61f56c46389/e46b2/disqus.webp 960w,
/static/f13e8b37c369a6aaa5a0c61f56c46389/f992d/disqus.webp 1440w,
/static/f13e8b37c369a6aaa5a0c61f56c46389/882b9/disqus.webp 1920w,
/static/f13e8b37c369a6aaa5a0c61f56c46389/e5490/disqus.webp 2098w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/f13e8b37c369a6aaa5a0c61f56c46389/8ff5a/disqus.png 240w,
/static/f13e8b37c369a6aaa5a0c61f56c46389/e85cb/disqus.png 480w,
/static/f13e8b37c369a6aaa5a0c61f56c46389/d9199/disqus.png 960w,
/static/f13e8b37c369a6aaa5a0c61f56c46389/07a9c/disqus.png 1440w,
/static/f13e8b37c369a6aaa5a0c61f56c46389/29114/disqus.png 1920w,
/static/f13e8b37c369a6aaa5a0c61f56c46389/6274f/disqus.png 2098w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/f13e8b37c369a6aaa5a0c61f56c46389/d9199/disqus.png&quot;
          alt=&quot;gatsby carbon&quot;
          title=&quot;gatsby carbon&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;config.js&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;module.exports = {
  url: &amp;#39;https://kyucumber.github.io&amp;#39;,
  // ...
  disqusShortname: &amp;#39;your-short-name&amp;#39;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;github-pages를-이용해-배포하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#github-pages%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%B4-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0&quot; aria-label=&quot;github pages를 이용해 배포하기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Github Pages를 이용해 배포하기&lt;/h2&gt;
&lt;p&gt;저는 원본 소스 코드를 저장하는 private repository와 static 정적 파일이 배포될 public repository를 별도로 구성했습니다.&lt;/p&gt;
&lt;p&gt;우선 deploy를 도와주는 gh-pages를 설치합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;$ npm install gh-pages --save-dev&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;배포를 위해 package.json을 수정합니다.&lt;/p&gt;
&lt;p&gt;저는 실제 소스 코드 repository와 정적 파일 repo가 분리되어 있어 static remote로 push하도록 설정을 변경했습니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git remote -v

origin  https://github.com/kyucumber/gatsby-blog.git (fetch)
origin  https://github.com/kyucumber/gatsby-blog.git (push)

# 정적 파일이 저장될 Github pages repo
static  https://github.com/kyucumber/kyucumber.github.io.git (fetch)
static  https://github.com/kyucumber/kyucumber.github.io.git (push)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;package.json&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;json&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;{
  &amp;quot;scripts&amp;quot;: {
    &amp;quot;deploy&amp;quot;: &amp;quot;yarn run clean &amp;amp;&amp;amp; gatsby build --prefix-paths &amp;amp;&amp;amp; gh-pages -d public --remote static&amp;quot;
  }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;그리고 아래 명령어를 통해 배포를 진행합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;$ npm run deploy&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위 설정으로 배포시 gh-pages 브랜치로 배포가 되기 때문에 아래 설정에서 branch를 변경해야 합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1742e31cf1aa4a7c5301ae2ee60449e5/49ee2/github-page.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.083333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABF0lEQVQoz52R3U7EIBCF9/1fzKzRxGxiYr3Qbtvtri0FhtL9sTDHKehq9E7Il8MMk5PAWTEzvPeYpgnj6HG+XPCfxZ97tRi2+zc0TYuyrLDfH8CREUPM/DinfoyZ633ui1ciGdKZoY4Md7rAOgtNNql1BoYMBqOSGun3eoASlpnBGvSDkjlC4CiEbPgaWzxMBe70I27VJiu9YO22WFOJG1vi3m9RxC2eYtaCKzwLRazyGbXUNVbL+9W7QXvu0EeDLuhMJMFd6dlB4wsSLBT/JRlabdHUOzjr4J0E5CQgGuEFZyipd2O6XyAfBIkgXBP5/sOlnueATg04dD2qZgdLhF7qetdCG4vpeAKNo8zNmMNCFCQgZvzeHxTmG5V+f6vAAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/1742e31cf1aa4a7c5301ae2ee60449e5/8ac56/github-page.webp 240w,
/static/1742e31cf1aa4a7c5301ae2ee60449e5/d3be9/github-page.webp 480w,
/static/1742e31cf1aa4a7c5301ae2ee60449e5/e46b2/github-page.webp 960w,
/static/1742e31cf1aa4a7c5301ae2ee60449e5/f992d/github-page.webp 1440w,
/static/1742e31cf1aa4a7c5301ae2ee60449e5/a31b9/github-page.webp 1618w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/1742e31cf1aa4a7c5301ae2ee60449e5/8ff5a/github-page.png 240w,
/static/1742e31cf1aa4a7c5301ae2ee60449e5/e85cb/github-page.png 480w,
/static/1742e31cf1aa4a7c5301ae2ee60449e5/d9199/github-page.png 960w,
/static/1742e31cf1aa4a7c5301ae2ee60449e5/07a9c/github-page.png 1440w,
/static/1742e31cf1aa4a7c5301ae2ee60449e5/49ee2/github-page.png 1618w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/1742e31cf1aa4a7c5301ae2ee60449e5/d9199/github-page.png&quot;
          alt=&quot;gatsby carbon&quot;
          title=&quot;gatsby carbon&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.gatsbyjs.com/starters/alxshelepenok/gatsby-starter-lumen&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://www.gatsbyjs.com/starters/alxshelepenok/gatsby-starter-lumen&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[systemd에서 환경변수 사용하기]]></title><description><![CDATA[systemd에서 환경 변수를 사용하는 방법을 정리합니다.]]></description><link>https://kyucumber.github.io/posts/etc/systemd-environment-variable/</link><guid isPermaLink="false">https://kyucumber.github.io/posts/etc/systemd-environment-variable/</guid><pubDate>Tue, 15 Sep 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;systemd에서 관리하고 있는 docker-compose 파일 내부의 환경변수를 가져오는 부분이 제대로 동작하지 않았습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;docker-compose.yml&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;version: &amp;#39;3&amp;#39;

services:
  server:
    container_name: server
    image: ${APP_IMAGE_TAG}
    environment:
      SPRING_PROFILES_ACTIVE: ${PROFILE}
      HEAP_OPTS: ${HEAP_OPTS}
      PINPOINT_ENABLED: &amp;quot;true&amp;quot;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;systemd&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;sql&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;[Unit]
Description=Baeminservice service
After=network-online.target

[Service]
Type=simple
User=ec2-user
Group=ec2-user
WorkingDirectory=/kyucumber/service
ExecStart=/bin/docker-compose up
ExecStop=/bin/docker-compose down
LimitNOFILE=65535
LimitNPROC=12000
TimeoutStopSec=90
SuccessExitStatus=130 143
Restart=always

[Install]
WantedBy=multi-user.target&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;systemd에서 환경변수를 사용하기 위해서는 별도의 Environment 혹은 EnvironmentFile을 등록해야 합니다.&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&quot;systemd에서-사용할-environmentfile-생성하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#systemd%EC%97%90%EC%84%9C-%EC%82%AC%EC%9A%A9%ED%95%A0-environmentfile-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0&quot; aria-label=&quot;systemd에서 사용할 environmentfile 생성하기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;systemd에서 사용할 EnvironmentFile 생성하기&lt;/h2&gt;
&lt;p&gt;systemd에서 사용할 EnvironmentFile의 포맷은 아래와 같습니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;EnvironmentFile&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;sql&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;APP_IMAGE_TAG=test
PROFILE=develop
HEAP_OPTS=&amp;#39;-Xmx1G -Xms1G&amp;#39;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;systemd&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code   terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;[Unit]
Description=Baeminservice service
After=network-online.target

[Service]
Type=simple
User=ec2-user
Group=ec2-user

// ...

// 이 부분을 추가해주어야 합니다.
EnvironmentFile=/kyucumber/EnvironmentFile&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위와 같이 EnvironmentFile을 등록하면 systemd에서 &lt;code class=&quot;language-text&quot;&gt;APP_IMAGE_TAG&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;PROFILE&lt;/code&gt; 등의 환경 변수를 사용할 수 있습니다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[globally_quoted_identifiers 옵션과 SchemaManagementException]]></title><description><![CDATA[globally_quoted_identifiers 옵션 적용 후 SchemaManagementException가 발생하는 경우]]></description><link>https://kyucumber.github.io/posts/issues/globally-quoted-identifiers-option-error</link><guid isPermaLink="false">https://kyucumber.github.io/posts/issues/globally-quoted-identifiers-option-error</guid><pubDate>Tue, 01 Sep 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;globally_quoted_identifiers&lt;/code&gt;옵션을 true로 지정하면 컬럼이나 테이블의 이름이 예약어와 충돌하는 것을 방지할 수 있습니다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;해당 옵션을 추가하면 컬럼, 테이블 이름을 Back Quote(`)로 감싸주게 됩니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;충돌 방지를 위해 해당 옵션을 추가했는데 이후 아래와 같은 예외가 발생하는 경우가 있습니다.&lt;/p&gt;
&lt;deckgo-highlight-code   terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;Caused by: org.hibernate.tool.schema.spi.SchemaManagementException: Schema-validation: wrong column type encountered in column&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;이는 &lt;code class=&quot;language-text&quot;&gt;globally_quoted_identifiers&lt;/code&gt; 옵션 사용 시 columnDefinition에 있는 단어들도 함께 escape 되면서 발생하는 에러입니다.&lt;/p&gt;
&lt;p&gt;위와 같은 에러를 방지하기 위해 아래와 같은 옵션을 추가로 더 설정해주어야 합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;yaml&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;hibernate:
  globally_quoted_identifiers: true
  globally_quoted_identifiers_skip_column_definitions: true&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://kwonnam.pe.kr/wiki/java/hibernate/configuration&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://kwonnam.pe.kr/wiki/java/hibernate/configuration&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Spring Boot Dependency Management Plugin]]></title><description><![CDATA[Spring Boot Dependency Management Plugin의 특정 버전 customizing 등의 내용을 다룹니다.]]></description><link>https://kyucumber.github.io/posts/spring/spring-boot-dependency-management-plugin/</link><guid isPermaLink="false">https://kyucumber.github.io/posts/spring/spring-boot-dependency-management-plugin/</guid><pubDate>Wed, 03 Jun 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Spring에서 제공해주는 여러 starter들을 사용하면 별도 의존성 버전을 명시해주지 않아도
여러 라이브러리들이 각각의 버전으로 추가되는 것을 확인할 수 있습니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;dependencies {
    testImplementation(&amp;quot;org.springframework.boot:spring-boot-starter-test&amp;quot;)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;./gradlew dependencies

+--- org.springframework.boot:spring-boot-starter-test -&amp;gt; 2.3.12.RELEASE
|    +--- org.springframework.boot:spring-boot-starter:2.3.12.RELEASE (*)
|    +--- org.springframework.boot:spring-boot-test:2.3.12.RELEASE
|    |    \--- org.springframework.boot:spring-boot:2.3.12.RELEASE (*)
|    +--- org.springframework.boot:spring-boot-test-autoconfigure:2.3.12.RELEASE
|    |    +--- org.springframework.boot:spring-boot:2.3.12.RELEASE (*)
|    |    +--- org.springframework.boot:spring-boot-test:2.3.12.RELEASE (*)
|    |    \--- org.springframework.boot:spring-boot-autoconfigure:2.3.12.RELEASE (*)
|    +--- com.jayway.jsonpath:json-path:2.4.0
|    |    +--- net.minidev:json-smart:2.3 -&amp;gt; 2.3.1
|    |    |    \--- net.minidev:accessors-smart:2.3.1
|    |    |         \--- org.ow2.asm:asm:5.0.4
|    |    \--- org.slf4j:slf4j-api:1.7.25 -&amp;gt; 1.7.30
|    +--- jakarta.xml.bind:jakarta.xml.bind-api:2.3.3 (*)
|    +--- org.assertj:assertj-core:3.16.1
|    +--- org.hamcrest:hamcrest:2.2
|    +--- org.junit.jupiter:junit-jupiter:5.6.3&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;별도 버전 없이도 위와 같은 의존성들을 사용할 수 있는 것은 &lt;code class=&quot;language-text&quot;&gt;io.spring.dependency-management&lt;/code&gt; 플러그인이 의존성들의 버전을 관리해주기 때문입니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;apply(plugin = &amp;quot;io.spring.dependency-management&amp;quot;)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-dependencies&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Spring Boot Dependencies&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;customizing-managed-versions&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#customizing-managed-versions&quot; aria-label=&quot;customizing managed versions permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Customizing Managed Versions&lt;/h2&gt;
&lt;p&gt;특정 버전의 버그나 이슈로 인해 플러그인이 관리하는 버전을 변경하려면 아래와 같은 두가지 방법을 사용할 수 있습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;version property override&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;ext[&amp;quot;logback.version&amp;quot;] = &amp;quot;1.2.9&amp;quot;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;dependency management의 bomProperty&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;dependencyManagement {
    imports {
        mavenBom(&amp;#39;io.spring.platform:platform-bom:1.0.1.RELEASE&amp;#39;) {
            bomProperty &amp;#39;spring.version&amp;#39;, &amp;#39;4.0.4.RELEASE&amp;#39;
        }
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;blockquote&gt;
&lt;p&gt;Spring Boot는 여러 의존성들에 대해 설계 및 테스트 되었으므로, 버전을 임의로 변경하는 경우 호환성 관련 이슈가 발생할 수 있습니다.
가급적 변경하지 않는 것이 좋습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;dependency-sets&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#dependency-sets&quot; aria-label=&quot;dependency sets permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Dependency Sets&lt;/h2&gt;
&lt;p&gt;그룹이나 버전이 동일한 경우 dependencySet을 활용해 아래처럼 사용할 수 있습니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;dependencyManagement {
    dependencies {
        dependencySet(&amp;quot;org.slf4j:1.7.7&amp;quot;) {
            entry(&amp;quot;slf4j-api&amp;quot;)
            entry(&amp;quot;slf4j-simple&amp;quot;)
        }
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;importing-a-maven-bom&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#importing-a-maven-bom&quot; aria-label=&quot;importing a maven bom permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Importing a Maven Bom&lt;/h2&gt;
&lt;p&gt;프로젝트 내에서 직접 의존성의 버전을 명시하지 않고 maven bom을 가져와서 의존성 관리를 할 수 있습니다.&lt;/p&gt;
&lt;p&gt;여러 이상의 bom을 가져오는 경우에 bom은 순서대로 처리되며,
동일한 dependency에 대한 bom이 있는 경우 나중에 추가된 bom의 의존성 버전이 사용됩니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;dependencyManagement {
    imports {
        mavenBom(&amp;quot;io.spring.platform:platform-bom:1.0.1.RELEASE&amp;quot;)
    }
}

dependencies {
    implementation(&amp;quot;org.springframework.integration:spring-integration-core&amp;quot;)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;spring-managed-dependency-versions&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#spring-managed-dependency-versions&quot; aria-label=&quot;spring managed dependency versions permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Spring Managed Dependency Versions&lt;/h2&gt;
&lt;p&gt;스프링에서 관리되는 의존성 버전 및 버전 프로퍼티 정보는 아래 링크에서 확인할 수 있습니다.&lt;/p&gt;
&lt;p&gt;스프링 버전별로 관리되는 버전이 다르기 때문에 버전 별 아래 링크의 주소를 변경해주셔야 합니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.spring.io/spring-boot/docs/2.6.1/reference/htmlsingle/#dependency-versions.coordinates&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Managed Dependency Coordinates&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.spring.io/spring-boot/docs/2.6.1/reference/htmlsingle/#dependency-versions.properties&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Version Properties&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.spring.io/spring-boot/docs/current/gradle-plugin/reference/htmlsingle/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Spring Boot Gradle Plugin Reference Guide&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;개인적인 기록을 위해 작성된 글이라 잘못된 내용이 있을 수 있습니다.&lt;/p&gt;
&lt;p&gt;오류가 있다면 댓글을 남겨주세요.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Failed to validate connection 이슈]]></title><description><![CDATA[Failed to validate connection (No operations allowed after connection closed.) WARN 로그]]></description><link>https://kyucumber.github.io/posts/issues/failed-to-validate-connection</link><guid isPermaLink="false">https://kyucumber.github.io/posts/issues/failed-to-validate-connection</guid><pubDate>Tue, 03 Mar 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;아래와 같은 WARN 로그가 지속적으로 발생하는 문제를 겪었습니다.&lt;/p&gt;
&lt;deckgo-highlight-code   terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;Failed to validate connection (No operations allowed after connection closed.)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;서비스에는 큰 영향이 없어보이나, 간헐적으로 발생하는 WARN 로그가 신경쓰여서 어떤 이유로 발생하는 것인지 찾아보았습니다.&lt;/p&gt;
&lt;p&gt;해당 WARN 로그는 &lt;strong&gt;HikariCP의 maxLifeTime&lt;/strong&gt;보다 데이터베이스의 &lt;strong&gt;wait_timeout&lt;/strong&gt;이 더 짧은 경우 발생하는 문제였습니다.&lt;/p&gt;
&lt;h3 id=&quot;wait_timeout&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#wait_timeout&quot; aria-label=&quot;wait_timeout permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;wait_timeout&lt;/h3&gt;
&lt;p&gt;아래 명령어로 데이터베이스의 wait_timeout 값을 확인할 수 있습니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;sql&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;show global variables like &amp;#39;wait_timeout&amp;#39;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;데이터베이스는 설정된 wait_timeout 시간이 지나면 커넥션을 끊습니다.&lt;/p&gt;
&lt;h3 id=&quot;hikaricp-maxlifetime&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#hikaricp-maxlifetime&quot; aria-label=&quot;hikaricp maxlifetime permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;HikariCP maxLifeTime&lt;/h3&gt;
&lt;p&gt;HikariCP는 커넥션을 관리하며, 설정된 max-lifetime이 지나기 전에 커넥션을 끊습니다.&lt;/p&gt;
&lt;p&gt;wait_timeout 값보다 max-lifetime이 긴 경우 끊긴 커넥션으로 작업을 시도하며, 그 과정에서 아래와 같은 에러가 발생합니다.&lt;/p&gt;
&lt;deckgo-highlight-code   terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;Failed to validate connection (No operations allowed after connection closed.)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;따라서 아래와 같이 max-lifetime 값을 설정된 wait_timeout보다 항상
짧게 주어야 &lt;code class=&quot;language-text&quot;&gt;Failed to validate connection&lt;/code&gt; WARN 로그가 발생하지 않습니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;yml&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;hikari:
      max-lifetime: 56000&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://jaehun2841.github.io/2020/01/08/2020-01-08-hikari-pool-validate-connection/#hikari-pool%EC%9D%98-maxlifetime&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;HikariCP Failed to Validate Connection Warning 이야기
&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Elasticsearch Node, Index, Shard, Segment]]></title><description><![CDATA[Elasticsearch의 Node, Index, Shard, Segment]]></description><link>https://kyucumber.github.io/posts/elasticsearch/elasticsearch-node-index-shard-segment</link><guid isPermaLink="false">https://kyucumber.github.io/posts/elasticsearch/elasticsearch-node-index-shard-segment</guid><pubDate>Sat, 12 Oct 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;팀 내 여러 파트에서 Elasticsearch를 활용하고 있습니다. 어플리케이션 레벨에서 데이터 조회 위한 코드를 작성하는 부분이야 계속 하다보면 늘겠지만 Elasticsearch 인프라에 관련된 부분에 대해서는 부족한 것 같아서 관련 내용을 정리하고 있습니다.&lt;/p&gt;
&lt;h2 id=&quot;nodes&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#nodes&quot; aria-label=&quot;nodes permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Nodes&lt;/h2&gt;
&lt;p&gt;Elasticsearch의 경우 여러 노드들을 모아 클러스터를 구성할 수 있습니다. 공식 문서에서는 클러스터가 커지고 변환이나 머신 러닝 등의 작업이 지속적으로 일어나는 경우 각각의 목적에 맞는 노드를 분리하는게 좋다고 설명하고 있습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html#master-node&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Master-eligible node&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html#data-node&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Data node&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html#node-ingest-node&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Ingest node&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html#remote-node&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Remote-eligible node&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html#ml-node&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Machine learning node&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html#transform-node&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Transform node&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;모든 노드 타입을 살펴볼 필요는 없을 것 같아 주요한 몇가지 노드에 대한 내용만 살펴보겠습니다.&lt;/p&gt;
&lt;h3 id=&quot;master-eligible-node&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#master-eligible-node&quot; aria-label=&quot;master eligible node permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;strong&gt;Master-eligible node&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;해당 노드로 지정되면 클러스터를 제어하는 마스터 노드로 선출 될 수 있습니다. 마스터 노드는 인덱스의 생성, 삭제 등 클러스터를 제어하는 역할을 수행합니다.
다수의 노드를 Master-eligible로 설정할 수 있지만 하나의 노드만 active master 역할을 수행합니다.&lt;/p&gt;
&lt;p&gt;Dedicated, Voting Only 등 추가적인 설정도 있는 것 같지만 해당 내용은 생략합니다.&lt;/p&gt;
&lt;deckgo-highlight-code   terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;node.roles: [master]&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 id=&quot;data-node&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#data-node&quot; aria-label=&quot;data node permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Data node&lt;/h3&gt;
&lt;p&gt;데이터 노드에는 인덱싱된 도큐먼트가 포함된 샤드들이 위치합니다. 검색이나 집계 등 데이터 관련 작업을 처리합니다. I/O나 메모리 CPU를 많이 소모하는 작업들이 주로 실행되므로 리소스 모니터링 및 임계치 도달 시 데이터 노드를 추가해야 합니다.&lt;/p&gt;
&lt;p&gt;전용 데이터 노드를 갖는 경우 마스터와 데이터 노드의 역할을 분리할 수 있습니다.&lt;/p&gt;
&lt;deckgo-highlight-code   terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;node.roles: [data]&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 id=&quot;coordinating-node&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#coordinating-node&quot; aria-label=&quot;coordinating node permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Coordinating node&lt;/h3&gt;
&lt;p&gt;사용자 요청에 대해 로드밸런서 역할만을 수행하는 노드, 내부적으로 어떤 방식을 통해 부하를 분산시켜주는지는 별도로 찾아봐야 하겠지만 클러스터 전체의 부하가 큰 경우라면 별도로 Coordinating 노드를 가지는 편이 좋을 것 같습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Coordinating node가 너무 클러스터에 많이 추가되면 전체 클러스터에 대한 부담이 증가할 수 있습니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code   terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;node.roles: []&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 id=&quot;ingest-node&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#ingest-node&quot; aria-label=&quot;ingest node permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Ingest node&lt;/h3&gt;
&lt;p&gt;데이터 색인을 위한 전처리를 담당하는 노드입니다. 현재 별도로 Ingest 노드를 분리할 필요는 없어보이는데, 이후 사용이 필요한 시점에 어떤 방법으로 전처리를 수행하는지 파악해보면 좋을 것 같습니다.&lt;/p&gt;
&lt;deckgo-highlight-code   terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;node.roles: [ingest]&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;index&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#index&quot; aria-label=&quot;index permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Index&lt;/h2&gt;
&lt;p&gt;Elasticsearch에서 저장된 한 Row를 Document라고 하며 이 Document들의 집합을 Index라고 합니다.&lt;/p&gt;
&lt;p&gt;인덱스는 클러스터 내의 여러 데이터 노드에 Shard라는 이름으로 분산되어 저장됩니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/current/index-templates.html&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Index Template&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Index Template을 정의해 Elasticsearch에서 인덱스를 구성하는 방법을 미리 정의할 수 있습니다. 관련 자세한 내용은 위 링크를 참고합니다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Index Template이 설정되어 있지 않으면 자동으로 필드 생성 및 타입을 결정해 예기치 않은 문제를 야기할 수 있습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;deckgo-highlight-code language=&quot;json&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;PUT _index_template/template_1
{
  &amp;quot;index_patterns&amp;quot;: [&amp;quot;te*&amp;quot;, &amp;quot;bar*&amp;quot;],
  &amp;quot;template&amp;quot;: {
    &amp;quot;settings&amp;quot;: {
      &amp;quot;number_of_shards&amp;quot;: 3,
      &amp;quot;number_of_replicas&amp;quot;: 1
    },
    &amp;quot;mappings&amp;quot;: {
      &amp;quot;_source&amp;quot;: {
        &amp;quot;enabled&amp;quot;: true
      },
      &amp;quot;properties&amp;quot;: {
        &amp;quot;host_name&amp;quot;: {
          &amp;quot;type&amp;quot;: &amp;quot;keyword&amp;quot;
        },
        &amp;quot;created_at&amp;quot;: {
          &amp;quot;type&amp;quot;: &amp;quot;date&amp;quot;,
          &amp;quot;format&amp;quot;: &amp;quot;EEE MMM dd HH:mm:ss Z yyyy&amp;quot;
        }
      }
    },
    &amp;quot;aliases&amp;quot;: {
      &amp;quot;mydata&amp;quot;: { }
    }
  },
  &amp;quot;priority&amp;quot;: 500,
  &amp;quot;composed_of&amp;quot;: [&amp;quot;component_template1&amp;quot;, &amp;quot;runtime_component_template&amp;quot;], 
  &amp;quot;version&amp;quot;: 3,
  &amp;quot;_meta&amp;quot;: {
    &amp;quot;description&amp;quot;: &amp;quot;my custom&amp;quot;
  }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;shard&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#shard&quot; aria-label=&quot;shard permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Shard&lt;/h2&gt;
&lt;p&gt;인덱스 내부에 색인된 데이터들은 여러 노드에 여러 파티션으로 나누어서 저장되는데 이 나누어진 각각의 파티션들을 Elasticsearch에서는 Shard라고 부릅니다.&lt;/p&gt;
&lt;p&gt;7.0 버전 이후 기준으로 인덱스 생성 시 디폴트로 1개의 샤드가 구성되며 만약 샤드 개수를 지정하고 싶으면 Index Template을 생성해야 합니다.&lt;/p&gt;
&lt;p&gt;클러스터 내 2개의 데이터 노드를 가진 상태에서 6개의 프라이머리 샤드, 1개의 레플리카 샤드를 지정한 인덱스를 생성하면 아래와 같은 형태로 배치되게 됩니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2 Data Node, 6 Primary Shard, 1 Replica Shard&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c9ebd461ceaccd147a4e601970a87df6/b94e3/elasticsearch-shard.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 70%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAAB+klEQVQ4y3VT2W7bMBDUJxVNrfumLuq2leShKJCiQJD/CND+9nRnbQtuEz8MZiktl7PLofP++w9+vPxEbXuMyxFxVsCOM6b1hCjN0fQDTNMhynJ0w6SxG0bwwvhTOKfXFzTfN+SPE8rnBcmxR/E0wzyvGufbJDwgXqx+55rxPTjfghBuJNXjROEn6R4ToSjLqhqpqf7JuQfHjyQpiOAKbtkLYhz8EFlRYd2e0PYjXP/83dtzbnFpmTNLC4NEcOU9zkudIw8Nk0zXV3Df/9CCRdWgsYMqqLte4zOPegH8f+Xc1MjKSrms2w/gwaqQKlyRTA7iVPmqLBY1gairWqtOGOZVXcA893KzzNNcqeX8en1TBQ+uj+W04evBU/vMxxO+PBz0ZG62/aQYxgXjtKKqO5iqVStxPJy3Kjy3PKKfFm2bYEwVjHUD2xzFQscR2SS8DCgkzgerxaiMMyacUVroZGMlKtkW1XKOVGaaFlYK6gZbI14tollMLn6LJA5ao65QZ0jrZKebN/FYqypYkO2ZxiIULqQldqC3HGfwZc5+KPPi3MJLHKX7DLVlI0UW8Rm9tpwelc8z3HZQYVAU8E0Jv5S4EjayzrOPT49FaAXeKu3AU7KyVgWcD/8xkTft8UXxIez45C3HxblYJCpoWLacyDfy1bCMidvW7uEvVtzusMHUBLoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/c9ebd461ceaccd147a4e601970a87df6/8ac56/elasticsearch-shard.webp 240w,
/static/c9ebd461ceaccd147a4e601970a87df6/d3be9/elasticsearch-shard.webp 480w,
/static/c9ebd461ceaccd147a4e601970a87df6/e46b2/elasticsearch-shard.webp 960w,
/static/c9ebd461ceaccd147a4e601970a87df6/65db1/elasticsearch-shard.webp 1126w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/c9ebd461ceaccd147a4e601970a87df6/8ff5a/elasticsearch-shard.png 240w,
/static/c9ebd461ceaccd147a4e601970a87df6/e85cb/elasticsearch-shard.png 480w,
/static/c9ebd461ceaccd147a4e601970a87df6/d9199/elasticsearch-shard.png 960w,
/static/c9ebd461ceaccd147a4e601970a87df6/b94e3/elasticsearch-shard.png 1126w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/c9ebd461ceaccd147a4e601970a87df6/d9199/elasticsearch-shard.png&quot;
          alt=&quot;es shard&quot;
          title=&quot;es shard&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;segment&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#segment&quot; aria-label=&quot;segment permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Segment&lt;/h2&gt;
&lt;p&gt;인덱스 내부의 문서들은 여러 샤드에 나뉘어 저장되며, 각각의 샤드들은 한개 이상의 세그먼트로 구성되어 있습니다.
세그먼트 내부에는 실제 문서 데이터가 저장됩니다.&lt;/p&gt;
&lt;p&gt;세그먼트는 &lt;strong&gt;불변의 특성&lt;/strong&gt;을 가집니다. 따라서 문서를 삭제하거나 동일한 아이디로
다시 인덱싱을 하는 경우 세그먼트를 업데이트 하는게 아니라 기존 세그먼트를 비활성 상태로 두고 새로운 세그먼트를 생성합니다.&lt;/p&gt;
&lt;p&gt;세그먼트가 쌓이면 디스크, 검색 속도와 관련된 문제가 생길 수 있습니다.
이러한 문제를 해결하기 위해 엘라스틱서치는 내부의 Scheduler를 통해 &lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/current/index-modules-merge.html&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;세그먼트 병합&lt;/a&gt;을 수행합니다.
상황에 따라 스케줄링을 기다리지 않고 &lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-forcemerge.html&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Force merge&lt;/a&gt;를 수행할 수 있습니다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;세그먼트를 병합하면 디스크가 확보되며, 검색 요청 시 접근해야하는 파일의 수가 줄어들어 검색 요청에 대한 부하가 적어지게 됩니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html#dedicated-master-node&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html#dedicated-master-node&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/current/index-templates.html&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://www.elastic.co/guide/en/elasticsearch/reference/current/index-templates.html&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[ssh error unable to negotiate with IP no matching cipher found]]></title><description><![CDATA[Unbuntu EC2 ssh 접근 이슈 - ssh error: unable to negotiate with IP: no matching cipher found]]></description><link>https://kyucumber.github.io/posts/issues/unbuntu-ec2-ssh-issue/</link><guid isPermaLink="false">https://kyucumber.github.io/posts/issues/unbuntu-ec2-ssh-issue/</guid><pubDate>Mon, 01 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;아래와 같은 에러 메세지와 함께 ssh 접근이 되지 않는 이슈가 발생했습니다. 자주 사용하던 인스턴스가 아니라 접속 시 암호화 방식이 맞지 않아 발생한 것으로 보입니다.
별 문제는 아니지만 찾아보기 쉽게 별도로 문서로 정리합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;ssh error: unable to negotiate with IP: no matching cipher found&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;아래처럼 -c 옵션으로 cipher_spec을 강제로 지정해주면 접속이 가능합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;$ ssh -c aes128-ctr -i kyunam-test.pem ubuntu@0.0.0.0&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;</content:encoded></item><item><title><![CDATA[NAT Gateway - ErrorPortAllocation]]></title><description><![CDATA[NAT Gateway의 ErrorPortAllocation metric이 급증하는 케이스 파악]]></description><link>https://kyucumber.github.io/posts/issues/nat-gateway-error-port-allocation/</link><guid isPermaLink="false">https://kyucumber.github.io/posts/issues/nat-gateway-error-port-allocation/</guid><pubDate>Sat, 01 Jun 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;개발 환경의 AWS 계정 내에서 ngrinder를 통해 성능 테스트 진행 중 NAT Gateway의 Cloudwatch metric의 ErrorPortAllocation가 급증하는 이슈가 발생했습니다.
과도한 요청으로 부하가 발생한 상황은 맞았지만, 설계상의 문제도 일부 파악되어 관련 내용을 정리합니다.&lt;/p&gt;
&lt;h2 id=&quot;원인&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%9B%90%EC%9D%B8&quot; aria-label=&quot;원인 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;원인&lt;/h2&gt;
&lt;p&gt;Private Subnet 내에 존재하는 어플리케이션 내부에서 Public Subnet에 존재하는 어플리케이션으로 요청을 보내는 부분에서 문제가 발생했습니다.&lt;/p&gt;
&lt;p&gt;Private 망 내부에서의 통신이었다면 NAT Gateway가 영향을 받지 않았겠지만
Private -&gt; Public으로 트래픽이 나가는 과정에서 NAT Gateway에 많은 요청이 몰려 최대 포트 할당 개수를 넘어 ErrorPortAllocation가 다수 발생한 것으로 보입니다.&lt;/p&gt;
&lt;h2 id=&quot;해결&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%95%B4%EA%B2%B0&quot; aria-label=&quot;해결 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;해결&lt;/h2&gt;
&lt;p&gt;위와 같은 문제의 경우 1차적인 원인은 많은 트래픽입니다.&lt;/p&gt;
&lt;p&gt;다만 근본적인 원인은 불필요하게 Public으로 설계되어 있던 어플리케이션이 문제였습니다.
가급적이면 Private 망 내부에서 통신할 수 있도록 여러 서비스간의 설계를 잘 구성해야 할 것 같습니다.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.aws.amazon.com/vpc/latest/userguide/vpc-nat-gateway.html#nat-gateway-limits&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://docs.aws.amazon.com/vpc/latest/userguide/vpc-nat-gateway.html#nat-gateway-limits&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[npm build Couldn't follow symbolic link - mac os case-insensitive filesystem issue]]></title><description><![CDATA[npm build Couldn't follow symbolic link 에러 해결]]></description><link>https://kyucumber.github.io/posts/issues/npm-build-error-mac-os-case-insensitive-filesystem/</link><guid isPermaLink="false">https://kyucumber.github.io/posts/issues/npm-build-error-mac-os-case-insensitive-filesystem/</guid><pubDate>Thu, 02 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;로컬 환경(MacOS)에서 성공하는 npm build가 아래와 같은 에러를 노출하며 CI 서버(Linux)에서 빌드가 실패하는 문제가 발생했습니다.
별거 아닌 문제였지만 1시간 가량 삽질을 진행했는데 아래와 같은 문제를 다시 겪지 않도록 관련 내용을 정리합니다.&lt;/p&gt;
&lt;deckgo-highlight-code   terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;ERROR in ./app/containers/~~.tsx
Module not found: Error: Can&amp;#39;t resolve &amp;#39;constants/~~~&amp;#39; in &lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;원인&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%9B%90%EC%9D%B8&quot; aria-label=&quot;원인 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;원인&lt;/h2&gt;
&lt;p&gt;Mac의 경우 case-insensitive filesystem로 설계되어 있으며 대 소문자를 구분하지 않습니다.&lt;/p&gt;
&lt;p&gt;리팩토링 과정에서 대 소문자를 변경했는데 일부 변경되지 않은 부분이 남아있었고 이 때문에 CI 서버(Linux)에서 빌드할 때 오류가 발생했습니다.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/13617863/can-i-force-node-js-require-to-be-case-sensitive&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://stackoverflow.com/questions/13617863/can-i-force-node-js-require-to-be-case-sensitive&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;해결&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%95%B4%EA%B2%B0&quot; aria-label=&quot;해결 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;해결&lt;/h2&gt;
&lt;p&gt;위와 같은 경우라면 import 구문 등에서 대 소문자가 제대로 입력되지 않은 부분을 찾아서 수정해야 합니다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Webpack Uncaught SyntaxError Unexpected token <]]></title><description><![CDATA[Uncaught SyntaxError: Unexpected token < 에러 해결]]></description><link>https://kyucumber.github.io/posts/issues/webpack-uncaught-syntax-error/</link><guid isPermaLink="false">https://kyucumber.github.io/posts/issues/webpack-uncaught-syntax-error/</guid><pubDate>Wed, 01 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;신규 프론트 프로젝트(React + Typescript) 설정 시 &lt;code class=&quot;language-text&quot;&gt;/one-path/two-path&lt;/code&gt;와 같은 2 depth 이상의 경로를 지정할 때
아래와 같은 에러가 노출되며 아무런 페이지도 렌더링 되지 않는 문제가 발생했습니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;Uncaught SyntaxError: Unexpected token &amp;lt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;원인&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%9B%90%EC%9D%B8&quot; aria-label=&quot;원인 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;원인&lt;/h2&gt;
&lt;p&gt;Webpack 사용 시 위와 같은 에러가 노출되는 케이스는 아주 많지만, 이번 경우는 설정에 publicPath가 잡혀있지 않아서 생기는 문제였던 것 같습니다.&lt;/p&gt;
&lt;h2 id=&quot;해결&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%95%B4%EA%B2%B0&quot; aria-label=&quot;해결 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;해결&lt;/h2&gt;
&lt;p&gt;webpack.config.js 파일에 publicPath 설정을 추가했습니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;module.exports = {
    context: sourcePath,
    entry: {
        app: &amp;#39;./main.tsx&amp;#39;
    },
    output: {
        path: outPath,
        filename: isProduction ? &amp;#39;[contenthash].js&amp;#39; : &amp;#39;[hash].js&amp;#39;,
        chunkFilename: isProduction ? &amp;#39;[name].[contenthash].js&amp;#39; : &amp;#39;[name].[hash].js&amp;#39;,
        publicPath: &amp;#39;/&amp;#39;
    }&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;</content:encoded></item><item><title><![CDATA[Hibernate 프록시 객체의 equals가 정상적으로 동작하지 않는 문제]]></title><description><![CDATA[JPA 사용 시 프록시 객체의 equals가 정상적으로 동작하지 않는 문제]]></description><link>https://kyucumber.github.io/posts/spring/hibernate-proxy-equals-issue/</link><guid isPermaLink="false">https://kyucumber.github.io/posts/spring/hibernate-proxy-equals-issue/</guid><pubDate>Fri, 01 Mar 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;JPA 사용 시 fetchType이 LAZY로 지정된 엔티티의 equals 메소드가 의도한대로 동작하지 않는 문제가 발생했습니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;java&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;public boolean equals(Object o) {
    if (o == null || getClass() != o.getClass())
    // ...
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위의 equals 메소드는 IDE의 자동 완성 기능을 통해 구현했는데, getClass가 아니라 아래와 같이 instanceOf를 이용해 비교해야 정상적으로 동작합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;java&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;public boolean equals(Object o) {
    if (!(o instanceof B)) {
    // ...
}        &lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;추가로 해당 프록시 객체의 값을 꺼내는 부분 또한 getter를 사용하도록 변경해야 값을 정상적으로 받아올 수 있습니다.&lt;/p&gt;
&lt;h3 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/11013138/hibernate-equals-and-proxy&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Hibernate equals and proxy&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[AWS Auto Scaling groups -  Instance failed to complete user's Lifecycle Action error]]></title><description><![CDATA[AWS Auto Scaling Group에서 인스턴스 생성이 Pending되는 이슈]]></description><link>https://kyucumber.github.io/posts/issues/aws-auto-scaling-group-pending/</link><guid isPermaLink="false">https://kyucumber.github.io/posts/issues/aws-auto-scaling-group-pending/</guid><pubDate>Mon, 01 Oct 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;운영중인 서비스의 Blue/Green 배포 중 신규 배포를 위한 Replacement의 Auto Scaling Group 내부에서 인스턴스가 제대로 생성되지 않는 문제가 발생했습니다.
인스턴스가 생성되지 않으니 배포를 위한 준비를 할 수 없어 배포 자체를 진행할 수 없는 상황이었습니다.&lt;/p&gt;
&lt;p&gt;AWS Auto Scaling Group에서 인스턴스가 제대로 생성되지 않은 이유와 해결할 수 있는 방법을 정리합니다.&lt;/p&gt;
&lt;h2 id=&quot;원인&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%9B%90%EC%9D%B8&quot; aria-label=&quot;원인 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;원인&lt;/h2&gt;
&lt;p&gt;현재 운영중인 서비스에서 어플리케이션 배포를 위해 AWS의 CodeDeploy 서비스를 사용하고 있습니다.
CodeDeploy 사용 시 신규로 올라온 인스턴스의 프로비저닝을 위해 Auto Scaling Group에 Lifecycle Hook이 자동으로 추가됩니다.
해당 Hook은 Scale out 시 새로 추가된 장비에 LifeCycle Hook을 통해 기존 배포된 버전을 프로비저닝 하는 역할을 수행합니다.&lt;/p&gt;
&lt;p&gt;Blue/Green 배포가 정상적으로 종료되면 Original Auto Scaling Group의 Lifecycle Hook을 제거하는 과정이 수행되는데
네트워크 이슈 등으로 ASG에서 Lifecycle Hook이 정상적으로 제거되지 않아 &lt;code class=&quot;language-text&quot;&gt;Instance failed to complete user&amp;#39;s Lifecycle Action&lt;/code&gt;와 같은 에러 메세지와 함께 Pending이 발생된 것 으로 생각됩니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/1a867/aws-auto-scaling-group-pending-history.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 14.166666666666666%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAApUlEQVQI10WM25KCMBAF+f/vQ0U05GYSrBUCkUTf2shW7T509dSZmdN4MxIq45S4SsfhPNBdDcdecTxL2m7gdNEMOiDtuFtoz6HmbSfqTtGeBNr9cH8kmq28eVa2XEhbZpoXnK+PUqG0rdZIpekvAjFIbi788b3z4b7Pc1xrx4um5MxOybxKYV0XQvBYazDGYM2vvXNM04NliTtxnonxn5TW2lH4AIcU3kZ6Tpp3AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/8ac56/aws-auto-scaling-group-pending-history.webp 240w,
/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/d3be9/aws-auto-scaling-group-pending-history.webp 480w,
/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/e46b2/aws-auto-scaling-group-pending-history.webp 960w,
/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/f992d/aws-auto-scaling-group-pending-history.webp 1440w,
/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/882b9/aws-auto-scaling-group-pending-history.webp 1920w,
/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/3c376/aws-auto-scaling-group-pending-history.webp 1998w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/8ff5a/aws-auto-scaling-group-pending-history.png 240w,
/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/e85cb/aws-auto-scaling-group-pending-history.png 480w,
/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/d9199/aws-auto-scaling-group-pending-history.png 960w,
/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/07a9c/aws-auto-scaling-group-pending-history.png 1440w,
/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/29114/aws-auto-scaling-group-pending-history.png 1920w,
/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/1a867/aws-auto-scaling-group-pending-history.png 1998w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/d9199/aws-auto-scaling-group-pending-history.png&quot;
          alt=&quot;asg pending&quot;
          title=&quot;asg pending&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;해결&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%95%B4%EA%B2%B0&quot; aria-label=&quot;해결 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;해결&lt;/h2&gt;
&lt;p&gt;아래 Auto ScalingGroup의 Lifecycle Hook 탭에서 해당 Lifecycle Hook을 수동으로 제거하면 정상적으로 인스턴스 생성이 이루어집니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/691611b16d87e79feea60a2d2ea88789/7f7f8/auto-scaling-group-lifecycle-hook.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 20.833333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAAApUlEQVQY02WQ2w6DIBBE+f8v9EFD4wW8g5ZUwMZph0ReJDk5m80ySxDLsmAYBvR9j2makrdtg7U2s65r6u37Ds4bY/B5Gzg74nsG8FzXlSw43LZtCmIwL5znieM4Hnjvs0OIOHz4OyDGmGAt5nlGXdegx3FMZigXKKUeNE2DqqrweklordJjyrKElBJFUUA459B1Xb6gtc6+YfjdZ815wh6Xk/tLflCELdNrzJxaAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/691611b16d87e79feea60a2d2ea88789/8ac56/auto-scaling-group-lifecycle-hook.webp 240w,
/static/691611b16d87e79feea60a2d2ea88789/d3be9/auto-scaling-group-lifecycle-hook.webp 480w,
/static/691611b16d87e79feea60a2d2ea88789/e46b2/auto-scaling-group-lifecycle-hook.webp 960w,
/static/691611b16d87e79feea60a2d2ea88789/f992d/auto-scaling-group-lifecycle-hook.webp 1440w,
/static/691611b16d87e79feea60a2d2ea88789/882b9/auto-scaling-group-lifecycle-hook.webp 1920w,
/static/691611b16d87e79feea60a2d2ea88789/e1a3b/auto-scaling-group-lifecycle-hook.webp 2396w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/691611b16d87e79feea60a2d2ea88789/8ff5a/auto-scaling-group-lifecycle-hook.png 240w,
/static/691611b16d87e79feea60a2d2ea88789/e85cb/auto-scaling-group-lifecycle-hook.png 480w,
/static/691611b16d87e79feea60a2d2ea88789/d9199/auto-scaling-group-lifecycle-hook.png 960w,
/static/691611b16d87e79feea60a2d2ea88789/07a9c/auto-scaling-group-lifecycle-hook.png 1440w,
/static/691611b16d87e79feea60a2d2ea88789/29114/auto-scaling-group-lifecycle-hook.png 1920w,
/static/691611b16d87e79feea60a2d2ea88789/7f7f8/auto-scaling-group-lifecycle-hook.png 2396w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/691611b16d87e79feea60a2d2ea88789/d9199/auto-scaling-group-lifecycle-hook.png&quot;
          alt=&quot;auto-scaling-group-lifecycle-hook&quot;
          title=&quot;auto-scaling-group-lifecycle-hook&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;어떤 이유인지는 모르겠으나 CodeDeploy agent가 위의 Lifecycle Hook을 제거해주는 작업을 정상적으로 수행해주지 못한것으로 보입니다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;CodeDeploy가 관리하는 Auto Scaling Group의 경우 Lifecycle Hook을 제거하면 Scale out 진행 시 프로비저닝이 정상적으로 동작하지 않으니 유의해서 제거하셔야 합니다.&lt;/p&gt;
&lt;/blockquote&gt;</content:encoded></item><item><title><![CDATA[Java의 Long 타입과 비교 연산]]></title><description><![CDATA[Java에서 Long 타입의 비교 연산 관련된 이슈 정리]]></description><link>https://kyucumber.github.io/posts/issues/java-long-type-equals</link><guid isPermaLink="false">https://kyucumber.github.io/posts/issues/java-long-type-equals</guid><pubDate>Sat, 01 Sep 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;코드리뷰 중 아래와 같이 Long 타입의 비교 연산을 &lt;code class=&quot;language-text&quot;&gt;==&lt;/code&gt; 를 이용해 수행하는 부분을 발견했습니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Long&lt;/code&gt; 타입의 경우 원시 값이 아니라 &lt;code class=&quot;language-text&quot;&gt;equals&lt;/code&gt;를 사용해야 정상적으로 동작할 것이라고 생각했는데
예상과 다르게 동작하는 부분을 확인해 관련 내용을 정리합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;java&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;Long id = 1L
Long anotherId = 1L

if (id == anotherId) // true?&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;자바에서는 &lt;strong&gt;-128에서 127까지의 범위의 경우 상수 풀을 유지&lt;/strong&gt;합니다. 따라서 &lt;code class=&quot;language-text&quot;&gt;==&lt;/code&gt;을 통해 비교하더라도 정상적으로 동작할 수 있습니다.
다만 더 큰 값으로 올라가는 경우 정상적으로 동작하지 않을 수 있기에 아래와 같이 &lt;code class=&quot;language-text&quot;&gt;equals&lt;/code&gt;를 사용해 비교해야 합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;java&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;Long id = 1L
Long anotherId = 1L

if (id.equals(anotherId)) // equals를 이용해 compare&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.oracle.com/javase/specs/jls/se7/html/jls-5.html#jls-5.1.7&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://docs.oracle.com/javase/specs/jls/se7/html/jls-5.html#jls-5.1.7&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Nginx의 keepalive 옵션과 502 Bad Gateway]]></title><description><![CDATA[Nginx의 keepalive 옵션을 사용하는 경우 간헐적으로 발생하는 502 Bad Gateway 문제]]></description><link>https://kyucumber.github.io/posts/issues/nginx-keep-alive-and-502-bad-gateway</link><guid isPermaLink="false">https://kyucumber.github.io/posts/issues/nginx-keep-alive-and-502-bad-gateway</guid><pubDate>Thu, 01 Mar 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;서비스 운영 중 간헐적으로 502 Bad Gateway가 발생하는 이슈를 겪었습니다.&lt;/p&gt;
&lt;p&gt;특정 시간, 트래픽이 몰리는 상황에 발생하는것이 아니라 간헐적으로 발생했기 때문에 어딘가 설정이 잘못된 부분이 있을거라고 추측했었습니다.
결론적으로 Nginx에 적용해둔 keepalive 시간과 로드밸런서의 idle timeout이 맞지 않아 간헐적으로 커넥션이 끊어지면서 발생하는 문제였습니다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;로드밸런서의 idle timeout&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;로드밸런서는 설정된 idle timeout이 경과할 때까지 데이터를 보내거나 받지 않은 경우 커넥션을 끊게 됩니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Nginx의 keepalive timeout&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Nginx는 keepalive timeout이 경과할 때까지 세션을 ESTABLISH 상태로 유지합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;문제가 발생한 어플리케이션은 아래와 같이 idle timeout 60초, Nginx keepalive timeout 30초로 설정되어 있었습니다.&lt;/p&gt;
&lt;deckgo-highlight-code   terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;idle timeout: 60s
keepalive timeout: 30s;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;strong&gt;60초가 지나기 전 keepalive timeout(30s)에 의해 연결을 끊어버리면서 502 Bad Gateway가 발생&lt;/strong&gt;한 것으로 보입니다.&lt;/p&gt;
&lt;p&gt;이런 문제를 방지하려면 항상 &lt;strong&gt;로드밸런서의 idle timeout보다 Nginx의 keepalive timeout을 길게 설정&lt;/strong&gt;해야 합니다.&lt;/p&gt;
&lt;deckgo-highlight-code   terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;idle timeout: 60s
keepalive timeout: 75s;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://adamcrowder.net/posts/node-express-api-and-aws-alb-502/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Dealing with Intermittent 502’s between an AWS ALB and Express Web Server&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[HTTP 301 응답과 302 응답의 차이]]></title><description><![CDATA[HTTP 301과 302 응답의 차이]]></description><link>https://kyucumber.github.io/posts/network/http-301-and-302</link><guid isPermaLink="false">https://kyucumber.github.io/posts/network/http-301-and-302</guid><pubDate>Thu, 01 Feb 2018 00:00:00 GMT</pubDate><content:encoded>&lt;h2 id=&quot;301-permanently-moved&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#301-permanently-moved&quot; aria-label=&quot;301 permanently moved permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;301 Permanently Moved&lt;/h2&gt;
&lt;p&gt;HTTP 301 Moved Permanently 응답 코드는 요청한 리소스가 Location 헤더가 지정하는 URL로 완전히 옮겨졌다는 것을 나타냅니다.&lt;/p&gt;
&lt;p&gt;영구적으로 리소스가 옮겨졌기 때문에 브라우저는 &lt;strong&gt;해당 결과를 캐싱해&lt;/strong&gt; 서버를 거치지 않고 Location 헤더가 지정하는 URL로 요청을 보내게 됩니다.&lt;/p&gt;
&lt;p&gt;사용자의 응답을 수집, 기록할 필요가 없다면 불필요한 부하를 서버가 받기 때문에 302 응답을 활용합니다.&lt;/p&gt;
&lt;h2 id=&quot;302-found&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#302-found&quot; aria-label=&quot;302 found permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;302 Found&lt;/h2&gt;
&lt;p&gt;HTTP 302 Found 응답 코드는 요청한 리소스가 Location 헤더가 지정하는 URL로 일시적으로 이동되었음을 나타냅니다.&lt;/p&gt;
&lt;p&gt;일시적으로 이동되었음을 나타내기 때문에 클라이언트의 요청은 &lt;strong&gt;캐싱되지 않고 서버를 거친 뒤&lt;/strong&gt; Location 헤더가 지정하는 URL로 요청을 보내게 됩니다.&lt;/p&gt;
&lt;p&gt;사용자의 데이터 수집 목적이 아니라면 서버의 부하를 줄이기 위해서 301 응답을 활용합니다.&lt;/p&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.mozilla.org/ko/docs/Web/HTTP/Status/301&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://developer.mozilla.org/ko/docs/Web/HTTP/Status/301&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.mozilla.org/ko/docs/Web/HTTP/Status/302&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://developer.mozilla.org/ko/docs/Web/HTTP/Status/302&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Clustered Index와 Non Clustered Index]]></title><description><![CDATA[Clustered Index와 Non Clustered Index에 대해 정리]]></description><link>https://kyucumber.github.io/posts/database/clustered-index-and-non-clustered-index</link><guid isPermaLink="false">https://kyucumber.github.io/posts/database/clustered-index-and-non-clustered-index</guid><pubDate>Sun, 01 Oct 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;개발을 진행할 때 데이터베이스의 인덱스나 조인(Nested Loop Join 등)에 대한 내용을 자주 다루지 않아서
매번 필요할때 다시 찾아보고 있습니다. 또 까먹겠지만 다음에 조금 더 빨리 찾아볼 수 있도록 해당 내용을 정리합니다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;아래 내용은 책이나 문서를 보며 아는 대로 정리한 부분이라 잘못된 부분이 있을 수 있습니다. 대부분의 내용은 MySQL을 기준으로 합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;데이터베이스에서는 테이블의 데이터 검색 속도를 향상시켜주기 위해서 인덱스라는 개념을 제공하고 있습니다.
인덱스는 컬럼 단위로 생성되며, 아래와 같이 하나의 컬럼 혹은 여러개의 컬럼에 하나의 인덱스를 생성할 수 있습니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;sql&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;ALTER TABLE user ADD INDEX IDX_CLOSED_AT (closed_at);
ALTER TABLE user ADD INDEX IDX_CREATED_AT_AND_LAST_MOD_AT (created_at, last_modified_at);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;별도로 인덱스를 만들지 않더라도 아래의 경우 자동으로 인덱스가 생성됩니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Primary Key를 지정하는 경우 Clustered Index 생성&lt;/li&gt;
&lt;li&gt;Unique 제약 조건 지정 시 Non Clustered Index 생성&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;인덱스는 Clustered Index, Non Clustered Index 두가지가 존재하며 각각에 대해서는 아래에서 설명합니다.&lt;/p&gt;
&lt;h2 id=&quot;clustered-index&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#clustered-index&quot; aria-label=&quot;clustered index permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Clustered Index&lt;/h2&gt;
&lt;p&gt;MySQL의 InnoDB 엔진에서는 B-Tree 기반 Clustered Index를 제공합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 959px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c16b98a6b0126f746f169a80b26bb741/d7abb/clustered-index.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.5%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABNklEQVQoz3WRiW7CMBBE8/8/VwnUXI2POPGROoHQBooCyXTtHhICVlpZ9tvZWdsJHsS6rjFDTJ8jnFUYeoflev3nzyL5E9/nEgusbbHdviBLtzifv24MH+VNw0fu+/0I7z1qVWOe57ubYL01SO4KKJZlwfF4xDRNUEohyzJsNhv4dx/PT6fT0wESrVtoo+lqBs45tG0DzjmtLfI8R+BV9YaiyOPKGKNaCykFMY2u62BIK4TAMAxIvO9RliUyEhsqrGmikCECC83TLI0GjDPsxzGyMHmappFrY1CRUd/3oaGDFBWK/JVENYxR8SMul5ncDRoliFHDRlIKetMdrvTbxjQ0bQFWFTSpinwkljgj0VkJyXPUsoQ1Ar77aWiJhT1nGQkqWM3xcdjFN+6cgvtljQpM4DAO+AYshV9/wHyxbQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/c16b98a6b0126f746f169a80b26bb741/8ac56/clustered-index.webp 240w,
/static/c16b98a6b0126f746f169a80b26bb741/d3be9/clustered-index.webp 480w,
/static/c16b98a6b0126f746f169a80b26bb741/1bae5/clustered-index.webp 959w&quot;
          sizes=&quot;(max-width: 959px) 100vw, 959px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/c16b98a6b0126f746f169a80b26bb741/8ff5a/clustered-index.png 240w,
/static/c16b98a6b0126f746f169a80b26bb741/e85cb/clustered-index.png 480w,
/static/c16b98a6b0126f746f169a80b26bb741/d7abb/clustered-index.png 959w&quot;
          sizes=&quot;(max-width: 959px) 100vw, 959px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/c16b98a6b0126f746f169a80b26bb741/d7abb/clustered-index.png&quot;
          alt=&quot;clustered-index&quot;
          title=&quot;clustered-index&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Clustered Index를 기준으로 테이블 데이터를 물리적으로 재배열 하기 때문에 테이블 당 하나만 존재할 수 있습니다.&lt;/p&gt;
&lt;p&gt;Clustered Index의 Leaf Node에는 실제 Row 데이터가 저장됩니다. 물리적으로 정렬되어 있어 Clustered Index 사용 시 검색 속도가 빠릅니다. 정렬되지 않은 데이터를 적재할 경우 성능의 저하가 일어날 수 있으므로 Primary Key의 경우 Auto Increment와 같이 정렬 순서를 보장하는 편이 좋습니다.&lt;/p&gt;
&lt;h2 id=&quot;non-clustered-index&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#non-clustered-index&quot; aria-label=&quot;non clustered index permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Non Clustered Index&lt;/h2&gt;
&lt;p&gt;Clustered Index와 달리 하나의 테이블에 여러 Non Clustered Index를 생성할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 678px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/8b34df759994b862396a471b30c06458/38cea/non-clustered-index-01.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 51.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABbUlEQVQoz4VRDW+CMBTk//+oxWXJPoxZjEO+ZEJpKwoSBRWHgLe+Lopmur3kUvp6Pe5eDdyo4/GI/+oex7hHpHVbVhp5sUEYBmCMwf/0sdls7ooat4SomqbBuyvwNAzghTMlNoUQAixiKIrizL28RzAuN3TWfXd/PxwO8CYeTNOEZVnI8/xXqhPf+GteZVkiSRJEUYQsy8BCpqKHmM/n4JxjtVqjrusrYe2waVt8VTXqpkWaJjpav9/XIDe73RZxHMO2bYytMaqq0q5t20LvsQfHcbBcLrsZxsscDwMfzx8McjaD49oQUkIqUO33e7ieg5CFmAbTc2QhOHx/ohIwbeJmZIpG84pVLCLR45AgCdGec3F+ZYodBIFe5Ux2Dkm0bX+Ei3ytXzRNF0gU6OygIkrJ1exiLBaxni0VcYSIsFD9LEuvBU9O00TAHL0p9MEjV/fLcgvfHWI0fIXvDZXDteZK7qveCyxzoESZ7n0Demf9L2PcyrQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/8b34df759994b862396a471b30c06458/8ac56/non-clustered-index-01.webp 240w,
/static/8b34df759994b862396a471b30c06458/d3be9/non-clustered-index-01.webp 480w,
/static/8b34df759994b862396a471b30c06458/7e03f/non-clustered-index-01.webp 678w&quot;
          sizes=&quot;(max-width: 678px) 100vw, 678px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/8b34df759994b862396a471b30c06458/8ff5a/non-clustered-index-01.png 240w,
/static/8b34df759994b862396a471b30c06458/e85cb/non-clustered-index-01.png 480w,
/static/8b34df759994b862396a471b30c06458/38cea/non-clustered-index-01.png 678w&quot;
          sizes=&quot;(max-width: 678px) 100vw, 678px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/8b34df759994b862396a471b30c06458/38cea/non-clustered-index-01.png&quot;
          alt=&quot;non-clustered-index-01&quot;
          title=&quot;non-clustered-index-01&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Non Clustered Index의 Leaf Node에는 Clustered Index의 키가 포함됩니다. 자세한 내용은 살펴보지 않았지만 아래와 같이 Non Clustered Index를 이용해 검색이 일어나는 경우 아래와 같이 Non Clustered Index의 Leaf Node를 찾은 뒤 Clustered Index를 활용해 데이터를 조회하는 것 같습니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 715px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9da214612f9a726998e1d37bc4994900/d0c0e/non-clustered-index-02.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 73.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAACEklEQVQ4y4VTibKiMBD0/z/LkvWpTxBR8cAD5AZREEHx6J3MltbT1d1UpTJkQqdnulPDm3G73R5xnmdw7CUC38blcvkr/zpqryD3tTqfkR1OMC0Lv6Q6ut02yqJ4nHmdD8CfQD+TxbHCzE6wdgOoqgpd13GmS95V8QT4qYSqqnAsD9jEMebzORaLBTabDdI0xel0eiLxVPJ943q9wolSuNEW4/EYkiRhbdvY7XZQFAWj0YgZilWSGrCoFe9AnwCDJEeUZFRiH4YxRxhGSJIEmjbAdDpjUUzTIlCdGb/2/bnke/J6wXCoYqApxG6LKArRV7uYTIYMaFlLYtwh5c1/M7wnBNNtEiGOfBzyPcqyoO8QWZpwPs9TspCDoth/BnxH/S7MbruB2utgMh5QD6uPfr3HtXeeElMoWZDvoihiIYR19nvBuGRxPnmxhv+MMAxZdaF0EAR8iWjLpxdWY7s4DlzXhe/7/NNqtWLvCTNrmoZ2uw1ZlonpkO0izooznuexaKZpciXMUCgnLNFsNtFqtTAzDHx9tQg8oItcYtbjnLCKLCtsI1F6oyGhXq/Tv1N0Ot9ssweguZpD6yuQux0slwb0kYYsSxHHVK4+oHcsRBlhNtV5/5DnZKseFPmb9saUG8JznT+AV/JdHLn0xDwCNsgSa/p2qPkHtoqI7fUCvmdxfDqWOB4Ljj3XxNpacCzOivEbZCp27Jbzo88AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/9da214612f9a726998e1d37bc4994900/8ac56/non-clustered-index-02.webp 240w,
/static/9da214612f9a726998e1d37bc4994900/d3be9/non-clustered-index-02.webp 480w,
/static/9da214612f9a726998e1d37bc4994900/cb533/non-clustered-index-02.webp 715w&quot;
          sizes=&quot;(max-width: 715px) 100vw, 715px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/9da214612f9a726998e1d37bc4994900/8ff5a/non-clustered-index-02.png 240w,
/static/9da214612f9a726998e1d37bc4994900/e85cb/non-clustered-index-02.png 480w,
/static/9da214612f9a726998e1d37bc4994900/d0c0e/non-clustered-index-02.png 715w&quot;
          sizes=&quot;(max-width: 715px) 100vw, 715px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/9da214612f9a726998e1d37bc4994900/d0c0e/non-clustered-index-02.png&quot;
          alt=&quot;non-clustered-index-02&quot;
          title=&quot;non-clustered-index-02&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;인덱스는 검색 성능 향상을 위해 사용하지만, 테이블 내에 인덱스가 너무 많이 생성된 경우에는 DML 작업의 성능 저하가 일어날 수 있으므로 꼭 필요한 경우에만 인덱스를 추가하는것이 좋습니다.&lt;/p&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.sqlservercentral.com/articles/nonclustered-index-structure&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://www.sqlservercentral.com/articles/nonclustered-index-structure&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[객체지향과 SOLID]]></title><description><![CDATA[객체지향과 SOLID에 대한 내용을 간단하게 정리합니다.]]></description><link>https://kyucumber.github.io/posts/etc/oop-and-solid</link><guid isPermaLink="false">https://kyucumber.github.io/posts/etc/oop-and-solid</guid><pubDate>Fri, 15 Sep 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;연차가 아직 많지 않은 편이라 그런지 개발을 하다보면 항상 객체지향의 5대 원칙인 SOLID에 대한 이야기가 자주 나옵니다.
코드리뷰를 진행하면서 SOLID와 관련해 설계에 대해 질문을 던지는 사람들도 있었고 각각의 원칙들이 의미하는 바를 물어보는 사람도 많았습니다.&lt;/p&gt;
&lt;p&gt;대략적인 내용은 파악하고 있으나 문서상으로 정리하지 않아 매번 새로 찾아보는 편입니다. 이번 기회에 관련 내용을 정리해보기로 했습니다.&lt;/p&gt;
&lt;p&gt;SOLID는 아래 5가지로 이루어져있습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;단일 책임의 원칙 - SRP(Single Responsibility Principle)&lt;/li&gt;
&lt;li&gt;개방 폐쇄 원칙 - OCP(Open-Closed Principle)&lt;/li&gt;
&lt;li&gt;리스코프 치환 원칙 - LSP(Liskov Substitution Principle)&lt;/li&gt;
&lt;li&gt;인터페이스 분리 원칙 - ISP(Interface Segregation Principle)&lt;/li&gt;
&lt;li&gt;의존성 역전 원칙 - DIP(Dependency Inversion Principle)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;각각이 의미하는 바를 간단하게 정리해보고 나중에 기회가 된다면 해당 원칙을 지켜 프로그래밍하는 사례들도 아래에 포함시키면 좋을 것 같습니다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;아래 내용은 책이나 문서를 보며 아는 대로 정리한 부분이라 잘못된 부분이 있을 수 있습니다. 잘못된 부분이 있다면 댓글에 남겨주시면 감사하겠습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;단일-책임의-원칙---srpsingle-responsibility-principle&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%8B%A8%EC%9D%BC-%EC%B1%85%EC%9E%84%EC%9D%98-%EC%9B%90%EC%B9%99---srpsingle-responsibility-principle&quot; aria-label=&quot;단일 책임의 원칙   srpsingle responsibility principle permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;단일 책임의 원칙 - SRP(Single Responsibility Principle)&lt;/h2&gt;
&lt;p&gt;하나의 클래스는 하나의 책임만을 가지며, 클래스를 변경해야 하는 이유 또한 한가지만 가져야 한다는 원칙입니다.&lt;/p&gt;
&lt;p&gt;이 원칙의 경우 의미가 원칙에 그대로 들어가 있어 이해하기 쉬웠습니다. 다만 적절하게 클래스 간 책임을 나누고 여러 클래스간 관계를 잘 설정하는 부분은 쉬운 작업은 아닐 것 같습니다.&lt;/p&gt;
&lt;p&gt;클래스간 책임을 적절히 잘 분리하여 응집도를 높이는 부분이 여기에 해당하며 설계를 잘 하기 위한 가장 기본적인 방법이 될 것 같습니다.&lt;/p&gt;
&lt;h2 id=&quot;개방-폐쇄-원칙---ocpopen-closed-principle&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EA%B0%9C%EB%B0%A9-%ED%8F%90%EC%87%84-%EC%9B%90%EC%B9%99---ocpopen-closed-principle&quot; aria-label=&quot;개방 폐쇄 원칙   ocpopen closed principle permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;개방 폐쇄 원칙 - OCP(Open-Closed Principle)&lt;/h2&gt;
&lt;p&gt;클래스는 확장에는 열려있고 변경에는 닫혀있어야 한다는 원칙입니다. 요구사항이 추가되어 새로운 기능을 추가한다고 했을 때, 쉽게 확장할 수 있어야 하며 기존 구현한 코드의 변경을 최소화해야 한다는 내용인 것 같습니다.&lt;/p&gt;
&lt;p&gt;어떤 경우에 개방 폐쇄 원칙이 적용되었다고 볼 수 있을까요? 특정 기능의 추상화를 통해 인터페이스를 추출하고 인터페이스 상속을 통해 구현체를 늘려나가는 과정이 개방 폐쇄 원칙을 지키는 사례에 해당할 수 있을 것 같네요.&lt;/p&gt;
&lt;h2 id=&quot;리스코프-치환-원칙---lspliskov-substitution-principle&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%A6%AC%EC%8A%A4%EC%BD%94%ED%94%84-%EC%B9%98%ED%99%98-%EC%9B%90%EC%B9%99---lspliskov-substitution-principle&quot; aria-label=&quot;리스코프 치환 원칙   lspliskov substitution principle permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;리스코프 치환 원칙 - LSP(Liskov Substitution Principle)&lt;/h2&gt;
&lt;p&gt;이 원칙의 경우 원칙의 이름만 보았을 때 어떤 내용인지 이해하기 힘들어 다섯가지의 원칙 중 가장 이해하기 어려웠던 것 같습니다.&lt;/p&gt;
&lt;p&gt;상위 타입의 객체를 하위 타입의 객체로 치환하더라도 정상 동작을 보장해야 한다는 내용의 원칙입니다.&lt;/p&gt;
&lt;p&gt;조금 풀어서 내용을 정리해보면 구현 상속(extends) 혹은 인터페이스 상속(implements)을 통해 서브타입을 구현하더라도 상위 타입이 가지는 제약이나 내용들을 보장해야 한다라는 내용 같습니다.&lt;/p&gt;
&lt;p&gt;어느 경우가 이에 해당할까 생각해봤는데, 흔히 사용하는 &lt;code class=&quot;language-text&quot;&gt;Collection&lt;/code&gt;이나 &lt;code class=&quot;language-text&quot;&gt;List&lt;/code&gt; 등의 인터페이스가 이 원칙을 잘 지켜서 개발된 것으로 볼 수 있을 것 같습니다.&lt;/p&gt;
&lt;h2 id=&quot;인터페이스-분리-원칙---ispinterface-segregation-principle&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4-%EB%B6%84%EB%A6%AC-%EC%9B%90%EC%B9%99---ispinterface-segregation-principle&quot; aria-label=&quot;인터페이스 분리 원칙   ispinterface segregation principle permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;인터페이스 분리 원칙 - ISP(Interface Segregation Principle)&lt;/h2&gt;
&lt;p&gt;이 원칙은 인터페이스를 구현하는 서브 클래스가 자신이 사용할 필요가 없는 메소드를 구현하지 말아야 한다는 원칙입니다.&lt;/p&gt;
&lt;p&gt;추상화를 통해 인터페이스를 추출했을 때 가지는 메소드가 3개라면, 서브타입은 모든 메소드를 유의미하게 구현하고 사용해야 합니다. 만약에 사용하지 않아 구현할 필요가 없는 메소드가 존재한다면 이 부분을 다른 인터페이스로 추출해야 합니다.&lt;/p&gt;
&lt;h2 id=&quot;의존성-역전-원칙---dipdependency-inversion-principle&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%9D%98%EC%A1%B4%EC%84%B1-%EC%97%AD%EC%A0%84-%EC%9B%90%EC%B9%99---dipdependency-inversion-principle&quot; aria-label=&quot;의존성 역전 원칙   dipdependency inversion principle permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;의존성 역전 원칙 - DIP(Dependency Inversion Principle)&lt;/h2&gt;
&lt;p&gt;DIP(Dependency Inversion Principle)의 경우 DDD Start와 같은 책을 통해 많이 알려지면서 SOLID를 이야기하지 않아도 자주 언급되는 용어가 된 것 같습니다.&lt;/p&gt;
&lt;p&gt;이는 상위 수준의 모듈이 하위 수준의 모듈의 구현에 의존하여 하위 수준 모듈에 변경에 상위 수준의 모듈이 영향을 받는 부분을 최소화하기 위한 원칙입니다.
상위 수준 모듈에서 추상화를 통해 추출한 인터페이스를 의존하게 하면 하위 수준 모듈과의 의존성을 끊어낼 수 있습니다.&lt;/p&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://johngrib.github.io/wiki/SOLID/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://johngrib.github.io/wiki/SOLID/&lt;/a&gt;&lt;/p&gt;</content:encoded></item></channel></rss>
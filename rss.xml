<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[규규규규]]></title><description><![CDATA[없음]]></description><link>https://kyucumber.github.io</link><generator>GatsbyJS</generator><lastBuildDate>Wed, 19 May 2021 14:09:00 GMT</lastBuildDate><item><title><![CDATA[logback에서 stdout 로그 출력 시 특정 Thread가 lock을 무기한 보유하는 이슈]]></title><description><![CDATA[stdout 로그 출력 시 특정 Thread가 lock을 무기한 보유하는 이슈 정리]]></description><link>https://kyucumber.github.io/posts/spring/logback-thread-lock-issue</link><guid isPermaLink="false">https://kyucumber.github.io/posts/spring/logback-thread-lock-issue</guid><pubDate>Sat, 01 May 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;운영중인 개발 환경 서버에서 504 Gateway Time-out이 발생하고 일정 시간이 지나도 회복되지 않는 문제가 발생했다.&lt;/p&gt;
&lt;p&gt;해당 어플리케이션의 경우 지속적으로 헬스체크를 진행하고 실패시 트래픽을 받지 않도록 구성해두었는데도 문제가 있는 장비는 제거되지 않고 계속 트래픽을 받고 있었다.&lt;/p&gt;
&lt;p&gt;트래픽을 받는 특정 장비 내부에서 curl을 이용해 헬스체크 path에 대해 요청을 보내보았으나 아래와 같이 정상적으로 200 응답이 내려오는 것을 확인할 수 있었다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;❯ curl http://localhost/actuator/health
{&amp;quot;status&amp;quot;:&amp;quot;UP&amp;quot;,&amp;quot;components&amp;quot;:{&amp;quot;ping&amp;quot;:{&amp;quot;status&amp;quot;:&amp;quot;UP&amp;quot;}}}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;명확한 원인 파악을 위해 아래와 같이 스레드 덤프를 따서 확인해보았다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;java.lang.Thread.State: RUNNABLE
at java.io.FileOutputStream.writeBytes(Native Method)
at java.io.FileOutputStream.write(FileOutputStream.java:326)
at java.io.BufferedOutputStream.write(BufferedOutputStream.java:122)
- locked &amp;lt;0x00000000c023a8e0&amp;gt; (a java.io.BufferedOutputStream)
at java.io.PrintStream.write(PrintStream.java:480)
- locked &amp;lt;0x00000000c023a8c0&amp;gt; (a java.io.PrintStream)
at java.io.FilterOutputStream.write(FilterOutputStream.java:97)
at ch.qos.logback.core.joran.spi.ConsoleTarget$1.write(ConsoleTarget.java:37)
at ch.qos.logback.core.OutputStreamAppender.writeBytes(OutputStreamAppender.java:199)
at ch.qos.logback.core.OutputStreamAppender.subAppend(OutputStreamAppender.java:231)
at ch.qos.logback.core.OutputStreamAppender.append(OutputStreamAppender.java:102)
at ch.qos.logback.core.UnsynchronizedAppenderBase.doAppend(UnsynchronizedAppenderBase.java:84)
at ch.qos.logback.core.spi.AppenderAttachableImpl.appendLoopOnAppenders(AppenderAttachableImpl.java:51)
at ch.qos.logback.classic.Logger.appendLoopOnAppenders(Logger.java:270)
at ch.qos.logback.classic.Logger.callAppenders(Logger.java:257)
at ch.qos.logback.classic.Logger.buildLoggingEventAndAppend(Logger.java:421)
at ch.qos.logback.classic.Logger.filterAndLog_1(Logger.java:398)
at ch.qos.logback.classic.Logger.info(Logger.java:583)
at 문제가 발생한 패키지(문제가 발생한 클래스.kt:107)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;해당 스레드 덤프의 내용을 보면 특정 스레드 하나가 RUNNABLE 상태임에도 불구하고 &lt;code class=&quot;language-text&quot;&gt;java.io.PrintStream.write&lt;/code&gt;에서 locked로 lock이 발생한 것을 확인할 수 있었다.&lt;/p&gt;
&lt;h2 id=&quot;원인&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%9B%90%EC%9D%B8&quot; aria-label=&quot;원인 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;원인&lt;/h2&gt;
&lt;p&gt;대부분의 로그는 파일로 별도로 떨구게 구성해두었는데, 개발 환경이다보니 어플리케이션 내부에 아래와 같이 stdout 로그를 찍는 부분이 logback 설정에 포함되어 있었고 이 부분에서 문제가 발생한 것으로 보인다.&lt;/p&gt;
&lt;deckgo-highlight-code   terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;
&amp;lt;appender name=&amp;quot;STDOUT&amp;quot; class=&amp;quot;ch.qos.logback.core.ConsoleAppender&amp;quot;&amp;gt;
    &amp;lt;encoder&amp;gt;
        &amp;lt;charset&amp;gt;utf8&amp;lt;/charset&amp;gt;
        &amp;lt;pattern&amp;gt;%d{MM-dd HH:mm:ss} [%thread] %.-5level %logger{36} - %msg%n&amp;lt;/pattern&amp;gt;
    &amp;lt;/encoder&amp;gt;
&amp;lt;/appender&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;stdout으로 로그를 출력하더라도 기존에 잘 동작하고 특별한 설정의 변경이 없던 어플리케이션에서 갑자기 왜 위와 같은 문제가 발생한 것인지는 명확히 파악하지 못했다.&lt;/p&gt;
&lt;p&gt;트래픽이나 로깅의 양이 늘어나지도 않았고, 설정도 변경되지 않았으며 Volume 설정 또한 변경한 부분이 없는 상태에서 갑자기 모든 장비에 lock이 잡히게 되었는지는 의문이다.&lt;/p&gt;
&lt;p&gt;일단 근본적인 원인은 lock을 무기한으로 보유하고 있는 RUNNABLE 스레드로 보이며 아래와 같이 유사한 현상을 겪은 케이스를 logback 이슈에서 찾을 수 있었다.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://jira.qos.ch/browse/LOGBACK-1406?attachmentViewMode=list&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://jira.qos.ch/browse/LOGBACK-1406?attachmentViewMode=list&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://jira.qos.ch/browse/LOGBACK-1422?attachmentViewMode=list&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://jira.qos.ch/browse/LOGBACK-1422?attachmentViewMode=list&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;해결&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%95%B4%EA%B2%B0&quot; aria-label=&quot;해결 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;해결&lt;/h2&gt;
&lt;p&gt;근본적인 원인은 확인하지 못했으나, stdout으로 로그를 찍는 부분이 어플리케이션에 영향을 주지 않도록 아래 부분을 변경했다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ConsoleAppender → AsyncAppender로 변경&lt;/li&gt;
&lt;li&gt;neverBlock 설정 추가&lt;/li&gt;
&lt;/ul&gt;
&lt;deckgo-highlight-code   terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;appender name=&amp;quot;STDOUT-ASYNC&amp;quot; class=&amp;quot;ch.qos.logback.classic.AsyncAppender&amp;quot;&amp;gt;
    &amp;lt;neverBlock&amp;gt;true&amp;lt;/neverBlock&amp;gt;
    &amp;lt;appender-ref ref=&amp;quot;STDOUT&amp;quot;/&amp;gt;
&amp;lt;/appender&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;AsyncAppender만 사용해도 문제가 없을 것으로 생각했는데 AsyncAppender만을 적용해도 스레드가 무기한으로 lock을 보유하는 문제는 동일하게 발생했다.&lt;/p&gt;
&lt;p&gt;설정을 조금 잘못 넣어서 그런것일지도 모르겠으나, neverBlock 설정을 추가한 시점부터 의도한 대로 lock이 걸려도 어플리케이션이 멈추지 않고 정상적으로 동작했다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;다만 lock이 걸린 시점부터는 stdout 로그가 정상적으로 출력되지 않는다.&lt;/p&gt;
&lt;/blockquote&gt;</content:encoded></item><item><title><![CDATA[파일이 존재하는데도 No such file or directory 에러가 발생하는 경우]]></title><description><![CDATA[파일이 존재하는데도 No such file or directory 에러가 발생하는 이슈 정리]]></description><link>https://kyucumber.github.io/posts/issues/no-such-file-or-directory</link><guid isPermaLink="false">https://kyucumber.github.io/posts/issues/no-such-file-or-directory</guid><pubDate>Mon, 29 Mar 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Gitlab runner 환경 구성 중 Embedded Redis를 사용해 테스트를 실행하는 모듈의 테스트가 지속적으로 실패하는 문제를 겪었다.&lt;/p&gt;
&lt;p&gt;로컬 환경 및 다른 이미지의 러너에서는 정상적으로 빌드가 성공했으나 신규로 테스트하던 모듈에서는 아래와 같은 에러 메세지와 함께 테스트가 정상적으로 구동되지 않았다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;2021-03-29T21:23:49.643+0900 [DEBUG] [TestEventLogger]         at java.lang.Thread.run(Thread.java:748)
2021-03-29T21:23:49.643+0900 [DEBUG] [TestEventLogger]
2021-03-29T21:23:49.643+0900 [DEBUG] [TestEventLogger]         Caused by:
2021-03-29T21:23:49.643+0900 [DEBUG] [TestEventLogger]         java.io.IOException: Cannot run program &amp;quot;/tmp/1617020629467-0/redis-server-3.0.7&amp;quot; (in directory &amp;quot;/tmp/1617020629467-0&amp;quot;): error=2, No such file or directory
2021-03-29T21:23:49.643+0900 [DEBUG] [TestEventLogger]             at java.lang.ProcessBuilder.start(ProcessBuilder.java:1048)
2021-03-29T21:23:49.643+0900 [DEBUG] [TestEventLogger]             at redis.embedded.AbstractRedisInstance.start(AbstractRedisInstance.java:34)
2021-03-29T21:23:49.643+0900 [DEBUG] [TestEventLogger]             ... 85 more
2021-03-29T21:23:49.643+0900 [DEBUG] [TestEventLogger]
2021-03-29T21:23:49.643+0900 [DEBUG] [TestEventLogger]             Caused by:
2021-03-29T21:23:49.643+0900 [DEBUG] [TestEventLogger]             java.io.IOException: error=2, No such file or directory&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;No such file or directory&lt;/code&gt; 메세지만 보고 바이너리를 해당 경로에 복사하거나 하는 과정이 누락된 것이라고 생각했는데 실제 바이너리 파일은 정상적으로 존재했다.&lt;/p&gt;
&lt;p&gt;해당 이미지에서 직접 바이너리를 실행시켜보니 바이너리 파일이 존재하는데도 아래와 같이 &lt;code class=&quot;language-text&quot;&gt;No such file or directory&lt;/code&gt; 에러가 노출되는것을 확인할 수 있었다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;bash-4.4# uname -a
Linux 490bc54ba0f4 4.14.214-160.339.amzn2.x86_64 #1 SMP Sun Jan 10 05:53:05 UTC 2021 x86_64 Linux

bash-4.4# ls -al

-rwxr-xr-x    1 root     root       4311368 Mar 29 20:35 redis-server-3.0.7
-rwxr-xr-x    1 root     root        927664 Mar 29 20:35 redis-server-3.0.7-darwin

bash-4.4# ./redis-server-3.0.7
bash: ./redis-server-3.0.7: No such file or directory&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;a href=&quot;https://askubuntu.com/questions/133389/no-such-file-or-directory-but-the-file-exists&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://askubuntu.com/questions/133389/no-such-file-or-directory-but-the-file-exists&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;파일을 찾지 못하는 경우 뿐만 아니라 운영체제 별 필요한 런타임 구성 요소가 누락되는 경우도 &lt;code class=&quot;language-text&quot;&gt;No such file or directory&lt;/code&gt;라는 형태로 에러가 출력될 수 있으며
위 케이스는 Embedded Redis 바이너리 자체가 alpine에서 구동되지 않는 문제라 빌드 이미지를 변경해 해결했다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[RestHighLevelClient 테스트 작성 시 SearchResponse 더미 데이터 생성하기]]></title><description><![CDATA[Spring Elasticsearch RestHighLevelClient 사용 시 단위 테스트 작성을 위한 SearchResponse 더미 데이터 생성하기]]></description><link>https://kyucumber.github.io/posts/spring/rest-high-level-client-unit-test/</link><guid isPermaLink="false">https://kyucumber.github.io/posts/spring/rest-high-level-client-unit-test/</guid><pubDate>Wed, 10 Feb 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Spring에서 RestHighLevelClient 관련 unit 테스트 작성시 SearchResponse의 더미 데이터 생성 예제&lt;/p&gt;
&lt;h2 id=&quot;searchresponse-데이터-생성을-위한-util-클래스-정의&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#searchresponse-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%83%9D%EC%84%B1%EC%9D%84-%EC%9C%84%ED%95%9C-util-%ED%81%B4%EB%9E%98%EC%8A%A4-%EC%A0%95%EC%9D%98&quot; aria-label=&quot;searchresponse 데이터 생성을 위한 util 클래스 정의 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;SearchResponse 데이터 생성을 위한 Util 클래스 정의&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ElasticsearchTestUtils.kt&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;object ElasticsearchTestUtils {
    fun getSearchResponseFromJson(jsonResponse: String): SearchResponse {
        try {
            val registry = NamedXContentRegistry(getDefaultNamedXContents())
            val parser: XContentParser =
                JsonXContent.jsonXContent.createParser(registry, DeprecationHandler.THROW_UNSUPPORTED_OPERATION, jsonResponse)
            return SearchResponse.fromXContent(parser)
        } catch (e: IOException) {
            println(&amp;quot;exception $e&amp;quot;)
        } catch (e: Exception) {
            println(&amp;quot;exception $e&amp;quot;)
        }
        throw IllegalStateException(&amp;quot;invalid state&amp;quot;)
    }

    private fun getDefaultNamedXContents(): List&amp;lt;NamedXContentRegistry.Entry&amp;gt; {
        val map: MutableMap&amp;lt;String, ContextParser&amp;lt;Any, out Aggregation&amp;gt;&amp;gt; = HashMap()
        map[TopHitsAggregationBuilder.NAME] =
            ContextParser { p: XContentParser?, c: Any? -&amp;gt; ParsedTopHits.fromXContent(p, c as String?) }
        map[StringTerms.NAME] =
            ContextParser { p: XContentParser?, c: Any? -&amp;gt; ParsedStringTerms.fromXContent(p, c as String?) }
        return map.entries.stream()
            .map { entry: Map.Entry&amp;lt;String, ContextParser&amp;lt;Any, out Aggregation&amp;gt;&amp;gt; -&amp;gt;
                NamedXContentRegistry.Entry(
                    Aggregation::class.java, ParseField(entry.key), entry.value
                )
            }.toList()
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;searchresponse-생성을-위한-json-파일-생성&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#searchresponse-%EC%83%9D%EC%84%B1%EC%9D%84-%EC%9C%84%ED%95%9C-json-%ED%8C%8C%EC%9D%BC-%EC%83%9D%EC%84%B1&quot; aria-label=&quot;searchresponse 생성을 위한 json 파일 생성 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;SearchResponse 생성을 위한 json 파일 생성&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;test/resources/json/search.json&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;json&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;{
    &amp;quot;took&amp;quot; : 3,
    &amp;quot;timed_out&amp;quot; : false,
    &amp;quot;_shards&amp;quot; : {
        &amp;quot;total&amp;quot; : 6,
        &amp;quot;successful&amp;quot; : 6,
        &amp;quot;skipped&amp;quot; : 0,
        &amp;quot;failed&amp;quot; : 0
    },
    &amp;quot;hits&amp;quot; : {
        &amp;quot;total&amp;quot; : {
            &amp;quot;value&amp;quot; : 3,
            &amp;quot;relation&amp;quot; : &amp;quot;eq&amp;quot;
        },
        &amp;quot;max_score&amp;quot; : 1.0,
        &amp;quot;hits&amp;quot; : [
            {
                &amp;quot;_index&amp;quot; : &amp;quot;index&amp;quot;,
                &amp;quot;_type&amp;quot; : &amp;quot;_doc&amp;quot;,
                &amp;quot;_id&amp;quot; : &amp;quot;1&amp;quot;,
                &amp;quot;_score&amp;quot; : 1.0,
                &amp;quot;_source&amp;quot; : {
                }
            }
        ]
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;resthighlevelclient-mocking이-필요한-테스트-작성&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#resthighlevelclient-mocking%EC%9D%B4-%ED%95%84%EC%9A%94%ED%95%9C-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%9E%91%EC%84%B1&quot; aria-label=&quot;resthighlevelclient mocking이 필요한 테스트 작성 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;RestHighLevelClient mocking이 필요한 테스트 작성&lt;/h2&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;describe(&amp;quot;elasticsearch client unit test&amp;quot;) {
    val elasticsearchClient = mockk&amp;lt;RestHighLevelClient&amp;gt;()
    val lastAccessService = LastAccessSearchService(
        elasticsearchClient = elasticsearchClient,
        fullAuthAccessInfoDeserializer = FullAuthAccessInfoDeserializer()
    )

    context(&amp;quot;key를 통해 검색하는 경우&amp;quot;) {
        val query = Query()
        val key = &amp;quot;key&amp;quot;

        it(&amp;quot;해당 key에 해당하는 모든 유저 목록을 불러온다&amp;quot;) {
            val searchResponse: SearchResponse = ElasticsearchTestUtils.getSearchResponseFromJson(ClassPathResource(&amp;quot;json/search.json&amp;quot;).file.readText())
            every { elasticsearchClient.search(query.createRequest(), RequestOptions.DEFAULT) } answers { searchResponse }

            val searchResults = elasticsearchService.search(key)

            assertThat(searchResults[0].key).isEqualTo(key)
        }
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://discuss.elastic.co/t/elasticsearch-json-response-to-searchresponse-object/124394/4&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://discuss.elastic.co/t/elasticsearch-json-response-to-searchresponse-object/124394/4&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Kotlin 프로젝트의 Spring Boot 2.2.x 마이그레이션]]></title><description><![CDATA[Kotlin 프로젝트의 Spring Boot 2.2.x 마이그레이션 과정에서 겪은 이슈 정리]]></description><link>https://kyucumber.github.io/posts/spring/spring-boot-2.2.x-migration</link><guid isPermaLink="false">https://kyucumber.github.io/posts/spring/spring-boot-2.2.x-migration</guid><pubDate>Sun, 01 Nov 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;코틀린과 스프링 부트로 구성해둔 사내 프로젝트의 스프링 부트 버전을 2.1.x -&gt; 2.2.x로 마이그레이션하면서 겪은 이슈 정리&lt;/p&gt;
&lt;h2 id=&quot;jackson-module-kotlin-is-prefix를-제거하는-버그-픽스&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#jackson-module-kotlin-is-prefix%EB%A5%BC-%EC%A0%9C%EA%B1%B0%ED%95%98%EB%8A%94-%EB%B2%84%EA%B7%B8-%ED%94%BD%EC%8A%A4&quot; aria-label=&quot;jackson module kotlin is prefix를 제거하는 버그 픽스 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Jackson module kotlin &lt;code class=&quot;language-text&quot;&gt;is&lt;/code&gt; prefix를 제거하는 버그 픽스&lt;/h2&gt;
&lt;p&gt;기존에 존재하던 &lt;code class=&quot;language-text&quot;&gt;is&lt;/code&gt; prefix를 제거하는 버그가 해소되었다.
아래와 같이 사용하는 코드가 있었다면 클라이언트쪽에서 찾아 변경하거나 &lt;code class=&quot;language-text&quot;&gt;@JsonProperty&lt;/code&gt;를 추가해야 할 것 같다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;data class Data(
    val isAdmin: Boolean = false // is가 제거된 `admin`으로 Deserialize 되던 버그가 해결되어 이제 `isAdmin` 으로 Deserialize 된다.
)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/FasterXML/jackson-module-kotlin/issues/80&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://github.com/FasterXML/jackson-module-kotlin/issues/80&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/FasterXML/jackson-module-kotlin/issues/346&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://github.com/FasterXML/jackson-module-kotlin/issues/346&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/spinnaker/orca/commit/df71ed993f77b06b029f5e129256f1972d1d0d3b&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://github.com/spinnaker/orca/commit/df71ed993f77b06b029f5e129256f1972d1d0d3b&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;deprecated-mediatypeapplicationjsonutf8&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#deprecated-mediatypeapplicationjsonutf8&quot; aria-label=&quot;deprecated mediatypeapplicationjsonutf8 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Deprecated MediaType.APPLICATION&lt;em&gt;JSON&lt;/em&gt;UTF8&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;MediaType.APPLICATION_JSON_UTF8&lt;/code&gt; 가 Deprecate 되었다.
&lt;a href=&quot;https://github.com/spring-projects/spring-framework/issues/22788&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;제기된 이슈&lt;/a&gt;와 관련된 내용을 살펴봤을 때
RFC 스펙이 변경되면서 JSON 인코딩이 기본적으로 UTF-8로 변경되었고 이에 따라 불필요해져 Deprecate 된 것 같다.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://tools.ietf.org/html/rfc7159#section-8.1&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;RFC-7159&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;JSON text SHALL be encoded in UTF-8, UTF-16, or UTF-32&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://tools.ietf.org/html/rfc8259#section-8.1&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;RFC-8259&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;JSON text exchanged between systems that are not part of a closed ecosystem MUST be encoded using UTF-8&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Deprecate 된 코드들만 제거해주면 큰 문제는 없었는데, 기존 MockMvc로 작성된 테스트 코드에서 한글이 다 깨지는 문제가 발생했다.
MockMvc를 사용하는 경우 아래처럼 &lt;code class=&quot;language-text&quot;&gt;DEFAULT_CHARACTER_ENCODING&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;ISO_8859&lt;/code&gt;로 지정되어 그런 것 같다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;java&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;public class MockHttpServletResponse implements HttpServletResponse {

	private static final String CHARSET_PREFIX = &amp;quot;charset=&amp;quot;;

	private static final String DATE_FORMAT = &amp;quot;EEE, dd MMM yyyy HH:mm:ss zzz&amp;quot;;

	private static final TimeZone GMT = TimeZone.getTimeZone(&amp;quot;GMT&amp;quot;);


	//---------------------------------------------------------------------
	// ServletResponse properties
	//---------------------------------------------------------------------

	private boolean outputStreamAccessAllowed = true;

	private boolean writerAccessAllowed = true;

	@Nullable
	private String characterEncoding = WebUtils.DEFAULT_CHARACTER_ENCODING;
	
    // public static final String DEFAULT_CHARACTER_ENCODING = &amp;quot;ISO-8859-1&amp;quot;;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;a href=&quot;https://qastack.kr/programming/58525387/mockmvc-no-longer-handles-utf-8-characters-with-spring-boot-2-2-0-release&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://qastack.kr/programming/58525387/mockmvc-no-longer-handles-utf-8-characters-with-spring-boot-2-2-0-release&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;mockmvcsecurityautoconfiguration-제거&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#mockmvcsecurityautoconfiguration-%EC%A0%9C%EA%B1%B0&quot; aria-label=&quot;mockmvcsecurityautoconfiguration 제거 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;MockMvcSecurityAutoConfiguration 제거&lt;/h2&gt;
&lt;p&gt;아래 2.1.x에 있던 &lt;code class=&quot;language-text&quot;&gt;MockMvcSecurityAutoConfiguration&lt;/code&gt;가 제거되었음&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/spring-projects/spring-boot/blob/2.1.x/spring-boot-project/spring-boot-test-autoconfigure/src/main/java/org/springframework/boot/test/autoconfigure/web/servlet/MockMvcSecurityAutoConfiguration.java&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://github.com/spring-projects/spring-boot/blob/2.1.x/spring-boot-project/spring-boot-test-autoconfigure/src/main/java/org/springframework/boot/test/autoconfigure/web/servlet/MockMvcSecurityAutoConfiguration.java&lt;/a&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;java&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;@Configuration
@ConditionalOnProperty(prefix=&amp;quot;spring.test.mockmvc&amp;quot;,
                       name=&amp;quot;secure&amp;quot;,
                       havingValue=&amp;quot;true&amp;quot;,
                       matchIfMissing=true)
@Import(value={SecurityAutoConfiguration.class,UserDetailsServiceAutoConfiguration.class,org.springframework.boot.test.autoconfigure.web.servlet.MockMvcSecurityConfiguration.class})
public class MockMvcSecurityAutoConfiguration {}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위 AutoConfiguration이 제거되면서 테스트 일부가 영향을 받았다.&lt;/p&gt;
&lt;p&gt;위 &lt;code class=&quot;language-text&quot;&gt;MockMvcSecurityAutoConfiguration&lt;/code&gt;이 제거되고 아래와 같이 변경되었다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/16ddd6bdd7723e3cff39b3a61a88585a/7388e/spring-boot-test-autoconfigure-spring-factories.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 24.583333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAAA70lEQVQY03XPyU7DMBAG4DwLFXDi1KrlQBYatXESx3uWJqmDkOD93+DHmariAodP/3gZaxydGIPsejRSgTcC2loY10IZC6kNhNIhNdXaOlqvd1f3uuIcXAgSySrDNDl8fy349G3Q4XpRmHoBP2osk8E8iEBS7UdD572t0JmS6CYPjpRRzTLULIWzEt7P8HOLvhUwioGd41+nm/Kc3BQpqjt6I6OMNrsUD9sYj/sEmXJ4Ky3iyiLlLV7iIuy/4/k1J0+HIza7BGvPf6K6zCDqHM41+FgG+PD91RImvYYcB415tFRPFxMmL9CE+2sf/8MPDZ67JmIWpy0AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/16ddd6bdd7723e3cff39b3a61a88585a/8ac56/spring-boot-test-autoconfigure-spring-factories.webp 240w,
/static/16ddd6bdd7723e3cff39b3a61a88585a/d3be9/spring-boot-test-autoconfigure-spring-factories.webp 480w,
/static/16ddd6bdd7723e3cff39b3a61a88585a/e46b2/spring-boot-test-autoconfigure-spring-factories.webp 960w,
/static/16ddd6bdd7723e3cff39b3a61a88585a/ff749/spring-boot-test-autoconfigure-spring-factories.webp 1104w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/16ddd6bdd7723e3cff39b3a61a88585a/8ff5a/spring-boot-test-autoconfigure-spring-factories.png 240w,
/static/16ddd6bdd7723e3cff39b3a61a88585a/e85cb/spring-boot-test-autoconfigure-spring-factories.png 480w,
/static/16ddd6bdd7723e3cff39b3a61a88585a/d9199/spring-boot-test-autoconfigure-spring-factories.png 960w,
/static/16ddd6bdd7723e3cff39b3a61a88585a/7388e/spring-boot-test-autoconfigure-spring-factories.png 1104w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/16ddd6bdd7723e3cff39b3a61a88585a/d9199/spring-boot-test-autoconfigure-spring-factories.png&quot;
          alt=&quot;autoconfigure&quot;
          title=&quot;autoconfigure&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;# AutoConfigureMockMvc auto-configuration imports
org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc=\
org.springframework.boot.test.autoconfigure.web.servlet.MockMvcAutoConfiguration,\
org.springframework.boot.test.autoconfigure.web.servlet.MockMvcWebClientAutoConfiguration,\
org.springframework.boot.test.autoconfigure.web.servlet.MockMvcWebDriverAutoConfiguration,\
org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration,\
org.springframework.boot.autoconfigure.security.servlet.SecurityFilterAutoConfiguration,\
org.springframework.boot.autoconfigure.security.servlet.UserDetailsServiceAutoConfiguration,\
org.springframework.boot.test.autoconfigure.web.servlet.MockMvcSecurityConfiguration&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;antpathmatcher-우선순위-변경-관련-이슈&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#antpathmatcher-%EC%9A%B0%EC%84%A0%EC%88%9C%EC%9C%84-%EB%B3%80%EA%B2%BD-%EA%B4%80%EB%A0%A8-%EC%9D%B4%EC%8A%88&quot; aria-label=&quot;antpathmatcher 우선순위 변경 관련 이슈 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;AntPathMatcher 우선순위 변경 관련 이슈&lt;/h2&gt;
&lt;p&gt;우선순위를 정하는 &lt;code class=&quot;language-text&quot;&gt;compare&lt;/code&gt; 로직에 아래 코드가 추가되었다.&lt;/p&gt;
&lt;p&gt;기존 &lt;code class=&quot;language-text&quot;&gt;AntPathMatcher&lt;/code&gt;를 활용하던 프로젝트라면 원하던 대로 기존 로직들이 동작하는지 체크해보아야 할 것 같다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;java&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt; if (info1.isPrefixPattern() &amp;amp;&amp;amp; info2.isPrefixPattern()) {
        return info2.getLength() - info1.getLength();
 }&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/spring-projects/spring-framework/blob/5.2.x/spring-core/src/main/java/org/springframework/util/AntPathMatcher.java#L782&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://github.com/spring-projects/spring-framework/blob/5.2.x/spring-core/src/main/java/org/springframework/util/AntPathMatcher.java#L782&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;tomcat-메트릭-노출-이슈&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#tomcat-%EB%A9%94%ED%8A%B8%EB%A6%AD-%EB%85%B8%EC%B6%9C-%EC%9D%B4%EC%8A%88&quot; aria-label=&quot;tomcat 메트릭 노출 이슈 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Tomcat 메트릭 노출 이슈&lt;/h2&gt;
&lt;p&gt;2.2.x로 마이그레이션을 진행한 이후 아래와 같은 톰캣 메트릭들이 노출되지 않았다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;tomcat_threads_busy_threads&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;아래 설정을 추가해 해결할 수 있다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;yaml&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;server:
  tomcat:
    mbeanregistry:
      enabled: true&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;릴리즈 노트를 잘 읽자.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.2-Release-Notes#tomcats-mbean-registry&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Spring Boot 2.2 릴리즈 노트 Tomcat’s MBean Registry&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Tomcat’s MBean Registry is now disabled by default, saving approximately 2MB of heap.
If you want to use Tomcat’s MBeans, for example so that they can be used to expose metrics via Micrometer, set the server.tomcat.mbeanregistry.enabled to true.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;redis-cluster-사용-시-redisreactivehealthindicator-이슈&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#redis-cluster-%EC%82%AC%EC%9A%A9-%EC%8B%9C-redisreactivehealthindicator-%EC%9D%B4%EC%8A%88&quot; aria-label=&quot;redis cluster 사용 시 redisreactivehealthindicator 이슈 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Redis cluster 사용 시 RedisReactiveHealthIndicator 이슈&lt;/h2&gt;
&lt;p&gt;2.2.x로 올리고 첫 배포를 진행할 때 레디스 클러스터를 사용중인 모듈의 헬스체크가 제대로 되지 않는 문제가 발생했는데 아래와 같은 이슈가 있었다.&lt;/p&gt;
&lt;p&gt;이후에는 모든 인프라에 대해 헬스체크에 영향을 주지 않도록 변경했다.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/spring-projects/spring-boot/issues/21514&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://github.com/spring-projects/spring-boot/issues/21514&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Spring Cloud Function을 이용한 Kafka Client 구성하기]]></title><description><![CDATA[Spring Cloud Function을 이용해 Spring에서 Kafka Producer, Consumer, Streams 코드를 작성하는 방법 정리]]></description><link>https://kyucumber.github.io/posts/spring/spring-cloud-function-kafka/</link><guid isPermaLink="false">https://kyucumber.github.io/posts/spring/spring-cloud-function-kafka/</guid><pubDate>Sat, 03 Oct 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://github.com/spring-cloud/spring-cloud-function&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Spring Cloud Function&lt;/a&gt;은 spring-cloud 하위의 프로젝트입니다.
Spring Cloud Function을 이용하면 사용자가 정의한 &lt;code class=&quot;language-text&quot;&gt;Supplier&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;Consumer&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;Function&lt;/code&gt;등의 인터페이스를 &lt;strong&gt;FunctionCatalog&lt;/strong&gt;가 읽어 Consume, Produce 등을 수행하는 표준 표현으로 변환하는 기능을 사용할 수 있습니다.&lt;/p&gt;
&lt;p&gt;Spring Cloud Function에서는 Java 8 부터 사용할 수 있는 3가지 코어 Function(&lt;code class=&quot;language-text&quot;&gt;Supplier&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Function&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Consumer&lt;/code&gt;) interface들을 지원합니다.
각각의 인터페이스를 이용해 Kafka Producer, Consumer, Streams를 구성한 코드를 정리했습니다. &lt;/p&gt;
&lt;h2 id=&quot;supplier-interface를-이용한-kafka-producer-구성하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#supplier-interface%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-kafka-producer-%EA%B5%AC%EC%84%B1%ED%95%98%EA%B8%B0&quot; aria-label=&quot;supplier interface를 이용한 kafka producer 구성하기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Supplier interface를 이용한 Kafka Producer 구성하기&lt;/h2&gt;
&lt;p&gt;Supplier interface를 통해 Kafka Producer를 구성할 수 있습니다. 아래와 같은 의존성 및 properties가 정의되어야 합니다.
Producer의 경우 Non Reactive 혹은 Reactive 방식으로 구성할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;build.gradle.kts&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;implementation(&amp;quot;org.springframework.cloud:spring-cloud-function-kotlin&amp;quot;)
implementation(&amp;quot;org.springframework.cloud:spring-cloud-stream-binder-kafka&amp;quot;)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;a href=&quot;https://cloud.spring.io/spring-cloud-stream-binder-kafka/spring-cloud-stream-binder-kafka.html#_kafka_binder_properties&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Kafka Binder Properties&lt;/a&gt;, &lt;a href=&quot;https://cloud.spring.io/spring-cloud-stream-binder-kafka/spring-cloud-stream-binder-kafka.html#kafka-producer-properties&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Kafka Producer Properties&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;application.yml&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;yaml&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;spring:
  profiles: local
  cloud:
    function:
      definition: kotlinSupplier; # 함수 이름, 여러개인 경우 kotlinSupplier,kotlinConsumer; 이런 식으로 정의
    stream:
      bindings:
        kotlinSupplier-out-0:
          destination: backoffice-auth.local.logging.access-info.json #
      kafka:
        binder:
          brokers: localhost
          defaultBrokerPort: 9092
          configuration:
            acks: all
        bindings:
          kotlinSupplier-out-0:
            producer: # producer 세부 설정, 별도로 설정할 부분이 없어 생략&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 id=&quot;non-reactive-producer&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#non-reactive-producer&quot; aria-label=&quot;non reactive producer permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Non Reactive Producer&lt;/h3&gt;
&lt;p&gt;Non Reactive 방식의 Producer를 정의하기 위해서 아래와 같이 설정할 수 있습니다.
아래와 같이 설정하는 경우 &lt;a href=&quot;https://github.com/spring-cloud/spring-cloud-stream/blob/master/spring-cloud-stream/src/main/java/org/springframework/cloud/stream/config/DefaultPollerProperties.java&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;default poller&lt;/a&gt; 에 의해서 polling 방식(Non Reactive)을 통해 producing을 진행합니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ProducerConfig&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;@Configuration
class ProducerConfig {
    @Bean
    fun kotlinSupplier() = Supplier&amp;lt;String&amp;gt; {
        &amp;quot;produce test&amp;quot;
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;아래와 같이 Polling 방식으로 producing이 진행되는것을 확인할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/dad2c90af96c4112cff042300d1c93ce/555cf/spring-cloud-function-supplier.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 22.083333333333332%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAYUlEQVQY06XNSw7DIBAEUe5/zmwsjBkYPsaIqci+gZOS3rLVLqROKgNVRZJggJn95M59tsS2Z0LY8d7TWqPW+sq9iTESjgPn5UR0UEoha2bZYq335pwPJ3qhbdJ7f57+7QvcJDm7xSnvJwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/dad2c90af96c4112cff042300d1c93ce/8ac56/spring-cloud-function-supplier.webp 240w,
/static/dad2c90af96c4112cff042300d1c93ce/d3be9/spring-cloud-function-supplier.webp 480w,
/static/dad2c90af96c4112cff042300d1c93ce/e46b2/spring-cloud-function-supplier.webp 960w,
/static/dad2c90af96c4112cff042300d1c93ce/f992d/spring-cloud-function-supplier.webp 1440w,
/static/dad2c90af96c4112cff042300d1c93ce/882b9/spring-cloud-function-supplier.webp 1920w,
/static/dad2c90af96c4112cff042300d1c93ce/9ddbc/spring-cloud-function-supplier.webp 1960w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/dad2c90af96c4112cff042300d1c93ce/8ff5a/spring-cloud-function-supplier.png 240w,
/static/dad2c90af96c4112cff042300d1c93ce/e85cb/spring-cloud-function-supplier.png 480w,
/static/dad2c90af96c4112cff042300d1c93ce/d9199/spring-cloud-function-supplier.png 960w,
/static/dad2c90af96c4112cff042300d1c93ce/07a9c/spring-cloud-function-supplier.png 1440w,
/static/dad2c90af96c4112cff042300d1c93ce/29114/spring-cloud-function-supplier.png 1920w,
/static/dad2c90af96c4112cff042300d1c93ce/555cf/spring-cloud-function-supplier.png 1960w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/dad2c90af96c4112cff042300d1c93ce/d9199/spring-cloud-function-supplier.png&quot;
          alt=&quot;nonreactivesupplier&quot;
          title=&quot;nonreactivesupplier&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&quot;reactive-producer&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reactive-producer&quot; aria-label=&quot;reactive producer permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reactive Producer&lt;/h3&gt;
&lt;p&gt;Reactive 방식의 Producer를 정의하기 위해서 아래와 같이 구성할 수 있습니다.
예제 코드에서는 기본 구현체 중 하나인 &lt;code class=&quot;language-text&quot;&gt;EmitterProcessor&lt;/code&gt;를 이용했습니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ProducerConfig&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;@Configuration
class ProducerConfig {
    @Bean
    fun processor(): EmitterProcessor&amp;lt;String&amp;gt; =
        EmitterProcessor.create&amp;lt;String&amp;gt;()

    @Bean
    fun processorSink(processor: EmitterProcessor&amp;lt;String&amp;gt;): FluxSink&amp;lt;String&amp;gt; {
        return processor.sink(FluxSink.OverflowStrategy.DROP)
    }

    @Bean
    fun kotlinSupplier(processor: EmitterProcessor&amp;lt;String&amp;gt;) = Supplier&amp;lt;Flux&amp;lt;String&amp;gt;&amp;gt; {
        processor
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ProduceTestController&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;@RestController
@RequestMapping(&amp;quot;/api/v1&amp;quot;)
class ProduceTestController(
    private val processorSink: FluxSink&amp;lt;String&amp;gt;
) {
    @GetMapping
    fun produce() {
        this.processorSink.next(UUID.randomUUID().toString())
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위와 같이 코드를 정의하고, 해당 &lt;code class=&quot;language-text&quot;&gt;/api/v1&lt;/code&gt; 경로로 GET 요청을 보내면 아래와 같이 producing이 진행됩니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2ba2991ce4f5a5049bc8316c86b3bae6/555cf/spring-cloud-function-reactive-supplier.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 22.083333333333332%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAWklEQVQY06WPWwqAIBQF2/8yIwIr7XbTfIFTLiE8MJy/gZnOO3FqZnOBebVohFwb0Git/79NTgvHVTAushhFAsQyIJS7Cyu7JIz1yANpRHj5gnS+VmMVn8aSXzfLO4v0BUOHAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/2ba2991ce4f5a5049bc8316c86b3bae6/8ac56/spring-cloud-function-reactive-supplier.webp 240w,
/static/2ba2991ce4f5a5049bc8316c86b3bae6/d3be9/spring-cloud-function-reactive-supplier.webp 480w,
/static/2ba2991ce4f5a5049bc8316c86b3bae6/e46b2/spring-cloud-function-reactive-supplier.webp 960w,
/static/2ba2991ce4f5a5049bc8316c86b3bae6/f992d/spring-cloud-function-reactive-supplier.webp 1440w,
/static/2ba2991ce4f5a5049bc8316c86b3bae6/882b9/spring-cloud-function-reactive-supplier.webp 1920w,
/static/2ba2991ce4f5a5049bc8316c86b3bae6/9ddbc/spring-cloud-function-reactive-supplier.webp 1960w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/2ba2991ce4f5a5049bc8316c86b3bae6/8ff5a/spring-cloud-function-reactive-supplier.png 240w,
/static/2ba2991ce4f5a5049bc8316c86b3bae6/e85cb/spring-cloud-function-reactive-supplier.png 480w,
/static/2ba2991ce4f5a5049bc8316c86b3bae6/d9199/spring-cloud-function-reactive-supplier.png 960w,
/static/2ba2991ce4f5a5049bc8316c86b3bae6/07a9c/spring-cloud-function-reactive-supplier.png 1440w,
/static/2ba2991ce4f5a5049bc8316c86b3bae6/29114/spring-cloud-function-reactive-supplier.png 1920w,
/static/2ba2991ce4f5a5049bc8316c86b3bae6/555cf/spring-cloud-function-reactive-supplier.png 1960w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/2ba2991ce4f5a5049bc8316c86b3bae6/d9199/spring-cloud-function-reactive-supplier.png&quot;
          alt=&quot;nonreactivesupplier&quot;
          title=&quot;nonreactivesupplier&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;consumer-interface를-통해-kafka-consumer-구성하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#consumer-interface%EB%A5%BC-%ED%86%B5%ED%95%B4-kafka-consumer-%EA%B5%AC%EC%84%B1%ED%95%98%EA%B8%B0&quot; aria-label=&quot;consumer interface를 통해 kafka consumer 구성하기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Consumer interface를 통해 Kafka Consumer 구성하기&lt;/h2&gt;
&lt;p&gt;Consumer interface를 통해 Kafka Consumer를 구성할 수 있습니다.
아래와 같은 의존성 및 설정이 정의되어야 합니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;build.gradle.kts&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;implementation(&amp;quot;org.springframework.cloud:spring-cloud-function-kotlin&amp;quot;)
implementation(&amp;quot;org.springframework.cloud:spring-cloud-stream-binder-kafka&amp;quot;)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;a href=&quot;https://cloud.spring.io/spring-cloud-stream-binder-kafka/spring-cloud-stream-binder-kafka.html#_kafka_binder_properties&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Kafka Binder Properties&lt;/a&gt;, &lt;a href=&quot;https://cloud.spring.io/spring-cloud-stream-binder-kafka/spring-cloud-stream-binder-kafka.html#kafka-consumer-properties&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Kafka Consumer Properties&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;application.yml&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;yaml&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;spring:
  profiles: local
  cloud:
    function:
      definition: kotlinConsumer;
    stream:
      kafka:
        binder:
          brokers: localhost
          defaultBrokerPort: 9092
          configuration:
            acks: all
        bindings:
          kotlinConsumer-in-0:
            startOffset: earliest
      bindings:
        kotlinConsumer-in-0:
          group: kotlin-consumer # consumer group id
          destination: topic # consume topic name&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ConsumerConfig&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;@Configuration
class ConsumerConfig {
    @Bean
    fun kotlinConsumer() = Consumer&amp;lt;String&amp;gt; {
        println(it)
    }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;function-interface를-이용해-kafka-streams-구성하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#function-interface%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%B4-kafka-streams-%EA%B5%AC%EC%84%B1%ED%95%98%EA%B8%B0&quot; aria-label=&quot;function interface를 이용해 kafka streams 구성하기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Function interface를 이용해 Kafka Streams 구성하기&lt;/h2&gt;
&lt;p&gt;Function interface를 통해 Kafka Streams API를 구현할 수 있습니다. 아래와 같은 의존성 및 설정이 정의되어야 합니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;build.gradle.kts&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;dependencies {
    implementation(&amp;quot;org.springframework.cloud:spring-cloud-stream&amp;quot;)
    implementation(&amp;quot;org.springframework.cloud:spring-cloud-stream-binder-kafka-streams&amp;quot;)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;a href=&quot;https://cloud.spring.io/spring-cloud-stream-binder-kafka/spring-cloud-stream-binder-kafka.html#_kafka_streams_properties&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Kafka Streams Properties&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;application.yml&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;yaml&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;spring:
  profiles: local
  cloud:
    function:
      definition: fullAuthAccessLogProcessor;
    stream:
      kafka:
        streams:
          binder:
            brokers: localhost:9092
            configuration:
              acks: all
          bindings:
            fullAuthAccessLogProcessor-in-0:
              consumer:
                applicationId: access-info-log-processor
      bindings:
        fullAuthAccessLogProcessor-in-0:
          destination: backoffice-auth.local.logging.access-info.json
        fullAuthAccessLogProcessor-out-0:
          destination: backoffice-auth.local.logging.full-access-info.json&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;StreamsConfig&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;@Configuration
class StreamsConfig {
    @Bean
    fun fullAuthAccessLogProcessor(fullAuthAccessInfoMapper: FullAuthAccessInfoMapper) =
        Function&amp;lt;KStream&amp;lt;String, AuthAccessInfoSchema&amp;gt;, KStream&amp;lt;String, FullAuthAccessInfoSchema&amp;gt;&amp;gt; {
            it.mapValues { value -&amp;gt; fullAuthAccessInfoMapper.map(value) }
        }

    @Bean
    fun fullAuthAccessInfoSchemaSerde(objectMapper: ObjectMapper): Serde&amp;lt;FullAuthAccessInfoSchema&amp;gt; =
        JsonSerde(FullAuthAccessInfoSchema::class.java, objectMapper)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;additional-options&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#additional-options&quot; aria-label=&quot;additional options permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Additional Options&lt;/h2&gt;
&lt;p&gt;Spring Cloud Function에서는 여러 함수 설정, Composition, Kotlin lambda support 등의 추가적인 기능을 제공합니다.&lt;/p&gt;
&lt;h3 id=&quot;multiple-functions-binding&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#multiple-functions-binding&quot; aria-label=&quot;multiple functions binding permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Multiple Functions Binding&lt;/h3&gt;
&lt;p&gt;여러 Function들이 정의되는 경우 아래와 같이 definition을 통해 여러 함수를 지정해주어야 동작합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;yaml&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;---
spring:
  profiles: local
  cloud:
    function:
      definition: kotlinSupplier|kotlinConsumer;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3 id=&quot;declarative-function-composition&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#declarative-function-composition&quot; aria-label=&quot;declarative function composition permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Declarative Function Composition&lt;/h3&gt;
&lt;p&gt;여러 Function들의 Composition 기능도 제공합니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;|&lt;/code&gt;를 통해 Composition을 표현할 수 있습니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;yaml&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;spring:
  profiles: local
  cloud:
    function:
      definition: uppercase|reverse&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/spring-cloud/spring-cloud-stream-samples/blob/master/multi-functions-samples/function-composition-kafka/src/main/java/demo/FunctionCompositionDemoApplication.java&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Function Composition Example&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;kotlin-lambda-support&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#kotlin-lambda-support&quot; aria-label=&quot;kotlin lambda support permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Kotlin Lambda support&lt;/h3&gt;
&lt;p&gt;Kotlin lambda를 이용해 Functon, Supplier, Consumer를 구성하려는 경우 아래 의존성을 추가해야 합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;@Bean
open fun kotlinSupplier(): () -&amp;gt; String {
    return  { &amp;quot;Hello from Kotlin&amp;quot; }
}

@Bean
open fun kotlinFunction(): (String) -&amp;gt; String {
    return  { it.toUpperCase() }
}

@Bean
open fun kotlinConsumer(): (String) -&amp;gt; Unit {
    return  { println(it) }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;build.gradle.kts&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;kotlin&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;dependencies {
    implementation(&amp;quot;org.springframework.cloud:spring-cloud-function-kotlin&amp;quot;)
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/spring-cloud/spring-cloud-stream-binder-kafka/issues/795&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;현재 작성된 버전 기준으로는 Kafka Streams에 대해서는 lambda support가 지원되지 않습니다.&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://cloud.spring.io/spring-cloud-stream-binder-kafka/spring-cloud-stream-binder-kafka.html&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://cloud.spring.io/spring-cloud-stream-binder-kafka/spring-cloud-stream-binder-kafka.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/spring-cloud/spring-cloud-stream-samples/tree/master/multi-functions-samples/function-composition-kafka&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://github.com/spring-cloud/spring-cloud-stream-samples/tree/master/multi-functions-samples/function-composition-kafka&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Gatsby로 블로그 만들기]]></title><description><![CDATA[Gatsby Starter를 통해 블로그를 생성하는 법을 정리합니다.]]></description><link>https://kyucumber.github.io/posts/gatsby/create-gatsby-blog/</link><guid isPermaLink="false">https://kyucumber.github.io/posts/gatsby/create-gatsby-blog/</guid><pubDate>Wed, 30 Sep 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;기존에 Jekyll이나 Hexo같은 블로그 프레임워크 대신 React로 구성되어 있는 &lt;a href=&quot;https://www.gatsbyjs.com/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;gatsby&lt;/a&gt;를 이용하여 정적 블로그를 구성해봤는데 평소 개발하던 스택과 비슷해서 커스터마이징도 쉽고 설치 및 사용도 편리한 것 같습니다.&lt;/p&gt;
&lt;h2 id=&quot;installation&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#installation&quot; aria-label=&quot;installation permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Installation&lt;/h2&gt;
&lt;p&gt;node, npm, xCode나 git 등은 기본적으로 설치되어 있다고 가정하고, gatsby-cli를 설치합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;$ npm install -g gatsby-cli&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;gatsby-블로그-생성하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#gatsby-%EB%B8%94%EB%A1%9C%EA%B7%B8-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0&quot; aria-label=&quot;gatsby 블로그 생성하기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Gatsby 블로그 생성하기&lt;/h2&gt;
&lt;p&gt;여러 starter들을 이용해 기본적인 테마를 가진 Gatsby 블로그를 생성할 수 있습니다.&lt;/p&gt;
&lt;p&gt;Hexo나 Jekyll에 있는 Theme랑 동일한데 Gatsby에서는 Starter라는 이름으로 제공하는 것 같습니다.&lt;/p&gt;
&lt;p&gt;아무것도 없는 기본 starter를 이용해 gatsby 블로그를 생성하는 경우 아래와 같이 진행할 수 있어요.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;$ gatsby new hello-world https://github.com/gatsbyjs/gatsby-starter-hello-world&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;Gatsby의 Starter들은 아래 링크에서 확인할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.gatsbyjs.com/starters/gatsbyjs/gatsby-starter-default&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Gatsby Starter&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;저는 아래 링크의 gatsby-starter-lumen을 이용해 전체적인 틀을 구성하고, css나 구성을 조금씩 변경해서 사용하고 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.gatsbyjs.com/starters/alxshelepenok/gatsby-starter-lumen&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;gatsby-starter-lumen&lt;/a&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;$ gatsby new my-gatsby-project https://github.com/alxshelepenok/gatsby-starter-lumen
$ cd my-gatsby-project
$ gatsby develop&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;순서대로 실행하고 localhost:8080으로 접속하면 아래와 같은 화면이 표시됩니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/22fb169a44c46c428f2ace7aba50eded/8079d/lumen-starter.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 47.08333333333333%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABP0lEQVQoz5VRW3KDMAzk/ofpBXqJ/mcIYAgkgME8HF6BrVcZUvr4qWYWCdsjrXY9azQKdQJj27YXGG3boiw1Rttg6SvM04hlWTDPk8Ms2N/u4VVpiI/3t1fDY87zHL7vI4kVAv8EpSKkaYowDHE+nxEEAbquk/ePx0OyZ61FXhRY1xXbgSXD1DUulwviOIGKY6mTJJFBt9tNcpZluF6v8k/20rCqKpnEuu97mcawdoAxDVp3RxhjcL/fZTjBd3sthMhwmp568HLHk+GGcXarrLs637X6K6QhGVH8nxcMXZaik84z6CxEWeRomsYZVaJ2cmitpWYmczGFzbj/0ZBXQ/eQBlC/IIzEoCiKnmdKSb2bQ7O4nccP1x7H8ZfLxtSiG7Xt3GDqTAJHkBnPCTFlGAYxhStQ2K+GG4aJYuNf8QnCtLdgv/rihAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/22fb169a44c46c428f2ace7aba50eded/8ac56/lumen-starter.webp 240w,
/static/22fb169a44c46c428f2ace7aba50eded/d3be9/lumen-starter.webp 480w,
/static/22fb169a44c46c428f2ace7aba50eded/e46b2/lumen-starter.webp 960w,
/static/22fb169a44c46c428f2ace7aba50eded/f992d/lumen-starter.webp 1440w,
/static/22fb169a44c46c428f2ace7aba50eded/882b9/lumen-starter.webp 1920w,
/static/22fb169a44c46c428f2ace7aba50eded/92e50/lumen-starter.webp 2100w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/22fb169a44c46c428f2ace7aba50eded/8ff5a/lumen-starter.png 240w,
/static/22fb169a44c46c428f2ace7aba50eded/e85cb/lumen-starter.png 480w,
/static/22fb169a44c46c428f2ace7aba50eded/d9199/lumen-starter.png 960w,
/static/22fb169a44c46c428f2ace7aba50eded/07a9c/lumen-starter.png 1440w,
/static/22fb169a44c46c428f2ace7aba50eded/29114/lumen-starter.png 1920w,
/static/22fb169a44c46c428f2ace7aba50eded/8079d/lumen-starter.png 2100w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/22fb169a44c46c428f2ace7aba50eded/d9199/lumen-starter.png&quot;
          alt=&quot;gatsby-lumen&quot;
          title=&quot;gatsby-lumen&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;css나 구성을 변경하고 싶으시면 직접 커스터마이징을 진행하시면 됩니다.&lt;/p&gt;
&lt;h2 id=&quot;gatsby-플러그인-적용하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#gatsby-%ED%94%8C%EB%9F%AC%EA%B7%B8%EC%9D%B8-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0&quot; aria-label=&quot;gatsby 플러그인 적용하기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Gatsby 플러그인 적용하기&lt;/h2&gt;
&lt;p&gt;lumen starter의 경우 코드 블럭 모양이 노란색이고 예쁘지 않은것 같아서 아래 플러그인을 추가로 적용했습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;gatsby-remark-highlight-code&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;위 플러그인을 적용하면 코드 블럭의 모양이 아래와 같은 모양으로 변경됩니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ecb6df9751274aa7b1172d1da29ff793/9b1e2/screenshot-carbon.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 20.416666666666668%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA0klEQVQY03XOzYqCYBSAYe8iBqaCCBXLrBkpG6dAJmg1t5kZOS1s0U3kTzQ/9xDOxhaFwjufuBtq8fBy4HA40vVyZRsELFZr3KWP6/lVS67PUsye93HfasPCXRNsd+R5jnQ6pczGEzTNQG49o7YHKIqBovZQNJNmq89jQxM6N9WbXWoPMubQIcsypDT9xbbnDAc2o5GDZb7yZE3ovwjWFN2w6ejWXd3eGFk1cd7excEzUvnm8fjJPoyJooRQKBuFlTgWkoPooeo/iVDuf33/UBQFf5cVyj3kDEUiAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/ecb6df9751274aa7b1172d1da29ff793/8ac56/screenshot-carbon.webp 240w,
/static/ecb6df9751274aa7b1172d1da29ff793/d3be9/screenshot-carbon.webp 480w,
/static/ecb6df9751274aa7b1172d1da29ff793/e46b2/screenshot-carbon.webp 960w,
/static/ecb6df9751274aa7b1172d1da29ff793/f992d/screenshot-carbon.webp 1440w,
/static/ecb6df9751274aa7b1172d1da29ff793/17f0a/screenshot-carbon.webp 1880w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/ecb6df9751274aa7b1172d1da29ff793/8ff5a/screenshot-carbon.png 240w,
/static/ecb6df9751274aa7b1172d1da29ff793/e85cb/screenshot-carbon.png 480w,
/static/ecb6df9751274aa7b1172d1da29ff793/d9199/screenshot-carbon.png 960w,
/static/ecb6df9751274aa7b1172d1da29ff793/07a9c/screenshot-carbon.png 1440w,
/static/ecb6df9751274aa7b1172d1da29ff793/9b1e2/screenshot-carbon.png 1880w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/ecb6df9751274aa7b1172d1da29ff793/d9199/screenshot-carbon.png&quot;
          alt=&quot;gatsby carbon&quot;
          title=&quot;gatsby carbon&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;적용 전 설치를 위해 루트 디렉토리에서 아래 명령어를 실행합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;$ npm install --save gatsby-transformer-remark gatsby-remark-highlight-code @deckdeckgo/highlight-code&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;이후 아래 설정 파일에 플러그인 설정을 추가합니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;gatsby-config.js&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;plugins: [
  {
    resolve: `gatsby-transformer-remark`,
    options: {
      plugins: [
        {
          resolve: `gatsby-remark-highlight-code`
        },
      ],
    },
  },
]&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;추가로 load를 위해 코드 내에 아래 내용을 추가합니다.&lt;/p&gt;
&lt;p&gt;저는 사용하는 테마에 맞춰 아래 파일에 추가했습니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;src/components/Layout/Layout.js&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;// @flow strict
import React from &amp;#39;react&amp;#39;;
import { defineCustomElements as deckDeckGoHighlightElement } from &amp;#39;@deckdeckgo/highlight-code/dist/loader&amp;#39;;

const Layout = ({}: Props) =&amp;gt; {

  deckDeckGoHighlightElement();
  return ();
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;google-analytics&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#google-analytics&quot; aria-label=&quot;google analytics permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Google Analytics&lt;/h2&gt;
&lt;p&gt;lumen starter의 경우 아래 설정 변경으로 간단하게 Google Analytics의 적용이 가능합니다.&lt;/p&gt;
&lt;p&gt;아래 googleAnalyticsId에 추적 ID 값을 입력하면 등록이 끝납니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;config.js&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;module.exports = {
  url: &amp;#39;https://kyucumber.github.io&amp;#39;,
  // ...
  googleAnalyticsId: &amp;#39;@Google Analytics Id&amp;#39;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;disqus-댓글-추가하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#disqus-%EB%8C%93%EA%B8%80-%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0&quot; aria-label=&quot;disqus 댓글 추가하기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Disqus 댓글 추가하기&lt;/h2&gt;
&lt;p&gt;disqus 홈페이지에서 shortname을 복사해 config.js에 입력하면 댓글 기능을 이용할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f13e8b37c369a6aaa5a0c61f56c46389/6274f/disqus.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 41.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABnElEQVQoz12Qy04UQRSG+1V8BBWDuDGAgVZfQBMHE6MLdizAuFLXbty4xIiEi4+kIoG4YEZlerqqb3Xpms9TBaPGk3z9n1N16q+uk61tvmH95TuevHjLtXzAlRs5V1cesTrYStx9/Jx87ULvP3vNvaevyAebLD/cYPHBBkv/kc2977i+3TG33TK/47i1G1jY9Sx89FJ7bu858k+OO/uWpX3H8oFn5cCQHxpWDx2Le5abO5b5D4Jo9nlYc/Sj4WRsOf7VJb6cqT98HWqOhorvhWFUTxlWvRASo0s903/JCt0w0S2Enr7vscagywI1KSgnYypVUukS2zUEb+md+YfLOgR8IEU2Vg26MThZsc7TdJapbESCfJzv8X1I6mQ/1bJuRa11mIisR+L5bKIq2bDJXc7RGsmn01RHg6JUNE2LUgqlNVq0OD1G/xxhpLfrOtq2TcQ8K8QwmlZVia+/iaETvwtDIxdFw1Ya4+GIlfz89IROxhJj1juLrNQ1uqqp6hrvmvSHs6ZO8lJX6WlB3h9kVlFjxJH5Ps49pNnP+A1aCDRgXn4S3AAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/f13e8b37c369a6aaa5a0c61f56c46389/8ac56/disqus.webp 240w,
/static/f13e8b37c369a6aaa5a0c61f56c46389/d3be9/disqus.webp 480w,
/static/f13e8b37c369a6aaa5a0c61f56c46389/e46b2/disqus.webp 960w,
/static/f13e8b37c369a6aaa5a0c61f56c46389/f992d/disqus.webp 1440w,
/static/f13e8b37c369a6aaa5a0c61f56c46389/882b9/disqus.webp 1920w,
/static/f13e8b37c369a6aaa5a0c61f56c46389/e5490/disqus.webp 2098w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/f13e8b37c369a6aaa5a0c61f56c46389/8ff5a/disqus.png 240w,
/static/f13e8b37c369a6aaa5a0c61f56c46389/e85cb/disqus.png 480w,
/static/f13e8b37c369a6aaa5a0c61f56c46389/d9199/disqus.png 960w,
/static/f13e8b37c369a6aaa5a0c61f56c46389/07a9c/disqus.png 1440w,
/static/f13e8b37c369a6aaa5a0c61f56c46389/29114/disqus.png 1920w,
/static/f13e8b37c369a6aaa5a0c61f56c46389/6274f/disqus.png 2098w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/f13e8b37c369a6aaa5a0c61f56c46389/d9199/disqus.png&quot;
          alt=&quot;gatsby carbon&quot;
          title=&quot;gatsby carbon&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;config.js&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;module.exports = {
  url: &amp;#39;https://kyucumber.github.io&amp;#39;,
  // ...
  disqusShortname: &amp;#39;your-short-name&amp;#39;
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;github-pages를-이용해-배포하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#github-pages%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%B4-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0&quot; aria-label=&quot;github pages를 이용해 배포하기 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Github Pages를 이용해 배포하기&lt;/h2&gt;
&lt;p&gt;저는 원본 소스 코드를 저장하는 private repository와 static 정적 파일이 배포될 public repository를 별도로 구성했습니다.&lt;/p&gt;
&lt;p&gt;우선 deploy를 도와주는 gh-pages를 설치합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;$ npm install gh-pages --save-dev&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;배포를 위해 package.json을 수정합니다.&lt;/p&gt;
&lt;p&gt;저는 실제 소스 코드 repository와 정적 파일 repo가 분리되어 있어 static remote로 push하도록 설정을 변경했습니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;$ git remote -v

origin  https://github.com/kyucumber/gatsby-blog.git (fetch)
origin  https://github.com/kyucumber/gatsby-blog.git (push)

# 정적 파일이 저장될 Github pages repo
static  https://github.com/kyucumber/kyucumber.github.io.git (fetch)
static  https://github.com/kyucumber/kyucumber.github.io.git (push)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;package.json&lt;/code&gt;&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;json&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;{
  &amp;quot;scripts&amp;quot;: {
    &amp;quot;deploy&amp;quot;: &amp;quot;yarn run clean &amp;amp;&amp;amp; gatsby build --prefix-paths &amp;amp;&amp;amp; gh-pages -d public --remote static&amp;quot;
  }
}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;그리고 아래 명령어를 통해 배포를 진행합니다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;$ npm run deploy&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;위 설정으로 배포시 gh-pages 브랜치로 배포가 되기 때문에 아래 설정에서 branch를 변경해야 합니다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1742e31cf1aa4a7c5301ae2ee60449e5/49ee2/github-page.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.083333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABF0lEQVQoz52R3U7EIBCF9/1fzKzRxGxiYr3Qbtvtri0FhtL9sTDHKehq9E7Il8MMk5PAWTEzvPeYpgnj6HG+XPCfxZ97tRi2+zc0TYuyrLDfH8CREUPM/DinfoyZ633ui1ciGdKZoY4Md7rAOgtNNql1BoYMBqOSGun3eoASlpnBGvSDkjlC4CiEbPgaWzxMBe70I27VJiu9YO22WFOJG1vi3m9RxC2eYtaCKzwLRazyGbXUNVbL+9W7QXvu0EeDLuhMJMFd6dlB4wsSLBT/JRlabdHUOzjr4J0E5CQgGuEFZyipd2O6XyAfBIkgXBP5/sOlnueATg04dD2qZgdLhF7qetdCG4vpeAKNo8zNmMNCFCQgZvzeHxTmG5V+f6vAAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/1742e31cf1aa4a7c5301ae2ee60449e5/8ac56/github-page.webp 240w,
/static/1742e31cf1aa4a7c5301ae2ee60449e5/d3be9/github-page.webp 480w,
/static/1742e31cf1aa4a7c5301ae2ee60449e5/e46b2/github-page.webp 960w,
/static/1742e31cf1aa4a7c5301ae2ee60449e5/f992d/github-page.webp 1440w,
/static/1742e31cf1aa4a7c5301ae2ee60449e5/a31b9/github-page.webp 1618w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/1742e31cf1aa4a7c5301ae2ee60449e5/8ff5a/github-page.png 240w,
/static/1742e31cf1aa4a7c5301ae2ee60449e5/e85cb/github-page.png 480w,
/static/1742e31cf1aa4a7c5301ae2ee60449e5/d9199/github-page.png 960w,
/static/1742e31cf1aa4a7c5301ae2ee60449e5/07a9c/github-page.png 1440w,
/static/1742e31cf1aa4a7c5301ae2ee60449e5/49ee2/github-page.png 1618w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/1742e31cf1aa4a7c5301ae2ee60449e5/d9199/github-page.png&quot;
          alt=&quot;gatsby carbon&quot;
          title=&quot;gatsby carbon&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.gatsbyjs.com/starters/alxshelepenok/gatsby-starter-lumen&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://www.gatsbyjs.com/starters/alxshelepenok/gatsby-starter-lumen&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[ssh error unable to negotiate with IP no matching cipher found]]></title><description><![CDATA[Unbuntu EC2 ssh 접근 이슈 - ssh error: unable to negotiate with IP: no matching cipher found]]></description><link>https://kyucumber.github.io/posts/issues/unbuntu-ec2-ssh-issue/</link><guid isPermaLink="false">https://kyucumber.github.io/posts/issues/unbuntu-ec2-ssh-issue/</guid><pubDate>Mon, 01 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;unbuntu 운영체제를 가진 EC2 인스턴스에서 아래와 같은 에러 메세지와 함께 ssh 접근이 되지 않는 이슈&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;ssh error: unable to negotiate with IP: no matching cipher found&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;아래처럼 -c 옵션으로 cipher_spec을 강제로 지정해주면 접속이 가능하다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;$ ssh -c aes128-ctr -i sre-kyunam-test.pem ubuntu@0.0.0.0&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;</content:encoded></item><item><title><![CDATA[NAT Gateway - ErrorPortAllocation]]></title><description><![CDATA[NAT Gateway의 ErrorPortAllocation metric이 급증하는 케이스 파악]]></description><link>https://kyucumber.github.io/posts/issues/nat-gateway-error-port-allocation/</link><guid isPermaLink="false">https://kyucumber.github.io/posts/issues/nat-gateway-error-port-allocation/</guid><pubDate>Sat, 01 Jun 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;AWS 계정 내에서 ngrinder를 통해 성능 테스트를 진행하는 중 NAT Gateway의 Cloudwatch metric의 ErrorPortAllocation가 급증하는 이슈가 발생했다.&lt;/p&gt;
&lt;h2 id=&quot;원인&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%9B%90%EC%9D%B8&quot; aria-label=&quot;원인 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;원인&lt;/h2&gt;
&lt;p&gt;private subnet 내에 존재하는 ngrinder에서 public subnet에 존재하는 alb로 요청을 보내고 있었고 이 과정에서 NAT Gateway에 많은 요청이 몰려 최대 포트 할당 개수를 넘어 ErrorPortAllocation가 다수 발생했다.&lt;/p&gt;
&lt;h2 id=&quot;해결&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%95%B4%EA%B2%B0&quot; aria-label=&quot;해결 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;해결&lt;/h2&gt;
&lt;p&gt;트래픽이 줄면서 자연적으로 해소되었으며,
위 케이스의 경우 private -&gt; public으로 나가도록 설계된 것 자체가 잘못된 케이스인 것 같다.&lt;/p&gt;
&lt;p&gt;가급적이면 내부 망 안에서 통신할 수 있도록 구조를 잘 설계해야 할 것 같다.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.aws.amazon.com/vpc/latest/userguide/vpc-nat-gateway.html#nat-gateway-limits&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://docs.aws.amazon.com/vpc/latest/userguide/vpc-nat-gateway.html#nat-gateway-limits&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[npm build Couldn't follow symbolic link - mac os case-insensitive filesystem issue]]></title><description><![CDATA[npm build Couldn't follow symbolic link 에러 해결]]></description><link>https://kyucumber.github.io/posts/issues/npm-build-error-mac-os-case-insensitive-filesystem/</link><guid isPermaLink="false">https://kyucumber.github.io/posts/issues/npm-build-error-mac-os-case-insensitive-filesystem/</guid><pubDate>Thu, 02 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;로컬 환경(MacOS)에서 성공하는 npm build가 아래와 같은 에러를 노출하며 CI 서버(Linux)에서 빌드가 실패하는 문제 발생&lt;/p&gt;
&lt;deckgo-highlight-code   terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;ERROR in ./app/containers/~~.tsx
Module not found: Error: Can&amp;#39;t resolve &amp;#39;constants/~~~&amp;#39; in &lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;원인&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%9B%90%EC%9D%B8&quot; aria-label=&quot;원인 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;원인&lt;/h2&gt;
&lt;p&gt;Mac의 경우 case-insensitive filesystem로 설계되어 있으며 대 소문자를 구분하지 않는다.&lt;/p&gt;
&lt;p&gt;리팩토링 과정에서 대 소문자를 변경했는데 일부 변경되지 않은 부분이 남아있었고 이 때문에 CI 서버(Linux)에서 빌드할 때 오류가 발생했다.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/13617863/can-i-force-node-js-require-to-be-case-sensitive&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://stackoverflow.com/questions/13617863/can-i-force-node-js-require-to-be-case-sensitive&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;해결&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%95%B4%EA%B2%B0&quot; aria-label=&quot;해결 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;해결&lt;/h2&gt;
&lt;p&gt;import 구문 등에서 대 소문자가 제대로 입력되지 않은 부분을 찾아서 수정한다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Webpack Uncaught SyntaxError Unexpected token <]]></title><description><![CDATA[Uncaught SyntaxError: Unexpected token < 에러 해결]]></description><link>https://kyucumber.github.io/posts/issues/webpack-uncaught-syntax-error/</link><guid isPermaLink="false">https://kyucumber.github.io/posts/issues/webpack-uncaught-syntax-error/</guid><pubDate>Wed, 01 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;react-router 사용 시 2 depth 이상의 경로를 지정할 때 아래와 같은 에러가 발생하며 아무런 페이지도 렌더링되지 않는 문제가 발생했다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;Uncaught SyntaxError: Unexpected token &amp;lt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2 id=&quot;원인&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%9B%90%EC%9D%B8&quot; aria-label=&quot;원인 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;원인&lt;/h2&gt;
&lt;p&gt;Webpack 설정에 publicPath가 잡혀있지 않아서 생기는 문제였다. &lt;/p&gt;
&lt;h2 id=&quot;해결&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%95%B4%EA%B2%B0&quot; aria-label=&quot;해결 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;해결&lt;/h2&gt;
&lt;p&gt;webpack.config.js 파일에 publicPath 설정을 추가한다.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;javascript&quot;  terminal=&quot;carbon&quot; theme=&quot;dracula&quot; &gt;
          &lt;code slot=&quot;code&quot;&gt;module.exports = {
    context: sourcePath,
    entry: {
        app: &amp;#39;./main.tsx&amp;#39;
    },
    output: {
        path: outPath,
        filename: isProduction ? &amp;#39;[contenthash].js&amp;#39; : &amp;#39;[hash].js&amp;#39;,
        chunkFilename: isProduction ? &amp;#39;[name].[contenthash].js&amp;#39; : &amp;#39;[name].[hash].js&amp;#39;,
        publicPath: &amp;#39;/&amp;#39;
    }&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;</content:encoded></item><item><title><![CDATA[AWS Auto Scaling groups -  Instance failed to complete user's Lifecycle Action error]]></title><description><![CDATA[AWS Auto Scaling Group에서 인스턴스 생성이 Pending되는 이슈]]></description><link>https://kyucumber.github.io/posts/issues/aws-auto-scaling-group-pending/</link><guid isPermaLink="false">https://kyucumber.github.io/posts/issues/aws-auto-scaling-group-pending/</guid><pubDate>Mon, 01 Oct 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;AWS Auto Scaling Group에서 인스턴스가 제대로 생성되지 않고 Pending 상태로 유지되는 문제 발생&lt;/p&gt;
&lt;h2 id=&quot;원인&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%9B%90%EC%9D%B8&quot; aria-label=&quot;원인 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;원인&lt;/h2&gt;
&lt;p&gt;CodeDeploy 사용 시 Scale out 시 프로비저닝을 위해 Auto Scaling Group에 Lifecycle Hook이 설정되며
Replacement ASG로의 배포가 정상적으로 종료되면 Original ASG의 Lifecycle Hook을 제거한다.&lt;/p&gt;
&lt;p&gt;네트워크 이슈 등으로 ASG에서 Lifecycle Hook이 정상적으로 제거되지 않아 &lt;code class=&quot;language-text&quot;&gt;Instance failed to complete user&amp;#39;s Lifecycle Action&lt;/code&gt;와 같은 에러 메세지와 함께 Pending이 발생된 것 같다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/1a867/aws-auto-scaling-group-pending-history.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 14.166666666666666%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAApUlEQVQI10WM25KCMBAF+f/vQ0U05GYSrBUCkUTf2shW7T509dSZmdN4MxIq45S4SsfhPNBdDcdecTxL2m7gdNEMOiDtuFtoz6HmbSfqTtGeBNr9cH8kmq28eVa2XEhbZpoXnK+PUqG0rdZIpekvAjFIbi788b3z4b7Pc1xrx4um5MxOybxKYV0XQvBYazDGYM2vvXNM04NliTtxnonxn5TW2lH4AIcU3kZ6Tpp3AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/8ac56/aws-auto-scaling-group-pending-history.webp 240w,
/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/d3be9/aws-auto-scaling-group-pending-history.webp 480w,
/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/e46b2/aws-auto-scaling-group-pending-history.webp 960w,
/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/f992d/aws-auto-scaling-group-pending-history.webp 1440w,
/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/882b9/aws-auto-scaling-group-pending-history.webp 1920w,
/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/3c376/aws-auto-scaling-group-pending-history.webp 1998w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/8ff5a/aws-auto-scaling-group-pending-history.png 240w,
/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/e85cb/aws-auto-scaling-group-pending-history.png 480w,
/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/d9199/aws-auto-scaling-group-pending-history.png 960w,
/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/07a9c/aws-auto-scaling-group-pending-history.png 1440w,
/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/29114/aws-auto-scaling-group-pending-history.png 1920w,
/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/1a867/aws-auto-scaling-group-pending-history.png 1998w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/e0ac669e8c8fb4f23b26ebf89d7c38d6/d9199/aws-auto-scaling-group-pending-history.png&quot;
          alt=&quot;gatsby carbon&quot;
          title=&quot;gatsby carbon&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;해결&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%95%B4%EA%B2%B0&quot; aria-label=&quot;해결 permalink&quot; class=&quot;anchor-header before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;해결&lt;/h2&gt;
&lt;p&gt;아래 ASG의 Lifecycle Hook 탭에서 해당 Lifecycle Hook을 수동으로 제거하면 정상적으로 동작한다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/691611b16d87e79feea60a2d2ea88789/7f7f8/auto-scaling-group-lifecycle-hook.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 20.833333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAAApUlEQVQY02WQ2w6DIBBE+f8v9EFD4wW8g5ZUwMZph0ReJDk5m80ySxDLsmAYBvR9j2makrdtg7U2s65r6u37Ds4bY/B5Gzg74nsG8FzXlSw43LZtCmIwL5znieM4Hnjvs0OIOHz4OyDGmGAt5nlGXdegx3FMZigXKKUeNE2DqqrweklordJjyrKElBJFUUA459B1Xb6gtc6+YfjdZ815wh6Xk/tLflCELdNrzJxaAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/691611b16d87e79feea60a2d2ea88789/8ac56/auto-scaling-group-lifecycle-hook.webp 240w,
/static/691611b16d87e79feea60a2d2ea88789/d3be9/auto-scaling-group-lifecycle-hook.webp 480w,
/static/691611b16d87e79feea60a2d2ea88789/e46b2/auto-scaling-group-lifecycle-hook.webp 960w,
/static/691611b16d87e79feea60a2d2ea88789/f992d/auto-scaling-group-lifecycle-hook.webp 1440w,
/static/691611b16d87e79feea60a2d2ea88789/882b9/auto-scaling-group-lifecycle-hook.webp 1920w,
/static/691611b16d87e79feea60a2d2ea88789/e1a3b/auto-scaling-group-lifecycle-hook.webp 2396w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/691611b16d87e79feea60a2d2ea88789/8ff5a/auto-scaling-group-lifecycle-hook.png 240w,
/static/691611b16d87e79feea60a2d2ea88789/e85cb/auto-scaling-group-lifecycle-hook.png 480w,
/static/691611b16d87e79feea60a2d2ea88789/d9199/auto-scaling-group-lifecycle-hook.png 960w,
/static/691611b16d87e79feea60a2d2ea88789/07a9c/auto-scaling-group-lifecycle-hook.png 1440w,
/static/691611b16d87e79feea60a2d2ea88789/29114/auto-scaling-group-lifecycle-hook.png 1920w,
/static/691611b16d87e79feea60a2d2ea88789/7f7f8/auto-scaling-group-lifecycle-hook.png 2396w&quot;
          sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
          type=&quot;image/png&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/691611b16d87e79feea60a2d2ea88789/d9199/auto-scaling-group-lifecycle-hook.png&quot;
          alt=&quot;gatsby carbon&quot;
          title=&quot;gatsby carbon&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;CodeDeploy agent가 위의 Lifecycle Hook을 제거해주는 작업을 정상적으로 수행해주지 못한것으로 보인다.
CodeDeploy가 관리하는 ASG의 경우 Lifecycle Hook을 제거하면 Scale out 진행 시 프로비저닝이 정상적으로 동작하지 않으니 유의해서 제거하자.&lt;/p&gt;</content:encoded></item></channel></rss>